import{_ as n,c as a,a as p,o as e}from"./app-CD1YpnS1.js";const t={};function l(o,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="_1-同构" tabindex="-1"><a class="header-anchor" href="#_1-同构"><span>1. 同构</span></a></h2><ul><li>同构的项目支持客户端渲染和服务器端渲染</li><li>客户端渲染缺点 <ul><li>首屏速度加载慢</li><li>不支持SEO和搜索引擎优化</li><li>首页需要通过请求初始化数据</li></ul></li></ul><p><img src="http://img.zhufengpeixun.cn/renderflow.png" alt="renderflow"></p><h2 id="_2-next-js" tabindex="-1"><a class="header-anchor" href="#_2-next-js"><span>2.Next.js</span></a></h2><ul><li><a href="https://nextjs.org/docs" target="_blank" rel="noopener noreferrer">Next.js英文文档</a><a href="https://nextjs.frontendx.cn/docs/" target="_blank" rel="noopener noreferrer">Next.js中文文档</a> 是一个轻量级的 React 服务端渲染应用框架</li><li>默认支持服务端渲染</li><li>自动根据页面进行代码分割</li><li>基于页面的客户端路由方案</li><li>基于 Webpack 的开发环境，支持热模块替换</li><li>可以跟<code>Koa</code>或者其它<code>Node.js</code>服务器进行集成</li><li>支持 Babel 和 Webpack 的配置项定制</li><li>静态文件服务 public</li></ul><h2 id="_3-初始化" tabindex="-1"><a class="header-anchor" href="#_3-初始化"><span>3.初始化</span></a></h2><h3 id="_3-1-创建项目" tabindex="-1"><a class="header-anchor" href="#_3-1-创建项目"><span>3.1 创建项目</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir zhufengnextjs</span>
<span class="line">cd zhufengnextjs</span>
<span class="line">npm init -y</span>
<span class="line">yarn add --dev typescript react @types/react react-dom @types/node next axios</span>
<span class="line">mkdir pages</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-创建脚本" tabindex="-1"><a class="header-anchor" href="#_3-2-创建脚本"><span>3.2 创建脚本</span></a></h3><p>package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next build&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next start&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://github.com/zeit/next.js/blob/canary/.gitignore" target="_blank" rel="noopener noreferrer">https://github.com/zeit/next.js/blob/canary/.gitignore</a></p><h3 id="_3-3-访问" tabindex="-1"><a class="header-anchor" href="#_3-3-访问"><span>3.3 访问</span></a></h3><ul><li>以 ./pages作为服务端的渲染和索引的根目录</li><li><code>public</code>静态文件服务映射</li><li><code>pages</code>组件代码自动分割</li></ul><p>index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">localhost:3000</span><span class="token regex-delimiter">/</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_4-跑通路由" tabindex="-1"><a class="header-anchor" href="#_4-跑通路由"><span>4.跑通路由</span></a></h2><h3 id="_4-1-知识点" tabindex="-1"><a class="header-anchor" href="#_4-1-知识点"><span>4.1 知识点</span></a></h3><ul><li>绑定 <code>styled-jsx</code> 来生成独立作用域的 <code>CSS</code></li><li>如何支持<code>css</code></li><li>如何支持<code>antd</code>并实现按需加载</li><li>路由的使用和两种跳转路径的方法</li></ul><h3 id="_4-2-安装依赖包" tabindex="-1"><a class="header-anchor" href="#_4-2-安装依赖包"><span>4.2 安装依赖包</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">yarn add @zeit<span class="token operator">/</span>next<span class="token operator">-</span>css antd babel<span class="token operator">-</span>plugin<span class="token operator">-</span><span class="token keyword">import</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-3-babelrc" tabindex="-1"><a class="header-anchor" href="#_4-3-babelrc"><span>4.3 .babelrc</span></a></h3><p>.babelrc</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;next/babel&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;import&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string-property property">&quot;libraryName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;antd&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-next-config-js" tabindex="-1"><a class="header-anchor" href="#_4-4-next-config-js"><span>4.4 next.config.js</span></a></h3><ul><li><a href="https://github.com/zeit/next-plugins/tree/master/packages/next-css" target="_blank" rel="noopener noreferrer">next-css</a>可以让你在项目中引用CSS</li></ul><p>next.config.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> withCSS <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@zeit/next-css&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> require <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    require<span class="token punctuation">.</span>extensions<span class="token punctuation">[</span><span class="token string">&#39;.css&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">withCSS</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-pages-app-tsx" tabindex="-1"><a class="header-anchor" href="#_4-5-pages-app-tsx"><span>4.5 pages_app.tsx</span></a></h3><ul><li><code>App</code>组件来初始化页面,你可以重写它来控制页面初始化 <ul><li>当页面变化时保持页面布局</li><li>当路由变化时保持页面状态</li><li>注入额外数据到页面里</li></ul></li></ul><p>pages_app.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> App<span class="token punctuation">,</span> <span class="token punctuation">{</span> Container <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;next/app&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">&#39;next/link&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Layout<span class="token punctuation">,</span> Menu<span class="token punctuation">,</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&#39;antd/dist/antd.css&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Header<span class="token punctuation">,</span> Footer <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">LayoutApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token operator">&lt;</span>any<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token keyword">as</span> any<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> pathname <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>router<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span></span>
<span class="line">        pathname <span class="token operator">=</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>style jsx<span class="token operator">&gt;</span></span>
<span class="line">                     <span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">a{display:inline-block!important;}</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Header className<span class="token operator">=</span><span class="token string">&quot;header&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                       <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;/images/jglogo.png&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">&#39;16px 24px 16px 0px&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">float</span><span class="token operator">:</span> <span class="token string">&#39;left&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Menu theme<span class="token operator">=</span><span class="token string">&quot;dark&quot;</span> mode<span class="token operator">=</span><span class="token string">&quot;horizontal&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">lineHeight</span><span class="token operator">:</span> <span class="token string">&#39;64px&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">display</span><span class="token operator">:</span> <span class="token string">&#39;inline-block&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                            selectedKeys<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>pathname<span class="token punctuation">]</span><span class="token punctuation">}</span> </span>
<span class="line">                            defaultSelectedKeys<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>pathname<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;home&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/user&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;/user&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/user&quot;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>用户管理<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/profile&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;profile&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/profile&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>个人中心<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;login&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Header<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Footer style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">&#39;center&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span>@copyright 珠峰架构<span class="token operator">&lt;</span><span class="token operator">/</span>Footer<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Container<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>LayoutApp<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-pages-index-tsx" tabindex="-1"><a class="header-anchor" href="#_4-6-pages-index-tsx"><span>4.6 pages\\index.tsx</span></a></h3><p>pages\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Layout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Content  style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">&#39;20px auto&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">/</span>user<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-pages-user-tsx" tabindex="-1"><a class="header-anchor" href="#_4-7-pages-user-tsx"><span>4.7 pages\\user.tsx</span></a></h3><p>pages\\user.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Layout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Content  style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">&#39;20px auto&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>User<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/profile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">/</span>profile<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-8-pages-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_4-8-pages-profile-tsx"><span>4.8 pages\\profile.tsx</span></a></h3><p>pages\\profile.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Layout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Content  style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">&#39;20px auto&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Profile<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>返回<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-二级路由" tabindex="-1"><a class="header-anchor" href="#_5-二级路由"><span>5.二级路由</span></a></h2><h3 id="_5-1-知识点" tabindex="-1"><a class="header-anchor" href="#_5-1-知识点"><span>5.1 知识点</span></a></h3><ul><li>支持二级路由</li><li>实现二级布局组件</li><li>路由跳转传递参数</li><li>页面组件通过<code>getInitialProps</code>获取数据</li></ul><h3 id="_5-2-执行顺序" tabindex="-1"><a class="header-anchor" href="#_5-2-执行顺序"><span>5.2 执行顺序</span></a></h3><h4 id="_5-2-1-后台顺序" tabindex="-1"><a class="header-anchor" href="#_5-2-1-后台顺序"><span>5.2.1 后台顺序</span></a></h4><p><img src="http://img.zhufengpeixun.cn/severflow.png" alt="severflow.png"></p><h4 id="_5-2-2-前台顺序" tabindex="-1"><a class="header-anchor" href="#_5-2-2-前台顺序"><span>5.2.2 前台顺序</span></a></h4><p><img src="http://img.zhufengpeixun.cn/clientflow.png" alt="clientflow.png"></p><h3 id="_5-3-pages-app-tsx" tabindex="-1"><a class="header-anchor" href="#_5-3-pages-app-tsx"><span>5.3 pages_app.tsx</span></a></h3><p>pages_app.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import App from &#39;next/app&#39;;</span>
<span class="line">import Link from &#39;next/link&#39;;</span>
<span class="line">import { Layout, Menu, Icon } from &#39;antd&#39;;</span>
<span class="line">import &#39;antd/dist/antd.css&#39;;</span>
<span class="line">import { withRouter } from &#39;next/router&#39;;</span>
<span class="line">const { Header, Footer } = Layout;</span>
<span class="line">class LayoutApp extends App&lt;any&gt; {</span>
<span class="line">+    static async getInitialProps(params) {</span>
<span class="line">+        if (params.ctx.req) params.ctx.req = &#39;req&#39;;</span>
<span class="line">+        if (params.ctx.res) params.ctx.res = &#39;res&#39;;</span>
<span class="line">+        console.log(&#39;1.LayoutApp.getInitialProps&#39;, params);</span>
<span class="line">+        let { Component, ctx } = params;</span>
<span class="line">+        let pageProps = {};</span>
<span class="line">+        if (Component.getInitialProps)</span>
<span class="line">+            pageProps = await Component.getInitialProps(ctx);</span>
<span class="line">+        return { pageProps };</span>
<span class="line">+    }</span>
<span class="line">    render() {</span>
<span class="line">+        console.log(&#39;3.LayoutApp.render&#39;, this.props);</span>
<span class="line">        let { Component } = this.props as any;</span>
<span class="line">        let pathname = this.props.router.pathname;</span>
<span class="line">        pathname = &#39;/&#39; + (pathname.split(&#39;/&#39;)[1]);</span>
<span class="line">        return (</span>
<span class="line">            &lt;&gt;</span>
<span class="line">                &lt;style jsx&gt;</span>
<span class="line">+                    {\`a{display:inline-block!important;}\`}</span>
<span class="line">                &lt;/style&gt;</span>
<span class="line">                &lt;Layout&gt;</span>
<span class="line">                    &lt;Header className=&quot;header&quot;&gt;</span>
<span class="line">+                        &lt;img src=&quot;/images/jglogo.png&quot; style={{ width: 120, height: 31, margin: &#39;16px 24px 16px 0px&#39;, float: &#39;left&#39; }} /&gt;</span>
<span class="line">+                        &lt;Menu theme=&quot;dark&quot; mode=&quot;horizontal&quot; style={{ lineHeight: &#39;64px&#39;, display: &#39;inline-block&#39; }}</span>
<span class="line">                            selectedKeys={[pathname]}</span>
<span class="line">                            defaultSelectedKeys={[pathname]}&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;home&quot; /&gt;&lt;Link href=&quot;/&quot;&gt;&lt;a&gt;首页&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/user&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;/user&quot; /&gt; &lt;Link href=&quot;/user&quot; &gt;&lt;a&gt;用户管理&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/profile&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;profile&quot; /&gt;&lt;Link href=&quot;/profile&quot;&gt;&lt;a&gt;个人中心&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                        &lt;/Menu&gt;</span>
<span class="line">                    &lt;/Header&gt;</span>
<span class="line">+                    &lt;Component {...this.props.pageProps} /&gt;</span>
<span class="line">                    &lt;Footer style={{ textAlign: &#39;center&#39; }} &gt;@copyright 珠峰架构&lt;/Footer&gt;</span>
<span class="line">                &lt;/Layout&gt;</span>
<span class="line">            &lt;/&gt;</span>
<span class="line">        )</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default withRouter(LayoutApp);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-user-index-tsx" tabindex="-1"><a class="header-anchor" href="#_5-4-user-index-tsx"><span>5.4 user\\index.tsx</span></a></h3><p>pages\\user\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">&#39;next/link&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Layout<span class="token punctuation">,</span> Menu<span class="token punctuation">,</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Sider<span class="token punctuation">,</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">UserLayout</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>style jsx<span class="token operator">&gt;</span></span>
<span class="line">                 <span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">a{display:inline-block!important;}</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Sider<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Menu</span>
<span class="line">                        theme<span class="token operator">=</span><span class="token string">&quot;dark&quot;</span></span>
<span class="line">                        mode<span class="token operator">=</span><span class="token string">&quot;inline&quot;</span></span>
<span class="line">                        defaultSelectedKeys<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>props<span class="token punctuation">.</span>router<span class="token punctuation">.</span>pathname<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/user/list&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;user&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/user/list&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>用户列表<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/user/add&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;plus&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/user/add&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>添加用户<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Sider<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Content style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>UserLayout<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-user-list-tsx" tabindex="-1"><a class="header-anchor" href="#_5-5-user-list-tsx"><span>5.5 user\\list.tsx</span></a></h3><p>pages\\user\\list.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> UserLayout <span class="token keyword">from</span> <span class="token string">&#39;./index&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> List <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">&#39;next/link&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">UseList</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;4.UseList.render&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>List</span>
<span class="line">                header<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>用户列表<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                footer<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>共计多少<span class="token punctuation">{</span>props<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">}</span>个用户<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                bordered</span>
<span class="line">                dataSource<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>list<span class="token punctuation">}</span></span>
<span class="line">                renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">                    <span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>_id<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Link <span class="token keyword">as</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/user/detail/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>item<span class="token punctuation">.</span>_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span> href<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/user/detail</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> item<span class="token punctuation">.</span>_id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">UseList<span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>req<span class="token punctuation">)</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span>req <span class="token operator">=</span> <span class="token string">&#39;req&#39;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span>res <span class="token operator">=</span> <span class="token string">&#39;res&#39;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;2.UseList.getInitialProps ctx&#39;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;zhangsan&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;lisi&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> UseList<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-user-add-tsx" tabindex="-1"><a class="header-anchor" href="#_5-6-user-add-tsx"><span>5.6 user\\add.tsx</span></a></h3><p>pages\\user\\add.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> UserLayout <span class="token keyword">from</span> <span class="token string">&#39;./index&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">UserAdd</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>form<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Form className<span class="token operator">=</span><span class="token string">&quot;login-form&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">maxWidth</span><span class="token operator">:</span> <span class="token string">&#39;300px&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Please input your username!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Input</span>
<span class="line">                            prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;user&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;rgba(0,0,0,.25)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                            placeholder<span class="token operator">=</span><span class="token string">&quot;Username&quot;</span></span>
<span class="line">                        <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Please input your Password!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Input</span>
<span class="line">                            prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;lock&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;rgba(0,0,0,.25)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                            type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">                            placeholder<span class="token operator">=</span><span class="token string">&quot;Password&quot;</span></span>
<span class="line">                        <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> className<span class="token operator">=</span><span class="token string">&quot;login-form-button&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                        添加用户</span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;UserAdd&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>UserAdd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-集成koa" tabindex="-1"><a class="header-anchor" href="#_6-集成koa"><span>6.集成koa</span></a></h2><ul><li>Next自身的服务器只能处理SSR请求</li><li>无法处理API接口的请求</li></ul><h3 id="_6-1-知识点" tabindex="-1"><a class="header-anchor" href="#_6-1-知识点"><span>6.1 知识点</span></a></h3><ul><li>如何集成<code>koa</code></li><li>在<code>koa</code>使用<code>next</code>作中间件</li></ul><h3 id="_6-2-安装依赖" tabindex="-1"><a class="header-anchor" href="#_6-2-安装依赖"><span>6.2 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn add koa koa-router</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-3-client-index-js" tabindex="-1"><a class="header-anchor" href="#_6-3-client-index-js"><span>6.3 client\\index.js</span></a></h3><p>client\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa-router&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;next&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> dev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dev</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> handler <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">await</span> <span class="token function">handler</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>req<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        ctx<span class="token punctuation">.</span>response <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;server started at port 3000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-4-package-json" tabindex="-1"><a class="header-anchor" href="#_6-4-package-json"><span>6.4 package.json</span></a></h3><p>package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">  &quot;scripts&quot;: {</span>
<span class="line">+   &quot;client&quot;: &quot;nodemon client&quot;,</span>
<span class="line">    &quot;build&quot;: &quot;next build&quot;,</span>
<span class="line">    &quot;start&quot;: &quot;next start&quot;</span>
<span class="line">  },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-调用接口" tabindex="-1"><a class="header-anchor" href="#_7-调用接口"><span>7.调用接口</span></a></h2><ul><li>添加用户</li><li>查看用户列表</li><li>当服务渲染时,<code>getInitialProps</code>将会把数据序列化，就像<code>JSON.stringify</code></li><li>所以确保<code>getInitialProps</code>返回的是一个普通 <code>JS</code> 对象，而不是Date, Map 或 Set类型</li><li>当页面初始化加载时,<code>getInitialProps</code>只会加载在服务端。只有当路由跳转（Link组件跳转或 API 方法跳转）时，客户端才会执行<code>getInitialProps</code></li><li><code>getInitialProps</code>将不能使用在子组件中。只能使用在<code>pages</code>页面中</li><li>[getInitialProps入参对象](https://nextjs.frontendx.cn/docs/</li><li>如果需要注入<code>pathname</code>,<code>query</code> 或 <code>asPath</code>到你组件中，你可以使用<code>withRouter</code></li></ul><h3 id="_7-1-utils-axios-tsx" tabindex="-1"><a class="header-anchor" href="#_7-1-utils-axios-tsx"><span>7.1 utils\\axios.tsx</span></a></h3><p>utils\\axios.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">;</span></span>
<span class="line">axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:4000&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> instance<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-pages-user-add-tsx" tabindex="-1"><a class="header-anchor" href="#_7-2-pages-user-add-tsx"><span>7.2 pages\\user\\add.tsx</span></a></h3><p>pages\\user\\add.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import UserLayout from &#39;./index&#39;;</span>
<span class="line">import router from &#39;next/router&#39;;</span>
<span class="line">+import { Form, Input, Button, Icon, message } from &#39;antd&#39;;</span>
<span class="line">+import axios from &#39;../../utils/axios&#39;;</span>
<span class="line">function UserAdd(props) {</span>
<span class="line">+    async function handleSubmit(event) {</span>
<span class="line">+        event.preventDefault();</span>
<span class="line">+        let values = props.form.getFieldsValue();</span>
<span class="line">+        let response = await axios.post(&#39;/api/register&#39;, values);</span>
<span class="line">+        if (response.data.code === 0) {</span>
<span class="line">+            router.push(&#39;/user/list&#39;);</span>
<span class="line">+        } else {</span>
<span class="line">+            message.error(&#39;添加用户失败&#39;);</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">    const { getFieldDecorator } = props.form;</span>
<span class="line">    return (</span>
<span class="line">        &lt;UserLayout&gt;</span>
<span class="line">+            &lt;Form onSubmit={handleSubmit} className=&quot;login-form&quot; style={{ maxWidth: &#39;300px&#39; }}&gt;</span>
<span class="line">                {props.currentUser &amp;&amp; &lt;span&gt;创建者:{props.currentUser.username}&lt;/span&gt;}</span>
<span class="line">                &lt;Form.Item&gt;</span>
<span class="line">                    {getFieldDecorator(&#39;username&#39;, {</span>
<span class="line">                        rules: [{ required: true, message: &#39;Please input your username!&#39; }],</span>
<span class="line">                    })(</span>
<span class="line">                        &lt;Input</span>
<span class="line">                            prefix={&lt;Icon type=&quot;user&quot; style={{ color: &#39;rgba(0,0,0,.25)&#39; }} /&gt;}</span>
<span class="line">                            placeholder=&quot;Username&quot;</span>
<span class="line">                        /&gt;,</span>
<span class="line">                    )}</span>
<span class="line">                &lt;/Form.Item&gt;</span>
<span class="line">                &lt;Form.Item&gt;</span>
<span class="line">                    {getFieldDecorator(&#39;password&#39;, {</span>
<span class="line">                        rules: [{ required: true, message: &#39;Please input your Password!&#39; }],</span>
<span class="line">                    })(</span>
<span class="line">                        &lt;Input</span>
<span class="line">                            prefix={&lt;Icon type=&quot;lock&quot; style={{ color: &#39;rgba(0,0,0,.25)&#39; }} /&gt;}</span>
<span class="line">                            type=&quot;password&quot;</span>
<span class="line">                            placeholder=&quot;Password&quot;</span>
<span class="line">                        /&gt;,</span>
<span class="line">                    )}</span>
<span class="line">                &lt;/Form.Item&gt;</span>
<span class="line">                &lt;Form.Item&gt;</span>
<span class="line">                    &lt;Button type=&quot;primary&quot; htmlType=&quot;submit&quot; className=&quot;login-form-button&quot;&gt;</span>
<span class="line">                        添加用户</span>
<span class="line">                &lt;/Button&gt;</span>
<span class="line">                &lt;/Form.Item&gt;</span>
<span class="line">            &lt;/Form&gt;</span>
<span class="line">        &lt;/UserLayout&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">export default Form.create({ name: &#39;UserAdd&#39; })(UserAdd);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-user-list-tsx" tabindex="-1"><a class="header-anchor" href="#_7-3-user-list-tsx"><span>7.3 user\\list.tsx</span></a></h3><p>pages\\user\\list.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import UserLayout from &#39;./index&#39;;</span>
<span class="line">import { List } from &#39;antd&#39;;</span>
<span class="line">import Link from &#39;next/link&#39;;</span>
<span class="line">+import axios from &#39;../../utils/axios&#39;;</span>
<span class="line">function UseList(props) {</span>
<span class="line">    console.log(&#39;4.UseList.render&#39;, props);</span>
<span class="line">    return (</span>
<span class="line">        &lt;UserLayout&gt;</span>
<span class="line">            &lt;List</span>
<span class="line">                header={&lt;div&gt;用户列表&lt;/div&gt;}</span>
<span class="line">                footer={&lt;div&gt;共计多少{props.list.length}个用户&lt;/div&gt;}</span>
<span class="line">                bordered</span>
<span class="line">                dataSource={props.list}</span>
<span class="line">                renderItem={(item: any) =&gt; (</span>
<span class="line">                    &lt;List.Item key={item._id}&gt;</span>
<span class="line">                        &lt;Link as={\`/user/detail/\${item._id}\`} href={{ pathname: \`/user/detail\`, query: { id: item._id } }}&gt;&lt;a&gt;{item.username}&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                    &lt;/List.Item&gt;</span>
<span class="line">                )}</span>
<span class="line">            /&gt;</span>
<span class="line">        &lt;/UserLayout&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">UseList.getInitialProps = async (ctx) =&gt; {</span>
<span class="line">    if (ctx.req) { ctx.req = &#39;req&#39;; }</span>
<span class="line">    if (ctx.res) { ctx.res = &#39;res&#39;; }</span>
<span class="line">    console.log(&#39;2.UseList.getInitialProps ctx&#39;, ctx);</span>
<span class="line">+    let response = await axios({ url: &#39;/api/users&#39;, method: &#39;GET&#39; });</span>
<span class="line">+    return { list: response.data.data };</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export default UseList;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-用户详情" tabindex="-1"><a class="header-anchor" href="#_8-用户详情"><span>8.用户详情</span></a></h2><h3 id="_8-1-知识点" tabindex="-1"><a class="header-anchor" href="#_8-1-知识点"><span>8.1 知识点</span></a></h3><ul><li>路由跳转传参数</li><li>模块和组件懒加载</li><li>自定义服务端路由</li></ul><h3 id="_8-2-user-detail-tsx" tabindex="-1"><a class="header-anchor" href="#_8-2-user-detail-tsx"><span>8.2 user\\detail.tsx</span></a></h3><p>pages\\user\\detail.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> UserLayout <span class="token keyword">from</span> <span class="token string">&#39;./&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;../../utils/axios&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> dynamic <span class="token keyword">from</span> <span class="token string">&#39;next/dynamic&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> UserInfo <span class="token operator">=</span> <span class="token function">dynamic</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;../../components/UserInfo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">UserDetail</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token constant">ID</span><span class="token operator">:</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>显示<span class="token operator">/</span>隐藏<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        show <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>UserInfo user<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>user<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">UserDetail<span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;GET&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>UserDetail<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-components-userinfo-tsx" tabindex="-1"><a class="header-anchor" href="#_8-2-components-userinfo-tsx"><span>8.2 components\\UserInfo.tsx</span></a></h3><p>components\\UserInfo.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">[</span>created<span class="token punctuation">,</span> setCreated<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">changeFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> moment <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;moment&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">setCreated</span><span class="token punctuation">(</span>moment<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>created<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>用户名<span class="token operator">:</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>密码<span class="token operator">:</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>password<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>创建时间<span class="token operator">:</span><span class="token punctuation">{</span>created<span class="token punctuation">}</span><span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span>changeFormat<span class="token punctuation">}</span><span class="token operator">&gt;</span>切换为相对时间<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> UserInfo<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-client-index-js" tabindex="-1"><a class="header-anchor" href="#_8-3-client-index-js"><span>8.3 client\\index.js</span></a></h3><p>client\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">let Koa = require(&#39;koa&#39;);</span>
<span class="line">let Router = require(&#39;koa-router&#39;);</span>
<span class="line">const next = require(&#39;next&#39;);</span>
<span class="line">const dev = process.env.NODE_ENV !== &#39;production&#39;;</span>
<span class="line">const app = next({ dev: true });</span>
<span class="line">const handler = app.getRequestHandler();</span>
<span class="line">app.prepare().then(() =&gt; {</span>
<span class="line">    const server = new Koa();</span>
<span class="line">    let router = new Router();</span>
<span class="line">+    router.get(&#39;/user/detail/:id&#39;, async (ctx, next) =&gt; {</span>
<span class="line">+        const id = ctx.params.id;</span>
<span class="line">+        await handler(ctx.req, ctx.res, {</span>
<span class="line">+            pathname: &#39;/user/detail&#39;,</span>
<span class="line">+            query: { id }</span>
<span class="line">+        });</span>
<span class="line">+        ctx.response = false;</span>
<span class="line">+    });</span>
<span class="line">    server.use(router.routes());</span>
<span class="line">    server.use(async (ctx, next) =&gt; {</span>
<span class="line">        await handler(ctx.req, ctx.res);</span>
<span class="line">        ctx.response = false;</span>
<span class="line">    });</span>
<span class="line">    server.listen(3000, () =&gt; console.log(&#39;server started at port 3000&#39;));</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-登录" tabindex="-1"><a class="header-anchor" href="#_9-登录"><span>9.登录</span></a></h2><h3 id="_9-1-pages-login-tsx" tabindex="-1"><a class="header-anchor" href="#_9-1-pages-login-tsx"><span>9.1 pages\\login.tsx</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;../utils/axios&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>form<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> values <span class="token operator">=</span> props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">getFieldsValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/login&#39;</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;登录失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;login-form&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">maxWidth</span><span class="token operator">:</span> <span class="token string">&#39;300px&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">margin</span><span class="token operator">:</span><span class="token string">&#39;20px auto&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Please input your username!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Input</span>
<span class="line">                        prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;user&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;rgba(0,0,0,.25)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                        placeholder<span class="token operator">=</span><span class="token string">&quot;Username&quot;</span></span>
<span class="line">                    <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Please input your Password!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Input</span>
<span class="line">                        prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;lock&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;rgba(0,0,0,.25)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                        type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">                        placeholder<span class="token operator">=</span><span class="token string">&quot;Password&quot;</span></span>
<span class="line">                    <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> className<span class="token operator">=</span><span class="token string">&quot;login-form-button&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                    登录</span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> WrappedLogin <span class="token operator">=</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Login&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Login<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> WrappedLogin<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-集成redux" tabindex="-1"><a class="header-anchor" href="#_10-集成redux"><span>10.集成redux</span></a></h2><h3 id="_10-1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_10-1-安装依赖"><span>10.1 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn add redux react-redux</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_10-2-pages-app-tsx" tabindex="-1"><a class="header-anchor" href="#_10-2-pages-app-tsx"><span>10.2 pages_app.tsx</span></a></h3><p>pages_app.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import App from &#39;next/app&#39;;</span>
<span class="line">import Link from &#39;next/link&#39;;</span>
<span class="line">+import { Layout, Menu, Icon, Avatar } from &#39;antd&#39;;</span>
<span class="line">import &#39;antd/dist/antd.css&#39;;</span>
<span class="line">import { withRouter } from &#39;next/router&#39;;</span>
<span class="line">+import axios from &#39;../utils/axios&#39;;</span>
<span class="line">+import initStore from &#39;../store&#39;;</span>
<span class="line">+import { Provider } from &#39;react-redux&#39;;</span>
<span class="line">+import * as TYEPS from &#39;../store/action-types&#39;;</span>
<span class="line">+const { Header, Footer, Content } = Layout;</span>
<span class="line">+declare global {</span>
<span class="line">+    interface Window {</span>
<span class="line">+        _redux_store_: any</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line">+function getStore(initialState) {</span>
<span class="line">+    if (typeof window == &#39;undefined&#39;) {</span>
<span class="line">+        return initStore(initialState);</span>
<span class="line">+    } else {</span>
<span class="line">+        if (!window._redux_store_) {</span>
<span class="line">+            window._redux_store_ = initStore(initialState);</span>
<span class="line">+        }</span>
<span class="line">+        return window._redux_store_;</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line">class LayoutApp extends App&lt;any&gt; {</span>
<span class="line">+    store: any</span>
<span class="line">+    constructor(props) {</span>
<span class="line">+        super(props);</span>
<span class="line">+        this.store = getStore(props.initialState);</span>
<span class="line">+    }</span>
<span class="line">+    static async getInitialProps({ Component, ctx }) {</span>
<span class="line">+        let store = getStore({});</span>
<span class="line">+        let currentUser;</span>
<span class="line">+        let options: any = { url: &#39;/api/currentUser&#39; };</span>
<span class="line">+        if (ctx.req&amp;&amp;ctx.req.headers.cookie) {</span>
<span class="line">+            (options.headers = options.headers || {}).cookie = ctx.req.headers.cookie;</span>
<span class="line">+        }</span>
<span class="line">+        let response = await axios(options);</span>
<span class="line">+        if (response.data.code == 0) {</span>
<span class="line">+            currentUser = response.data.data;</span>
<span class="line">+            store.dispatch({ type: TYEPS.SET_USER_INFO, payload: currentUser });</span>
<span class="line">+        }</span>
<span class="line">        let pageProps = {};</span>
<span class="line">        if (Component.getInitialProps)</span>
<span class="line">            pageProps = await Component.getInitialProps(ctx);</span>
<span class="line"></span>
<span class="line">+        return { pageProps, currentUser, initialState: store.getState() };</span>
<span class="line">    }</span>
<span class="line">    render() {</span>
<span class="line">        let { Component } = this.props as any;</span>
<span class="line">        let pathname = this.props.router.pathname;</span>
<span class="line">        pathname = &#39;/&#39; + (pathname.split(&#39;/&#39;)[1]);</span>
<span class="line">        return (</span>
<span class="line">+            &lt;Provider store={this.store}&gt;</span>
<span class="line">                &lt;style jsx&gt;</span>
<span class="line">                    {\`a{display:inline-block!important;}\`}</span>
<span class="line">                &lt;/style&gt;</span>
<span class="line">                &lt;Layout&gt;</span>
<span class="line">                    &lt;Header className=&quot;header&quot;&gt;</span>
<span class="line">                        &lt;img src=&quot;/images/jglogo.png&quot; style={{ width: 120, height: 31, margin: &#39;16px 24px 16px 0px&#39;, float: &#39;left&#39; }} /&gt;</span>
<span class="line">                        &lt;Menu theme=&quot;dark&quot; mode=&quot;horizontal&quot; style={{ lineHeight: &#39;64px&#39;, display: &#39;inline-block&#39; }}</span>
<span class="line">                            selectedKeys={[pathname]}</span>
<span class="line">                            defaultSelectedKeys={[pathname]}&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;home&quot; /&gt;&lt;Link href=&quot;/&quot;&gt;&lt;a&gt;首页&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/user&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;/user&quot; /&gt; &lt;Link href=&quot;/user&quot; &gt;&lt;a&gt;用户管理&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/profile&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;profile&quot; /&gt;&lt;Link href=&quot;/profile&quot;&gt;&lt;a&gt;个人中心&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/login&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;login&quot; /&gt;&lt;Link href=&quot;/login&quot;&gt;&lt;a&gt;登录&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                        &lt;/Menu&gt;</span>
<span class="line">+                        {</span>
<span class="line">+                            this.props.currentUser &amp;&amp; &lt;div style={{ display: &#39;inline-block&#39;, float: &#39;right&#39;, color: &#39;red&#39; }}&gt;</span>
<span class="line"> +                                &lt;Avatar style={{ color: &#39;#F00&#39;, backgroundColor: &#39;</span>
<span class="line">+                            &lt;/div&gt;</span>
<span class="line">+                        }</span>
<span class="line">                    &lt;/Header&gt;</span>
<span class="line">                    &lt;Component {...this.props.pageProps} /&gt;</span>
<span class="line">                    &lt;Footer style={{ textAlign: &#39;center&#39; }} &gt;@copyright 珠峰架构&lt;/Footer&gt;</span>
<span class="line">                &lt;/Layout&gt;</span>
<span class="line">+            &lt;/Provider&gt;</span>
<span class="line">        )</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default withRouter(LayoutApp);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-3-user-add-tsx" tabindex="-1"><a class="header-anchor" href="#_10-3-user-add-tsx"><span>10.3 user\\add.tsx</span></a></h3><p>pages\\user\\add.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> UserLayout <span class="token keyword">from</span> <span class="token string">&#39;./index&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;../../utils/axios&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">UserAdd</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> values <span class="token operator">=</span> props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">getFieldsValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/register&#39;</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/user/list&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;添加用户失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>form<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;login-form&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">maxWidth</span><span class="token operator">:</span> <span class="token string">&#39;300px&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Please input your username!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Input</span>
<span class="line">                            prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;user&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;rgba(0,0,0,.25)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                            placeholder<span class="token operator">=</span><span class="token string">&quot;Username&quot;</span></span>
<span class="line">                        <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Please input your Password!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Input</span>
<span class="line">                            prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;lock&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;rgba(0,0,0,.25)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">                            type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">                            placeholder<span class="token operator">=</span><span class="token string">&quot;Password&quot;</span></span>
<span class="line">                        <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> className<span class="token operator">=</span><span class="token string">&quot;login-form-button&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                        添加用户</span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>UserLayout<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">const</span> WrappedUserAdd <span class="token operator">=</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;UserAdd&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>UserAdd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">default</span> WrappedUserAdd<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_10-4-action-types-tsx"><span>10.4 action-types.tsx</span></a></h3><p>store\\action-types.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SET_USER_INFO</span> <span class="token operator">=</span> <span class="token string">&#39;SET_USER_INFO&#39;</span><span class="token punctuation">;</span><span class="token comment">//设置用户信息</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_10-5-store-index-tsx" tabindex="-1"><a class="header-anchor" href="#_10-5-store-index-tsx"><span>10.5 store\\index.tsx</span></a></h3><p>store\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">TYPES</span> <span class="token keyword">from</span> <span class="token string">&#39;./action-types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> initState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">currentUser</span><span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">SET_USER_INFO</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">currentUser</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">initStore</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> store<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-loading效果" tabindex="-1"><a class="header-anchor" href="#_11-loading效果"><span>11.loading效果</span></a></h2><ul><li>[路由事件](https://nextjs.frontendx.cn/docs/</li></ul><table><thead><tr><th style="text-align:left;">事件</th><th style="text-align:left;">触发时机</th></tr></thead><tbody><tr><td style="text-align:left;">routeChangeStart(url)</td><td style="text-align:left;">路由开始切换时触发</td></tr><tr><td style="text-align:left;">routeChangeComplete(url)</td><td style="text-align:left;">完成路由切换时触发</td></tr><tr><td style="text-align:left;">routeChangeError(err, url)</td><td style="text-align:left;">路由切换报错时触发</td></tr><tr><td style="text-align:left;">beforeHistoryChange(url)</td><td style="text-align:left;">浏览器 history 模式开始切换时触发</td></tr><tr><td style="text-align:left;">hashChangeStart(url)</td><td style="text-align:left;">开始切换 hash 值但是没有切换页面路由时触发</td></tr><tr><td style="text-align:left;">hashChangeComplete(url)</td><td style="text-align:left;">完成切换 hash 值但是没有切换页面路由时触发</td></tr></tbody></table><h3 id="_11-1-pages-app-tsx" tabindex="-1"><a class="header-anchor" href="#_11-1-pages-app-tsx"><span>11.1 pages_app.tsx</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import App from &#39;next/app&#39;;</span>
<span class="line">import Link from &#39;next/link&#39;;</span>
<span class="line">import { Layout, Menu, Icon, Avatar } from &#39;antd&#39;;</span>
<span class="line">import &#39;antd/dist/antd.css&#39;;</span>
<span class="line">import { withRouter } from &#39;next/router&#39;;</span>
<span class="line">import axios from &#39;../utils/axios&#39;;</span>
<span class="line">import initStore from &#39;../store&#39;;</span>
<span class="line">import { Provider } from &#39;react-redux&#39;;</span>
<span class="line">import * as TYEPS from &#39;../store/action-types&#39;;</span>
<span class="line">+import router from &#39;next/router&#39;;</span>
<span class="line">+import { Spin } from &#39;antd&#39;;</span>
<span class="line">const { Header, Footer, Content } = Layout;</span>
<span class="line">declare global {</span>
<span class="line">    interface Window {</span>
<span class="line">        _redux_store_: any</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">function getStore(initialState) {</span>
<span class="line">    if (typeof window == &#39;undefined&#39;) {</span>
<span class="line">        return initStore(initialState);</span>
<span class="line">    } else {</span>
<span class="line">        if (!window._redux_store_) {</span>
<span class="line">            window._redux_store_ = initStore(initialState);</span>
<span class="line">        }</span>
<span class="line">        return window._redux_store_;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">class LayoutApp extends App&lt;any&gt; {</span>
<span class="line">    store: any</span>
<span class="line">+    state = { loading: false }</span>
<span class="line">+    routeChangeStart: any</span>
<span class="line">+    routeChangeComplete: any</span>
<span class="line">    constructor(props) {</span>
<span class="line">        super(props);</span>
<span class="line">        this.store = getStore(props.initialState);</span>
<span class="line">    }</span>
<span class="line">    static async getInitialProps({ Component, ctx }) {</span>
<span class="line">        let store = getStore({});</span>
<span class="line">        let currentUser;</span>
<span class="line">        let options: any = { url: &#39;/api/currentUser&#39; };</span>
<span class="line">        if (ctx.req) {</span>
<span class="line">            (options.headers = options.headers || {}).cookie = ctx.req.headers.cookie;</span>
<span class="line">        }</span>
<span class="line">        let response = await axios(options);</span>
<span class="line">        if (response.data.code == 0) {</span>
<span class="line">            currentUser = response.data.data;</span>
<span class="line">            store.dispatch({ type: TYEPS.SET_USER_INFO, payload: currentUser });</span>
<span class="line">        }</span>
<span class="line">        let pageProps = {};</span>
<span class="line">        if (Component.getInitialProps)</span>
<span class="line">            pageProps = await Component.getInitialProps(ctx);</span>
<span class="line"></span>
<span class="line">        return { pageProps, currentUser, initialState: store.getState() };</span>
<span class="line">    }</span>
<span class="line">+    componentDidMount() {</span>
<span class="line">+        this.routeChangeStart = (url) =&gt; {</span>
<span class="line">+            this.setState({ loading: true });</span>
<span class="line">+        };</span>
<span class="line">+        router.events.on(&#39;routeChangeStart&#39;, this.routeChangeStart);</span>
<span class="line">+        this.routeChangeComplete = (url) =&gt; {</span>
<span class="line">+            this.setState({ loading: false });</span>
<span class="line">+        };</span>
<span class="line">+        router.events.on(&#39;routeChangeComplete&#39;, this.routeChangeComplete);</span>
<span class="line">+    }</span>
<span class="line">    componentWillUnmount() {</span>
<span class="line">        router.events.off(&#39;routeChangeStart&#39;, this.routeChangeStart)</span>
<span class="line">        router.events.off(&#39;routeChangeStart&#39;, this.routeChangeComplete)</span>
<span class="line">    }</span>
<span class="line">    render() {</span>
<span class="line">        let { Component, pageProps, currentUser } = this.props as any;</span>
<span class="line">        let pathname = this.props.router.pathname;</span>
<span class="line">        pathname = &#39;/&#39; + (pathname.split(&#39;/&#39;)[1]);</span>
<span class="line">        return (</span>
<span class="line">            &lt;Provider store={this.store}&gt;</span>
<span class="line">                &lt;style jsx&gt;</span>
<span class="line">                    {\`a{display:inline-block!important;}\`}</span>
<span class="line">                &lt;/style&gt;</span>
<span class="line">                &lt;Layout&gt;</span>
<span class="line">                    &lt;Header className=&quot;header&quot;&gt;</span>
<span class="line">                        &lt;img src=&quot;/images/jglogo.png&quot; style={{ width: 120, height: 31, margin: &#39;16px 24px 16px 0px&#39;, float: &#39;left&#39; }} /&gt;</span>
<span class="line">                        &lt;Menu theme=&quot;dark&quot; mode=&quot;horizontal&quot; style={{ lineHeight: &#39;64px&#39;, display: &#39;inline-block&#39; }}</span>
<span class="line">                            selectedKeys={[pathname]}</span>
<span class="line">                            defaultSelectedKeys={[pathname]}&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;home&quot; /&gt;&lt;Link href=&quot;/&quot;&gt;&lt;a&gt;首页&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/user&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;/user&quot; /&gt; &lt;Link href=&quot;/user&quot; &gt;&lt;a&gt;用户管理&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/profile&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;profile&quot; /&gt;&lt;Link href=&quot;/profile&quot;&gt;&lt;a&gt;个人中心&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                            &lt;Menu.Item key=&quot;/login&quot;&gt;</span>
<span class="line">                                &lt;Icon type=&quot;login&quot; /&gt;&lt;Link href=&quot;/login&quot;&gt;&lt;a&gt;登录&lt;/a&gt;&lt;/Link&gt;</span>
<span class="line">                            &lt;/Menu.Item&gt;</span>
<span class="line">                        &lt;/Menu&gt;</span>
<span class="line">+                        {</span>
<span class="line">+                            this.props.currentUser &amp;&amp; &lt;div style={{ display: &#39;inline-block&#39;, float: &#39;right&#39;, color: &#39;red&#39; }}&gt;</span>
<span class="line"> +                                &lt;Avatar style={{ color: &#39;#F00&#39;, backgroundColor: &#39;</span>
<span class="line">+                            &lt;/div&gt;</span>
<span class="line">                        }</span>
<span class="line">                    &lt;/Header&gt;</span>
<span class="line">                    {</span>
<span class="line">                        this.state.loading ? &lt;Spin style={{ margin: &#39;50px auto&#39; }} /&gt; : &lt;Component {...pageProps} currentUser={currentUser} /&gt;</span>
<span class="line">                    }</span>
<span class="line">                    &lt;Footer style={{ textAlign: &#39;center&#39; }} &gt;@copyright 珠峰架构&lt;/Footer&gt;</span>
<span class="line">                &lt;/Layout&gt;</span>
<span class="line">            &lt;/Provider&gt;</span>
<span class="line">        )</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default withRouter(LayoutApp);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-受保护路由" tabindex="-1"><a class="header-anchor" href="#_12-受保护路由"><span>12.受保护路由</span></a></h2><h3 id="_12-1-pages-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_12-1-pages-profile-tsx"><span>12.1 pages\\profile.tsx</span></a></h3><p>pages\\profile.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import router from &#39;next/router&#39;;</span>
<span class="line">import { Button, Layout } from &#39;antd&#39;;</span>
<span class="line">+import axios from &#39;../utils/axios&#39;;</span>
<span class="line">const { Content } = Layout;</span>
<span class="line">+function Profile(props) {</span>
<span class="line">    return (</span>
<span class="line">        &lt;Content style={{ margin: &#39;20px auto&#39; }}&gt;</span>
<span class="line">+           &lt;div&gt;当前登录用户:{props.currentUser.username}&lt;/div&gt;</span>
<span class="line">            &lt;Button onClick={() =&gt; router.back()}&gt;返回&lt;/Button&gt;</span>
<span class="line">        &lt;/Content&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">+Profile.getInitialProps = async function (ctx) {</span>
<span class="line">+    let options: any = { url: &#39;/api/currentUser&#39; };</span>
<span class="line">+    if (ctx.req&amp;&amp;ctx.req.headers.cookie) {</span>
<span class="line">+        (options.headers = options.headers || {}).cookie = ctx.req.headers.cookie;</span>
<span class="line">+    }</span>
<span class="line">+    let response = await axios(options);</span>
<span class="line">+    if (response.data.code == 0) {</span>
<span class="line">+        return {};</span>
<span class="line">+    } else {</span>
<span class="line">+        if (ctx.req) {</span>
<span class="line">+            ctx.res.writeHead(303, { Location: &#39;/login&#39; })</span>
<span class="line">+            ctx.res.end()</span>
<span class="line">+        } else {</span>
<span class="line">+            router.push(&#39;/login&#39;);</span>
<span class="line">+        }</span>
<span class="line">+        return {};</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line">+</span>
<span class="line">+const WrappedProfile = connect(</span>
<span class="line">+    state =&gt; state</span>
<span class="line">+)(Profile);</span>
<span class="line">+export default WrappedProfile;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_13-自定义document" tabindex="-1"><a class="header-anchor" href="#_13-自定义document"><span>13.自定义Document</span></a></h2><h3 id="_13-1-pages-document-js" tabindex="-1"><a class="header-anchor" href="#_13-1-pages-document-js"><span>13.1 pages_document.js</span></a></h3><p>pages_document.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> Document<span class="token punctuation">,</span> <span class="token punctuation">{</span> Html<span class="token punctuation">,</span> Head<span class="token punctuation">,</span> Main<span class="token punctuation">,</span> NextScript <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;next/document&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">CustomDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token keyword">await</span> Document<span class="token punctuation">.</span><span class="token function">getInitialProps</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Html<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">                            *{</span>
<span class="line">                                padding:0;</span>
<span class="line">                                margin:0;</span>
<span class="line">                            }</span>
<span class="line">                            </span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Main <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>NextScript <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Html<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> CustomDocument<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-2-pages-index-tsx" tabindex="-1"><a class="header-anchor" href="#_13-2-pages-index-tsx"><span>13.2 pages\\index.tsx</span></a></h3><p>pages\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;next/router&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Layout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Head <span class="token keyword">from</span> <span class="token string">&#39;next/head&#39;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;description&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;这是首页&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Content style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">&#39;20px auto&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">/</span>user<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-服务端" tabindex="-1"><a class="header-anchor" href="#_14-服务端"><span>14.服务端</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn add express  body-parser  cors express-session connect-mongo mongoose</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_14-1-api-index-js" tabindex="-1"><a class="header-anchor" href="#_14-1-api-index-js"><span>14.1 api\\index.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;body-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> Models <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express-session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> MongoStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;connect-mongo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;http://localhost:3000&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">allowedHeaders</span><span class="token operator">:</span> <span class="token string">&quot;Content-Type,Authorization&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token string">&quot;GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">secret</span><span class="token operator">:</span> config<span class="token punctuation">.</span>secret<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">store</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">MongoStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">url</span><span class="token operator">:</span> config<span class="token punctuation">.</span>dbUrl<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">mongoOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/users&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> users <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/users/:id&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/register&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    user <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/login&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> dbUser <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>dbUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>currentUser <span class="token operator">=</span> dbUser<span class="token punctuation">;</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> dbUser <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;登录失败&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/currentUser&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> currentUser <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>currentUser<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> currentUser <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;当前用户未登录&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;服务器在4000端口启动!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-2-api-config-js" tabindex="-1"><a class="header-anchor" href="#_14-2-api-config-js"><span>14.2 api\\config.js</span></a></h3><p>api\\config.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">&#39;zhufeng&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">dbUrl</span><span class="token operator">:</span> <span class="token string">&quot;mongodb://127.0.0.1/zhufengnext2&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-3-api-db-js" tabindex="-1"><a class="header-anchor" href="#_14-3-api-db-js"><span>14.3 api\\db.js</span></a></h3><p>api\\db.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> ObjectId <span class="token operator">=</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> conn <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dbUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> UserModel <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">updatedAt</span><span class="token operator">:</span> <span class="token string">&#39;updated&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    UserModel</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,141)])])}const c=n(t,[["render",l]]),r=JSON.parse('{"path":"/strong/89.nextjs.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/89.nextjs.md"}');export{c as comp,r as data};
