import{_ as o,c,a,b as s,e,d as t,w as l,r as i,o as u}from"./app-CD1YpnS1.js";const m={},v={style:{"text-align":"left"}};function g(h,n){const r=i("container"),p=i("dest"),d=i("src");return u(),c("div",null,[n[22]||(n[22]=a(`<h2 id="_1-布署软件的问题" tabindex="-1"><a class="header-anchor" href="#_1-布署软件的问题"><span>1. 布署软件的问题</span></a></h2><ul><li>如果想让软件运行起来要保证操作系统的设置，各种库和组件的安装都是正确的</li><li>热带鱼&amp;冷水鱼 冷水鱼适应的水温在5-30度，而热带鱼只能适应22-30度水温，低于22度半小时就冻死了</li></ul><h2 id="_2-虚拟机" tabindex="-1"><a class="header-anchor" href="#_2-虚拟机"><span>2. 虚拟机</span></a></h2><ul><li>虚拟机（virtual machine）就是带环境安装的一种解决方案。它可以在一种操作系统里面运行另一种操作系统 <ul><li>资源占用多</li><li>冗余步骤多</li><li>启动速度慢</li></ul></li></ul><h2 id="_3-linux-容器" tabindex="-1"><a class="header-anchor" href="#_3-linux-容器"><span>3. Linux 容器</span></a></h2><ul><li>由于虚拟机存在这些缺点，Linux 发展出了另一种虚拟化技术：Linux 容器（Linux Containers，缩写为 LXC）。</li><li>Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。或者说，在正常进程的外面套了一个保护层。对于容器里面的进程来说，它接触到的各种资源都是虚拟的，从而实现与底层系统的隔离。 <ul><li>启动快</li><li>资源占用少</li><li>体积小</li></ul></li></ul><h2 id="_4-docker-是什么" tabindex="-1"><a class="header-anchor" href="#_4-docker-是什么"><span>4. Docker 是什么</span></a></h2><ul><li>Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。它是目前最流行的 Linux 容器解决方案。</li><li>Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样</li></ul><h2 id="_5-docker和kvm" tabindex="-1"><a class="header-anchor" href="#_5-docker和kvm"><span>5. docker和KVM</span></a></h2><ul><li>启动时间 <ul><li>Docker秒级启动</li><li>KVM分钟级启动</li></ul></li><li>轻量级 容器镜像通常以M为单位，虚拟机以G为单位，容器资源占用小，要比虚拟要部署更快速 <ul><li>容器共享宿主机内核，系统级虚拟化，占用资源少，容器性能基本接近物理机</li><li>虚拟机需要虚拟化一些设备，具有完整的OS,虚拟机开销大，因而降低性能，没有容器性能好</li></ul></li><li>安全性 <ul><li>由于共享宿主机内核，只是进程隔离，因此隔离性和稳定性不如虚拟机，容器具有一定权限访问宿主机内核，存在一下安全隐患</li></ul></li><li>使用要求 <ul><li>KVM基于硬件的完全虚拟化，需要硬件CPU虚拟化技术支持</li><li>容器共享宿主机内核，可运行在主机的Linux的发行版，不用考虑CPU是否支持虚拟化技术</li></ul></li></ul><h2 id="_6-docker应用场景" tabindex="-1"><a class="header-anchor" href="#_6-docker应用场景"><span>6. docker应用场景</span></a></h2><ul><li>节省项目环境部署时间 <ul><li>单项目打包</li><li>整套项目打包</li><li>新开源技术</li></ul></li><li>环境一致性</li><li>持续集成</li><li>微服务</li><li>弹性伸缩</li></ul><h2 id="_7-docker-体系结构" tabindex="-1"><a class="header-anchor" href="#_7-docker-体系结构"><span>7. Docker 体系结构</span></a></h2><ul><li>containerd 是一个守护进程，使用runc管理容器，向Docker Engine提供接口</li><li>shim 只负责管理一个容器</li><li>runC是一个轻量级工具，只用来运行容器</li></ul><p><img src="http://img.zhufengpeixun.cn/dockerarch.png" alt="dockerarch"></p><h2 id="_8-docker内部组件" tabindex="-1"><a class="header-anchor" href="#_8-docker内部组件"><span>8. Docker内部组件</span></a></h2><ul><li><code>namespaces</code> 命名空间，Linux内核提供的一种对进程资源隔离的机制，例如进程、网络、挂载等资源</li><li><code>cgroups</code> 控制组,linux内核提供的一种限制进程资源的机制，例如cpu 内存等资源</li><li><code>unonFS</code> 联合文件系统，支持将不同位置的目录挂载到同一虚拟文件系统，形成一种分层的模型</li></ul><h2 id="_9-docker安装" tabindex="-1"><a class="header-anchor" href="#_9-docker安装"><span>9. docker安装</span></a></h2><ul><li>docker分为企业版(EE)和社区版(CE)</li><li><a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener noreferrer">docker-ce</a></li><li><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">hub.docker</a></li></ul><h3 id="_9-1-安装" tabindex="-1"><a class="header-anchor" href="#_9-1-安装"><span>9.1 安装</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils   device<span class="token operator">-</span>mapper<span class="token operator">-</span>persistent<span class="token operator">-</span>data   lvm2</span>
<span class="line">yum<span class="token operator">-</span>config<span class="token operator">-</span>manager     <span class="token operator">--</span>add<span class="token operator">-</span>repo     https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo</span>
<span class="line">yum install docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io <span class="token operator">-</span>y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-启动" tabindex="-1"><a class="header-anchor" href="#_9-2-启动"><span>9.2 启动</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl start docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_9-3-查看docker版本" tabindex="-1"><a class="header-anchor" href="#_9-3-查看docker版本"><span>9.3 查看docker版本</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$ docker version</span>
<span class="line">$ docker info</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-4-卸载" tabindex="-1"><a class="header-anchor" href="#_9-4-卸载"><span>9.4 卸载</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker info</span>
<span class="line">yum remove docker</span>
<span class="line">rm <span class="token operator">-</span>rf <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-docker架构" tabindex="-1"><a class="header-anchor" href="#_10-docker架构"><span>10. Docker架构</span></a></h2><p><img src="http://img.zhufengpeixun.cn/docker-arch.jpg" alt="docker"></p><h2 id="_11-阿里云加速" tabindex="-1"><a class="header-anchor" href="#_11-阿里云加速"><span>11.阿里云加速</span></a></h2><ul><li><a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener noreferrer">镜像仓库</a></li><li><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener noreferrer">镜像加速器</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo mkdir -p /etc/docker</span>
<span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;</span>
<span class="line">{</span>
<span class="line">  &quot;registry-mirrors&quot;: [&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;]</span>
<span class="line">}</span>
<span class="line">EOF</span>
<span class="line"> </span>
<span class="line">//daemon-reload: 重新加载某个服务的配置文件</span>
<span class="line">sudo systemctl daemon-reload</span>
<span class="line">sudo systemctl restart docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-image镜像" tabindex="-1"><a class="header-anchor" href="#_12-image镜像"><span>12. image镜像</span></a></h2><ul><li>Docker 把应用程序及其依赖，打包在 image 文件里面。只有通过这个文件，才能生成 Docker 容器</li><li>image 文件可以看作是容器的模板</li><li>Docker 根据 image 文件生成容器的实例</li><li>同一个 image 文件，可以生成多个同时运行的容器实例</li><li>镜像不是一个单一的文件，而是有多层</li><li>容器其实就是在镜像的最上面加了一层读写层，在运行容器里做的任何文件改动，都会写到这个读写层里。如果容器删除了，最上面的读写层也就删除了，改动也就丢失了</li><li>我们可以通过<code>docker history &lt;ID/NAME&gt;</code> 查看镜像中各层内容及大小，每层对应着<code>Dockerfile</code>中的一条指令</li></ul><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">含义</th><th style="text-align:left;">语法</th><th style="text-align:left;">案例</th></tr></thead><tbody><tr><td style="text-align:left;">ls</td><td style="text-align:left;">查看全部镜像</td><td style="text-align:left;">docker image ls</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">search</td><td style="text-align:left;">查找镜像</td><td style="text-align:left;">docker search [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">history</td><td style="text-align:left;">查看镜像历史</td><td style="text-align:left;">docker history [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">inspect</td><td style="text-align:left;">显示一个或多个镜像详细信息</td><td style="text-align:left;">docker inspect [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">pull</td><td style="text-align:left;">拉取镜像</td><td style="text-align:left;">docker pull [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">push</td><td style="text-align:left;">推送一个镜像到镜像仓库</td><td style="text-align:left;">docker push [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">rmi</td><td style="text-align:left;">删除镜像</td><td style="text-align:left;">docker rmi [imageName] docker image rmi 2</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">prune</td><td style="text-align:left;">移除未使用的镜像，没有标记或补任何容器引用</td><td style="text-align:left;">docker image prune</td><td style="text-align:left;">docker image prune</td></tr><tr><td style="text-align:left;">tag</td><td style="text-align:left;">标记本地镜像，将其归入某一仓库</td><td style="text-align:left;">docker tag [OPTIONS] IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]</td><td style="text-align:left;">docker tag centos:7 zhangrenyang/centos:v1</td></tr><tr><td style="text-align:left;">export</td><td style="text-align:left;">将容器文件系统作为一个tar归档文件导出到STDOUT</td><td style="text-align:left;">docker export [OPTIONS] CONTAINER</td><td style="text-align:left;">docker export -o hello-world.tar b2712f1067a3</td></tr><tr><td style="text-align:left;">import</td><td style="text-align:left;">导入容器快照文件系统tar归档文件并创建镜像</td><td style="text-align:left;">docker import [OPTIONS] file/URL/- [REPOSITORY[:TAG]]</td><td style="text-align:left;">docker import hello-world.tar</td></tr><tr><td style="text-align:left;">save</td><td style="text-align:left;">将指定镜像保存成<code>tar</code>文件</td><td style="text-align:left;">docker save [OPTIONS] IMAGE [IMAGE...]</td><td style="text-align:left;">docker save -o hello-world.tar hello-world:latest</td></tr><tr><td style="text-align:left;">load</td><td style="text-align:left;">加载tar文件并创建镜像</td><td style="text-align:left;"></td><td style="text-align:left;">docker load -i hello-world.tar</td></tr><tr><td style="text-align:left;">build</td><td style="text-align:left;">根据Dockerfile构建镜像</td><td style="text-align:left;">docker build [OPTIONS] PATH / URL / -</td><td style="text-align:left;">docker build -t zf/ubuntu:v1 .</td></tr></tbody></table><ul><li>用户既可以使用 <code>docker load</code> 来导入镜像存储文件到本地镜像库，也可以使用 <code>docker import</code> 来导入一个容器快照到本地镜像库</li><li>这两者的区别在于容器(import)快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像(load)存储文件将保存完整记录，体积也要大</li><li>此外，从容器(import)快照文件导入时可以重新指定标签等元数据信息</li></ul><h3 id="_12-1-查看镜像" tabindex="-1"><a class="header-anchor" href="#_12-1-查看镜像"><span>12.1 查看镜像</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker image ls</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">REPOSITORY</td><td style="text-align:left;">仓库地址</td></tr><tr><td style="text-align:left;">TAG</td><td style="text-align:left;">标签</td></tr><tr><td style="text-align:left;">IMAGE_ID</td><td style="text-align:left;">镜像ID</td></tr><tr><td style="text-align:left;">CREATED</td><td style="text-align:left;">创建时间</td></tr><tr><td style="text-align:left;">SIZE</td><td style="text-align:left;">镜像大小</td></tr></tbody></table><h3 id="_12-2-查找镜像" tabindex="-1"><a class="header-anchor" href="#_12-2-查找镜像"><span>12.2 查找镜像</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker search ubuntu</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">NAME</td><td style="text-align:left;">名称</td></tr><tr><td style="text-align:left;">DESCRIPTION</td><td style="text-align:left;">描述</td></tr><tr><td style="text-align:left;">STARTS</td><td style="text-align:left;">星星的数量</td></tr><tr><td style="text-align:left;">OFFICIAL</td><td style="text-align:left;">是否官方源</td></tr></tbody></table><h3 id="_12-3-拉取镜像" tabindex="-1"><a class="header-anchor" href="#_12-3-拉取镜像"><span>12.3 拉取镜像</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker  pull docker.io/hello-world</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>docker image pull是抓取 image 文件的命令</li><li>docker.io/hello-world是 image 文件在仓库里面的位置，其中<code>docker.io</code>是 image的作者，hello-world是 image 文件的名字</li><li>Docker 官方提供的 image 文件，都放在<code>docker.io</code>组里面，所以它的是默认组，可以省略 <code>docker image pull hello-world</code></li></ul><h3 id="_12-4-删除镜像" tabindex="-1"><a class="header-anchor" href="#_12-4-删除镜像"><span>12.4 删除镜像</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker rmi  hello-world</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_12-5-export" tabindex="-1"><a class="header-anchor" href="#_12-5-export"><span>12.5 export</span></a></h3><ul><li>将容器文件系统作为一个tar归档文件导出到<code>STDOUT</code></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker <span class="token keyword">export</span> <span class="token operator">-</span>o hello<span class="token operator">-</span>world<span class="token punctuation">.</span>tar b2712f1067a3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_12-6-import" tabindex="-1"><a class="header-anchor" href="#_12-6-import"><span>12.6 import</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker <span class="token keyword">import</span> hello<span class="token operator">-</span>world<span class="token punctuation">.</span>tar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_12-7-save" tabindex="-1"><a class="header-anchor" href="#_12-7-save"><span>12.7 save</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker save -o hello-world.tar hello-world:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_12-8-load" tabindex="-1"><a class="header-anchor" href="#_12-8-load"><span>12.8 load</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker load -i hello-world.tar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_13-容器" tabindex="-1"><a class="header-anchor" href="#_13-容器"><span>13. 容器</span></a></h2><ul><li><code>docker run</code> 命令会从 <code>image</code> 文件，生成一个正在运行的容器实例。</li><li><code>docker container run</code>命令具有自动抓取 image 文件的功能。如果发现本地没有指定的 image 文件，就会从仓库自动抓取</li><li>输出提示以后，hello world就会停止运行，容器自动终止。</li><li>有些容器不会自动终止</li><li>image 文件生成的容器实例，本身也是一个文件，称为容器文件</li><li>容器生成，就会同时存在两个文件： image 文件和容器文件</li><li>关闭容器并不会删除容器文件，只是容器停止运行</li></ul><h3 id="_13-1-命令" tabindex="-1"><a class="header-anchor" href="#_13-1-命令"><span>13.1 命令</span></a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">含义</th><th style="text-align:left;">案例</th></tr></thead><tbody><tr><td style="text-align:left;">run</td><td style="text-align:left;">从镜像运行一个容器</td><td style="text-align:left;">docker run ubuntu /bin/echo &#39;hello-world&#39;</td></tr><tr><td style="text-align:left;">ls</td><td style="text-align:left;">列出容器</td><td style="text-align:left;">docker container ls</td></tr><tr><td style="text-align:left;">inspect</td><td style="text-align:left;">显示一个或多个容器详细信息</td><td style="text-align:left;">docker inspect</td></tr><tr><td style="text-align:left;">attach</td><td style="text-align:left;">要attach上去的容器必须正在运行，可以同时连接上同一个container来共享屏幕</td><td style="text-align:left;">docker attach [OPTIONS] CONTAINER</td></tr><tr><td style="text-align:left;">stats</td><td style="text-align:left;">显示容器资源使用统计</td><td style="text-align:left;">docker container stats</td></tr><tr><td style="text-align:left;">top</td><td style="text-align:left;">显示一个容器运行的进程</td><td style="text-align:left;">docker container top</td></tr><tr><td style="text-align:left;">update</td><td style="text-align:left;">更新一个或多个容器配置</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">port</td><td style="text-align:left;">列出指定的容器的端口映射</td><td style="text-align:left;">docker run -d -p 8080:80 nginx docker container port containerID</td></tr><tr><td style="text-align:left;">ps</td><td style="text-align:left;">查看当前运行的容器</td><td style="text-align:left;">docker ps -a -l</td></tr><tr><td style="text-align:left;">kill [containerId]</td><td style="text-align:left;">终止容器(发送SIGKILL )</td><td style="text-align:left;">docker kill [containerId]</td></tr><tr><td style="text-align:left;">rm [containerId]</td><td style="text-align:left;">删除容器</td><td style="text-align:left;">docker rm [containerId]</td></tr><tr><td style="text-align:left;">start [containerId]</td><td style="text-align:left;">启动已经生成、已经停止运行的容器文件</td><td style="text-align:left;">docker start [containerId]</td></tr><tr><td style="text-align:left;">stop [containerId]</td><td style="text-align:left;">终止容器运行 (发送 SIGTERM )</td><td style="text-align:left;">docker stop [containerId] docker container stop $(docker container ps -aq)</td></tr><tr><td style="text-align:left;">logs [containerId]</td><td style="text-align:left;">查看 docker 容器的输出</td><td style="text-align:left;">docker logs [containerId]</td></tr><tr><td style="text-align:left;">exec [containerId]</td><td style="text-align:left;">进入一个正在运行的 docker 容器执行命令</td><td style="text-align:left;">docker container exec -it f6a53629488b /bin/bash</td></tr><tr><td style="text-align:left;">cp [containerId]</td><td style="text-align:left;">从正在运行的 Docker 容器里面，将文件拷贝到本机</td><td style="text-align:left;">docker container cp f6a53629488b:/root/root.txt .</td></tr><tr><td style="text-align:left;">commit [containerId]</td><td style="text-align:left;">根据一个现有容器创建一个新的镜像</td><td style="text-align:left;">docker commit -a &quot;zhufeng&quot; -m &quot;mynginx&quot; a404c6c174a2 mynginx:v1</td></tr></tbody></table><ul><li>docker容器的主线程（dockfile中CMD执行的命令）结束，容器会退出 <ul><li>以使用交互式启动 <code>docker run -i [CONTAINER_NAME or CONTAINER_ID]</code></li><li>tty选项 <code>docker run -dit [CONTAINER_NAME or CONTAINER_ID]</code></li><li>守护态（Daemonized）形式运行 <code>docker run -d ubuntu /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</code></li></ul></li></ul><h3 id="_13-2-启动容器" tabindex="-1"><a class="header-anchor" href="#_13-2-启动容器"><span>13.2 启动容器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker run ubuntu <span class="token operator">/</span>bin<span class="token operator">/</span>echo <span class="token string">&quot;Hello world&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>docker: Docker 的二进制执行文件。</li><li>run:与前面的 docker 组合来运行一个容器。</li><li>ubuntu指定要运行的镜像，Docker首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</li><li>/bin/echo &quot;Hello world&quot;: 在启动的容器里执行的命令</li></ul><blockquote><p>Docker以ubuntu镜像创建一个新容器，然后在容器里执行 bin/echo &quot;Hello world&quot;，然后输出结果</p><ul><li>Docker attach必须是登陆到一个已经运行的容器里。需要注意的是如果从这个容器中exit退出的话，就会导致容器停止</li></ul></blockquote><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">-i --interactive</td><td style="text-align:left;">交互式</td></tr><tr><td style="text-align:left;">-t --tty</td><td style="text-align:left;">分配一个伪终端</td></tr><tr><td style="text-align:left;">-d --detach</td><td style="text-align:left;">运行容器到后台</td></tr><tr><td style="text-align:left;">-a --attach list</td><td style="text-align:left;">附加到运行的容器</td></tr><tr><td style="text-align:left;">-e --env list</td><td style="text-align:left;">设置环境变量</td></tr><tr><td style="text-align:left;">-p --publish list</td><td style="text-align:left;">发布容器端口到主机</td></tr><tr><td style="text-align:left;">-P</td><td style="text-align:left;">--publish-all</td></tr></tbody></table><h3 id="_13-3-查看容器" tabindex="-1"><a class="header-anchor" href="#_13-3-查看容器"><span>13.3 查看容器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker ps</span>
<span class="line">docker -a</span>
<span class="line">docker -l</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>-a 显示所有的容器，包括已停止的</li><li>-l 显示最新的那个容器</li></ul><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">CONTAINER ID</td><td style="text-align:left;">容器ID</td></tr><tr><td style="text-align:left;">IMAGE</td><td style="text-align:left;">使用的镜像</td></tr><tr><td style="text-align:left;">COMMAND</td><td style="text-align:left;">使用的命令</td></tr><tr><td style="text-align:left;">CREATED</td><td style="text-align:left;">创建时间</td></tr><tr><td style="text-align:left;">STATUS</td><td style="text-align:left;">状态</td></tr><tr><td style="text-align:left;">PORTS</td><td style="text-align:left;">端口号</td></tr><tr><td style="text-align:left;">NAMES</td><td style="text-align:left;">自动分配的名称</td></tr></tbody></table><h3 id="_13-4-运行交互式的容器" tabindex="-1"><a class="header-anchor" href="#_13-4-运行交互式的容器"><span>13.4 运行交互式的容器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run -i -t ubuntu /bin/bash</span>
<span class="line">exit</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>-t=--interactive 在新容器内指定一个伪终端或终端。</li><li>-i=--tty 允许你对容器内的标准输入 (STDIN) 进行交互。</li></ul><blockquote><p>我们可以通过运行exit命令或者使用CTRL+D来退出容器。</p></blockquote><h3 id="_13-5-后台运行容器" tabindex="-1"><a class="header-anchor" href="#_13-5-后台运行容器"><span>13.5 后台运行容器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run --detach centos ping www.baidu.com</span>
<span class="line">docker ps </span>
<span class="line">docker logs --follow ad04d9acde94</span>
<span class="line">docker stop ad04d9acde94</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-6-kill" tabindex="-1"><a class="header-anchor" href="#_13-6-kill"><span>13.6 kill</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker kill 5a5c3a760f61</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>kill是不管容器同不同意，直接执行<code>kill -9</code>，强行终止；stop的话，首先给容器发送一个<code>TERM</code>信号，让容器做一些退出前必须的保护性、安全性操作，然后让容器自动停止运行，如果在一段时间内，容器还是没有停止，再进行kill -9，强行终止</p></blockquote><h3 id="_13-7-删除容器" tabindex="-1"><a class="header-anchor" href="#_13-7-删除容器"><span>13.7 删除容器</span></a></h3>`,80)),s("ul",null,[s("li",null,[n[1]||(n[1]=e("docker rm ",-1)),t(r,null,{default:l(()=>[...n[0]||(n[0]=[e("删除容器",-1)])]),_:1})]),n[2]||(n[2]=s("li",null,[e("docker rmi "),s("img",{src:"",alt:""}),e(" 删除镜像")],-1)),n[3]||(n[3]=s("li",null,"docker rm $(docker ps -a -q)",-1))]),n[23]||(n[23]=a(`<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker rm 5a5c3a760f61</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-8-启动容器" tabindex="-1"><a class="header-anchor" href="#_13-8-启动容器"><span>13.8 启动容器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker start [containerId]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-9-停止容器" tabindex="-1"><a class="header-anchor" href="#_13-9-停止容器"><span>13.9 停止容器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker stop [containerId]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-10-进入一个容器" tabindex="-1"><a class="header-anchor" href="#_13-10-进入一个容器"><span>13.10 进入一个容器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker attach [containerID]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-11-进入一个正在运行中的容器" tabindex="-1"><a class="header-anchor" href="#_13-11-进入一个正在运行中的容器"><span>13.11 进入一个正在运行中的容器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker container -exec -it [containerID] /bin/bash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-12-拷贝文件" tabindex="-1"><a class="header-anchor" href="#_13-12-拷贝文件"><span>13.12 拷贝文件</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker container cp [containerID]/readme.md .</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-13-自动删除" tabindex="-1"><a class="header-anchor" href="#_13-13-自动删除"><span>13.13 自动删除</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run --rm ubuntu /bin/bash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-14-stats" tabindex="-1"><a class="header-anchor" href="#_13-14-stats"><span>13.14 stats</span></a></h3><ul><li>显示容器资源使用统计</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker container stats</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-15-top" tabindex="-1"><a class="header-anchor" href="#_13-15-top"><span>13.15 top</span></a></h3><ul><li>显示一个容器运行的进程</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker container top</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-16-update" tabindex="-1"><a class="header-anchor" href="#_13-16-update"><span>13.16 update</span></a></h3><ul><li>更新一个或多个容器配置</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker update <span class="token operator">-</span>m 500m  6d1a25f95132</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-17-port" tabindex="-1"><a class="header-anchor" href="#_13-17-port"><span>13.17 port</span></a></h3><ul><li>列出指定的容器的端口映射</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token operator">:</span><span class="token number">80</span> nginx </span>
<span class="line">docker container port containerID</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-18-logs" tabindex="-1"><a class="header-anchor" href="#_13-18-logs"><span>13.18 logs</span></a></h3><ul><li>查看 docker 容器的输出<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker logs [containerId]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h2 id="_14-commit制作个性化镜像" tabindex="-1"><a class="header-anchor" href="#_14-commit制作个性化镜像"><span>14. commit制作个性化镜像</span></a></h2><ul><li>docker commit :从容器创建一个新的镜像。</li><li>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]] <ul><li>-a :提交的镜像作者</li><li>-c :使用Dockerfile指令来创建镜像</li><li>-m :提交时的说明文字</li><li>-p :在commit时，将容器暂停</li></ul></li><li>停止容器后不会自动删除这个容器，除非在启动容器的时候指定了 --rm 标志</li><li>使用 docker ps -a 命令查看 Docker 主机上包含停止的容器在内的所有容器</li><li>停止状态的容器的可写层仍然占用磁盘空间。要清理可以使用 <code>docker container prune</code> 命令</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker container commit <span class="token operator">-</span>m<span class="token string">&quot;我的nginx&quot;</span> <span class="token operator">-</span>a<span class="token string">&quot;zhangrenyang&quot;</span> 3695dc5b9c2d zhangrenyang<span class="token operator">/</span>mynginx<span class="token operator">:</span>v1</span>
<span class="line">docker image ls</span>
<span class="line">docker container run zhangrenyang<span class="token operator">/</span>mynginx <span class="token operator">/</span>bin<span class="token operator">/</span>bash</span>
<span class="line">docker container rm b2839066c362</span>
<span class="line">docker container prune </span>
<span class="line">docker image rmi c79ef5b3f5fc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_15-制作dockerfile" tabindex="-1"><a class="header-anchor" href="#_15-制作dockerfile"><span>15. 制作Dockerfile</span></a></h2><ul><li>Docker 的镜像是用一层一层的文件组成的</li><li><code>docker inspect</code>命令可以查看镜像或者容器</li><li>Layers就是镜像的层文件，只读不能修改。基于镜像创建的容器会共享这些文件层</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker inspect centos</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_15-1-编写dockerfile" tabindex="-1"><a class="header-anchor" href="#_15-1-编写dockerfile"><span>15.1 编写Dockerfile</span></a></h3><ul><li>-t --tag list 镜像名称</li><li>-f --file string 指定Dockerfile文件的位置</li></ul>`,35)),s("table",null,[n[21]||(n[21]=s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"left"}},"指令"),s("th",{style:{"text-align":"left"}},"含义"),s("th",{style:{"text-align":"left"}},"示例")])],-1)),s("tbody",null,[n[8]||(n[8]=s("tr",null,[s("td",{style:{"text-align":"left"}},"FROM"),s("td",{style:{"text-align":"left"}},"构建的新镜像是基于哪个镜像"),s("td",{style:{"text-align":"left"}},"FROM centos:6")],-1)),n[9]||(n[9]=s("tr",null,[s("td",{style:{"text-align":"left"}},"MAINTAINER"),s("td",{style:{"text-align":"left"}},"镜像维护者姓名或邮箱地址"),s("td",{style:{"text-align":"left"}},"MAINTAINER zhufengjiagou")],-1)),n[10]||(n[10]=s("tr",null,[s("td",{style:{"text-align":"left"}},"RUN"),s("td",{style:{"text-align":"left"}},"构建镜像时运行的shell命令"),s("td",{style:{"text-align":"left"}},"RUN yum install httpd")],-1)),n[11]||(n[11]=s("tr",null,[s("td",{style:{"text-align":"left"}},"CMD"),s("td",{style:{"text-align":"left"}},"CMD 设置容器启动后默认执行的命令及其参数，但 CMD 能够被 docker run 后面跟的命令行参数替换"),s("td",{style:{"text-align":"left"}},"CMD /usr/sbin/sshd -D")],-1)),n[12]||(n[12]=s("tr",null,[s("td",{style:{"text-align":"left"}},"EXPOSE"),s("td",{style:{"text-align":"left"}},"声明容器运行的服务器端口"),s("td",{style:{"text-align":"left"}},"EXPOSE 80 443")],-1)),n[13]||(n[13]=s("tr",null,[s("td",{style:{"text-align":"left"}},"ENV"),s("td",{style:{"text-align":"left"}},"设置容器内的环境变量"),s("td",{style:{"text-align":"left"}},"ENV MYSQL_ROOT_PASSWORD 123456")],-1)),s("tr",null,[n[6]||(n[6]=s("td",{style:{"text-align":"left"}},"ADD",-1)),n[7]||(n[7]=s("td",{style:{"text-align":"left"}},"拷贝文件或目录到镜像中，如果是URL或者压缩包会自动下载和解压",-1)),s("td",v,[n[5]||(n[5]=e("ADD ",-1)),t(d,null,{default:l(()=>[t(p,null,{default:l(()=>[...n[4]||(n[4]=[e(",ADD ",-1),s("a",{href:"https://xxx.com/html.tar.gz",target:"_blank",rel:"noopener noreferrer"},"https://xxx.com/html.tar.gz",-1),e(" /var/",-1),s("a",{href:"http://www.html",target:"_blank",rel:"noopener noreferrer"},"www.html",-1),e(", ADD html.tar.gz /var/www/html",-1)])]),_:1})]),_:1})])]),n[14]||(n[14]=s("tr",null,[s("td",{style:{"text-align":"left"}},"COPY"),s("td",{style:{"text-align":"left"}},"拷贝文件或目录到镜像"),s("td",{style:{"text-align":"left"}},"COPY ./start.sh /start.sh")],-1)),n[15]||(n[15]=s("tr",null,[s("td",{style:{"text-align":"left"}},"ENTRYPOINT"),s("td",{style:{"text-align":"left"}},"配置容器启动时运行的命令"),s("td",{style:{"text-align":"left"}},"ENTRYPOINT /bin/bash -c '/start.sh'")],-1)),n[16]||(n[16]=s("tr",null,[s("td",{style:{"text-align":"left"}},"VOLUME"),s("td",{style:{"text-align":"left"}},"指定容器挂载点到宿主自动生成的目录或其它容器"),s("td",{style:{"text-align":"left"}},'VOLUME ["/var/lib/mysql"]')],-1)),n[17]||(n[17]=s("tr",null,[s("td",{style:{"text-align":"left"}},"USER"),s("td",{style:{"text-align":"left"}},"为 RUN CMD和ENTRYPOINT执行命令指定运行用户"),s("td",{style:{"text-align":"left"}},"USER zhufengjiagou")],-1)),n[18]||(n[18]=s("tr",null,[s("td",{style:{"text-align":"left"}},"WORKDIR"),s("td",{style:{"text-align":"left"}},"为RUN CMD ENTRYPOINT COPY ADD 设置工作目录"),s("td",{style:{"text-align":"left"}},"WORKDIR /data")],-1)),n[19]||(n[19]=s("tr",null,[s("td",{style:{"text-align":"left"}},"HEALTHCHECK"),s("td",{style:{"text-align":"left"}},"健康检查"),s("td",{style:{"text-align":"left"}},"HEALTHCHECK --interval=5m --timeout=3s --retries=3 CMS curl -f htp://localhost")],-1)),n[20]||(n[20]=s("tr",null,[s("td",{style:{"text-align":"left"}},"ARG"),s("td",{style:{"text-align":"left"}},"在构建镜像时指定一些参数"),s("td",{style:{"text-align":"left"}},"ARG user")],-1))])]),n[24]||(n[24]=a(`<ul><li>cmd给出的是一个容器的默认的可执行体。也就是容器启动以后，默认的执行的命令。重点就是这个&quot;默认&quot;。意味着，如果<code>docker run</code>没有指定任何的执行命令或者<code>dockerfile</code>里面也没有<code>entrypoint</code>，那么，就会使用cmd指定的默认的执行命令执行。同时也从侧面说明了<code>entrypoint</code>的含义，它才是真正的容器启动以后要执行命令</li></ul><h3 id="_15-2-dockerignore" tabindex="-1"><a class="header-anchor" href="#_15-2-dockerignore"><span>15.2 .dockerignore</span></a></h3><p>表示要排除，不要打包到image中的文件路径</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">.git</span>
<span class="line">node_modules</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-3-dockerfile" tabindex="-1"><a class="header-anchor" href="#_15-3-dockerfile"><span>15.3 Dockerfile</span></a></h3><h4 id="_15-3-1-安装node" tabindex="-1"><a class="header-anchor" href="#_15-3-1-安装node"><span>15.3.1 安装node</span></a></h4><ul><li><p><a href="https://github.com/creationix/nvm/blob/master/README.md" target="_blank" rel="noopener noreferrer">nvm</a></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">wget <span class="token operator">-</span>qO<span class="token operator">-</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>creationix<span class="token operator">/</span>nvm<span class="token operator">/</span>v0<span class="token punctuation">.</span><span class="token number">33.11</span><span class="token operator">/</span>install<span class="token punctuation">.</span>sh <span class="token operator">|</span> bash</span>
<span class="line">source <span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>bashrc</span>
<span class="line">nvm install stable</span>
<span class="line">node <span class="token operator">-</span>v</span>
<span class="line">npm config <span class="token keyword">set</span> registry https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org</span>
<span class="line">npm i cnpm <span class="token operator">-</span>g  <span class="token operator">--</span>registry https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org</span>
<span class="line">npm i nrm <span class="token operator">-</span>g  <span class="token operator">--</span>registry https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_15-3-2-安装express项目生成器" tabindex="-1"><a class="header-anchor" href="#_15-3-2-安装express项目生成器"><span>15.3.2 安装express项目生成器</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install express-generator -g</span>
<span class="line">express app</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_15-3-3-dockerfile" tabindex="-1"><a class="header-anchor" href="#_15-3-3-dockerfile"><span>15.3.3 Dockerfile</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">FROM</span> node</span>
<span class="line"><span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>app <span class="token operator">/</span>app</span>
<span class="line"><span class="token constant">WORKDIR</span> <span class="token operator">/</span>app</span>
<span class="line"><span class="token constant">RUN</span> npm install</span>
<span class="line"><span class="token constant">EXPOSE</span> <span class="token number">3000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>FROM 表示该镜像继承的镜像 :表示标签</li><li>COPY 是将当前目录下的app目录下面的文件都拷贝到image里的/app目录中</li><li>WORKDIR 指定工作路径，类似于执行 <code>cd</code> 命令</li><li>RUN npm install 在/app目录下安装依赖，安装后的依赖也会打包到image目录中</li><li>EXPOSE 暴露3000端口，允许外部连接这个端口</li></ul><h3 id="_15-4-创建image" tabindex="-1"><a class="header-anchor" href="#_15-4-创建image"><span>15.4 创建image</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker build -t express-demo .</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>-t用来指定image镜像的名称，后面还可以加冒号指定标签，如果不指定默认就是latest</li><li><code>.</code> 表示Dockerfile文件的所有路径,<code>.</code>就表示当前路径</li></ul><h3 id="_15-5-使用新的镜像运行容器" tabindex="-1"><a class="header-anchor" href="#_15-5-使用新的镜像运行容器"><span>15.5 使用新的镜像运行容器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker container run <span class="token operator">-</span>p <span class="token number">3333</span><span class="token operator">:</span><span class="token number">3000</span> <span class="token operator">-</span>it express<span class="token operator">-</span>demo <span class="token operator">/</span>bin<span class="token operator">/</span>bash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>-p</code> 参数是将容器的3000端口映射为本机的3333端口</li><li><code>-it</code> 参数是将容器的shell容器映射为当前的shell,在本机容器中执行的命令都会发送到容器当中执行</li><li><code>express-demo</code> image的名称</li><li>/bin/bash 容器启动后执行的第一个命令,这里是启动了bash容器以便执行脚本</li><li><code>--rm</code> 在容器终止运行后自动删除容器文件</li></ul><h3 id="_15-6-cmd" tabindex="-1"><a class="header-anchor" href="#_15-6-cmd"><span>15.6 CMD</span></a></h3><p>Dockerfile</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ CMD npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重新制作镜像</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker build <span class="token operator">-</span>t express<span class="token operator">-</span>demo <span class="token punctuation">.</span></span>
<span class="line">docker container run <span class="token operator">-</span>p <span class="token number">3333</span><span class="token operator">:</span><span class="token number">3000</span> express<span class="token operator">-</span>demo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>RUN命令在 image 文件的构建阶段执行，执行结果都会打包进入 image 文件；CMD命令则是在容器启动后执行</li><li>一个 Dockerfile 可以包含多个RUN命令，但是只能有一个CMD命令</li><li>指定了CMD命令以后，docker container run命令就不能附加命令了（比如前面的/bin/bash），否则它会覆盖CMD命令</li></ul><h3 id="_15-7-发布image" tabindex="-1"><a class="header-anchor" href="#_15-7-发布image"><span>15.7 发布image</span></a></h3><ul><li><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">注册账户</a></li><li>83687401 Abc</li><li>docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker login</span>
<span class="line">docker image tag [imageName] [username]/[repository]:[tag]</span>
<span class="line">docker image build -t [username]/[repository]:[tag] .</span>
<span class="line"></span>
<span class="line">docker tag express-demo zhangrenyang/express-demo:v1</span>
<span class="line">docker push zhangrenyang/express-demo:v1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_16-数据盘" tabindex="-1"><a class="header-anchor" href="#_16-数据盘"><span>16. 数据盘</span></a></h2><ul><li>删除容器的时候，容器层里创建的文件也会被删除掉，如果有些数据你想永久保存，比如Web服务器的日志，数据库管理系统中的数据，可以为容器创建一个数据盘</li></ul><p><img src="http://img.zhufengpeixun.cn/bindmount.png" alt="bindmount"></p><h3 id="_16-1-volume" tabindex="-1"><a class="header-anchor" href="#_16-1-volume"><span>16.1 volume</span></a></h3><ul><li>volumes Docker管理宿主机文件系统的一部分(/var/lib/docker/volumes)</li><li>如果没有指定卷，则会自动创建</li><li>建议使用--mount ,更通用</li></ul><h3 id="_16-1-1-创建数据卷" tabindex="-1"><a class="header-anchor" href="#_16-1-1-创建数据卷"><span>16.1.1 创建数据卷</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker volume --help</span>
<span class="line">docker volume create nginx-vol</span>
<span class="line">docker volume ls</span>
<span class="line">docker volume inspect nginx-vol</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">docker run -d  --name=nginx1 --mount src=nginx-vol,dst=/usr/share/nginx/html nginx</span>
<span class="line">docker run -d  --name=nginx2  -v nginx-vol:/usr/share/nginx/html -p 3000:80 nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_16-1-2-删除数据卷" tabindex="-1"><a class="header-anchor" href="#_16-1-2-删除数据卷"><span>16.1.2 删除数据卷</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker container stop nginx1 停止容器</span>
<span class="line">docker container rm nginx1 删除容器</span>
<span class="line">docker volume rm nginx-vol  删除数据库</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_16-1-3-管理数据盘" tabindex="-1"><a class="header-anchor" href="#_16-1-3-管理数据盘"><span>16.1.3 管理数据盘</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> docker volume ls </span>
<span class="line"> docker volume ls -f dangling=true </span>
<span class="line"> docker volume rm xxxx </span>
<span class="line"> docker volume ls      </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_16-2-bind-mounts" tabindex="-1"><a class="header-anchor" href="#_16-2-bind-mounts"><span>16.2 Bind mounts</span></a></h3><ul><li>此方式与Linux系统的mount方式很相似，即是会覆盖容器内已存在的目录或文件，但并不会改变容器内原有的文件，当umount后容器内原有的文件就会还原</li><li>创建容器的时候我们可以通过<code>-v</code>或<code>--volumn</code>给它指定一下数据盘</li><li><code>bind mounts</code> 可以存储在宿主机系统的任意位置</li><li>如果源文件/目录不存在，不会自动创建，会抛出一个错误</li><li>如果挂载目标在容器中非空目录，则该目录现有内容将被隐藏</li></ul><h4 id="_16-2-1-默认数据盘" tabindex="-1"><a class="header-anchor" href="#_16-2-1-默认数据盘"><span>16.2.1 默认数据盘</span></a></h4><ul><li>-v 参数两种挂载数据方式都可以用</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run -v /mnt:/mnt -it --name logs centos bash</span>
<span class="line">cd /mnt</span>
<span class="line">echo 1 &gt; 1.txt</span>
<span class="line">exit</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker inspect logs</span>
<span class="line"><span class="token string-property property">&quot;Mounts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;Source&quot;</span><span class="token operator">:</span><span class="token string">&quot;/mnt/sda1/var/lib/docker/volumes/dea6a8b3aefafa907d883895bbf931a502a51959f83d63b7ece8d7814cf5d489/_data&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;Destination&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/mnt&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Source</code>的值就是我们给容器指定的数据盘在主机上的位置</li><li><code>Destination</code>的值是这个数据盘在容器上的位置</li></ul><h4 id="_16-2-2-指定数据盘" tabindex="-1"><a class="header-anchor" href="#_16-2-2-指定数据盘"><span>16.2.2 指定数据盘</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir ~/data</span>
<span class="line">docker run -v ~/data:/mnt -it --name logs2 centos bash</span>
<span class="line">cd /mnt</span>
<span class="line">echo 3 &gt; 3.txt</span>
<span class="line">exit</span>
<span class="line">cat ~/data/3.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>~/data:/mnt 把当前用户目录中的<code>data</code>目录映射到<code>/mnt</code>上</li></ul><h4 id="_16-2-3-指定数据盘容器" tabindex="-1"><a class="header-anchor" href="#_16-2-3-指定数据盘容器"><span>16.2.3 指定数据盘容器</span></a></h4><ul><li>docker create [OPTIONS] IMAGE [COMMAND] [ARG...] 创建一个新的容器但不启动</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker create -v /mnt:/mnt --name logger centos</span>
<span class="line">docker run --volumes-from logger --name logger3 -i -t centos bash</span>
<span class="line">cd /mnt </span>
<span class="line">touch logger3</span>
<span class="line">docker run --volumes-from logger --name logger4 -i -t centos bash</span>
<span class="line">cd /mnt</span>
<span class="line">touch logger4</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_17-网络" tabindex="-1"><a class="header-anchor" href="#_17-网络"><span>17. 网络</span></a></h2><ul><li>安装Docker时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、host <ul><li>None：该模式关闭了容器的网络功能,对外界完全隔离</li><li>host：容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。</li><li>bridge 桥接网络，此模式会为每一个容器分配IP</li></ul></li><li>可以使用该<code>--network</code>标志来指定容器应连接到哪些网络</li></ul><h3 id="_17-1-bridge-桥接" tabindex="-1"><a class="header-anchor" href="#_17-1-bridge-桥接"><span>17.1 bridge(桥接)</span></a></h3><ul><li>bridge网络代表所有Docker安装中存在的网络</li><li>除非你使用该<code>docker run --network=&lt;NETWORK&gt;</code>选项指定，否则Docker守护程序默认将容器连接到此网络</li><li>bridge模式使用 <code>--net=bridge</code> 指定，默认设置</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> docker network ls </span>
<span class="line"> docker inspect bridge </span>
<span class="line">docker run -d --name nginx1 nginx</span>
<span class="line">docker run -d --name nginx2 --link nginx1 nginx</span>
<span class="line">docker exec -it nginx2 bash</span>
<span class="line">apt update</span>
<span class="line"> apt install -y inetutils-ping  </span>
<span class="line"> apt install -y dnsutils        </span>
<span class="line"> apt install -y net-tools       </span>
<span class="line"> apt install -y iproute2        </span>
<span class="line"> apt install -y curl            </span>
<span class="line">cat /etc/hosts</span>
<span class="line">ping nginx1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-2-none" tabindex="-1"><a class="header-anchor" href="#_17-2-none"><span>17.2 none</span></a></h3><ul><li>none模式使用<code>--net=none</code>指定</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">docker run -d --name nginx_none --net none nginx</span>
<span class="line">docker inspect none</span>
<span class="line">docker exec -it nginx_none bash</span>
<span class="line">ip addr</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-3-host" tabindex="-1"><a class="header-anchor" href="#_17-3-host"><span>17.3 host</span></a></h3><ul><li>host模式使用 <code>--net=host</code> 指定</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run -d --name nginx_host --net host nginx</span>
<span class="line">docker inspect host</span>
<span class="line">docker exec -it nginx_host bash</span>
<span class="line">ip addr</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-4-端口映射" tabindex="-1"><a class="header-anchor" href="#_17-4-端口映射"><span>17.4 端口映射</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">docker image inspect nginx</span>
<span class="line">&quot;ExposedPorts&quot;: {&quot;80/tcp&quot;: {}}</span>
<span class="line"> </span>
<span class="line">docker run -d --name port_nginx -p 8080:80  nginx</span>
<span class="line"> </span>
<span class="line">docker container port port_nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-5-指向主机的随机端口" tabindex="-1"><a class="header-anchor" href="#_17-5-指向主机的随机端口"><span>17.5 指向主机的随机端口</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name random_nginx <span class="token operator">--</span>publish <span class="token number">80</span> nginx</span>
<span class="line">docker port random_nginx</span>
<span class="line"></span>
<span class="line">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name randomall_nginx <span class="token operator">--</span>publish<span class="token operator">-</span>all nginx</span>
<span class="line">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name randomall_nginx <span class="token operator">--</span><span class="token constant">P</span> nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-6-创建自定义网络" tabindex="-1"><a class="header-anchor" href="#_17-6-创建自定义网络"><span>17.6 创建自定义网络</span></a></h3><ul><li>可以创建多个网络，每个网络IP范围均不相同</li><li>docker的自定义网络里面有一个DNS服务，可以通过容器名称访问主机</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">docker network create --driver bridge myweb</span>
<span class="line"> </span>
<span class="line">docker network inspect myweb</span>
<span class="line"> </span>
<span class="line">docker run -d --name mynginx1  --net myweb nginx</span>
<span class="line">docker run -d --name mynginx2  --net myweb nginx</span>
<span class="line">docker exec -it mynginx2 bash</span>
<span class="line">ping mynginx1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-7-连接到指定网络" tabindex="-1"><a class="header-anchor" href="#_17-7-连接到指定网络"><span>17.7 连接到指定网络</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run -d --name mynginx3   nginx</span>
<span class="line">docker network connect  myweb mynginx3</span>
<span class="line">docker network disconnect myweb mynginx3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-8-移除网络" tabindex="-1"><a class="header-anchor" href="#_17-8-移除网络"><span>17.8 移除网络</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker network rm myweb</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_18-compose" tabindex="-1"><a class="header-anchor" href="#_18-compose"><span>18.compose</span></a></h2><ul><li>Compose 通过一个配置文件来管理多个Docker容器</li><li>在配置文件中，所有的容器通过services来定义，然后使用docker-compose脚本来启动、停止和重启应用和应用中的服务以及所有依赖服务的容器</li><li>步骤： <ul><li>最后，运行<code>docker-compose up</code>，Compose 将启动并运行整个应用程序 配置文件组成</li><li>services 可以定义需要的服务，每个服务都有自己的名字、使用的镜像、挂载的数据卷所属的网络和依赖的其它服务</li><li>networks 是应用的网络，在它下面可以定义使用的网络名称，类性</li><li>volumes是数据卷，可以在此定义数据卷，然后挂载到不同的服务上面使用</li></ul></li></ul><h3 id="_18-1-安装compose" tabindex="-1"><a class="header-anchor" href="#_18-1-安装compose"><span>18.1 安装compose</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum -y install epel-release</span>
<span class="line">yum -y install python-pip</span>
<span class="line">yum clean all</span>
<span class="line">pip install docker-compose</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.25.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span>
<span class="line"> </span>
<span class="line">sudo chmod +x /usr/local/bin/docker-compose</span>
<span class="line"> </span>
<span class="line">docker-compose -versio</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_18-2-编写docker-compose-yml" tabindex="-1"><a class="header-anchor" href="#_18-2-编写docker-compose-yml"><span>18.2 编写docker-compose.yml</span></a></h3><ul><li>在 <code>docker-compose.yml</code> 中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行</li><li>空格缩进表示层次</li><li>冒号空格后面有空格</li></ul><p>docker-compose.yml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span></span>
<span class="line"><span class="token literal-property property">services</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">nginx1</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">image</span><span class="token operator">:</span> nginx</span>
<span class="line">    <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;8080:80&quot;</span></span>
<span class="line">  <span class="token literal-property property">nginx2</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">image</span><span class="token operator">:</span> nginx</span>
<span class="line">    <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;8081:80&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_18-3-启动服务" tabindex="-1"><a class="header-anchor" href="#_18-3-启动服务"><span>18.3 启动服务</span></a></h3><ul><li>docker会创建默认的网络</li></ul><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">服务</th></tr></thead><tbody><tr><td style="text-align:left;">docker-compose up</td><td style="text-align:left;">启动所有的服务</td></tr><tr><td style="text-align:left;">docker-compose up -d</td><td style="text-align:left;">后台启动所有的服务</td></tr><tr><td style="text-align:left;">docker-compose ps</td><td style="text-align:left;">打印所有的容器</td></tr><tr><td style="text-align:left;">docker-compose stop</td><td style="text-align:left;">停止所有服务</td></tr><tr><td style="text-align:left;">docker-compose logs -f</td><td style="text-align:left;">持续跟踪日志</td></tr><tr><td style="text-align:left;">docker-compose exec nginx1 bash</td><td style="text-align:left;">进入nginx1服务系统</td></tr><tr><td style="text-align:left;">docker-compose rm nginx1</td><td style="text-align:left;">删除服务容器</td></tr><tr><td style="text-align:left;">docker network ls</td><td style="text-align:left;">查看网络网络不会删除</td></tr><tr><td style="text-align:left;">docker-compose down</td><td style="text-align:left;">删除所有的网络和容器</td></tr></tbody></table><blockquote><p>删除所有的容器 docker container rm <code>docker container ps -a -q</code></p></blockquote><h3 id="_18-4-网络互ping" tabindex="-1"><a class="header-anchor" href="#_18-4-网络互ping"><span>18.4 网络互ping</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker-compose up -d</span>
<span class="line">docker-compose exec nginx1 bash</span>
<span class="line">apt update &amp;&amp; apt install -y inetutils-ping</span>
<span class="line"> </span>
<span class="line">ping nginx2 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_18-5-配置数据卷" tabindex="-1"><a class="header-anchor" href="#_18-5-配置数据卷"><span>18.5 配置数据卷</span></a></h3><ul><li>networks 指定自定义网络</li><li>volumes 指定数据卷</li><li>数据卷在宿主机的位置 <code>/var/lib/docker/volumes/nginx-compose_data/_data</code></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&#39;3&#39;</span></span>
<span class="line"><span class="token literal-property property">services</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">nginx1</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">image</span><span class="token operator">:</span> nginx</span>
<span class="line">    <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;8081:80&quot;</span></span>
<span class="line">    <span class="token literal-property property">networks</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;newweb&quot;</span></span>
<span class="line">    <span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;data:/data&quot;</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;./nginx1:/usr/share/nginx/html&quot;</span></span>
<span class="line">  <span class="token literal-property property">nginx2</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">image</span><span class="token operator">:</span> nginx</span>
<span class="line">    <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;8082:80&quot;</span></span>
<span class="line">    <span class="token literal-property property">networks</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;default&quot;</span></span>
<span class="line">    <span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;data:/data&quot;</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;./nginx2:/usr/share/nginx/html&quot;</span></span>
<span class="line">  <span class="token literal-property property">nginx3</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">image</span><span class="token operator">:</span> nginx</span>
<span class="line">    <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;8083:80&quot;</span></span>
<span class="line">    <span class="token literal-property property">networks</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;default&quot;</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;newweb&quot;</span></span>
<span class="line">    <span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;data:/data&quot;</span></span>
<span class="line">      <span class="token operator">-</span> <span class="token string">&quot;./nginx3:/usr/share/nginx/html&quot;</span></span>
<span class="line"><span class="token literal-property property">networks</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">newweb</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">driver</span><span class="token operator">:</span> bridge</span>
<span class="line"><span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">data</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">driver</span><span class="token operator">:</span> local</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker exec nginx<span class="token operator">-</span>compose_nginx1_1  bash</span>
<span class="line">cd <span class="token operator">/</span>data </span>
<span class="line">touch <span class="token number">1</span><span class="token punctuation">.</span>txt</span>
<span class="line">exit</span>
<span class="line">cd <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>docker<span class="token operator">/</span>volumes<span class="token operator">/</span>nginx<span class="token operator">-</span>compose_data<span class="token operator">/</span>_data</span>
<span class="line">ls</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_19-node项目" tabindex="-1"><a class="header-anchor" href="#_19-node项目"><span>19. node项目</span></a></h2><ul><li>nodeapp 是一个用 Docker 搭建的本地 Node.js 应用开发与运行环境。</li></ul><h3 id="_19-1-服务分类" tabindex="-1"><a class="header-anchor" href="#_19-1-服务分类"><span>19.1 服务分类</span></a></h3><ul><li>db：使用 <code>mariadb</code> 作为应用的数据库</li><li>node：启动<code>node</code>服务</li><li>web：使用 <code>nginx</code> 作为应用的 web 服务器</li></ul><h3 id="_19-2-app目录结构" tabindex="-1"><a class="header-anchor" href="#_19-2-app目录结构"><span>19.2 app目录结构</span></a></h3><table><thead><tr><th style="text-align:left;">文件</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">docker-compose.yml</td><td style="text-align:left;">定义本地开发环境需要的服务</td></tr><tr><td style="text-align:left;">images/nginx/config/default.conf</td><td style="text-align:left;">nginx 配置文件</td></tr><tr><td style="text-align:left;">images/node/Dockerfile</td><td style="text-align:left;">node的Dockfile配置文件</td></tr><tr><td style="text-align:left;">images/node/web/package.json</td><td style="text-align:left;">项目文件</td></tr><tr><td style="text-align:left;">images/node/web/public/index.html</td><td style="text-align:left;">静态首页</td></tr><tr><td style="text-align:left;">images/node/web/server.js</td><td style="text-align:left;">node服务</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">├── docker<span class="token operator">-</span>compose<span class="token punctuation">.</span>yml</span>
<span class="line">└── images</span>
<span class="line">    ├── nginx</span>
<span class="line">    │   └── config</span>
<span class="line">    │       └── <span class="token keyword">default</span><span class="token punctuation">.</span>conf</span>
<span class="line">    └── node</span>
<span class="line">        ├── Dockerfile</span>
<span class="line">        └── web</span>
<span class="line">            ├── <span class="token keyword">package</span><span class="token punctuation">.</span>json</span>
<span class="line">            ├── <span class="token keyword">public</span></span>
<span class="line">            │   └── index<span class="token punctuation">.</span>html</span>
<span class="line">            └── server<span class="token punctuation">.</span>js</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_19-2-1-docker-compose-yml" tabindex="-1"><a class="header-anchor" href="#_19-2-1-docker-compose-yml"><span>19.2.1 docker-compose.yml</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span></span>
<span class="line"><span class="token literal-property property">services</span><span class="token operator">:</span></span>
<span class="line"> <span class="token literal-property property">node</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">build</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>images<span class="token operator">/</span>node</span>
<span class="line">    <span class="token literal-property property">dockerfile</span><span class="token operator">:</span> Dockerfile</span>
<span class="line">  <span class="token literal-property property">depends_on</span><span class="token operator">:</span></span>
<span class="line">   <span class="token operator">-</span> db</span>
<span class="line"> <span class="token literal-property property">web</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">image</span><span class="token operator">:</span> nginx</span>
<span class="line">  <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">   <span class="token operator">-</span> <span class="token string">&quot;8080:80&quot;</span></span>
<span class="line">  <span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line">   <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>images<span class="token operator">/</span>nginx<span class="token operator">/</span>config<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d</span>
<span class="line">   <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>images<span class="token operator">/</span>node<span class="token operator">/</span>web<span class="token operator">/</span><span class="token keyword">public</span><span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">public</span>  </span>
<span class="line">  <span class="token literal-property property">depends_on</span><span class="token operator">:</span></span>
<span class="line">   <span class="token operator">-</span> node</span>
<span class="line"> <span class="token literal-property property">db</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">image</span><span class="token operator">:</span> mariadb</span>
<span class="line">  <span class="token literal-property property">environment</span><span class="token operator">:</span></span>
<span class="line">   <span class="token constant">MYSQL_ROOT_PASSWORD</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span></span>
<span class="line">   <span class="token constant">MYSQL_DATABASE</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span></span>
<span class="line">   <span class="token constant">MYSQL_USER</span><span class="token operator">:</span> <span class="token string">&quot;zfpx&quot;</span></span>
<span class="line">   <span class="token constant">MYSQL_PASSWORD</span><span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span></span>
<span class="line">  <span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line">    <span class="token operator">-</span> db<span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql</span>
<span class="line"><span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line"> <span class="token literal-property property">db</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">driver</span><span class="token operator">:</span> local</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_19-2-2-server-js" tabindex="-1"><a class="header-anchor" href="#_19-2-2-server-js"><span>19.2.2 server.js</span></a></h4><p>images/node/web/server.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> mysql  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mysql&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">host</span>     <span class="token operator">:</span> <span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">user</span>     <span class="token operator">:</span> <span class="token string">&#39;zfpx&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">password</span> <span class="token operator">:</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">database</span> <span class="token operator">:</span> <span class="token string">&#39;node&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> server<span class="token operator">=</span>http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&#39;SELECT 2 + 2 AS solution&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> results<span class="token punctuation">,</span> fields</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">throw</span> error<span class="token punctuation">;</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token operator">+</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>solution<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_19-2-3-package-json" tabindex="-1"><a class="header-anchor" href="#_19-2-3-package-json"><span>19.2.3 package.json</span></a></h4><p>images/node/web/package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line"><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server.js&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;mysql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.16.0&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_19-2-4-images-node-dockerfile" tabindex="-1"><a class="header-anchor" href="#_19-2-4-images-node-dockerfile"><span>19.2.4 images/node/Dockerfile</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">FROM</span> node</span>
<span class="line"><span class="token constant">MAINTAINER</span> zhangrenyang <span class="token operator">&lt;</span>zhang_renyang@<span class="token number">126</span><span class="token punctuation">.</span>com<span class="token operator">&gt;</span></span>
<span class="line"><span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>web <span class="token operator">/</span>web</span>
<span class="line"><span class="token constant">WORKDIR</span> <span class="token operator">/</span>web</span>
<span class="line"><span class="token constant">RUN</span> npm install</span>
<span class="line"><span class="token constant">CMD</span> npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_19-2-5-images-nginx-config-default-conf" tabindex="-1"><a class="header-anchor" href="#_19-2-5-images-nginx-config-default-conf"><span>19.2.5 images/nginx/config/default.conf</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">upstream backend <span class="token punctuation">{</span></span>
<span class="line">    server node<span class="token operator">:</span><span class="token number">3000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">server <span class="token punctuation">{</span></span>
<span class="line">    listen <span class="token number">80</span><span class="token punctuation">;</span></span>
<span class="line">    server_name localhost<span class="token punctuation">;</span></span>
<span class="line">    root <span class="token operator">/</span><span class="token keyword">public</span><span class="token punctuation">;</span></span>
<span class="line">    index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    location <span class="token operator">/</span>api <span class="token punctuation">{</span></span>
<span class="line">        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_20-参考" tabindex="-1"><a class="header-anchor" href="#_20-参考"><span>20. 参考</span></a></h2><ul><li><a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html" target="_blank" rel="noopener noreferrer">yaml</a></li><li><a href="https://www.npmjs.com/package/mysql" target="_blank" rel="noopener noreferrer">mysql</a></li></ul>`,115))])}const b=o(m,[["render",g]]),x=JSON.parse('{"path":"/strong/125.11.docker.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/125.11.docker.md"}');export{b as comp,x as data};
