import{_ as n,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const l={};function t(r,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-kubernetes介绍" tabindex="-1"><a class="header-anchor" href="#_1-kubernetes介绍"><span>1. Kubernetes介绍</span></a></h2><ul><li>Master是控制节点,负责编排、管理、调度用户提交的作业 <ul><li>负责API服务的<code>kube-apiserver</code></li><li>负责调度的<code>kube-scheduler</code></li><li>负责容器编排的<code>kube-controller-manager</code></li><li><code>kube-apiserver</code>会处理集群的持久化数据并保存在<code>etcd</code>中</li></ul></li><li>Node是计算节点 <ul><li>CRI(Container Runtime Interface)的远程调用接口，这个接口定义了容器运行时的各项核心操作</li><li>OCI(Open Container Initiative) 容器运行时通过OCI同底层的Linux操作系统进行交互</li><li>设备插件是用来管理宿主机物理设备的组件</li><li><a href="http://doc.oschina.net/grpc" target="_blank" rel="noopener noreferrer">gRPC</a>是可以在任何环境中运行的现代开源高性能 RPC 框架</li><li>RPC是指远程过程调用，也就是说两台服务器A，B，一个应用部署在A服务器上，想要调用B服务器上应用提供的函数/方法，由于不在一个内存空间，不能直接调用，需要通过网络来表达调用的语义和传达调用的数据</li></ul></li></ul><p><img src="https://img.zhufengpeixun.com/bc263d89a4e90ce3a0902a5181d3baef" alt="bc263d89a4e90ce3a0902a5181d3baef"></p><p><img src="https://img.zhufengpeixun.com/6376f226526ca6957a3cd33a4fa9435a" alt="6376f226526ca6957a3cd33a4fa9435a"></p><h3 id="_1-1-pod" tabindex="-1"><a class="header-anchor" href="#_1-1-pod"><span>1.1 Pod</span></a></h3><ul><li>Pod 是 K8S 中最小的可调度单元（可操作/可部署单元）</li><li>它里面可以包含1个或者多个 Docker 容器</li><li>在 Pod 内的所有 Docker 容器，都会共享同一个网络、存储卷、端口映射规则</li><li>一个 Pod 拥有一个 IP,但这个 IP 会随着Pod的重启，创建，删除等跟着改变，所以不固定且不完全可靠,这也就是 Pod 的 IP 漂移问题。这个问题我们可以使用下面的 Service 去自动映射</li><li>Pod 是一个容器组，里面有很多容器，容器组内共享资源</li></ul><p><img src="https://img.zhufengpeixun.com/b2c720b50cdea123123344b9c0325cd5" alt="pod"></p><h3 id="_1-2-deployment" tabindex="-1"><a class="header-anchor" href="#_1-2-deployment"><span>1.2 deployment</span></a></h3><ul><li>希望批量启动和管理多个Pod实例，就可以使用deployment</li></ul><h3 id="_1-3-service" tabindex="-1"><a class="header-anchor" href="#_1-3-service"><span>1.3 Service</span></a></h3><ul><li>有了Pod实例后就需要以固定的IP地址以负载均衡的方式访问多个Pod实例，就有了Service</li></ul><h2 id="_2-部署" tabindex="-1"><a class="header-anchor" href="#_2-部署"><span>2.部署</span></a></h2><h3 id="_2-1-编写配置文件" tabindex="-1"><a class="header-anchor" href="#_2-1-编写配置文件"><span>2.1 编写配置文件</span></a></h3><ul><li>Kubernetes 最核心的设计理念就是声明式 API</li><li>声明式 API可以用来描述容器化业务和容器间关系</li><li><a href="https://matthewpalmer.net/kubernetes-app-developer/articles/kubernetes-apiversion-definition-guide.html" target="_blank" rel="noopener noreferrer">apiversion</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir deployment &amp;&amp; cd deployment</span>
<span class="line">vim deployment-user-v1.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> <span class="token literal-property property">apiVersion</span><span class="token operator">:</span> apps<span class="token operator">/</span>v1  </span>
<span class="line"> <span class="token literal-property property">kind</span><span class="token operator">:</span> Deployment     </span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">   <span class="token literal-property property">name</span><span class="token operator">:</span> user<span class="token operator">-</span>v1     </span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">matchLabels</span><span class="token operator">:</span></span>
<span class="line">       <span class="token literal-property property">app</span><span class="token operator">:</span> user<span class="token operator">-</span>v1 </span>
<span class="line">   <span class="token literal-property property">replicas</span><span class="token operator">:</span> <span class="token number">3</span> </span>
<span class="line">  <span class="token literal-property property">template</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">labels</span><span class="token operator">:</span></span>
<span class="line">         <span class="token literal-property property">app</span><span class="token operator">:</span> user<span class="token operator">-</span>v1 </span>
<span class="line">     <span class="token literal-property property">spec</span><span class="token operator">:</span>   </span>
<span class="line">      <span class="token literal-property property">containers</span><span class="token operator">:</span></span>
<span class="line">       <span class="token operator">-</span> name<span class="token operator">:</span> nginx </span>
<span class="line">         <span class="token literal-property property">image</span><span class="token operator">:</span> registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>nginx<span class="token operator">:</span>user<span class="token operator">-</span>v1 </span>
<span class="line">        <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">         <span class="token operator">-</span> containerPort<span class="token operator">:</span> <span class="token number">80</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-布署pod" tabindex="-1"><a class="header-anchor" href="#_2-2-布署pod"><span>2.2 布署Pod</span></a></h3><ul><li><code>kubectl apply</code> 代表准备对资源进行配置</li><li>-f 等于 --filename 后面可以跟随多个配置文件</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f deployment-user-v1.yaml</span>
<span class="line">deployment.apps/user-v1 created</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>想查看部署完毕后的 Pod 运行状态，当状态都是 Running 时，代表 Pod 运行正常 <ul><li>name 是 Pod的名称</li><li>READY 为容器状态，格式为可用容器/所有容器数量</li><li>STATUS 为 Pod 的运行状态</li><li>RESTARTS 为重启数量</li><li>AGE 为 Pod 运行时间</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token keyword">get</span> pod</span>
<span class="line"><span class="token constant">NAME</span>                        <span class="token constant">READY</span>   <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span></span>
<span class="line">user<span class="token operator">-</span>8445fbf8d7<span class="token operator">-</span>6f6d7       <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     ContainerCreating   <span class="token number">0</span>          13s</span>
<span class="line">user<span class="token operator">-</span>8445fbf8d7<span class="token operator">-</span>nggzv       <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     ContainerCreating   <span class="token number">0</span>          13s</span>
<span class="line">user<span class="token operator">-</span>8445fbf8d7<span class="token operator">-</span>xfn52       <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     ContainerCreating   <span class="token number">0</span>          13s</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-service" tabindex="-1"><a class="header-anchor" href="#_2-3-service"><span>2.3 Service</span></a></h3><ul><li>deployment 是无状态的</li><li>deployment 并不会对 pod 进行网络通信和分发</li><li>Pod 的 IP 在运行时还会经常进行漂移且不固定</li><li>想访问服务需要使用 Service 组织统一的 Pod 访问入口</li><li>可以定义Service 来进行统一组织 Pod 服务访问</li><li>负责自动调度和组织deployment中 Pod 的服务访问，由于自动映射 Pod 的IP，同时也解决了 Pod 的IP漂移问题</li></ul><p><img src="https://img.zhufengpeixun.com/e98326ae235c5da3ee69e3e42981f424" alt="service"></p><h4 id="_2-3-1-配置文件" tabindex="-1"><a class="header-anchor" href="#_2-3-1-配置文件"><span>2.3.1 配置文件</span></a></h4><ul><li><a href="http://www.dockerone.com/article/4884" target="_blank" rel="noopener noreferrer">Kubernetes的三种外部访问方式</a></li><li>NodePort服务是引导外部流量到你的服务的最原始方式</li><li>NodePort在所有节点上开放一个特定端口,任何发送到该端口的流量都被转发到对应服务</li></ul><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">protocol</td><td style="text-align:left;">通信类型（TCP/UDP）</td></tr><tr><td style="text-align:left;">targetPort</td><td style="text-align:left;">原本 Pod 开放的端口</td></tr><tr><td style="text-align:left;">port</td><td style="text-align:left;">Kubernetes容器之间互相访问的端口</td></tr><tr><td style="text-align:left;">type</td><td style="text-align:left;">NodePort，Service的一种访问方式</td></tr></tbody></table><p>user-service-v1.yaml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> Service</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> service<span class="token operator">-</span>user<span class="token operator">-</span>v1</span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">app</span><span class="token operator">:</span> user<span class="token operator">-</span>v1</span>
<span class="line">  <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">  <span class="token operator">-</span> protocol<span class="token operator">:</span> <span class="token constant">TCP</span></span>
<span class="line">    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">80</span></span>
<span class="line">    <span class="token literal-property property">targetPort</span><span class="token operator">:</span> <span class="token number">80</span></span>
<span class="line">  <span class="token literal-property property">type</span><span class="token operator">:</span> NodePort</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-2-启动" tabindex="-1"><a class="header-anchor" href="#_2-3-2-启动"><span>2.3.2 启动</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f user-service-v1.yaml</span>
<span class="line">service/service-user-v1 created</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看当前的服务</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token keyword">get</span> svc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>可以在任何节点上访问</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.31</span><span class="token number">.178</span><span class="token number">.169</span><span class="token operator">:</span><span class="token number">30859</span></span>
<span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.31</span><span class="token number">.178</span><span class="token number">.170</span><span class="token operator">:</span><span class="token number">30859</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-ingress" tabindex="-1"><a class="header-anchor" href="#_2-4-ingress"><span>2.4 ingress</span></a></h3><ul><li>我们可能会根据请求路径前缀的匹配，权重，甚至根据 <code>cookie/header</code> 的值去访问不同的服务</li><li>为了达到这种负载均衡的效果，我们可以使用kubernetes的另一个组件<code>ingress</code></li><li>ingress-nginx 是基于 nginx 的一个 ingress 实现。</li><li>可以实现正则匹配路径，流量转发，基于 cookie header 切分流量（灰度发布）</li></ul><p><img src="https://img.zhufengpeixun.com/ec4038a49d0f6eb986be1e5144fc6e41" alt="ec4038a49d0f6eb986be1e5144fc6e41"></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">wget https://img.zhufengpeixun.com/deploy.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>vi deploy.yaml d$</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">  namespace: ingress-nginx</span>
<span class="line">spec:</span>
<span class="line">  type: NodePort</span>
<span class="line">  ports:</span>
<span class="line">    - name: http</span>
<span class="line">      port: 80</span>
<span class="line">      protocol: TCP</span>
<span class="line">      targetPort: http</span>
<span class="line">+     nodePort: 31234</span>
<span class="line">    - name: https</span>
<span class="line">      port: 443</span>
<span class="line">      protocol: TCP</span>
<span class="line">      targetPort: https</span>
<span class="line">+     nodePort: 31235</span>
<span class="line"></span>
<span class="line">+ image: registry.cn-hangzhou.aliyuncs.com/bin_x/nginx-ingress:v0.34.1@sha256:80359bdf124d49264fabf136d2aecadac729b54f16618162194356d3c78ce2fe</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>配置生效，拉取ingress镜像并自动布署ingress</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f deploy.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>查看pods的部署状态</p><ul><li>-n 指定命名空间查询</li><li>-l 指定label名称查询</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token operator">-</span>n ingress<span class="token operator">-</span>nginx <span class="token keyword">get</span> svc</span>
<span class="line"><span class="token constant">NAME</span>                                 <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>      <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>                      <span class="token constant">AGE</span></span>
<span class="line">ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller             NodePort    <span class="token number">10.108</span><span class="token number">.109</span><span class="token number">.94</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">:</span><span class="token number">31234</span><span class="token operator">/</span><span class="token constant">TCP</span><span class="token punctuation">,</span><span class="token number">443</span><span class="token operator">:</span><span class="token number">31235</span><span class="token operator">/</span><span class="token constant">TCP</span>   16m</span>
<span class="line">ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller<span class="token operator">-</span>admission   ClusterIP   <span class="token number">10.106</span><span class="token number">.43</span><span class="token number">.59</span>    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span><span class="token constant">TCP</span>                      16m</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token operator">-</span>n ingress<span class="token operator">-</span>nginx <span class="token keyword">get</span> svc</span>
<span class="line"><span class="token constant">NAME</span>                                 <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>      <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>                      <span class="token constant">AGE</span></span>
<span class="line">ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller             NodePort    <span class="token number">10.108</span><span class="token number">.109</span><span class="token number">.94</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">:</span><span class="token number">31234</span><span class="token operator">/</span><span class="token constant">TCP</span><span class="token punctuation">,</span><span class="token number">443</span><span class="token operator">:</span><span class="token number">31235</span><span class="token operator">/</span><span class="token constant">TCP</span>   17m</span>
<span class="line">ingress<span class="token operator">-</span>nginx<span class="token operator">-</span>controller<span class="token operator">-</span>admission   ClusterIP   <span class="token number">10.106</span><span class="token number">.43</span><span class="token number">.59</span>    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span><span class="token constant">TCP</span>                      17m</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ingress 服务的配置也是使用 yaml 文件进行管理</li><li><a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/" target="_blank" rel="noopener noreferrer">annotations</a> 是 ingress 的主要配置项目，可以用来修改这些配置来修改 ingress 的行为。我们可以通过修改这些配置来实现灰度发布，跨域资源，甚至将 <a href="http://www.abc.com" target="_blank" rel="noopener noreferrer">www.abc.com</a> 重定向到 abc.com</li><li>rules 是 ingress 配置路径转发规则的地方,当我们去访问 /front 时， ingress 就会帮我们调度到 front-service-v1 这个 service 上面 <ul><li>path 可以是一个路径字符串，也可以是一个正则表达式</li><li>backend 则是 k8s 的 service 服务， serviceName 是服务名称， servicePort 是服务端口</li></ul></li><li>backend 可以用来给 ingress 设置默认访问的 Service 服务。当请求不匹配 rules 中任何一条规则时，则会去走 backend 中的配置</li></ul><p>vi ingress.yaml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">apiVersion: extensions/v1beta1</span>
<span class="line">kind: Ingress</span>
<span class="line">metadata:</span>
<span class="line">  name: nginx-ingress</span>
<span class="line">  annotations:</span>
<span class="line">    nginx.ingress.kubernetes.io/rewrite-target: /</span>
<span class="line">    kubernetes.io/ingress.class: nginx</span>
<span class="line">spec:</span>
<span class="line">  rules:</span>
<span class="line">  - http:</span>
<span class="line">      paths: </span>
<span class="line">       - path: /user</span>
<span class="line">         backend:</span>
<span class="line">          serviceName: user-service-v1</span>
<span class="line">          servicePort: 80</span>
<span class="line">       - path: /pay</span>
<span class="line">         backend:</span>
<span class="line">          serviceName: pay-service-v1</span>
<span class="line">          servicePort: 80    </span>
<span class="line">  backend:</span>
<span class="line">     serviceName: user-service-v1</span>
<span class="line">     servicePort: 80</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f ./ingress.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.244</span><span class="token number">.93</span><span class="token operator">:</span><span class="token number">31234</span><span class="token operator">/</span>user</span>
<span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.244</span><span class="token number">.94</span><span class="token operator">:</span><span class="token number">31234</span><span class="token operator">/</span>user</span>
<span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.244</span><span class="token number">.93</span><span class="token operator">:</span><span class="token number">31234</span><span class="token operator">/</span>pay</span>
<span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.244</span><span class="token number">.94</span><span class="token operator">:</span><span class="token number">31234</span><span class="token operator">/</span>pay</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl  describe   ingress</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-参考" tabindex="-1"><a class="header-anchor" href="#_3-参考"><span>3.参考</span></a></h2><h3 id="_3-1-查看" tabindex="-1"><a class="header-anchor" href="#_3-1-查看"><span>3.1 查看</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//查看当前的deployment</span></span>
<span class="line">kubectl <span class="token keyword">get</span> deploy </span>
<span class="line"><span class="token comment">//删除deploy 删除后ReplicateSet和pod也没有了</span></span>
<span class="line">kubectl <span class="token keyword">delete</span> deploy nginx</span>
<span class="line"></span>
<span class="line"><span class="token comment">//查看Replication Controller</span></span>
<span class="line">kubectl <span class="token keyword">get</span> rc</span>
<span class="line"><span class="token comment">//删除Replication Controller,删除后Pod也没有了</span></span>
<span class="line">kubectl <span class="token keyword">delete</span> rc mysql</span>
<span class="line"></span>
<span class="line"><span class="token comment">//查看pod</span></span>
<span class="line">kubectl <span class="token keyword">get</span> pod</span>
<span class="line"><span class="token comment">//删除pod</span></span>
<span class="line">kubectl <span class="token keyword">delete</span> pod mysql<span class="token operator">-</span>77w7z</span>
<span class="line"></span>
<span class="line"><span class="token comment">//查看服务</span></span>
<span class="line">kubectl <span class="token keyword">get</span> svc</span>
<span class="line"><span class="token comment">//删除服务</span></span>
<span class="line">kubectl <span class="token keyword">delete</span> service nginx</span>
<span class="line"></span>
<span class="line"><span class="token comment">//查看pod详情</span></span>
<span class="line">kubectl describe pod fail<span class="token operator">-</span><span class="token number">1034443984</span><span class="token operator">-</span>jerry</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-发布镜像" tabindex="-1"><a class="header-anchor" href="#_3-2-发布镜像"><span>3.2 发布镜像</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//登录阿里云Docker Registry</span></span>
<span class="line">sudo docker login <span class="token operator">--</span>username<span class="token operator">=</span>hongqishiq@<span class="token number">126</span><span class="token punctuation">.</span>com registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com</span>
<span class="line"><span class="token comment">//从Registry中拉取镜像</span></span>
<span class="line">docker pull registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>zhangrenyang<span class="token operator">:</span><span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span></span>
<span class="line"><span class="token comment">//将镜像推送到Registry</span></span>
<span class="line">docker login <span class="token operator">--</span>username<span class="token operator">=</span>hongqishiq@<span class="token number">126</span><span class="token punctuation">.</span>com registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com</span>
<span class="line">docker tag <span class="token punctuation">[</span>ImageId<span class="token punctuation">]</span> registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>zhangrenyang<span class="token operator">:</span><span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span></span>
<span class="line">docker push registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>zhangrenyang<span class="token operator">:</span><span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker login <span class="token operator">--</span>username<span class="token operator">=</span>hongqishiq@<span class="token number">126</span><span class="token punctuation">.</span>com registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com</span>
<span class="line">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token operator">:</span><span class="token number">80</span> nginx</span>
<span class="line">docker exec <span class="token operator">-</span>it 6764db063e37  bash</span>
<span class="line"><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html</span>
<span class="line">docker container commit <span class="token operator">-</span>m<span class="token string">&quot;nginx-user-v1&quot;</span> <span class="token operator">-</span>a<span class="token string">&quot;zhangrenyang&quot;</span> 6764db063e37  registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>nginx<span class="token operator">:</span>user<span class="token operator">-</span>v1</span>
<span class="line">docker container commit <span class="token operator">-</span>m<span class="token string">&quot;nginx-user-v2&quot;</span> <span class="token operator">-</span>a<span class="token string">&quot;zhangrenyang&quot;</span> 6764db063e37  registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>nginx<span class="token operator">:</span>user<span class="token operator">-</span>v2</span>
<span class="line">docker container commit <span class="token operator">-</span>m<span class="token string">&quot;nginx-pay-v1&quot;</span> <span class="token operator">-</span>a<span class="token string">&quot;zhangrenyang&quot;</span> 6764db063e37  registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>nginx<span class="token operator">:</span>pay<span class="token operator">-</span>v1</span>
<span class="line">docker push registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>zhangrenyang<span class="token operator">/</span>http<span class="token operator">-</span>probe<span class="token operator">:</span><span class="token number">1.0</span><span class="token number">.0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-链接" tabindex="-1"><a class="header-anchor" href="#_3-3-链接"><span>3.3 链接</span></a></h3><ul><li><a href="http://docs.kubernetes.org.cn/" target="_blank" rel="noopener noreferrer">Kubernetes中文社区</a></li><li>[kubectl Cheat Sheet](http://docs.kubernetes.org.cn/783.html</li><li><a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" rel="noopener noreferrer">kubernetes.cheatsheet</a></li><li><a href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noopener noreferrer">namespaces</a>Kubernetes 支持多个虚拟集群，它们底层依赖于同一个物理集群。 这些虚拟集群被称为命名空间</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token keyword">get</span> ns</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,59)])])}const o=n(l,[["render",t]]),c=JSON.parse('{"path":"/strong/125.14.k8s.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/125.14.k8s.md"}');export{o as comp,c as data};
