import{_ as n,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(i,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-http" tabindex="-1"><a class="header-anchor" href="#_1-http"><span>1.HTTP</span></a></h2><ul><li>HTTP 协议(HyperText Transfer Protocol，超文本传输协议)是客户端浏览器或其他程序与Web服务器之间的应用层通信协议</li></ul><h3 id="_1-1-http服务器" tabindex="-1"><a class="header-anchor" href="#_1-1-http服务器"><span>1.1 HTTP服务器</span></a></h3><p><img src="http://img.zhufengpeixun.cn/1.httpprotocal.jpg" alt=""></p><p><img src="http://img.zhufengpeixun.cn/1.httpprotocal.png" alt=""></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">tcp<span class="token punctuation">.</span>port <span class="token operator">==</span> <span class="token number">7788</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">7788</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;listening 7788&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-http三大风险" tabindex="-1"><a class="header-anchor" href="#_1-2-http三大风险"><span>1.2 HTTP三大风险</span></a></h3><ul><li>(1)窃听风险：黑客可以获知通信内容</li><li>(2)篡改风险：黑客可以修改通信内容</li><li>(3)冒充风险：黑客可以冒充他人身份参与通信</li></ul><p><img src="http://img.zhufengpeixun.cn/2.httpprotocaldanger.jpg" alt=""></p><h2 id="_2-https" tabindex="-1"><a class="header-anchor" href="#_2-https"><span>2. HTTPS</span></a></h2><ul><li>HTTP = HTTP+TLS/SSL</li></ul><table><thead><tr><th style="text-align:left;">风险</th><th style="text-align:left;">对策</th><th style="text-align:left;">方法</th></tr></thead><tbody><tr><td style="text-align:left;">信息窃听</td><td style="text-align:left;">信息加密</td><td style="text-align:left;">对称加密 AES</td></tr><tr><td style="text-align:left;">密钥传递</td><td style="text-align:left;">密钥协商</td><td style="text-align:left;">非对称加密(RSA和ECC)</td></tr><tr><td style="text-align:left;">信息篡改</td><td style="text-align:left;">完整性校验</td><td style="text-align:left;">散列算法(MD5和SHA)</td></tr><tr><td style="text-align:left;">身份冒充</td><td style="text-align:left;">CA权威机构</td><td style="text-align:left;">散列算法(MD5和SHA)+RSA签名</td></tr></tbody></table><h2 id="_3-加密算法" tabindex="-1"><a class="header-anchor" href="#_3-加密算法"><span>3. 加密算法</span></a></h2><h3 id="_3-1-对称加密-aes" tabindex="-1"><a class="header-anchor" href="#_3-1-对称加密-aes"><span>3.1 对称加密 AES</span></a></h3><ul><li>加密和解密使用同一个密钥</li></ul><p><img src="http://img.zhufengpeixun.cn/Symmetric_encryption.jpg" alt=""></p><h3 id="_3-2-非对称加密" tabindex="-1"><a class="header-anchor" href="#_3-2-非对称加密"><span>3.2 非对称加密</span></a></h3><p><img src="http://img.zhufengpeixun.cn/4.rsakey.jpg" alt=""></p><h3 id="_3-3-哈希算法" tabindex="-1"><a class="header-anchor" href="#_3-3-哈希算法"><span>3.3 哈希算法</span></a></h3><ul><li>哈希函数的作用是给一个任意长度的数据生成出一个固定长度的数据 <ul><li>安全性 可以从给定的数据X计算出哈希值Y，但不能从哈希值Y计算机数据X</li><li>独一无二 不同的数据一定会产出不同的哈希值</li><li>长度固定 不管输入多大的数据,输出长度都是固定的</li></ul></li></ul><p><img src="http://img.zhufengpeixun.cn/5.hashkey.jpg" alt="5.hashkey"></p><h3 id="_3-4-签名" tabindex="-1"><a class="header-anchor" href="#_3-4-签名"><span>3.4 签名</span></a></h3><ul><li>数字签名的基本原理是用私钥去签名，而用公钥去验证签名</li></ul><p><img src="http://img.zhufengpeixun.cn/verify3.png" alt="verify3"></p><h3 id="_3-5-数字证书" tabindex="-1"><a class="header-anchor" href="#_3-5-数字证书"><span>3.5 数字证书</span></a></h3><ul><li>数字证书是一个由可信的第三方发出的，用来证明所有人身份以及所有人拥有某个公钥的电子文件</li></ul><p><img src="http://img.zhufengpeixun.cn/certification3.jpg" alt="certification3"></p><h3 id="_3-6-密钥交换" tabindex="-1"><a class="header-anchor" href="#_3-6-密钥交换"><span>3.6 密钥交换</span></a></h3><ul><li>Diffie-Hellman算法是一种密钥交换协议，它可以让双方在不泄漏密钥的情况下协商出一个密钥来</li></ul><p><img src="http://img.zhufengpeixun.cn/6.DiffieHellman.jpg" alt=""></p><h3 id="_3-7-ecc" tabindex="-1"><a class="header-anchor" href="#_3-7-ecc"><span>3.7 ECC</span></a></h3><ul><li>椭圆曲线加密算法(ECC) 是基于椭圆曲线数学的一种公钥加密的算法</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> basic <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">//共享basic</span></span>
<span class="line"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> basicA <span class="token operator">=</span> basic <span class="token operator">*</span> a<span class="token punctuation">;</span><span class="token comment">//15</span></span>
<span class="line"><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> basicB <span class="token operator">=</span> basic <span class="token operator">*</span> b<span class="token punctuation">;</span><span class="token comment">//21</span></span>
<span class="line"></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">*</span> basicB<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//105</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">*</span> basicA<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//105</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://img.zhufengpeixun.cn/ecc.png" alt=""></p><h2 id="_4-加密过程" tabindex="-1"><a class="header-anchor" href="#_4-加密过程"><span>4. 加密过程</span></a></h2><ul><li><code>firefox: https://47.105.191.39\`\`ip.addr ==47.105.191.39 and tls</code></li></ul><p><img src="http://img.zhufengpeixun.cn/httpsoverflow.jpg" alt=""></p><h3 id="_4-1-clienthello" tabindex="-1"><a class="header-anchor" href="#_4-1-clienthello"><span>4.1 ClientHello</span></a></h3><ul><li>在一次新的握手流程中，客户端先发送ClientHello <ul><li>Version 协议版本</li><li>Random 包含32个字节的随机数 28随机数字节+4字节时间戳,随机数是为了保证每一次连接者是独立无二的</li><li>Cipher Suites 客户端支持的所有密码套件</li><li>Extensions 扩展的额外数据</li></ul></li></ul><p><img src="http://img.zhufengpeixun.cn/1.clienthello.png" alt="1.clienthello.png"></p><h3 id="_4-2-serverhello" tabindex="-1"><a class="header-anchor" href="#_4-2-serverhello"><span>4.2 ServerHello</span></a></h3><ul><li>将服务器选择的连接参数发回给客户端，消息结构和ClientHello类似 ，每个字段只包含一个选项</li></ul><p><img src="http://img.zhufengpeixun.cn/2.serverres.png" alt="serverres"></p><p><img src="http://img.zhufengpeixun.cn/3.serverhello.png" alt="serverhello"></p><h3 id="_4-3-certificate" tabindex="-1"><a class="header-anchor" href="#_4-3-certificate"><span>4.3 Certificate</span></a></h3><ul><li>Certificate消息发送X.509证书</li></ul><p><img src="http://img.zhufengpeixun.cn/4.certificate.png" alt="4.certificate.png"></p><h3 id="_4-4-serverkeyexchange" tabindex="-1"><a class="header-anchor" href="#_4-4-serverkeyexchange"><span>4.4 ServerKeyExchange</span></a></h3><ul><li>ServerKeyExchange的目的在于发送交换密钥的参数</li></ul><p><img src="http://img.zhufengpeixun.cn/5.serverkeyexchange.png" alt="5.serverkeyexchange.png"></p><h3 id="_4-5-server-hello-done" tabindex="-1"><a class="header-anchor" href="#_4-5-server-hello-done"><span>4.5 Server Hello Done</span></a></h3><ul><li>ClientKeyExchange消息携带客户端为密钥交换的所有信息</li></ul><p><img src="http://img.zhufengpeixun.cn/6.serverhellodone.png" alt="6.serverhellodone.png"></p><h3 id="_4-6-clientkeyexchange" tabindex="-1"><a class="header-anchor" href="#_4-6-clientkeyexchange"><span>4.6 ClientKeyExchange</span></a></h3><ul><li>ClientKeyExchange消息携带客户端为密钥交换的所有信息</li></ul><p><img src="http://img.zhufengpeixun.cn/7.clientkeyexchange.png" alt="clientkeyexchange"></p><h3 id="_4-7-changecipherspec" tabindex="-1"><a class="header-anchor" href="#_4-7-changecipherspec"><span>4.7 ChangeCipherSpec</span></a></h3><ul><li>ChangeCipherSpec表示客户端已经得到了连接参数的足够信息，已生成加密密钥，并切换到了加密模式</li></ul><p><img src="http://img.zhufengpeixun.cn/8.ChangeCipherSpec.png" alt="ChangeCipherSpec"></p><h3 id="_4-8-encryptedhandshakemessage" tabindex="-1"><a class="header-anchor" href="#_4-8-encryptedhandshakemessage"><span>4.8 EncryptedHandshakeMessage</span></a></h3><ul><li>这个报文的目的就是告诉对端自己在整个握手过程中收到了什么数据，发送了什么数据,来保证中间没人篡改报文</li><li>其次这个报文作用就是确认秘钥的正确性。因为<code>Encrypted handshake message</code>是使用对称秘钥进行加密的第一个报文，如果这个报文加解密校验成功，那么就说明对称秘钥是正确的</li><li>计算方法就将之前所有的握手数据(包括接受和发送)计算哈希运算,然后就是使用协商好的对称密钥进行加密</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">加密(SHA(客户端随机数+服务器随机数))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="http://img.zhufengpeixun.cn/9.EncryptedHandshakeMessage.png" alt="EncryptedHandshakeMessage"></p><h3 id="_4-9-new-session-ticket" tabindex="-1"><a class="header-anchor" href="#_4-9-new-session-ticket"><span>4.9 New Session Ticket</span></a></h3><ul><li>SSL 中的 session 会跟 HTTP 的 session 类似,都是用来保存客户端和服务端之间交互的一些记录</li><li>如果服务端允许使用 Session ID,客户端的 Client Hello 带上 Session ID，服务端复用 Session ID 后，会直接略过协商加密密钥的过程，直接发出一个 Change Cipher Spec 报文,然后就是加密的握手信息报文</li><li>在服务器发送New Session Ticket消息 <ul><li>Type 类型</li><li>Version 版本</li><li>Length长度</li><li>Session Ticket Lifetime Hint 表示Ticket的剩余有效时间</li><li>Session Ticket 会话标识</li></ul></li></ul><p><img src="http://img.zhufengpeixun.cn/10.NewSessionTicket.png" alt="NewSessionTicket"></p><p><img src="http://img.zhufengpeixun.cn/11.NewSessionTicket.png" alt="11.NewSessionTicket"></p><h2 id="_5-openssl" tabindex="-1"><a class="header-anchor" href="#_5-openssl"><span>5.openssl</span></a></h2><ul><li>linux中的openssl 是SSL/TLS协议和多种加密算法的开源实现</li><li>openssl包括libcrypto实现算法、libssl 实现TLS/SSL协议,libssl是基于会话的，实现了身份认证 ,数据加密, 会话完整性的一个TLS/SSL的库。</li></ul><h3 id="_5-1-查看版本" tabindex="-1"><a class="header-anchor" href="#_5-1-查看版本"><span>5.1 查看版本</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">openssl version -a   </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-摘要算法" tabindex="-1"><a class="header-anchor" href="#_5-2-摘要算法"><span>5.2 摘要算法</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">openssl dgst -help</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>file... files to digest (default is stdin) 生成摘要的文件</li><li>-out outfile Output to filename rather than stdout 输出文件</li><li>-sign val Sign digest using private key 使用私钥签名</li><li>-verify val Verify a signature using public key 使用公钥验证签名</li><li>-signature infile File with signature to verify 验证的签名的文件</li><li>-hex Print as hex dump 以16进制打印</li><li>-hmac val Create hashed MAC with key 创建hashed过的消息摘要</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">echo <span class="token number">123</span> <span class="token operator">&gt;</span> msg<span class="token punctuation">.</span>txt</span>
<span class="line">openssl dgst <span class="token operator">-</span>md5  msg<span class="token punctuation">.</span>txt</span>
<span class="line">openssl dgst <span class="token operator">-</span>sha1  msg<span class="token punctuation">.</span>txt</span>
<span class="line">openssl dgst <span class="token operator">-</span>sha256  msg<span class="token punctuation">.</span>txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-对称加密" tabindex="-1"><a class="header-anchor" href="#_5-3-对称加密"><span>5.3 对称加密</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">openssl enc -help</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>-in infile Input file 输入要加密的文件</li><li>-out outfile Output file 输出加密后的文件</li><li>-e Encrypt 加密</li><li>-d Decrypt 解密</li><li>-a Base64 encode/decode, depending on encryption flag Base64编码和解码</li><li>-pass val Passphrase source 指定密码</li><li>-k val Passphrase 指定密码</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">openssl  enc <span class="token operator">-</span>e <span class="token operator">-</span>aes128 <span class="token operator">-</span>a <span class="token operator">-</span>k <span class="token number">123456789</span>  <span class="token operator">-</span><span class="token keyword">in</span> msg<span class="token punctuation">.</span>txt  <span class="token operator">-</span>out enc_msg<span class="token punctuation">.</span>txt</span>
<span class="line">openssl  enc <span class="token operator">-</span>d <span class="token operator">-</span>aes128 <span class="token operator">-</span>a <span class="token operator">-</span>k <span class="token number">123456789</span>  <span class="token operator">-</span><span class="token keyword">in</span> enc_msg<span class="token punctuation">.</span>txt  <span class="token operator">-</span>out dec_msg<span class="token punctuation">.</span>txt</span>
<span class="line"></span>
<span class="line">openssl  enc <span class="token operator">-</span>e <span class="token operator">-</span>aes128 <span class="token operator">-</span>a <span class="token operator">-</span>pass pass<span class="token operator">:</span><span class="token number">123456</span>  <span class="token operator">-</span><span class="token keyword">in</span> msg<span class="token punctuation">.</span>txt  <span class="token operator">-</span>out enc_msg<span class="token punctuation">.</span>txt <span class="token operator">-</span><span class="token constant">P</span></span>
<span class="line">openssl  enc <span class="token operator">-</span>d <span class="token operator">-</span>aes128 <span class="token operator">-</span>a <span class="token operator">-</span>pass pass<span class="token operator">:</span><span class="token number">123456</span>  <span class="token operator">-</span><span class="token keyword">in</span> enc_msg<span class="token punctuation">.</span>txt  <span class="token operator">-</span>out dec_msg<span class="token punctuation">.</span>txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-rsa非对称加密" tabindex="-1"><a class="header-anchor" href="#_5-5-rsa非对称加密"><span>5.5 RSA非对称加密</span></a></h3><h4 id="_5-5-1-rsa" tabindex="-1"><a class="header-anchor" href="#_5-5-1-rsa"><span>5.5.1 RSA</span></a></h4><h5 id="_5-5-1-1-rsa生成公私钥" tabindex="-1"><a class="header-anchor" href="#_5-5-1-1-rsa生成公私钥"><span>5.5.1.1 RSA生成公私钥</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">openssl genrsa -help</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>-aes256 是使用aes256算法加密这个私钥</li><li>-passout 指定加密的密钥</li><li>-out output the key to file 指明输出文件</li><li>-in 指定输入文件</li><li>-pubout 输出公钥信息； 根据私钥的信息得出公钥</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//生成加密的私钥</span></span>
<span class="line">openssl genrsa <span class="token operator">-</span>aes256 <span class="token operator">-</span>passout pass<span class="token operator">:</span><span class="token number">123456</span> <span class="token operator">-</span>out <span class="token keyword">private</span><span class="token punctuation">.</span>key <span class="token number">2048</span></span>
<span class="line"><span class="token comment">//生成不加密的私钥</span></span>
<span class="line">openssl genrsa  <span class="token operator">-</span>out <span class="token keyword">private</span><span class="token punctuation">.</span>key <span class="token number">1024</span></span>
<span class="line"><span class="token comment">//生成公钥</span></span>
<span class="line">openssl rsa <span class="token operator">-</span>pubout <span class="token operator">-</span><span class="token keyword">in</span> <span class="token keyword">private</span><span class="token punctuation">.</span>key  <span class="token operator">-</span>out  <span class="token keyword">public</span><span class="token punctuation">.</span>key</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-5-1-2-rsa加解密" tabindex="-1"><a class="header-anchor" href="#_5-5-1-2-rsa加解密"><span>5.5.1.2 RSA加解密</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">openssl rsautl -help</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>-in infile Input file 输入文件（待加密或待解密的文件）</li><li>-out outfile Output file 输出文件 加密解密后的文件</li><li>-inkey val Input key 输入加密的公钥</li><li>-encrypt Encrypt with public key 使用公钥加密</li><li>-decrypt Decrypt with private key 使用私钥解密</li><li>-pubin Input is an RSA public 表明输入的是公钥(默认是私钥)</li><li>-sign Sign with private key 表明使用私钥签名</li><li>-verify Verify with public key 表明使用公钥验证签名</li><li>-hexdump Hex dump output 以十六进制形式输出</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//公钥加密</span></span>
<span class="line">openssl rsautl <span class="token operator">-</span>encrypt <span class="token operator">-</span>inkey <span class="token keyword">public</span><span class="token punctuation">.</span>key  <span class="token operator">-</span>pubin  <span class="token operator">-</span><span class="token keyword">in</span> msg<span class="token punctuation">.</span>txt  <span class="token operator">-</span>out enc<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>txt </span>
<span class="line"><span class="token comment">//私钥解密</span></span>
<span class="line">openssl rsautl <span class="token operator">-</span>decrypt <span class="token operator">-</span>inkey <span class="token keyword">private</span><span class="token punctuation">.</span>key <span class="token operator">-</span><span class="token keyword">in</span> enc<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>txt   <span class="token operator">-</span>out  dec<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>txt </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-5-1-3-数字签名" tabindex="-1"><a class="header-anchor" href="#_5-5-1-3-数字签名"><span>5.5.1.3 数字签名</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//摘要后使用RSA私钥签名，摘要算法sha256</span></span>
<span class="line">openssl dgst <span class="token operator">-</span>sign <span class="token keyword">private</span><span class="token punctuation">.</span>key <span class="token operator">-</span>sha256 <span class="token operator">-</span>out  sign<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>txt  msg<span class="token punctuation">.</span>txt</span>
<span class="line"><span class="token comment">//使用RSA公钥验证签名</span></span>
<span class="line">openssl dgst <span class="token operator">-</span>verify  <span class="token keyword">public</span><span class="token punctuation">.</span>key <span class="token operator">-</span>sha256 <span class="token operator">-</span>signature sign<span class="token punctuation">.</span>msg<span class="token punctuation">.</span>txt  msg<span class="token punctuation">.</span>txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-2-ecdsa" tabindex="-1"><a class="header-anchor" href="#_5-5-2-ecdsa"><span>5.5.2 ECDSA</span></a></h4><h5 id="_5-5-2-1-生成公私钥" tabindex="-1"><a class="header-anchor" href="#_5-5-2-1-生成公私钥"><span>5.5.2.1 生成公私钥</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//生成ecdsa私钥</span></span>
<span class="line">openssl ecparam <span class="token operator">-</span>genkey  <span class="token operator">-</span>name secp256k1 <span class="token operator">-</span>out ec<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key</span>
<span class="line"><span class="token comment">//提取 ecdsa 公钥</span></span>
<span class="line">openssl ec <span class="token operator">-</span><span class="token keyword">in</span> ec<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key <span class="token operator">-</span>pubout <span class="token operator">-</span>out ec<span class="token punctuation">.</span>public<span class="token punctuation">.</span>key</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-5-2-2-数字签名" tabindex="-1"><a class="header-anchor" href="#_5-5-2-2-数字签名"><span>5.5.2.2 数字签名</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//使用ECDSA私钥进行签名 (sha256) </span></span>
<span class="line">openssl  dgst <span class="token operator">-</span>sign ec<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key  <span class="token operator">-</span>sha256 <span class="token operator">-</span>out sign<span class="token punctuation">.</span>msg  msg<span class="token punctuation">.</span>txt</span>
<span class="line"><span class="token comment">//使用ECDSA公钥进行签名验证</span></span>
<span class="line">openssl dgst <span class="token operator">-</span>verify ec<span class="token punctuation">.</span>public<span class="token punctuation">.</span>key <span class="token operator">-</span>sha256 <span class="token operator">-</span>signature sign<span class="token punctuation">.</span>msg  msg<span class="token punctuation">.</span>txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-证书体系-pki" tabindex="-1"><a class="header-anchor" href="#_6-证书体系-pki"><span>6.证书体系（PKI）</span></a></h2><ul><li>为了检查公钥不是服务器就需要引入权威第三方</li><li>数字证书就是权威第三方发布的并包括 <ul><li>Issuer (证书的发布机构)：哪个权威第三方发布的证书</li><li>Valid from,Valid to(证书的有效期) 过了有效期限，证书就会作废</li><li>Public key(公钥) 权威第三方给申请者配发的公钥</li><li>Subject(主题): 证书所有者,一般是公司名称、机构名称、公司网站的网址等</li><li>Signature algorithm(签名所使用的算法): 使用哪个算法加密了指纹，指纹的加密结果就是数字签名</li><li>Thumbprint, Thumbprint algorithm (指纹以及指纹算法) 这是个加密后的结果，是用来确保证书完整性的，保证证书不被篡改</li></ul></li></ul><h3 id="_6-1-生成自签的根证书" tabindex="-1"><a class="header-anchor" href="#_6-1-生成自签的根证书"><span>6.1. 生成自签的根证书</span></a></h3><ul><li>-new 新的签名请求</li><li>-x509 输出x509格式的证书</li><li>-key 私钥</li><li>-out 输出文件</li><li>-days 证书有效期天数</li><li>-subject 请求主体</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//1.生成CA私钥</span></span>
<span class="line">openssl genrsa <span class="token operator">-</span>out ca<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key  <span class="token number">2048</span></span>
<span class="line"><span class="token comment">//2.根据CA私钥生成根证书</span></span>
<span class="line">openssl req <span class="token operator">-</span><span class="token keyword">new</span> <span class="token operator">-</span>x509 <span class="token operator">-</span>key ca<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key  <span class="token operator">-</span>out ca<span class="token punctuation">.</span>crt  <span class="token operator">-</span>days <span class="token number">365</span>  <span class="token operator">-</span>subj <span class="token operator">/</span><span class="token constant">C</span><span class="token operator">=</span><span class="token constant">CN</span><span class="token operator">/</span><span class="token constant">ST</span><span class="token operator">=</span>BeiJing<span class="token operator">/</span><span class="token constant">L</span><span class="token operator">=</span>BeiJing<span class="token operator">/</span><span class="token constant">O</span><span class="token operator">=</span>ca<span class="token operator">/</span><span class="token constant">OU</span><span class="token operator">=</span>ca<span class="token operator">/</span><span class="token constant">CN</span><span class="token operator">=</span>www<span class="token punctuation">.</span>ca<span class="token punctuation">.</span>com<span class="token operator">/</span>emailAddress<span class="token operator">=</span>ca@qq<span class="token punctuation">.</span>com</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-服务器证书申请" tabindex="-1"><a class="header-anchor" href="#_6-2-服务器证书申请"><span>6.2.服务器证书申请</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//1.生成服务器私钥</span></span>
<span class="line">openssl genrsa <span class="token operator">-</span>out server<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key <span class="token number">2048</span></span>
<span class="line"><span class="token comment">//2.创建证书签名申请CSR(certificate signing request)并且发送给CA</span></span>
<span class="line">openssl req <span class="token operator">-</span><span class="token keyword">new</span> <span class="token operator">-</span>key server<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key <span class="token operator">-</span>out server<span class="token punctuation">.</span>csr <span class="token operator">-</span>subj  <span class="token operator">/</span><span class="token constant">C</span><span class="token operator">=</span><span class="token constant">CN</span><span class="token operator">/</span><span class="token constant">ST</span><span class="token operator">=</span>BeiJing<span class="token operator">/</span><span class="token constant">L</span><span class="token operator">=</span>BeiJing<span class="token operator">/</span><span class="token constant">O</span><span class="token operator">=</span><span class="token number">47.105</span><span class="token number">.67</span><span class="token number">.214</span><span class="token operator">/</span><span class="token constant">OU</span><span class="token operator">=</span><span class="token number">47.105</span><span class="token number">.67</span><span class="token number">.214</span><span class="token operator">/</span><span class="token constant">CN</span><span class="token operator">=</span><span class="token number">47.105</span><span class="token number">.67</span><span class="token number">.214</span><span class="token operator">/</span>emailAddress<span class="token operator">=</span><span class="token number">47.105</span><span class="token number">.67</span><span class="token number">.214</span>@qq<span class="token punctuation">.</span>com</span>
<span class="line"><span class="token comment">//3.签发证书</span></span>
<span class="line">openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span>days <span class="token number">365</span>  <span class="token operator">-</span><span class="token constant">CA</span> ca<span class="token punctuation">.</span>crt <span class="token operator">-</span>CAkey ca<span class="token punctuation">.</span>private<span class="token punctuation">.</span>key <span class="token operator">-</span>CAcreateserial  <span class="token operator">-</span><span class="token keyword">in</span>  server<span class="token punctuation">.</span>csr  <span class="token operator">-</span>out server<span class="token punctuation">.</span>crt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-nginx" tabindex="-1"><a class="header-anchor" href="#_7-nginx"><span>7.nginx</span></a></h2><h3 id="_7-1-安装" tabindex="-1"><a class="header-anchor" href="#_7-1-安装"><span>7.1 安装</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">yum <span class="token operator">-</span>y install gcc gcc<span class="token operator">-</span>c<span class="token operator">++</span> pcre<span class="token operator">-</span>devel zlib<span class="token operator">-</span>devel</span>
<span class="line"></span>
<span class="line">wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nginx<span class="token punctuation">.</span>org<span class="token operator">/</span>download<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.12</span><span class="token number">.2</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</span>
<span class="line">wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>openssl<span class="token punctuation">.</span>org<span class="token operator">/</span>source<span class="token operator">/</span>openssl<span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">.</span>0h<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</span>
<span class="line">tar zxf nginx<span class="token operator">-</span><span class="token number">1.12</span><span class="token number">.2</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</span>
<span class="line">tar zxf openssl<span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">.</span>0h</span>
<span class="line">cd nginx<span class="token operator">-</span><span class="token number">1.12</span><span class="token number">.2</span></span>
<span class="line"></span>
<span class="line">groupadd nginx</span>
<span class="line"><span class="token comment">// -M 不要自动建立用户的登入目录 -s 不能登录的shell</span></span>
<span class="line">useradd nginx  <span class="token operator">-</span><span class="token constant">M</span> <span class="token operator">-</span>s <span class="token operator">/</span>sbin<span class="token operator">/</span>nologin <span class="token operator">-</span>g nginx</span>
<span class="line"></span>
<span class="line">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr<span class="token operator">/</span>nginx</span>
<span class="line">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr<span class="token operator">/</span>nginx<span class="token operator">/</span>logs  </span>
<span class="line">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr<span class="token operator">/</span>nginx<span class="token operator">/</span>cache</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">.</span><span class="token operator">/</span>configure  <span class="token operator">--</span>prefix<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>nginx   <span class="token operator">--</span><span class="token keyword">with</span><span class="token operator">-</span>http_ssl_module <span class="token operator">--</span><span class="token keyword">with</span><span class="token operator">-</span>openssl<span class="token operator">=</span><span class="token operator">/</span>root<span class="token operator">/</span>openssl<span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">.</span>0h        <span class="token operator">--</span><span class="token keyword">with</span><span class="token operator">-</span>http_ssl_module <span class="token operator">--</span>user<span class="token operator">=</span>nginx <span class="token operator">--</span>group<span class="token operator">=</span>nginx</span>
<span class="line"></span>
<span class="line">make </span>
<span class="line">make install</span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token constant">PATH</span><span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>nginx<span class="token operator">/</span>sbin<span class="token operator">:</span>$<span class="token constant">PATH</span></span>
<span class="line">nginx <span class="token operator">-</span>t</span>
<span class="line">nginx <span class="token operator">-</span><span class="token constant">V</span></span>
<span class="line">nginx</span>
<span class="line">netstat <span class="token operator">-</span>ntlp</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-布署证书" tabindex="-1"><a class="header-anchor" href="#_7-2-布署证书"><span>7.2 布署证书</span></a></h3><ul><li>配置文件<code>/usr/nginx</code></li><li>重启 <code>nginx -s reload</code></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">    server {</span>
<span class="line">        listen       443 ssl;</span>
<span class="line">        server_name  localhost;</span>
<span class="line"></span>
<span class="line">+       ssl_certificate      /root/server.crt;</span>
<span class="line">+       ssl_certificate_key  /root/server.private.key;</span>
<span class="line"></span>
<span class="line">        ssl_session_cache    shared:SSL:1m;</span>
<span class="line">        ssl_session_timeout  5m;</span>
<span class="line"></span>
<span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span>
<span class="line">        ssl_prefer_server_ciphers  on;</span>
<span class="line"></span>
<span class="line">        location / {</span>
<span class="line">            root   html;</span>
<span class="line">            index  index.html index.htm;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-tls安全" tabindex="-1"><a class="header-anchor" href="#_8-tls安全"><span>8. tls安全</span></a></h2><h3 id="_8-1-证书吊销" tabindex="-1"><a class="header-anchor" href="#_8-1-证书吊销"><span>8.1 证书吊销</span></a></h3><ul><li>证书吊销列表分发点 (CRL Distribution Point ，简称 CDP) 是含在数字证书中的一个可以共各种应用软件自动下载的最新的 CRL 的位置信息,一般 CA 每隔一定时间 ( 几天或几个月 ) 才发布新的吊销列表</li><li>OCSP(Online Certificate Status Protocol)证书状态在线查询协议，是IETF颁布的用于实时查询数字证书在某一时间是否有效的标准。</li></ul><h3 id="_8-1-证书链" tabindex="-1"><a class="header-anchor" href="#_8-1-证书链"><span>8.1 证书链</span></a></h3><ul><li>一个证书链就是能溯源到一个可信根证书的有序证书列表</li><li>使用证书链的原因 <ul><li>保证根证书安全</li><li>交叉证书 用已有的根证书签署新的根证书</li><li>划分二级CA</li><li>委派 签发给一个组织或者公司一个二级CA，但限制用于签署其自用的证书，只能签署他们自己所拥有的域名的证书。</li></ul></li></ul><h3 id="_8-2-多域名证书与泛域名证书" tabindex="-1"><a class="header-anchor" href="#_8-2-多域名证书与泛域名证书"><span>8.2 多域名证书与泛域名证书</span></a></h3><ul><li>建议给每个域名一个单独的证书</li><li><em>.xxxx.com或</em>.xxxx.org 就是泛域名</li></ul><h3 id="_8-2-安全的优化" tabindex="-1"><a class="header-anchor" href="#_8-2-安全的优化"><span>8.2 安全的优化</span></a></h3><ul><li>使用服务器优先的更安全的密码套件</li><li>密钥算法与加密强度</li><li>注意保护私钥，定期更换</li><li>选择可靠的CA权威机构</li><li>前向安全保密</li></ul>`,119)])])}const c=n(t,[["render",l]]),r=JSON.parse('{"path":"/strong/94.7.nginx.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/94.7.nginx.md"}');export{c as comp,r as data};
