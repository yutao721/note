import{_ as s,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(c,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h2 id="_1-redux-toolkit-是什么" tabindex="-1"><a class="header-anchor" href="#_1-redux-toolkit-是什么"><span>1.Redux Toolkit 是什么？</span></a></h2><ul><li><a href="https://redux-toolkit.js.org" target="_blank" rel="noopener noreferrer">Redux Toolkit</a>是我们官方的，有观点的，开箱即用的高效 Redux 开发工具集</li><li>Redux Toolkit解决的问题 <ul><li>配置 Redux store 过于复杂</li><li>我必须添加很多软件包才能开始使用 Redux 做事情</li><li>Redux 有太多样板代码</li></ul></li></ul><h2 id="_2-安装" tabindex="-1"><a class="header-anchor" href="#_2-安装"><span>2. 安装</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install redux redux-logger redux-thunk @reduxjs/toolkit   express cors  axios --save</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-正常用法" tabindex="-1"><a class="header-anchor" href="#_3-正常用法"><span>3. 正常用法</span></a></h2><h3 id="_3-1-public-index-html" tabindex="-1"><a class="header-anchor" href="#_3-1-public-index-html"><span>3.1 public\\index.html</span></a></h3><p>public\\index.html</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">     <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;theme-color&quot;</span> content<span class="token operator">=</span>&quot;</span>
<span class="line">    <span class="token operator">&lt;</span>meta</span>
<span class="line">      name<span class="token operator">=</span><span class="token string">&quot;description&quot;</span></span>
<span class="line">      content<span class="token operator">=</span><span class="token string">&quot;Web site created using create-react-app&quot;</span></span>
<span class="line">    <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Redux Toolkit<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>p id<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;add&quot;</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;minus&quot;</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-src-index-js" tabindex="-1"><a class="header-anchor" href="#_3-2-src-index-js"><span>3.2 src\\index.js</span></a></h3><p>src\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">ADD</span> <span class="token operator">=</span> <span class="token string">&#39;ADD&#39;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">MINUS</span> <span class="token operator">=</span> <span class="token string">&#39;MINUS&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ADD</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">MINUS</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">ADD</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">number</span><span class="token operator">:</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">MINUS</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">number</span><span class="token operator">:</span>state<span class="token punctuation">.</span>number<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> state</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> valueEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    valueEl<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>number<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;add&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;minus&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-问题" tabindex="-1"><a class="header-anchor" href="#_3-3-问题"><span>3.3 问题</span></a></h3><ul><li>action creator增加代码量</li><li><code>const ADD = &#39;ADD&#39;</code>冗余</li><li><code>switch</code>结构不清晰</li></ul><h2 id="_4-configurestore" tabindex="-1"><a class="header-anchor" href="#_4-configurestore"><span>4. configureStore</span></a></h2><ul><li>Redux工具包有一个 <code>configureStore()</code> 函数，其中覆盖了 <code>createStore()</code> 的功能</li><li><code>configureStore() 函数</code> 提供简化的配置选项。它可以自动组合切片 slice 的 reducer，添加你提供的任何 Redux 中间件，默认 情况下包含 redux-thunk，并启用<a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noopener noreferrer">Redux DevTools 扩展</a></li></ul><h3 id="_4-1-public-index-html" tabindex="-1"><a class="header-anchor" href="#_4-1-public-index-html"><span>4.1 public\\index.html</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;!DOCTYPE html&gt;</span>
<span class="line">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="line">  &lt;head&gt;</span>
<span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;</span>
<span class="line">     &lt;meta name=&quot;theme-color&quot; content=&quot;</span>
<span class="line">    &lt;meta</span>
<span class="line">      name=&quot;description&quot;</span>
<span class="line">      content=&quot;Web site created using create-react-app&quot;</span>
<span class="line">    /&gt;</span>
<span class="line">    &lt;title&gt;Redux Toolkit&lt;/title&gt;</span>
<span class="line">  &lt;/head&gt;</span>
<span class="line">  &lt;body&gt;</span>
<span class="line">    &lt;div&gt;</span>
<span class="line">      &lt;p id=&quot;value&quot;&gt;0&lt;/p&gt;</span>
<span class="line">      &lt;button id=&quot;add&quot;&gt;+&lt;/button&gt;</span>
<span class="line">      &lt;button id=&quot;minus&quot;&gt;-&lt;/button&gt;</span>
<span class="line">+     &lt;button id=&quot;async-add&quot;&gt;async-add&lt;/button&gt;</span>
<span class="line">    &lt;/div&gt;</span>
<span class="line">  &lt;/body&gt;</span>
<span class="line">&lt;/html&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-src-index-js" tabindex="-1"><a class="header-anchor" href="#_4-2-src-index-js"><span>4.2 src\\index.js</span></a></h3><p>src\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">-import { createStore } from &#39;redux&#39;;</span>
<span class="line">+import {configureStore} from &#39;@reduxjs/toolkit&#39;;</span>
<span class="line">+import {configureStore} from &#39;./toolkit&#39;;</span>
<span class="line">+import thunk from &#39;redux-thunk&#39;;</span>
<span class="line">+import logger from &#39;redux-logger&#39;;</span>
<span class="line">const ADD = &#39;ADD&#39;</span>
<span class="line">const MINUS = &#39;MINUS&#39;</span>
<span class="line"></span>
<span class="line">function add() {</span>
<span class="line">    return { type: ADD }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">function minus() {</span>
<span class="line">    return { type: MINUS }</span>
<span class="line">}</span>
<span class="line">function counter(state = { number: 0 }, action) {</span>
<span class="line">    switch (action.type) {</span>
<span class="line">        case ADD:</span>
<span class="line">            return {number:state.number+1}</span>
<span class="line">        case MINUS:</span>
<span class="line">            return {number:state.number-1}</span>
<span class="line">        default:</span>
<span class="line">            return state</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">-let store = createStore(counter)</span>
<span class="line">+const store = configureStore({</span>
<span class="line">+  reducer: counter,</span>
<span class="line">+  middleware: [thunk, logger]</span>
<span class="line">+})</span>
<span class="line">var valueEl = document.getElementById(&#39;value&#39;)</span>
<span class="line"></span>
<span class="line">function render() {</span>
<span class="line">    valueEl.innerHTML = store.getState().number;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">render()</span>
<span class="line">store.subscribe(render)</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(add())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;minus&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(minus())</span>
<span class="line">})</span>
<span class="line">+document.getElementById(&#39;async-add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">+  store.dispatch((dispatch)=&gt;{</span>
<span class="line">+    setTimeout(()=&gt;{</span>
<span class="line">+      dispatch(add())</span>
<span class="line">+    },1000)</span>
<span class="line">+  })</span>
<span class="line">+})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-toolkit-index-js" tabindex="-1"><a class="header-anchor" href="#_4-3-toolkit-index-js"><span>4.3 toolkit\\index.js</span></a></h3><p>src\\toolkit\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> configureStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./configureStore&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-4-configurestore-js" tabindex="-1"><a class="header-anchor" href="#_4-4-configurestore-js"><span>4.4 configureStore.js</span></a></h3><p>src\\toolkit\\configureStore.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers<span class="token punctuation">,</span>applyMiddleware<span class="token punctuation">,</span>createStore<span class="token punctuation">,</span>compose<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> middleware<span class="token punctuation">,</span> preloadedState <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> rootReducer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> reducer <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rootReducer <span class="token operator">=</span> reducer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ <span class="token operator">||</span> compose<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> preloadedState<span class="token punctuation">,</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>enhancer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> configureStore<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>compose</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> str<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">add2</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> str<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter">fn1<span class="token punctuation">,</span>fn2</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line"> <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">   <span class="token keyword">return</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token function">fn2</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>add1<span class="token punctuation">,</span> add2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">&#39;zhufeng&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//zhufeng21</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-createaction" tabindex="-1"><a class="header-anchor" href="#_5-createaction"><span>5. createAction</span></a></h2><ul><li>createAction 接受一个 action 类型字符串作为参数，并返回一个使用该类型字符串的 action creator 函数</li></ul><h3 id="_5-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_5-1-src-index-js"><span>5.1 src\\index.js</span></a></h3><p>src\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import {configureStore,createAction} from &#39;./toolkit&#39;;</span>
<span class="line">import thunk from &#39;redux-thunk&#39;;</span>
<span class="line">import logger from &#39;redux-logger&#39;;</span>
<span class="line">-const ADD = &#39;ADD&#39;</span>
<span class="line">-const MINUS = &#39;MINUS&#39;</span>
<span class="line"></span>
<span class="line">-function add() {</span>
<span class="line">-    return { type: ADD }</span>
<span class="line">-}</span>
<span class="line">+const add = createAction(&#39;ADD&#39;)</span>
<span class="line">-function minus() {</span>
<span class="line">-    return { type: MINUS }</span>
<span class="line">-}</span>
<span class="line">+const minus = createAction(&#39;MINUS&#39;, (amount) =&gt; ({ payload: amount }))</span>
<span class="line">+console.log(minus.toString());</span>
<span class="line">+console.log(minus.type);</span>
<span class="line"></span>
<span class="line">function counter(state = { number: 0 }, action) {</span>
<span class="line">    switch (action.type) {</span>
<span class="line">+       case add.type:</span>
<span class="line">          return {number:state.number+1}</span>
<span class="line">+       case minus.type:</span>
<span class="line">+         return {number:state.number-action.payload}</span>
<span class="line">        default:</span>
<span class="line">            return state</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">const store = configureStore({</span>
<span class="line">  reducer: counter,</span>
<span class="line">  middleware: [thunk, logger]</span>
<span class="line">})</span>
<span class="line">var valueEl = document.getElementById(&#39;value&#39;)</span>
<span class="line"></span>
<span class="line">function render() {</span>
<span class="line">    valueEl.innerHTML = store.getState().number;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">render()</span>
<span class="line">store.subscribe(render)</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(add())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;minus&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">+   store.dispatch(minus(2))</span>
<span class="line">})</span>
<span class="line">document.getElementById(&#39;async-add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch((dispatch)=&gt;{</span>
<span class="line">    setTimeout(()=&gt;{</span>
<span class="line">      dispatch(add())</span>
<span class="line">    },1000)</span>
<span class="line">  })</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-toolkit-index-js" tabindex="-1"><a class="header-anchor" href="#_5-2-toolkit-index-js"><span>5.2 toolkit\\index.js</span></a></h3><p>src\\toolkit\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as configureStore } from &#39;./configureStore&#39;;</span>
<span class="line">+export { default as createAction } from &#39;./createAction&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-createaction-js" tabindex="-1"><a class="header-anchor" href="#_5-3-createaction-js"><span>5.3 createAction.js</span></a></h3><p>src\\toolkit\\createAction.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> prepareAction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">actionCreator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>prepareAction<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">var</span> prepared <span class="token operator">=</span> <span class="token function">prepareAction</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">type</span><span class="token operator">:</span> type<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">payload</span><span class="token operator">:</span> prepared<span class="token punctuation">.</span>payload<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">error</span><span class="token operator">:</span> prepared<span class="token punctuation">.</span>error</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> type<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">payload</span><span class="token operator">:</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    actionCreator<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> type<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    actionCreator<span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> actionCreator<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> createAction<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-createreducer" tabindex="-1"><a class="header-anchor" href="#_6-createreducer"><span>6. createReducer</span></a></h2><ul><li>Redux工具包 包含了一个 createReducer 函数 ，它让使用&quot;查找表&quot;对象的方式编写 reducer</li><li>其中对象的每一个 key 都是一个 Redux action type 字符串，value 是 reducer 函数</li></ul><h3 id="_6-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_6-1-src-index-js"><span>6.1 src\\index.js</span></a></h3><p>src\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import {configureStore,createAction,createReducer} from &#39;./toolkit&#39;;</span>
<span class="line">import thunk from &#39;redux-thunk&#39;;</span>
<span class="line">import logger from &#39;redux-logger&#39;;</span>
<span class="line">const add = createAction(&#39;ADD&#39;)</span>
<span class="line">const minus = createAction(&#39;MINUS&#39;, (amount) =&gt; ({ payload: amount }))</span>
<span class="line">console.log(minus.toString());</span>
<span class="line">console.log(minus.type);</span>
<span class="line"></span>
<span class="line">-function counter(state = { number: 0 }, action) {</span>
<span class="line">-    switch (action.type) {</span>
<span class="line">-        case add.type:</span>
<span class="line">-            return {number:state.number+1}</span>
<span class="line">-        case minus.type:</span>
<span class="line">-            return {number:state.number-action.payload}</span>
<span class="line">-        default:</span>
<span class="line">-            return state</span>
<span class="line">-    }</span>
<span class="line">-}</span>
<span class="line"></span>
<span class="line">+const counter = createReducer({number:0}, {</span>
<span class="line">+  [add]: state =&gt; ({number:state.number+1}),</span>
<span class="line">+  [minus]: state =&gt; ({number:state.number-1})</span>
<span class="line">+})</span>
<span class="line"></span>
<span class="line">const store = configureStore({</span>
<span class="line">  reducer: counter,</span>
<span class="line">  middleware: [thunk, logger]</span>
<span class="line">})</span>
<span class="line">var valueEl = document.getElementById(&#39;value&#39;)</span>
<span class="line"></span>
<span class="line">function render() {</span>
<span class="line">    valueEl.innerHTML = store.getState().number;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">render()</span>
<span class="line">store.subscribe(render)</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(add())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;minus&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(minus(2))</span>
<span class="line">})</span>
<span class="line">document.getElementById(&#39;async-add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch((dispatch)=&gt;{</span>
<span class="line">    setTimeout(()=&gt;{</span>
<span class="line">      dispatch(add())</span>
<span class="line">    },1000)</span>
<span class="line">  })</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-createreducer-js" tabindex="-1"><a class="header-anchor" href="#_6-2-createreducer-js"><span>6.2 createReducer.js</span></a></h3><p>src\\toolkit\\createReducer.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">createReducer</span><span class="token punctuation">(</span><span class="token parameter">initialState<span class="token punctuation">,</span> reducers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> reducer <span class="token operator">=</span> reducers<span class="token punctuation">[</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>reducer<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> createReducer<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-toolkit-index-js" tabindex="-1"><a class="header-anchor" href="#_6-3-toolkit-index-js"><span>6.3 toolkit\\index.js</span></a></h3><p>src\\toolkit\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as configureStore } from &#39;./configureStore&#39;;</span>
<span class="line">export { default as createAction } from &#39;./createAction&#39;;</span>
<span class="line">+export { default as createReducer } from &#39;./createReducer&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-createslice" tabindex="-1"><a class="header-anchor" href="#_7-createslice"><span>7. createSlice</span></a></h2><ul><li>createSlice函数允许我们提供一个带有reducer函数的对象，并且它将根据我们列出的 reducer 的名称自动生成 action type 字符串和 action creator 函数</li><li>createSlice 返回一个<code>分片</code>对象，该对象包含生成的 reducer 函数作为一个名为 reducer 的字段，以及在一个名为 actions 的对象中生成的 action creator <ul><li>reducers 一个包含case reducer函数的对象，它的key将被用来生成动作类型常量并在派发的时候可见</li><li>prepare 可以用来自定义payload的值的创建</li><li>extraReducers 允许createSlice去响应别的slice创建的动作类型，它们不会用来生成actions</li></ul></li></ul><h3 id="_7-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_7-1-src-index-js"><span>7.1 src\\index.js</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//import {configureStore,createAction,createReducer,createSlice} from &#39;@reduxjs/toolkit&#39;;</span>
<span class="line">import {configureStore,createAction,createReducer,createSlice} from &#39;./toolkit&#39;;</span>
<span class="line">import thunk from &#39;redux-thunk&#39;;</span>
<span class="line">import logger from &#39;redux-logger&#39;;</span>
<span class="line">-const add = createAction(&#39;ADD&#39;)</span>
<span class="line">-const minus = createAction(&#39;MINUS&#39;, (amount) =&gt; ({ payload: amount }))</span>
<span class="line">-const counter = createReducer({number:0}, {</span>
<span class="line">-  [add]: state =&gt; ({number:state.number+1}),</span>
<span class="line">-  [minus]: state =&gt; ({number:state.number-1})</span>
<span class="line">-})</span>
<span class="line"></span>
<span class="line">+const counterSlice = createSlice({</span>
<span class="line">+  name: &#39;counter&#39;,</span>
<span class="line">+  initialState: {number:0},</span>
<span class="line">+  reducers: {</span>
<span class="line">+    add: (state)  =&gt;  ({number:state.number+1}),//派发的时候动作类型是 counter/add</span>
<span class="line">+    minus: (state,action) =&gt; ({number:state.number-action.payload})</span>
<span class="line">+  }</span>
<span class="line">+})</span>
<span class="line">const { actions, reducer } = counterSlice</span>
<span class="line">console.log(actions);</span>
<span class="line">const { add, minus } = actions</span>
<span class="line">console.log(add);</span>
<span class="line"></span>
<span class="line">const store = configureStore({</span>
<span class="line">  reducer: reducer,</span>
<span class="line">  middleware: [thunk, logger]</span>
<span class="line">})</span>
<span class="line">var valueEl = document.getElementById(&#39;value&#39;)</span>
<span class="line"></span>
<span class="line">function render() {</span>
<span class="line">    valueEl.innerHTML = store.getState().number;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">render()</span>
<span class="line">store.subscribe(render)</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(add())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;minus&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(minus(2))</span>
<span class="line">})</span>
<span class="line">document.getElementById(&#39;async-add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch((dispatch)=&gt;{</span>
<span class="line">    setTimeout(()=&gt;{</span>
<span class="line">      dispatch(add())</span>
<span class="line">    },1000)</span>
<span class="line">  })</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-createslice-js" tabindex="-1"><a class="header-anchor" href="#_7-2-createslice-js"><span>7.2 createSlice.js</span></a></h3><p>src\\toolkit\\createSlice.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createReducer, createAction } from &#39;./&#39;</span>
<span class="line">function createSlice(options) {</span>
<span class="line">    let { name, initialState={}, reducers={} } = options;</span>
<span class="line">    let actions = {};</span>
<span class="line">    const prefixReducers = {};</span>
<span class="line">    Object.keys(reducers).forEach(function (key) {</span>
<span class="line">        var type = getType(name, key);</span>
<span class="line">        actions[key] = createAction(type);</span>
<span class="line">        prefixReducers[type]=reducers[key];</span>
<span class="line">    })</span>
<span class="line">    let reducer = createReducer(initialState, prefixReducers);</span>
<span class="line">    return {</span>
<span class="line">        name,</span>
<span class="line">        reducer,</span>
<span class="line">        actions</span>
<span class="line">    };</span>
<span class="line">}</span>
<span class="line">function getType(slice, actionKey) {</span>
<span class="line">    return slice + &quot;/&quot; + actionKey;</span>
<span class="line">}</span>
<span class="line">export default createSlice;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-toolkit-index-js" tabindex="-1"><a class="header-anchor" href="#_7-3-toolkit-index-js"><span>7.3 toolkit\\index.js</span></a></h3><p>src\\toolkit\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as configureStore } from &#39;./configureStore&#39;;</span>
<span class="line">export { default as createAction } from &#39;./createAction&#39;;</span>
<span class="line">export { default as createReducer } from &#39;./createReducer&#39;;</span>
<span class="line">+export { default as createSlice } from &#39;./createSlice&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-immer" tabindex="-1"><a class="header-anchor" href="#_8-immer"><span>8. immer</span></a></h2><h3 id="_8-1-基础" tabindex="-1"><a class="header-anchor" href="#_8-1-基础"><span>8.1 基础</span></a></h3><h4 id="_8-1-1-介绍" tabindex="-1"><a class="header-anchor" href="#_8-1-1-介绍"><span>8.1.1 介绍</span></a></h4><ul><li><a href="https://immerjs.github.io/immer" target="_blank" rel="noopener noreferrer">immer</a>是 mobx 的作者写的一个 immutable 库</li><li>核心实现是利用 ES6 的 proxy,几乎以最小的成本实现了 js 的不可变数据结构</li></ul><h4 id="_8-1-2-produce" tabindex="-1"><a class="header-anchor" href="#_8-1-2-produce"><span>8.1.2 produce</span></a></h4><ul><li>对 draftState 的修改都会反应到 nextState 上</li><li>而 immer 使用的结构是共享的，nextState 在结构上又与 currentState 共享未修改的部分 <ul><li>currentState 被操作对象的最初状态</li><li>draftState 根据 currentState 生成的草稿状态，它是 currentState 的代理，对 draftState 所做的任何修改都将被记录并用于生成 nextState 。在此过程中，currentState 将不受影响</li><li>nextState 根据 draftState 生成的最终状态</li><li>produce 生产 用来生成 nextState的函数</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> produce <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;immer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> baseState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">ids</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">pos</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">1</span> </span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> nextState <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>baseState<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    draft<span class="token punctuation">.</span>ids<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baseState<span class="token punctuation">.</span>ids <span class="token operator">===</span> nextState<span class="token punctuation">.</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baseState<span class="token punctuation">.</span>pos <span class="token operator">===</span> nextState<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-使用" tabindex="-1"><a class="header-anchor" href="#_8-2-使用"><span>8.2 使用</span></a></h3><h4 id="_8-2-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_8-2-1-src-index-js"><span>8.2.1 src\\index.js</span></a></h4><p>src\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//import {configureStore,createAction,createReducer,createSlice} from &#39;@reduxjs/toolkit&#39;;</span>
<span class="line">import {configureStore,createAction,createReducer,createSlice} from &#39;./toolkit&#39;;</span>
<span class="line">import thunk from &#39;redux-thunk&#39;;</span>
<span class="line">import logger from &#39;redux-logger&#39;;</span>
<span class="line">const counterSlice = createSlice({</span>
<span class="line">  name: &#39;counter&#39;,</span>
<span class="line">  initialState: {number:0},</span>
<span class="line">  reducers: {</span>
<span class="line">+   add: (state)  =&gt;  state.number+=1,//派发的时候动作类型是 counter/add</span>
<span class="line">+   minus: (state,action) =&gt; state.number-=action.payload</span>
<span class="line">  }</span>
<span class="line">})</span>
<span class="line">const { actions, reducer } = counterSlice</span>
<span class="line">console.log(actions);</span>
<span class="line">const { add, minus } = actions</span>
<span class="line">console.log(add);</span>
<span class="line"></span>
<span class="line">const store = configureStore({</span>
<span class="line">  reducer: reducer,</span>
<span class="line">  middleware: [thunk, logger]</span>
<span class="line">})</span>
<span class="line">var valueEl = document.getElementById(&#39;value&#39;)</span>
<span class="line"></span>
<span class="line">function render() {</span>
<span class="line">    valueEl.innerHTML = store.getState().number;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">render()</span>
<span class="line">store.subscribe(render)</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(add())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;minus&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">    store.dispatch(minus(2))</span>
<span class="line">})</span>
<span class="line">document.getElementById(&#39;async-add&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch((dispatch)=&gt;{</span>
<span class="line">    setTimeout(()=&gt;{</span>
<span class="line">      dispatch(add())</span>
<span class="line">    },1000)</span>
<span class="line">  })</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-2-createreducer-js" tabindex="-1"><a class="header-anchor" href="#_8-2-2-createreducer-js"><span>8.2.2 createReducer.js</span></a></h4><p>src\\toolkit\\createReducer.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import produce from &#39;immer&#39;;</span>
<span class="line">function createReducer(initialState, reducers={}) {</span>
<span class="line">    return function (state = initialState, action) {</span>
<span class="line">        let reducer = reducers[action.type];</span>
<span class="line">+       if (reducer)</span>
<span class="line">+           return produce(state, draft =&gt; {</span>
<span class="line">+               reducer(draft, action);</span>
<span class="line">+           });</span>
<span class="line">        return state;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default createReducer;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-reselect" tabindex="-1"><a class="header-anchor" href="#_9-reselect"><span>9. reselect</span></a></h2><h3 id="_9-1-基础" tabindex="-1"><a class="header-anchor" href="#_9-1-基础"><span>9.1 基础</span></a></h3><ul><li>reselect可以缓存运算结果，提升性能</li><li>reselect的原理是，只要相关状态不变，即直接使用上一次的缓存结果</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">///const {createSelector} = require(&#39;reselect&#39;);</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">createSelector</span><span class="token punctuation">(</span><span class="token parameter">selectors<span class="token punctuation">,</span> reducer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> lastState<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> lastValue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastState <span class="token operator">===</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> lastValue<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">let</span> values <span class="token operator">=</span> selectors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">selector</span> <span class="token operator">=&gt;</span> <span class="token function">selector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        lastValue <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token operator">...</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        lastState <span class="token operator">=</span> state<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> lastValue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">selectCounter1</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>counter1</span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">selectCounter2</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>counter2</span>
<span class="line"><span class="token keyword">const</span> totalSelector <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">[</span>selectCounter1<span class="token punctuation">,</span> selectCounter2<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter">counter1<span class="token punctuation">,</span> counter2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;计算结果&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> counter1<span class="token punctuation">.</span>number <span class="token operator">+</span> counter2<span class="token punctuation">.</span>number<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter1</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">counter2</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> state1 <span class="token operator">=</span> <span class="token function">totalSelector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> state2 <span class="token operator">=</span> <span class="token function">totalSelector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-使用" tabindex="-1"><a class="header-anchor" href="#_9-2-使用"><span>9.2 使用</span></a></h3><h4 id="_9-2-1-index-html" tabindex="-1"><a class="header-anchor" href="#_9-2-1-index-html"><span>9.2.1 index.html</span></a></h4><p>public\\index.html</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;!DOCTYPE html&gt;</span>
<span class="line">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="line">  &lt;head&gt;</span>
<span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;</span>
<span class="line">     &lt;meta name=&quot;theme-color&quot; content=&quot;</span>
<span class="line">    &lt;meta</span>
<span class="line">      name=&quot;description&quot;</span>
<span class="line">      content=&quot;Web site created using create-react-app&quot;</span>
<span class="line">    /&gt;</span>
<span class="line">    &lt;title&gt;Redux Toolkit&lt;/title&gt;</span>
<span class="line">  &lt;/head&gt;</span>
<span class="line">  &lt;body&gt;</span>
<span class="line">    &lt;div&gt;</span>
<span class="line">+     &lt;p id=&quot;value1&quot;&gt;0&lt;/p&gt;</span>
<span class="line">+     &lt;button id=&quot;add1&quot;&gt;add1&lt;/button&gt;</span>
<span class="line">+     &lt;button id=&quot;minus1&quot;&gt;minus1&lt;/button&gt;</span>
<span class="line">+     &lt;hr/&gt;</span>
<span class="line">+     &lt;p id=&quot;value2&quot;&gt;0&lt;/p&gt;</span>
<span class="line">+     &lt;button id=&quot;add2&quot;&gt;add2&lt;/button&gt;</span>
<span class="line">+     &lt;button id=&quot;minus2&quot;&gt;minus2&lt;/button&gt;</span>
<span class="line">+     &lt;hr/&gt;</span>
<span class="line">+     &lt;p id=&quot;sum&quot;&gt;0&lt;/p&gt;</span>
<span class="line">    &lt;/div&gt;</span>
<span class="line">  &lt;/body&gt;</span>
<span class="line">&lt;/html&gt;</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-2-2-src-index-js" tabindex="-1"><a class="header-anchor" href="#_9-2-2-src-index-js"><span>9.2.2 src\\index.js</span></a></h4><p>src\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//import {configureStore,createAction,createReducer,createSlice} from &#39;@reduxjs/toolkit&#39;;</span>
<span class="line">import {configureStore,createAction,createReducer,createSlice,createSelector} from &#39;./toolkit&#39;;</span>
<span class="line">import thunk from &#39;redux-thunk&#39;;</span>
<span class="line">import logger from &#39;redux-logger&#39;;</span>
<span class="line"></span>
<span class="line">const counter1Slice = createSlice({</span>
<span class="line">  name: &#39;counter1&#39;,</span>
<span class="line">  initialState: { number: 0 },</span>
<span class="line">  reducers: {</span>
<span class="line">    add: state =&gt; { state.number += 1 },</span>
<span class="line">    minus: state =&gt; { state.number -= 1 }</span>
<span class="line">  }</span>
<span class="line">})</span>
<span class="line">const counter2Slice = createSlice({</span>
<span class="line">  name: &#39;counter2&#39;,</span>
<span class="line">  initialState: { number: 0 },</span>
<span class="line">  reducers: {</span>
<span class="line">    add: state =&gt; { state.number += 1 },</span>
<span class="line">    minus: state =&gt; { state.number -= 1 }</span>
<span class="line">  }</span>
<span class="line">})</span>
<span class="line">const { actions: { add: add1, minus: minus1 }, reducer: reducer1 } = counter1Slice</span>
<span class="line">const { actions: { add: add2, minus: minus2 }, reducer: reducer2 } = counter2Slice</span>
<span class="line"></span>
<span class="line">const store = configureStore({</span>
<span class="line">  reducer: { counter1: reducer1, counter2: reducer2 },</span>
<span class="line">  middleware: [thunk, logger]</span>
<span class="line">})</span>
<span class="line">var value1El = document.getElementById(&#39;value1&#39;)</span>
<span class="line">var value2El = document.getElementById(&#39;value2&#39;)</span>
<span class="line">var sumEl = document.getElementById(&#39;sum&#39;)</span>
<span class="line">const selectCounter1 = state =&gt; state.counter1</span>
<span class="line">const selectCounter2 = state =&gt; state.counter2</span>
<span class="line">const totalSelector = createSelector(</span>
<span class="line">  [selectCounter1, selectCounter2],</span>
<span class="line">  (counter1, counter2) =&gt; {</span>
<span class="line">    return counter1.number + counter2.number;</span>
<span class="line">  }</span>
<span class="line">)</span>
<span class="line">function render() {</span>
<span class="line">  value1El.innerHTML = store.getState().counter1.number;</span>
<span class="line">  value2El.innerHTML = store.getState().counter2.number;</span>
<span class="line">  sumEl.innerHTML = totalSelector(store.getState());</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">render()</span>
<span class="line">store.subscribe(render)</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;add1&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch(add1())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;minus1&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch(minus1())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;add2&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch(add2())</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">document.getElementById(&#39;minus2&#39;).addEventListener(&#39;click&#39;, function () {</span>
<span class="line">  store.dispatch(minus2())</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-2-3-toolkit-index-js" tabindex="-1"><a class="header-anchor" href="#_9-2-3-toolkit-index-js"><span>9.2.3 toolkit\\index.js</span></a></h4><p>src\\toolkit\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as configureStore } from &#39;./configureStore&#39;;</span>
<span class="line">export { default as createAction } from &#39;./createAction&#39;;</span>
<span class="line">export { default as createReducer } from &#39;./createReducer&#39;;</span>
<span class="line">export { default as createSlice } from &#39;./createSlice&#39;;</span>
<span class="line">+export {createSelector } from &#39;../reselect&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-2-4-reselect-index-js" tabindex="-1"><a class="header-anchor" href="#_9-2-4-reselect-index-js"><span>9.2.4 reselect\\index.js</span></a></h4><p>src\\reselect\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token keyword">default</span> <span class="token keyword">as</span> createSelector<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./createSelector&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_9-2-5-createselector-js" tabindex="-1"><a class="header-anchor" href="#_9-2-5-createselector-js"><span>9.2.5 createSelector.js</span></a></h4><p>src\\reselect\\createSelector.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">createSelector</span><span class="token punctuation">(</span><span class="token parameter">selectors<span class="token punctuation">,</span> reducer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> lastState<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> lastValue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastState <span class="token operator">===</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> lastValue<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">let</span> values <span class="token operator">=</span> selectors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">selector</span> <span class="token operator">=&gt;</span> <span class="token function">selector</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        lastValue <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token operator">...</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        lastState <span class="token operator">=</span> state<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> lastValue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> createSelector<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-createasyncthunk" tabindex="-1"><a class="header-anchor" href="#_10-createasyncthunk"><span>10. createAsyncThunk</span></a></h2><ul><li>接收redux动作类型字符串和一个返回promise回调的函数</li><li>它会基于你传递的动作类型前缀生成promise生命周期的动作类型</li><li>并且返回一个thunk动作创建者，这个thunk动作创建者会运行promise回调并且派发生命周期动作</li><li>它抽象了处理异步请求生命周期的标准推荐方法</li></ul><h3 id="_10-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_10-1-src-index-js"><span>10.1 src\\index.js</span></a></h3><p>src\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore<span class="token punctuation">,</span> createSlice<span class="token punctuation">,</span> createAsyncThunk <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./toolkit&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//接收redux动作类型字符串和一个返回promise回调的函数</span></span>
<span class="line"><span class="token comment">//它会基于你传递的动作类型前缀生成promise生命周期的动作类型</span></span>
<span class="line"><span class="token comment">//并且返回一个thunk动作创建者，这个thunk动作创建者会运行promise回调并且派发生命周期动作</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> getTodosList <span class="token operator">=</span> <span class="token function">createAsyncThunk</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;todos/list&quot;</span><span class="token punctuation">,</span>  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">http://localhost:8080/todos/list</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> todoSlice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;todo&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  initialState<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">extraReducers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span>getTodosList<span class="token punctuation">.</span>pending<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      state<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span>getTodosList<span class="token punctuation">.</span>fulfilled<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      state<span class="token punctuation">.</span>todos <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">      state<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span>getTodosList<span class="token punctuation">.</span>rejected<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      state<span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      state<span class="token punctuation">.</span>error <span class="token operator">=</span> action<span class="token punctuation">.</span>error<span class="token punctuation">.</span>message<span class="token punctuation">;</span></span>
<span class="line">      state<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> reducer <span class="token punctuation">}</span> <span class="token operator">=</span> todoSlice<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  reducer</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">let</span> promise <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getTodosList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;请求开始&#39;</span><span class="token punctuation">,</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//promise.abort();</span></span>
<span class="line">promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;成功&#39;</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;请求结束&#39;</span><span class="token punctuation">,</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">error</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;失败&#39;</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;请求结束&#39;</span><span class="token punctuation">,</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-2-configurestore-js" tabindex="-1"><a class="header-anchor" href="#_10-2-configurestore-js"><span>10.2 configureStore.js</span></a></h3><p>src\\toolkit\\configureStore.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers<span class="token punctuation">,</span>applyMiddleware<span class="token punctuation">,</span>createStore<span class="token punctuation">,</span>compose <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">&#39;redux-thunk&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token keyword">let</span> <span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> middleware<span class="token operator">=</span><span class="token punctuation">[</span>thunk<span class="token punctuation">]</span><span class="token punctuation">,</span> preloadedState <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> rootReducer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> reducer <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rootReducer <span class="token operator">=</span> reducer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> enhancer <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token operator">...</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ <span class="token operator">||</span> compose<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> preloadedState<span class="token punctuation">,</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>enhancer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> configureStore<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-3-createreducer-js" tabindex="-1"><a class="header-anchor" href="#_10-3-createreducer-js"><span>10.3 createReducer.js</span></a></h3><p>src\\toolkit\\createReducer.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import produce from &#39;immer&#39;;</span>
<span class="line">+function createReducer(initialState, reducers={}, extraReducers={}) {</span>
<span class="line">    return function (state = initialState, action) {</span>
<span class="line">        let reducer = reducers[action.type];</span>
<span class="line">        if (reducer)</span>
<span class="line">            return produce(state, draft =&gt; {</span>
<span class="line">                reducer(draft, action);</span>
<span class="line">            });</span>
<span class="line">+       let extraReducer = extraReducers[action.type];</span>
<span class="line">+       if (extraReducer) {</span>
<span class="line">+           return produce(state, draft =&gt; {</span>
<span class="line">+               extraReducer(draft, action);</span>
<span class="line">+           });</span>
<span class="line">+       }</span>
<span class="line">        return state;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default createReducer;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-createslice-js" tabindex="-1"><a class="header-anchor" href="#_10-4-createslice-js"><span>10.4 createSlice.js</span></a></h3><p>src\\toolkit\\createSlice.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createReducer, createAction } from &#39;./&#39;</span>
<span class="line">function createSlice(options) {</span>
<span class="line">+   let { name, initialState={}, reducers={},extraReducers={}  } = options;</span>
<span class="line">    let actions = {};</span>
<span class="line">    const prefixReducers = {};</span>
<span class="line">    Object.keys(reducers).forEach(function (key) {</span>
<span class="line">        var type = getType(name, key);</span>
<span class="line">        actions[key] = createAction(type);</span>
<span class="line">        prefixReducers[type]=reducers[key];</span>
<span class="line">    })</span>
<span class="line">+   let reducer = createReducer(initialState, prefixReducers,extraReducers);</span>
<span class="line">    return {</span>
<span class="line">        name,</span>
<span class="line">        reducer,</span>
<span class="line">        actions</span>
<span class="line">    };</span>
<span class="line">}</span>
<span class="line">function getType(slice, actionKey) {</span>
<span class="line">    return slice + &quot;/&quot; + actionKey;</span>
<span class="line">}</span>
<span class="line">export default createSlice;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-5-createasyncthunk-js" tabindex="-1"><a class="header-anchor" href="#_10-5-createasyncthunk-js"><span>10.5 createAsyncThunk.js</span></a></h3><p>src\\toolkit\\createAsyncThunk.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">createAsyncThunk</span><span class="token punctuation">(</span><span class="token parameter">typePrefix<span class="token punctuation">,</span> payloadCreator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>typePrefix <span class="token operator">+</span> <span class="token string">&quot;/pending&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> fulfilled <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>typePrefix <span class="token operator">+</span> <span class="token string">&quot;/fulfilled&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> rejected <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>typePrefix <span class="token operator">+</span> <span class="token string">&quot;/rejected&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">actionCreator</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">pending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">payloadCreator</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> abort<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> abortedPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function-variable function">abort</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;AbortError&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Aborted&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise<span class="token punctuation">,</span> abortedPromise<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fulfilled</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">rejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token punctuation">{</span> abort <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>actionCreator<span class="token punctuation">,</span> <span class="token punctuation">{</span> pending<span class="token punctuation">,</span> rejected<span class="token punctuation">,</span> fulfilled <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> createAsyncThunk<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-6-toolkit-index-js" tabindex="-1"><a class="header-anchor" href="#_10-6-toolkit-index-js"><span>10.6 toolkit\\index.js</span></a></h3><p>src\\toolkit\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as configureStore } from &#39;./configureStore&#39;;</span>
<span class="line">export { default as createAction } from &#39;./createAction&#39;;</span>
<span class="line">export { default as createReducer } from &#39;./createReducer&#39;;</span>
<span class="line">export { default as createSlice } from &#39;./createSlice&#39;;</span>
<span class="line">export {createSelector } from &#39;../reselect&#39;;</span>
<span class="line">+export { default as createAsyncThunk } from &quot;./createAsyncThunk&quot;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-7-api-js" tabindex="-1"><a class="header-anchor" href="#_10-7-api-js"><span>10.7 api.js</span></a></h3><p>api.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;cors&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;接口出错&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token string">&quot;吃饭&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token string">&quot;睡觉&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/todos/list&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">_req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/todos/detail/:id&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> todo <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span>item<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">服务在端口8080启动</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-redux-toolkit-query" tabindex="-1"><a class="header-anchor" href="#_11-redux-toolkit-query"><span>11.Redux Toolkit Query</span></a></h2><ul><li><p><a href="https://redux-toolkit.js.org/rtk-query/overview" target="_blank" rel="noopener noreferrer">Redux Toolkit Query</a>是一种高级的数据获取和缓存工具，旨在简化在Web应用程序中加载数据的常见情况</p></li><li><p>跟踪加载状态用来显示UI转圈组件</p></li><li><p>避免对相同的数据进行重复请求</p></li><li><p>优化UI的更新感觉更快</p></li><li><p>根据用户的交互来管理缓存的生命周期</p></li><li><p>createApi() RTK Query的核心函数，它允许你定义endpoint的集合用来描述如何获取数据，包含如何获取和转换数据</p></li><li><p>fetchBaseQuery() 一个用来简化请求的对fetch的封装</p></li></ul><h3 id="_11-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_11-1-src-index-js"><span>11.1 src\\index.js</span></a></h3><p>src\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;!DOCTYPE html&gt;</span>
<span class="line">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="line">  &lt;head&gt;</span>
<span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;</span>
<span class="line">     &lt;meta name=&quot;theme-color&quot; content=&quot;</span>
<span class="line">    &lt;meta</span>
<span class="line">      name=&quot;description&quot;</span>
<span class="line">      content=&quot;Web site created using create-react-app&quot;</span>
<span class="line">    /&gt;</span>
<span class="line">    &lt;title&gt;Redux Toolkit&lt;/title&gt;</span>
<span class="line">  &lt;/head&gt;</span>
<span class="line">  &lt;body&gt;</span>
<span class="line">+    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span>
<span class="line">  &lt;/body&gt;</span>
<span class="line">&lt;/html&gt;</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-src-index-js" tabindex="-1"><a class="header-anchor" href="#_11-2-src-index-js"><span>11.2 src\\index.js</span></a></h3><p>src\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./store&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App&#39;</span><span class="token punctuation">;</span></span>
<span class="line">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-3-src-app-js" tabindex="-1"><a class="header-anchor" href="#_11-3-src-app-js"><span>11.3 src\\App.js</span></a></h3><p>src\\App.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> todosApi <span class="token keyword">from</span> <span class="token string">&#39;./todos&#39;</span></span>
<span class="line"><span class="token comment">//使用自定义查询 hook可以自动获取数据并且返回查询结果</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用一个查询Hook，它会自动获取数据并且返回查询的值</span></span>
<span class="line">    <span class="token comment">//const { data, error, isLoading } = useGetTodosQuery(1)</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span> <span class="token operator">=</span> todosApi<span class="token punctuation">.</span>endpoints<span class="token punctuation">.</span>getTodos<span class="token punctuation">.</span><span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// Individual hooks are also accessible under the generated endpoints:</span></span>
<span class="line">    <span class="token comment">// 每个hook也</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;isLoading=&#39;</span><span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> <span class="token string">&#39;error=&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> <span class="token string">&#39;data=&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>加载中<span class="token operator">...</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>error<span class="token punctuation">.</span>error<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-4-src-store-js" tabindex="-1"><a class="header-anchor" href="#_11-4-src-store-js"><span>11.4 src\\store.js</span></a></h3><p>src\\store.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@reduxjs/toolkit&#39;</span></span>
<span class="line"><span class="token comment">//import { configureStore } from &#39;./toolkit&#39;</span></span>
<span class="line"><span class="token keyword">import</span> todosApi <span class="token keyword">from</span> <span class="token string">&#39;./todos&#39;</span></span>
<span class="line"> <span class="token comment">//API slice会包含自动生成的redux reducer和一个自定义中间件</span></span>
<span class="line"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">reducer</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span>todosApi<span class="token punctuation">.</span>reducerPath<span class="token punctuation">]</span><span class="token operator">:</span> todosApi<span class="token punctuation">.</span>reducer<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">middleware</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">getDefaultMiddleware</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">    <span class="token function">getDefaultMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>todosApi<span class="token punctuation">.</span>middleware<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-5-src-todos-js" tabindex="-1"><a class="header-anchor" href="#_11-5-src-todos-js"><span>11.5 src\\todos.js</span></a></h3><p>src\\todos.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//React entry point 会自动根据endpoints生成hooks</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApi<span class="token punctuation">,</span> fetchBaseQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@reduxjs/toolkit/query/react&#39;</span></span>
<span class="line"><span class="token comment">//import { createApi, fetchBaseQuery } from &#39;./toolkit/query/react&#39;</span></span>
<span class="line"><span class="token comment">//使用base URL 和endpoints 定义服务</span></span>
<span class="line"><span class="token keyword">const</span> todosApi <span class="token operator">=</span> <span class="token function">createApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">reducerPath</span><span class="token operator">:</span> <span class="token string">&#39;todosApi&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">baseQuery</span><span class="token operator">:</span> <span class="token function">fetchBaseQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">baseUrl</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:8080&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">endpoints</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">//从参数生成查询参数 转变响应并且缓存</span></span>
<span class="line">      <span class="token literal-property property">getTodos</span><span class="token operator">:</span> builder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">query</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/todos/detail/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">//导出可在函数式组件使用的hooks,它是基于定义的endpoints自动生成的</span></span>
<span class="line"><span class="token comment">//export const { useGetTodosQuery } = todosApi</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> todosApi<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-6-configurestore-js" tabindex="-1"><a class="header-anchor" href="#_11-6-configurestore-js"><span>11.6 configureStore.js</span></a></h3><p>src\\toolkit\\configureStore.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers<span class="token punctuation">,</span>applyMiddleware<span class="token punctuation">,</span>createStore<span class="token punctuation">,</span>compose <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">&#39;redux-thunk&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> middleware<span class="token operator">=</span><span class="token punctuation">[</span>thunk<span class="token punctuation">]</span><span class="token punctuation">,</span> preloadedState <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> rootReducer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> reducer <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rootReducer <span class="token operator">=</span> reducer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   middleware<span class="token operator">=</span><span class="token keyword">typeof</span> middleware <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token operator">?</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">[</span>thunk<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>middleware</span>
<span class="line">    <span class="token keyword">const</span> enhancer <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token operator">...</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ <span class="token operator">||</span> compose<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> preloadedState<span class="token punctuation">,</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>enhancer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> configureStore<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-7-react-js" tabindex="-1"><a class="header-anchor" href="#_11-7-react-js"><span>11.7 react.js</span></a></h3><p>src\\toolkit\\query\\react.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createSlice <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ReactReduxContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">FETCH_DATA</span> <span class="token operator">=</span> <span class="token string">&#39;FETCH_DATA&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">fetchBaseQuery</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> baseUrl <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        url <span class="token operator">=</span> baseUrl <span class="token operator">+</span> url<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">createApi</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> reducerPath<span class="token punctuation">,</span> baseQuery<span class="token punctuation">,</span> endpoints <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> builder <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ReactReduxContext<span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> forceUpdate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">let</span> url <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">FETCH_DATA</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> url <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>forceUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">,</span> store<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">let</span> state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> state <span class="token operator">?</span> state<span class="token punctuation">[</span>reducerPath<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> reducerPath<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">initialState</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> payload<span class="token punctuation">)</span></span>
<span class="line">                    state<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> payload<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> actions<span class="token punctuation">,</span> reducer <span class="token punctuation">}</span> <span class="token operator">=</span> slice</span>
<span class="line">    <span class="token keyword">let</span> api <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        reducerPath<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">endpoints</span><span class="token operator">:</span> <span class="token function">endpoints</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        reducer<span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">middleware</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">FETCH_DATA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">let</span> <span class="token punctuation">{</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                                <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">baseQuery</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">,</span> <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> error<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> api<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> fetchBaseQuery<span class="token punctuation">,</span> createApi <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-axios-basequery" tabindex="-1"><a class="header-anchor" href="#_12-axios-basequery"><span>12.axios-basequery</span></a></h2><ul><li>[basequery](https://redux-toolkit.js.org/rtk-query/api/createApi</li><li><a href="https://redux-toolkit.js.org/rtk-query/usage/customizing-queries" target="_blank" rel="noopener noreferrer">customizing-queries</a></li><li>[axios-basequery](https://redux-toolkit.js.org/rtk-query/usage/customizing-queries</li></ul><h4 id="_11-4-1-src-todos-js" tabindex="-1"><a class="header-anchor" href="#_11-4-1-src-todos-js"><span>11.4.1 src\\todos.js</span></a></h4><p>src\\todos.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//React entry point 会自动根据endpoints生成hooks</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApi<span class="token punctuation">,</span> fetchBaseQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@reduxjs/toolkit/query/react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span></span>
<span class="line">axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">data</span><span class="token operator">:</span>response<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//成功的响应体</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//失败</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">error</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">error</span><span class="token operator">:</span>error<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">axiosBaseQuery</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> baseUrl <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> baseUrl <span class="token operator">+</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> error<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">//import { createApi, fetchBaseQuery } from &#39;./toolkit/query/react&#39;</span></span>
<span class="line"><span class="token comment">//使用base URL 和endpoints 定义服务</span></span>
<span class="line"><span class="token keyword">const</span> todosApi <span class="token operator">=</span> <span class="token function">createApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">reducerPath</span><span class="token operator">:</span> <span class="token string">&#39;todosApi&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">baseQuery</span><span class="token operator">:</span> <span class="token function">axiosBaseQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">baseUrl</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:8080&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">endpoints</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">//从参数生成查询参数 转变响应并且缓存</span></span>
<span class="line">      <span class="token literal-property property">getTodos</span><span class="token operator">:</span> builder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">query</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/todos/detail/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">//导出可在函数式组件使用的hooks,它是基于定义的endpoints自动生成的</span></span>
<span class="line"><span class="token comment">//export const { useGetTodosQuery } = todosApi</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> todosApi<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li><a href="https://gitee.com/zhufengpeixun/zhufeng-redux-toolkit" target="_blank" rel="noopener noreferrer">toolkit</a></li></ul>`,147)])])}const o=s(t,[["render",l]]),u=JSON.parse('{"path":"/strong/136.toolkit.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/136.toolkit.md"}');export{o as comp,u as data};
