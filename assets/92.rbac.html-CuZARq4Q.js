import{_ as s,c as a,a as t,o as p}from"./app-CD1YpnS1.js";const e={};function l(i,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h2 id="_1-rbac" tabindex="-1"><a class="header-anchor" href="#_1-rbac"><span>1.RBAC</span></a></h2><ul><li>基于角色的权限访问控制（Role-Based Access Control）</li><li>RBAC（Role-Based Access Control，基于角色的访问控制），就是用户通过角色与权限进行关联</li><li>一个用户拥有若干角色,每一个角色拥有若干权限。这样，就构造成<code>用户-角色-权限</code>的授权模型</li><li>在这种模型中，用户与角色之间，角色与权限之间一般是多对多的关系</li><li>在RBAC中最重要的概念包括：用户(User)，角色(Role)，权限(Permission)</li></ul><h3 id="_1-1-示意图" tabindex="-1"><a class="header-anchor" href="#_1-1-示意图"><span>1.1 示意图</span></a></h3><p><img src="http://img.zhufengpeixun.cn/rbacimage.jpg" alt="rbacimage"></p><h3 id="_1-2-表设计" tabindex="-1"><a class="header-anchor" href="#_1-2-表设计"><span>1.2 表设计</span></a></h3><h3 id="_1-2-1-用户表-user" tabindex="-1"><a class="header-anchor" href="#_1-2-1-用户表-user"><span>1.2.1 用户表(user)</span></a></h3><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th><th style="text-align:left;">默认</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">userName</td><td style="text-align:left;">用户名</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">password</td><td style="text-align:left;">密码</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">userName</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">password</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;isadmin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;isuser&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-2-角色表-role" tabindex="-1"><a class="header-anchor" href="#_1-2-2-角色表-role"><span>1.2.2 角色表(role)</span></a></h3><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th><th style="text-align:left;">默认</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">name</td><td style="text-align:left;">名称</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">desc</td><td style="text-align:left;">描述</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">name</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">desc</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span> <span class="token constant">E</span></span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;管理员&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;普通用户&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-3-权限表-permission" tabindex="-1"><a class="header-anchor" href="#_1-2-3-权限表-permission"><span>1.2.3 权限表(permission)</span></a></h3><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th><th style="text-align:left;">默认</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">name</td><td style="text-align:left;">名称</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">parent_id</td><td style="text-align:left;">父ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">icon</td><td style="text-align:left;">图标</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">key</td><td style="text-align:left;">路径</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">type</td><td style="text-align:left;">类型</td><td style="text-align:left;">varchar(32)</td><td style="text-align:left;"></td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">name</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">parent_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">icon</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">key</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">type</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;授权平台&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;desktop&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;角色管理&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;team&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/role&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;用户管理&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&#39;权限管理&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;idcard&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/resource&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&#39;添加用户&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;team&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/user/add&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&#39;删除用户&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;team&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/user/delete&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-4-角色用户表-role-user" tabindex="-1"><a class="header-anchor" href="#_1-2-4-角色用户表-role-user"><span>1.2.4 角色用户表(role_user)</span></a></h3><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th></tr></thead><tbody><tr><td style="text-align:left;">role_id</td><td style="text-align:left;">角色ID</td><td style="text-align:left;">int(11)</td></tr><tr><td style="text-align:left;">user_id</td><td style="text-align:left;">用户ID</td><td style="text-align:left;">int(11)</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">DROP</span> <span class="token constant">TABLE</span> <span class="token constant">IF</span> <span class="token constant">EXISTS</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-5-角色权限-role-permission" tabindex="-1"><a class="header-anchor" href="#_1-2-5-角色权限-role-permission"><span>1.2.5 角色权限(role_permission)</span></a></h3><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th></tr></thead><tbody><tr><td style="text-align:left;">role_id</td><td style="text-align:left;">角色ID</td><td style="text-align:left;">int(11)</td></tr><tr><td style="text-align:left;">permission_id</td><td style="text-align:left;">资源ID</td><td style="text-align:left;">int(11)</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-6-数据库脚本" tabindex="-1"><a class="header-anchor" href="#_1-2-6-数据库脚本"><span>1.2.6 数据库脚本</span></a></h3><ul><li><a href="http://img.zhufengpeixun.cn/cms.sql" target="_blank" rel="noopener noreferrer">cms.sql</a></li></ul><h2 id="_2-后端" tabindex="-1"><a class="header-anchor" href="#_2-后端"><span>2. 后端</span></a></h2><h3 id="_2-1-初始化项目" tabindex="-1"><a class="header-anchor" href="#_2-1-初始化项目"><span>2.1.初始化项目</span></a></h3><ul><li><a href="https://eggjs.org/zh-cn/intro/quickstart.html" target="_blank" rel="noopener noreferrer">egg.js</a></li><li><a href="https://eggjs.org/api/" target="_blank" rel="noopener noreferrer">api</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir client-side</span>
<span class="line">cd client-side</span>
<span class="line">cnpm init egg --type=ts</span>
<span class="line">cnpm i </span>
<span class="line">cnpm run dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-支持mysql" tabindex="-1"><a class="header-anchor" href="#_2-2-支持mysql"><span>2.2.支持MYSQL</span></a></h3><ul><li><a href="https://eggjs.org/zh-cn/tutorials/mysql.html" target="_blank" rel="noopener noreferrer">mysql</a></li></ul><h4 id="_2-2-1-安装" tabindex="-1"><a class="header-anchor" href="#_2-2-1-安装"><span>2.2.1 安装</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i --save egg-mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-2-2-开启插件" tabindex="-1"><a class="header-anchor" href="#_2-2-2-开启插件"><span>2.2.2 开启插件</span></a></h4><ul><li>config\\plugin.ts</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { EggPlugin } from &#39;egg&#39;;</span>
<span class="line"></span>
<span class="line">const plugin: EggPlugin = {</span>
<span class="line">+  mysql: {</span>
<span class="line">+    enable: true,</span>
<span class="line">+    package: &#39;egg-mysql&#39;</span>
<span class="line">+  }</span>
<span class="line">};</span>
<span class="line">export default plugin;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-3-配置数据源" tabindex="-1"><a class="header-anchor" href="#_2-2-3-配置数据源"><span>2.2.3 配置数据源</span></a></h4><p>config\\config.default.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { EggAppConfig, EggAppInfo, PowerPartial } from &#39;egg&#39;;</span>
<span class="line"></span>
<span class="line">export default (appInfo: EggAppInfo) =&gt; {</span>
<span class="line">  const config = {} as PowerPartial&lt;EggAppConfig&gt;;</span>
<span class="line"></span>
<span class="line">  // override config from framework / plugin</span>
<span class="line">  // use for cookie sign key, should change to your own and keep security</span>
<span class="line">  config.keys = appInfo.name + &#39;_1580620890875_8931&#39;;</span>
<span class="line"></span>
<span class="line">  // add your egg config in here</span>
<span class="line">  config.middleware = [];</span>
<span class="line"></span>
<span class="line">+  config.mysql = {</span>
<span class="line">+    // 单数据库信息配置</span>
<span class="line">+    client: {</span>
<span class="line">+      // host</span>
<span class="line">+      host: &#39;localhost&#39;,</span>
<span class="line">+      // 端口号</span>
<span class="line">+      port: &#39;3306&#39;,</span>
<span class="line">+      // 用户名</span>
<span class="line">+      user: &#39;root&#39;,</span>
<span class="line">+      // 密码</span>
<span class="line">+      password: &#39;root&#39;,</span>
<span class="line">+      // 数据库名</span>
<span class="line">+      database: &#39;cms&#39;</span>
<span class="line">+    },</span>
<span class="line">+    // 是否加载到 app 上，默认开启</span>
<span class="line">+    app: true,</span>
<span class="line">+    // 是否加载到 agent 上，默认关闭</span>
<span class="line">+    agent: false,</span>
<span class="line">+  };</span>
<span class="line">  // add your special config in here</span>
<span class="line">  const bizConfig = {</span>
<span class="line">    sourceUrl: \`https://github.com/eggjs/examples/tree/master/\${appInfo.name}\`,</span>
<span class="line">  };</span>
<span class="line"></span>
<span class="line">  // the return config will combines to EggAppConfig</span>
<span class="line">  return {</span>
<span class="line">    ...config,</span>
<span class="line">    ...bizConfig,</span>
<span class="line">  };</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-4-配置声明文件" tabindex="-1"><a class="header-anchor" href="#_2-2-4-配置声明文件"><span>2.2.4 配置声明文件</span></a></h4><ul><li>config\\config.default.ts</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import &#39;egg&#39;;</span>
<span class="line"></span>
<span class="line">declare module &#39;egg&#39; {</span>
<span class="line">+    interface Application {</span>
<span class="line">+        mysql: any;</span>
<span class="line">+    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-4-使用mysql" tabindex="-1"><a class="header-anchor" href="#_2-2-4-使用mysql"><span>2.2.4 使用mysql</span></a></h4><ul><li>app\\controller\\home.ts</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { Controller } from &#39;egg&#39;;</span>
<span class="line"></span>
<span class="line">export default class HomeController extends Controller {</span>
<span class="line">  public async index() {</span>
<span class="line">    const { ctx } = this;</span>
<span class="line">+    let users = await this.app.mysql.select(&#39;user&#39;);</span>
<span class="line">+    ctx.body = {</span>
<span class="line">+      success: true,</span>
<span class="line">+      data: users</span>
<span class="line">+    };</span>
<span class="line">    //ctx.body = await ctx.service.test.sayHi(&#39;egg&#39;);</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-passport" tabindex="-1"><a class="header-anchor" href="#_2-3-passport"><span>2.3.Passport</span></a></h3><ul><li><a href="https://eggjs.org/zh-cn/tutorials/passport.html" target="_blank" rel="noopener noreferrer">passport</a></li></ul><h4 id="_2-3-1-安装" tabindex="-1"><a class="header-anchor" href="#_2-3-1-安装"><span>2.3.1 安装</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i --save egg-passport passport-local</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-3-2-config-plugin-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-2-config-plugin-ts"><span>2.3.2 config\\plugin.ts</span></a></h4><p>config\\plugin.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { EggPlugin } from &#39;egg&#39;;</span>
<span class="line"></span>
<span class="line">const plugin: EggPlugin = {</span>
<span class="line">  mysql: {</span>
<span class="line">    enable: true,</span>
<span class="line">    package: &#39;egg-mysql&#39;</span>
<span class="line">  },</span>
<span class="line">+  passport: {</span>
<span class="line">+    enable: true,</span>
<span class="line">+    package: &#39;egg-passport&#39;</span>
<span class="line">+  },</span>
<span class="line">+  passportLocal: {</span>
<span class="line">+    enable: true,</span>
<span class="line">+    package: &#39;egg-passport-local&#39;</span>
<span class="line">+  }</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">export default plugin;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-3-typings-index-d-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-3-typings-index-d-ts"><span>2.3.3 typings\\index.d.ts</span></a></h4><p>typings\\index.d.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import &#39;egg&#39;;</span>
<span class="line"></span>
<span class="line">declare module &#39;egg&#39; {</span>
<span class="line">    interface Application {</span>
<span class="line">         mysql: any;</span>
<span class="line">+        passport: any;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-4-app-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-4-app-ts"><span>2.3.4 app.ts</span></a></h4><p>app.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> IBoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;egg&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Strategy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;passport-local&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FooBoot</span> <span class="token keyword">implements</span> <span class="token class-name">IBoot</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> readonly app<span class="token operator">:</span> Application<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">app</span><span class="token operator">:</span> Application</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> app<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">configDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//Config, plugin files have loaded.</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">        app<span class="token punctuation">.</span>passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Strategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">usernameField</span><span class="token operator">:</span> <span class="token string">&#39;userName&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">passReqToCallback</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> password<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> userName<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>users <span class="token operator">&amp;&amp;</span> users<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">let</span> user <span class="token operator">=</span> users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">let</span> roles <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">SELECT role.* FROM user INNER JOIN role_user ON user.id = role_user.user_id inner JOIN role ON role_user.role_id=role.id WHERE user.id=?</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                user<span class="token punctuation">.</span>currentAuthority <span class="token operator">=</span> roles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">role</span> <span class="token operator">=&gt;</span> role<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                req<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-5-app-controller-user-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-5-app-controller-user-ts"><span>2.3.5 app\\controller\\user.ts</span></a></h4><p>app\\controller\\user.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;egg&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">userController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">loginCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">.</span>type<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">.</span>currentAuthority</span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;用户名或密码错误&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">addUser2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> user <span class="token operator">=</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> permissions <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">SELECT permission.key FROM user INNER JOIN role_user ON user.id = role_user.user_id inner JOIN role_permission ON role_user.role_id=role_permission.role_id  INNER JOIN permission ON role_permission.permission_id = permission.id  WHERE user.id=?</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> allowed <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>allowed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;添加用户成功&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;用户未授权&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;用户未授权&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;添加用户成功&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-6-middleware-auth-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-6-middleware-auth-ts"><span>2.3.6 middleware\\auth.ts</span></a></h4><p>app\\middleware\\auth.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_options<span class="token punctuation">,</span> _app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> user <span class="token operator">=</span> ctx<span class="token punctuation">.</span>user<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>url<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> permissions <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">SELECT permission.key FROM user INNER JOIN role_user ON user.id = role_user.user_id inner JOIN role_permission ON role_user.role_id=role_permission.role_id  INNER JOIN permission ON role_permission.permission_id = permission.id  WHERE user.id=?</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> allowed <span class="token operator">=</span> permissions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>allowed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;用户未授权&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;用户未授权&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-7-app-router-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-7-app-router-ts"><span>2.3.7 app\\router.ts</span></a></h4><ul><li>[middleware](https://eggjs.org/zh-cn/basics/middleware.html</li></ul><p>app\\router.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { Application } from &#39;egg&#39;;</span>
<span class="line">export default (app: Application) =&gt; {</span>
<span class="line">  const { controller, router } = app;</span>
<span class="line">  router.get(&#39;/&#39;, controller.home.index);</span>
<span class="line">+  const localStrategy = app.passport.authenticate(&#39;local&#39;, { successRedirect: &#39;/server/api/loginCallback&#39;, failureRedirect: &#39;/server/api/loginCallback&#39; });</span>
<span class="line">+  router.post(&#39;/api/login/account&#39;, localStrategy);</span>
<span class="line">+  const auth = app.middleware.auth();</span>
<span class="line">+  router.post(&#39;/api/user/add&#39;, auth, controller.user.addUser);</span>
<span class="line">+  router.get(&#39;/api/loginCallback&#39;, controller.user.loginCallback);</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-8-config-config-default-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-8-config-config-default-ts"><span>2.3.8 config\\config.default.ts</span></a></h4><ul><li>config\\config.default.ts</li><li>[csrf](https://eggjs.org/zh-cn/core/security.html</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+  config.security = {</span>
<span class="line">+    csrf: false</span>
<span class="line">+  }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-9-测试" tabindex="-1"><a class="header-anchor" href="#_2-3-9-测试"><span>2.3.9 测试</span></a></h4><ul><li><a href="https://insomnia.rest/" target="_blank" rel="noopener noreferrer">insomnia</a></li><li><a href="http://img.zhufengpeixun.cn/Insomnia.Setup.7.0.6.zip" target="_blank" rel="noopener noreferrer">window</a></li><li>[debug](https://eggjs.org/zh-cn/core/development.html</li></ul><p>ctrl+shift+p</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">Debug: Toggle Auto Attach</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-前端" tabindex="-1"><a class="header-anchor" href="#_3-前端"><span>3. 前端</span></a></h2><h3 id="_3-1-启动项目" tabindex="-1"><a class="header-anchor" href="#_3-1-启动项目"><span>3.1. 启动项目</span></a></h3><ul><li><a href="https://github.com/umijs/create-umi" target="_blank" rel="noopener noreferrer">create-umi</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">umi -v</span>
<span class="line">umi ui</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-设置代理" tabindex="-1"><a class="header-anchor" href="#_3-2-设置代理"><span>3.2. 设置代理</span></a></h3><h4 id="_3-2-1-config-config-ts" tabindex="-1"><a class="header-anchor" href="#_3-2-1-config-config-ts"><span>3.2.1 config\\config.ts</span></a></h4><p>config\\config.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+  proxy: {</span>
<span class="line">+    &#39;/server/api/&#39;: {</span>
<span class="line">+      target: &#39;http://localhost:7001/&#39;,</span>
<span class="line">+      changeOrigin: true,</span>
<span class="line">+      pathRewrite: { &#39;^/server&#39;: &#39;&#39; },</span>
<span class="line">+    },</span>
<span class="line">+  },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-前端项目" tabindex="-1"><a class="header-anchor" href="#_3-3-前端项目"><span>3.3. 前端项目</span></a></h3><h4 id="_3-3-1-config-config-ts" tabindex="-1"><a class="header-anchor" href="#_3-3-1-config-config-ts"><span>3.3.1 config\\config.ts</span></a></h4><p>config\\config.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/user&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;../layouts/UserLayout&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;login&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/user/login&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./user/login&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;../layouts/SecurityLayout&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;../layouts/BasicLayout&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">authority</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">&#39;/welcome&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/welcome&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;welcome&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;smile&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./Welcome&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/admin&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;权限平台&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;crown&#39;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token comment">//component: &#39;./Admin&#39;,</span></span>
<span class="line">              <span class="token comment">//authority: [&#39;admin&#39;],</span></span>
<span class="line">              <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;角色管理&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;smile&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/admin/role&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./admin/Role&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">authority</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">]</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;用户管理&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;smile&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/admin/user&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./admin/User&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">authority</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">]</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;权限管理&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;smile&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/admin/permission&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./admin/Permission&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">authority</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">]</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./404&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./404&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./404&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-2-user-index-tsx" tabindex="-1"><a class="header-anchor" href="#_3-3-2-user-index-tsx"><span>3.3.2 User\\index.tsx</span></a></h4><p>src\\pages\\admin\\User\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { queryRule, updateRule, addUser, removeRule } from &#39;./service&#39;;</span>
<span class="line">+import Authorized from &#39;@/utils/Authorized&#39;;</span>
<span class="line">+&lt;Authorized authority={[&#39;admin&#39;, &#39;user&#39;]} noMatch={null}&gt;</span>
<span class="line">+            &lt;Button icon={&#39;plus&#39;} type=&quot;primary&quot; onClick={() =&gt; handleModalVisible(true)}&gt;</span>
<span class="line">+              新建</span>
<span class="line">+           &lt;/Button&gt;</span>
<span class="line">+&lt;/Authorized&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,87)])])}const o=s(e,[["render",l]]),r=JSON.parse('{"path":"/strong/92.rbac.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/92.rbac.md"}');export{o as comp,r as data};
