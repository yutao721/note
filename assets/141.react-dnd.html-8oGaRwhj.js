import{_ as s,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(i,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h2 id="_1-拖拽应用场景" tabindex="-1"><a class="header-anchor" href="#_1-拖拽应用场景"><span>1.拖拽应用场景</span></a></h2><ul><li>拖拽的业务很常见，比如拖拽菜单 、拖拽卡片排序和拖拽评分等</li></ul><h2 id="_2-react-dnd" tabindex="-1"><a class="header-anchor" href="#_2-react-dnd"><span>2.React DnD</span></a></h2><ul><li><a href="https://www.npmjs.com/package/react-dnd" target="_blank" rel="noopener noreferrer">react-dnd</a>是React和Redux核心作者 Dan创造的一组React实用程序，可帮助您构建复杂的拖放界面</li><li><a href="http://react-dnd.github.io/react-dnd/" target="_blank" rel="noopener noreferrer">react-dnd官网</a></li></ul><h2 id="_3-核心知识" tabindex="-1"><a class="header-anchor" href="#_3-核心知识"><span>3.核心知识</span></a></h2><h3 id="_3-1-html拖放api" tabindex="-1"><a class="header-anchor" href="#_3-1-html拖放api"><span>3.1 HTML拖放API</span></a></h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API" target="_blank" rel="noopener noreferrer">HTML 拖放（Drag and Drop）</a>接口使应用程序能够在浏览器中使用拖放功能。例如，用户可使用鼠标选择可拖拽（draggable）元素，将元素拖拽到可放置（droppable）元素，并释放鼠标按钮以放置这些元素。拖拽操作期间，会有一个可拖拽元素的半透明快照跟随着鼠标指针</li></ul><table><thead><tr><th style="text-align:left;">事件</th><th style="text-align:left;">触发时刻</th></tr></thead><tbody><tr><td style="text-align:left;">dragstart</td><td style="text-align:left;">当用户开始拖拽一个元素时触发</td></tr><tr><td style="text-align:left;">dragover</td><td style="text-align:left;">当元素被拖到一个可释放目标上时触发(每100毫秒触发一次)</td></tr><tr><td style="text-align:left;">dragend</td><td style="text-align:left;">当拖拽操作结束时触发</td></tr></tbody></table><h3 id="_3-2-触摸事件" tabindex="-1"><a class="header-anchor" href="#_3-2-触摸事件"><span>3.2 触摸事件</span></a></h3><ul><li>HTML拖放API不支持触摸事件，所以它不适用于平板电脑和移动设备</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Touch_events" target="_blank" rel="noopener noreferrer">触摸事件(Touch_events)</a>可为特定程序提供多点触控交互的支持</li></ul><table><thead><tr><th style="text-align:left;">事件</th><th style="text-align:left;">触发时刻</th></tr></thead><tbody><tr><td style="text-align:left;">touchstart</td><td style="text-align:left;">触摸开始</td></tr><tr><td style="text-align:left;">touchmove</td><td style="text-align:left;">接触点移动</td></tr><tr><td style="text-align:left;">touchend</td><td style="text-align:left;">触摸结束</td></tr></tbody></table><h3 id="_3-3-getboundingclientrect" tabindex="-1"><a class="header-anchor" href="#_3-3-getboundingclientrect"><span>3.3 getBoundingClientRect</span></a></h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect" target="_blank" rel="noopener noreferrer">getBoundingClientRect</a>方法返回元素的大小及其相对于视口的位置</li></ul><p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/rect_1634833633920.png" alt=""></p><h3 id="_3-4-clientx-y" tabindex="-1"><a class="header-anchor" href="#_3-4-clientx-y"><span>3.4 clientX/Y</span></a></h3><ul><li>event.clientX 鼠标相对于浏览器左上角x轴的坐标； 不随滚动条滚动而改变</li><li>event.clientY 鼠标相对于浏览器左上角y轴的坐标； 不随滚动条滚动而改变</li></ul><h3 id="_3-5-react-hooks" tabindex="-1"><a class="header-anchor" href="#_3-5-react-hooks"><span>3.5 React Hooks</span></a></h3><ul><li><code>useState</code> 通过在函数组件里调用它来给组件添加一些内部 state,React 会在重复渲染时保留这个 state</li><li><code>useCallback</code> 把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新</li><li><code>useMemo</code> 把创建函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算 memoized 值</li><li><code>useLayoutEffect</code> 给函数组件增加了操作副作用的能力</li></ul><h3 id="_3-6-高阶组件" tabindex="-1"><a class="header-anchor" href="#_3-6-高阶组件"><span>3.6 高阶组件</span></a></h3><ul><li>高阶组件就是一个函数，传给它一个老组件，它返回一个新的组件</li><li>高阶组件的作用其实就是为了组件之间的代码复用</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> NewComponent <span class="token operator">=</span> <span class="token function">higherOrderComponent</span><span class="token punctuation">(</span>OldComponent<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_4-核心概念" tabindex="-1"><a class="header-anchor" href="#_4-核心概念"><span>4. 核心概念</span></a></h2><p><img src="https://static.zhufengpeixun.com/reactdnd2_1635074386436.png" alt="reactdnd"></p><h3 id="_4-1-dndprovider" tabindex="-1"><a class="header-anchor" href="#_4-1-dndprovider"><span>4.1 DndProvider</span></a></h3><ul><li>DndProvider 组件为您的应用程序提供 React-DnD 功能</li><li>使用时必须通过<code>backend</code>属性注入一个后端 <ul><li>backend: 必需属性 React DnD 后端</li></ul></li></ul><h3 id="_4-2-backend-后端" tabindex="-1"><a class="header-anchor" href="#_4-2-backend-后端"><span>4.2 backend(后端)</span></a></h3><ul><li>React DnD 使用 HTML5 拖放 API。它会截取拖动的 DOM 节点并将其用作开箱即用的<code>拖动预览</code>。 当光标移动时，您不必进行任何绘图，这很方便</li><li>后端抽象出浏览器差异并处理原生 DOM 事件,并将 DOM 事件转换为 React DnD 可以处理的内部 Redux 操作</li><li><a href="https://react-dnd.github.io/react-dnd/docs/backends/html5" target="_blank" rel="noopener noreferrer">react-dnd-html5-backend</a>是 React-DnD 支持的主要后端,它本质上是使用 HTML5 拖放 API</li><li>HTML5 后端不支持触摸事件。 所以它不适用于平板电脑和移动设备。 您可以使用<a href="https://react-dnd.github.io/react-dnd/docs/backends/touch" target="_blank" rel="noopener noreferrer">react-dnd-touch-backend</a></li></ul><h3 id="_4-3-dragdropmanager-管理器-和registry-注册器" tabindex="-1"><a class="header-anchor" href="#_4-3-dragdropmanager-管理器-和registry-注册器"><span>4.3 DragDropManager(管理器)和Registry(注册器)</span></a></h3><ul><li>管理整个拖拽应用</li><li>包含仓库和全局monitor</li><li>全局monitor里包含registry(注册器)</li><li>注册器里包含了handlerId和对应的DragSource或DropTarget的对应关系</li><li>每一个项目都会有一个唯一的handlerId</li></ul><h3 id="_4-4-items-and-types-项目和类型" tabindex="-1"><a class="header-anchor" href="#_4-4-items-and-types-项目和类型"><span>4.4 Items and Types(项目和类型)</span></a></h3><ul><li>与Redux一样，React DnD 使用数据而不是视图作为来源</li><li>当您在屏幕上拖动某物时，我们并不是说正在拖动组件或 DOM 节点。 相反，我们说某种类型的项目正在被拖动</li><li>什么是项目？ 一个项目是一个简单的 JavaScript 对象，描述被拖动的内容。 例如，在看板应用程序中，当您拖动卡片时，项目可能看起来像是<code>{type:&#39;card&#39;, id: &#39;card1&#39; }</code>, 将拖动的数据描述为普通对象可以帮助您保持组件解耦</li><li>那什么是type(类型)呢？ 类型是一个字符串(或Symbol)，它唯一地标识了应用程序中的项目。 在看板应用程序中，您可能有一个代表可拖动卡片的<code>卡片</code>类型</li><li>类型很有用，因为随着您的应用程序的增长，您可能希望使更多内容可拖动，但您不一定希望所有现有的放置目标突然开始对新项目做出反应。 这些类型允许您指定兼容的拖放源和放置目标</li></ul><p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/kanbanben_1634867988749.png" alt="kanbanben_1634867988749"></p><h3 id="_4-5-monitors-监听器" tabindex="-1"><a class="header-anchor" href="#_4-5-monitors-监听器"><span>4.5 Monitors(监听器)</span></a></h3><ul><li>拖放本质上是有状态的。 要么正在进行拖动操作，要么不在。 要么有当前类型和当前项目，要么没有。 这种状态必须存在于某个地方</li><li>React DnD 通过监视器封装内部存储状态,并将此状态公开给您的组件</li><li>监视器允许您更新组件的属性以响应拖放状态的变化</li><li>对于需要跟踪拖放状态的每个组件，您可以定义一个收集函数，从监视器获取它的相关属性</li><li>React DnD 然后负责及时调用您的收集函数并将其返回值合并到组件的属性对象中</li></ul><h4 id="_4-5-1-dragsourcemonitor-拖动源监听器" tabindex="-1"><a class="header-anchor" href="#_4-5-1-dragsourcemonitor-拖动源监听器"><span>4.5.1 DragSourceMonitor(拖动源监听器)</span></a></h4><ul><li><code>DragSourceMonitor</code> 是传递给基于钩子或基于装饰器的拖动源的收集函数的对象</li><li>它的方法可让您获取有关特定拖动源的拖动状态的信息</li><li>绑定到该监视器的特定拖动源在下面称为监视器的所有者</li><li>方法 <ul><li>isDragging(): 如果拖动操作正在进行中，并且所有者发起拖动，则返回 true</li><li>getItemType(): 返回标识当前拖动项目类型的字符串或Symbol</li><li>getItem(): 返回一个表示当前拖动项目的普通对象。 每个拖动源都必须通过从其 <code>beginDrag()</code> 方法返回一个对象来指定它</li><li>getClientOffset(): 在拖动操作正在进行时，返回最后记录的 { x, y } 鼠标的客户端偏移量</li></ul></li></ul><h4 id="_4-5-2-droptargetmonitor-放置目标监听器" tabindex="-1"><a class="header-anchor" href="#_4-5-2-droptargetmonitor-放置目标监听器"><span>4.5.2 DropTargetMonitor(放置目标监听器)</span></a></h4><ul><li>DropTargetMonitor 是传递给基于钩子或基于装饰器的收集函数的对象</li><li>它的方法可让您获取有关特定放置目标的拖动状态的信息</li><li>绑定到该监视器的特定放置目标在下面称为监视器的所有者</li><li>方法 <ul><li>getItemType(): 返回标识当前拖动项目类型的字符串或Symbol</li><li>getItem(): 返回一个表示当前拖动项目的普通对象。 每个拖动源都必须通过从其 beginDrag() 方法返回一个对象来指定它</li><li>getClientOffset(): 在拖动操作正在进行时，返回最后记录的 { x, y } 鼠标的客户端偏移量</li></ul></li></ul><h3 id="_4-6-connectors-连接器" tabindex="-1"><a class="header-anchor" href="#_4-6-connectors-连接器"><span>4.6 Connectors(连接器)</span></a></h3><ul><li>如果后端处理 DOM 事件，但是组件使用 React 来描述 DOM，后端如何知道要监听哪些 DOM 节点？</li><li>连接器允许您将预定义角色之一（拖动源或放置目标）分配给渲染函数中的 DOM 节点</li><li>事实上，连接器作为第一个参数传递给我们上面描述的收集函数</li><li>在组件的渲染方法中，我们可以访问从监视器获得的数据和从连接器获得的函数</li></ul><h4 id="_4-6-1-dragsourceconnector-拖动源连接器" tabindex="-1"><a class="header-anchor" href="#_4-6-1-dragsourceconnector-拖动源连接器"><span>4.6.1 DragSourceConnector(拖动源连接器)</span></a></h4><ul><li>DragSourceConnector 是传递给 DragSource 的收集函数的对象</li><li>它提供了将 React 组件绑定到 Drag Source 角色的能力</li><li>属性 <ul><li>dragSource 返回一个必须被 prop-injected 到你的组件中并在该组件的 render() 方法中使用的函数。 您可以将此函数传递给此方法一个 react 组件、一个 DOM 元素或一个 ref 对象</li></ul></li></ul><h4 id="_4-6-2-dragtargetconnector-放置目标连接器" tabindex="-1"><a class="header-anchor" href="#_4-6-2-dragtargetconnector-放置目标连接器"><span>4.6.2 DragTargetConnector(放置目标连接器)</span></a></h4><ul><li>DropTargetConnector 是传递给 DropTarget 的收集函数的对象。 它提供了将 React 组件绑定到 Drop Target 角色的能力</li><li>属性 <ul><li>dropTarget() =&gt; (Element | Node | Ref) 返回一个必须被 prop-injected 到你的组件中并在该组件的 render() 方法中使用的函数。 您可以将此函数传递给此方法一个 react 组件、一个 DOM 元素或一个 ref 对象</li></ul></li></ul><h3 id="_4-7-dragsources-拖动源-和droptargets-放置目标" tabindex="-1"><a class="header-anchor" href="#_4-7-dragsources-拖动源-和droptargets-放置目标"><span>4.7 DragSources(拖动源)和DropTargets(放置目标)</span></a></h3><ul><li>上面我们已经介绍了与 DOM 一起工作的后端、由项目和类型表示的数据以及收集功能，依靠监视器和连接器，这些功能让您可以描述 React DnD 应该注入到您的组件中的属性对象中</li><li>但是我们如何配置我们的组件来实际注入这些属性对象中呢？ 我们如何执行响应拖放事件的副作用？React DnD 的主要抽象单元拖动源和放置目标可以将类型、项目、副作用和收集功能与您的组件联系在一起</li><li>每当您想让一个组件或其某些部分可拖动时，您需要将该组件包装到拖动源声明中。 每个拖动源都针对特定类型注册，并且必须实现一个方法，从组件的 props 生成一个项目。 拖动源声明还允许您为给定组件指定收集功能</li><li>放置目标与拖动源非常相似。 唯一的区别是单个放置目标可以同时注册多个项目类型</li></ul><h4 id="_4-7-1-dragsource" tabindex="-1"><a class="header-anchor" href="#_4-7-1-dragsource"><span>4.7.1 DragSource</span></a></h4><ul><li>参数 <ul><li>type: 必需的。 一个字符串、一个符号或一个函数，返回给定组件的属性。 只有为相同类型注册的放置目标才会对此拖动源生成的项目做出反应</li><li>spec: 必需的。 一个简单的 JavaScript 对象，上面有一些允许的方法。 它描述了拖动源如何对拖放事件做出反应 <ul><li>beginDrag(props, monitor, component): 必需的。 当拖动开始时，beginDrag被调用。 您必须返回一个描述被拖动数据的普通 JavaScript 对象。 您返回的是有关拖放源的放置目标可用的唯一信息，因此选择他们需要知道的最少数据很重要</li></ul></li><li>collect: 必需的。 收集功能。 它应该返回一个普通的属性对象以注入到您的组件中。 它接收两个参数：connect 和 monitor</li></ul></li></ul><h4 id="_4-7-2-droptarget" tabindex="-1"><a class="header-anchor" href="#_4-7-2-droptarget"><span>4.7.2 DropTarget</span></a></h4><ul><li>参数 <ul><li>types: 必需的。 给定组件的 props，一个字符串、一个符号、一个数组或一个返回其中任何一个的函数。 这个放置目标只会对指定类型的拖拽源产生的项目做出反应</li><li>spec: 必需的。 一个简单的 JavaScript 对象，上面有一些允许的方法。 它描述了放置目标如何对拖放事件做出反应 <ul><li>hover(props, monitor, component): 可选的。 当项目悬停在组件上时调用</li></ul></li><li>collect: 必需的。 收集功能。 它应该返回一个普通的属性对象以注入到您的组件中。 它接收两个参数：connect 和 monitor</li></ul></li></ul><h3 id="_4-8-usedrag" tabindex="-1"><a class="header-anchor" href="#_4-8-usedrag"><span>4.8 useDrag</span></a></h3><ul><li>useDrag hook 提供了一种将组件作为拖动源连接到 DnD 系统的方法</li><li>通过将规范传入 useDrag，您可以声明性地描述正在生成的可拖动的类型、表示拖动源的项目对象、要收集的属性等</li><li>useDrag hooks 返回几个关键项：收集的属性，以及可能附加到拖动源的 <code>refs</code></li><li>参数 <ul><li>spec 规范对象或创建规范对象的函数 <ul><li>type: 必需的。 这必须是字符串或Symbol。 只有为相同类型注册的放置目标才会对此项目做出反应</li><li>item: 必需的 (对象或者函数) 当这是一个对象时，它是一个描述被拖动数据的普通 JavaScript 对象。 这是拖放目标唯一可用的有关拖动源的信息。当这是一个函数时，它在拖动操作开始时被触发，并返回一个表示拖动操作的对象</li><li>collect: 可选的。 收集功能。 它应该返回一个普通的属性对象，以返回以注入到您的组件属性中。 它接收两个参数，monitor 和 props</li></ul></li></ul></li><li>返回值数组 <ul><li>[0] - Collected Props: 包含从 collect 函数收集的属性的对象。 如果没有定义 collect 函数，则返回一个空对象</li><li>[1] - DragSource Ref: 拖动源的连接器功能。 这必须附加到 DOM 的可拖动部分</li></ul></li></ul><h3 id="_4-9-usedrop" tabindex="-1"><a class="header-anchor" href="#_4-9-usedrop"><span>4.9 useDrop</span></a></h3><ul><li><a href="https://react-dnd.github.io/react-dnd/docs/api/use-drop" target="_blank" rel="noopener noreferrer">useDrop hook</a> 为您提供了一种将组件连接到 DnD 系统作为放置目标的方法</li><li>通过将规范传入 useDrop hook，您可以指定放置目标将接受哪些类型的数据项，要收集哪些属性，等等</li><li>此函数返回一个要附加到 Drop Target 节点的ref和收集到的属性</li><li>参数 <ul><li>specA 规范对象或创建规范对象的函数 <ul><li>accept 必填项 一个字符串或一个Symbol,这个放置目标只会对指定类型的拖拽源产生的项目做出反应</li><li>collect: 可选的。收集功能。 它应该返回一个普通的属性对象，以返回以注入到您的组件属性中。 它接收两个参数，monitor 和 props</li><li>hover(item, monitor): 可选的。 当在组件发生hover事件时调用</li></ul></li></ul></li><li>返回值 <ul><li>Collected Props: 包含从 collect 函数收集的属性的对象。 如果没有定义collect function，则返回一个空对象</li><li>DropTarget Ref: 放置目标的连接器函数。 这必须附加到 DOM 的放置目标部分</li></ul></li></ul><h2 id="_5-拖拽排序实战" tabindex="-1"><a class="header-anchor" href="#_5-拖拽排序实战"><span>5. 拖拽排序实战</span></a></h2><h3 id="_5-1-安装" tabindex="-1"><a class="header-anchor" href="#_5-1-安装"><span>5.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install react-dnd react-dnd-html5-backend --save</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-绘制容器" tabindex="-1"><a class="header-anchor" href="#_5-2-绘制容器"><span>5.2 绘制容器</span></a></h3><h4 id="_5-2-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_5-2-1-src-index-js"><span>5.2.1 src\\index.js</span></a></h4><p>src\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Container <span class="token keyword">from</span> <span class="token string">&#39;./Container&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> DndProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-dnd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> HTML5Backend <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-dnd-html5-backend&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token operator">&lt;</span>DndProvider backend<span class="token operator">=</span><span class="token punctuation">{</span>HTML5Backend<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>Container <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>DndProvider<span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-2-container-js" tabindex="-1"><a class="header-anchor" href="#_5-2-2-container-js"><span>5.2.2 Container.js</span></a></h4><p>src\\Container.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&#39;300px&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            Container</span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> Container<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-绘制卡片" tabindex="-1"><a class="header-anchor" href="#_5-3-绘制卡片"><span>5.3 绘制卡片</span></a></h3><h4 id="_5-3-1-src-card-js" tabindex="-1"><a class="header-anchor" href="#_5-3-1-src-card-js"><span>5.3.1 src\\Card.js</span></a></h4><p>src\\Card.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token string">&#39;5px&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">&#39;5px&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">&#39;1px dashed gray&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">cursor</span><span class="token operator">:</span> <span class="token string">&#39;move&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Card</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> text <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">{</span>text<span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-src-container-js" tabindex="-1"><a class="header-anchor" href="#_5-3-2-src-container-js"><span>5.3.2 src\\Container.js</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import React, { useState } from &#39;react&#39;</span>
<span class="line">+import Card from &#39;./Card&#39;;</span>
<span class="line">const style = {</span>
<span class="line">    width: &#39;300px&#39;</span>
<span class="line">}</span>
<span class="line">function Container() {</span>
<span class="line">+   const [cards, setCards] = useState([</span>
<span class="line">+       { id: &#39;card1&#39;, text: &#39;卡片1&#39; },</span>
<span class="line">+       { id: &#39;card2&#39;, text: &#39;卡片2&#39; },</span>
<span class="line">+       { id: &#39;card3&#39;, text: &#39;卡片3&#39; }</span>
<span class="line">+   ]);</span>
<span class="line">    return (</span>
<span class="line">        &lt;div style={style}&gt;</span>
<span class="line">+           {</span>
<span class="line">+               cards.map((card, index) =&gt; (</span>
<span class="line">+                   &lt;Card key={card.id} text={card.text} /&gt;</span>
<span class="line">+               ))</span>
<span class="line">+           }</span>
<span class="line">        &lt;/div&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">export default Container;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-拖动卡片" tabindex="-1"><a class="header-anchor" href="#_5-4-拖动卡片"><span>5.4 拖动卡片</span></a></h3><h4 id="_5-4-1-itemtypes-js" tabindex="-1"><a class="header-anchor" href="#_5-4-1-itemtypes-js"><span>5.4.1 ItemTypes.js</span></a></h4><p>src\\ItemTypes.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CARD</span> <span class="token operator">=</span> <span class="token string">&#39;card&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * React DnD 使用数据而不是视图作为来源</span>
<span class="line"> * 当您在屏幕上拖动某物时，我们并不是说正在拖动组件或 DOM 节点。 相反，我们说某种类型的项目正在被拖动</span>
<span class="line"> * 什么是项目？ 一个项目是一个简单的 JavaScript 对象，描述被拖动的内容</span>
<span class="line"> * 那什么是type(类型)呢？ 类型是一个字符串(或Symbol)，它唯一地标识了应用程序中的项目。 在看板应用程序中，您可能有一个代表可拖动卡片的卡片类型</span>
<span class="line"> * 类型很有用，因为随着您的应用程序的增长，您可能希望使更多内容可拖动，但您不一定希望所有现有的放置目标突然开始对新项目做出反应</span>
<span class="line"> * 这些类型允许您指定兼容的拖放源和放置目标</span>
<span class="line"> */</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-2-container-js" tabindex="-1"><a class="header-anchor" href="#_5-4-2-container-js"><span>5.4.2 Container.js</span></a></h4><p>src\\Container.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React, { useState } from &#39;react&#39;</span>
<span class="line">import Card from &#39;./Card&#39;;</span>
<span class="line">const style = {</span>
<span class="line">    width: &#39;200px&#39;</span>
<span class="line">}</span>
<span class="line">function Container() {</span>
<span class="line">    const [cards, setCards] = useState([</span>
<span class="line">        { id: &#39;card1&#39;, text: &#39;卡片1&#39; },</span>
<span class="line">        { id: &#39;card2&#39;, text: &#39;卡片2&#39; },</span>
<span class="line">        { id: &#39;card3&#39;, text: &#39;卡片3&#39; }</span>
<span class="line">    ]);</span>
<span class="line">    return (</span>
<span class="line">        &lt;div style={style}&gt;</span>
<span class="line">            {</span>
<span class="line">                cards.map((card, index) =&gt; (</span>
<span class="line">+                   &lt;Card key={card.id} text={card.text} id={card.id} index={index} /&gt;</span>
<span class="line">                ))</span>
<span class="line">            }</span>
<span class="line">        &lt;/div&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export default Container;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-4-3-card-js" tabindex="-1"><a class="header-anchor" href="#_5-4-3-card-js"><span>5.4.3 Card.js</span></a></h4><p>src\\Card.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React, { useRef } from &#39;react&#39;</span>
<span class="line">+import { useDrag } from &#39;react-dnd&#39;;</span>
<span class="line">+import { CARD } from &#39;./ItemTypes&#39;;</span>
<span class="line">const style = {</span>
<span class="line">    backgroundColor: &#39;red&#39;,</span>
<span class="line">    padding: &#39;5px&#39;,</span>
<span class="line">    margin: &#39;5px&#39;,</span>
<span class="line">    border: &#39;1px dashed gray&#39;,</span>
<span class="line">    cursor: &#39;move&#39;</span>
<span class="line">}</span>
<span class="line">export default function Card({ text, id, index }) {</span>
<span class="line">+   const ref = useRef(null);</span>
<span class="line">+   //useDrag hook 提供了一种将组件作为拖动源连接到 DnD 系统的方法</span>
<span class="line">+   //Collected Props: 包含从 collect 函数收集的属性的对象。 如果没有定义 collect 函数，则返回一个空对象</span>
<span class="line">+   //DragSource Ref: 拖动源的连接器功能。 这必须附加到 DOM 的可拖动部分</span>
<span class="line">+   const [{ isDragging }, drag] = useDrag({//spec</span>
<span class="line">+       //必需的。 这必须是字符串或Symbol。 只有为相同类型注册的放置目标才会对此项目做出反应</span>
<span class="line">+       type: CARD,</span>
<span class="line">+       //item: 必需的 (对象或者函数) 当这是一个对象时，它是一个描述被拖动数据的普通 JavaScript 对象</span>
<span class="line">+       item: () =&gt; ({ id, index }),</span>
<span class="line">+       //collect:  收集功能。 它应该返回一个普通的属性对象，以返回以注入到您的组件属性中</span>
<span class="line">+       //它接收两个参数，monitor 和 props</span>
<span class="line">+       collect: (monitor) =&gt; ({//要收集的属性</span>
<span class="line">+           isDragging: monitor.isDragging()</span>
<span class="line">+       })</span>
<span class="line">+   });</span>
<span class="line">+   const opacity = isDragging ? 0.1 : 1;</span>
<span class="line">+   drag(ref)</span>
<span class="line">    return (</span>
<span class="line">+       &lt;div ref={ref} style={{ ...style, opacity }}&gt;</span>
<span class="line">            {text}</span>
<span class="line">        &lt;/div&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-放置卡片" tabindex="-1"><a class="header-anchor" href="#_5-5-放置卡片"><span>5.5 放置卡片</span></a></h3><h4 id="_5-5-1-container-js" tabindex="-1"><a class="header-anchor" href="#_5-5-1-container-js"><span>5.5.1 Container.js</span></a></h4><p>src\\Container.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React, { useState } from &#39;react&#39;</span>
<span class="line">import Card from &#39;./Card&#39;;</span>
<span class="line">const style = {</span>
<span class="line">    width: &#39;200px&#39;</span>
<span class="line">}</span>
<span class="line">function Container() {</span>
<span class="line">    const [cards, setCards] = useState([</span>
<span class="line">        { id: &#39;card1&#39;, text: &#39;卡片1&#39; },</span>
<span class="line">        { id: &#39;card2&#39;, text: &#39;卡片2&#39; },</span>
<span class="line">        { id: &#39;card3&#39;, text: &#39;卡片3&#39; }</span>
<span class="line">    ]);</span>
<span class="line">+   const moveCard = (dragIndex, hoverIndex) =&gt; {</span>
<span class="line">+       const dragCard = cards[dragIndex];</span>
<span class="line">+       const cloneCards = [...cards];</span>
<span class="line">+       cloneCards.splice(dragIndex, 1);</span>
<span class="line">+       cloneCards.splice(hoverIndex, 0, dragCard);</span>
<span class="line">+       setCards(cloneCards);</span>
<span class="line">+   }</span>
<span class="line">    return (</span>
<span class="line">        &lt;div style={style}&gt;</span>
<span class="line">            {</span>
<span class="line">                cards.map((card, index) =&gt; (</span>
<span class="line">+                   &lt;Card key={card.id} text={card.text} id={card.id} index={index} moveCard={moveCard} /&gt;</span>
<span class="line">                ))</span>
<span class="line">            }</span>
<span class="line">        &lt;/div&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">export default Container;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-2-src-card-js" tabindex="-1"><a class="header-anchor" href="#_5-5-2-src-card-js"><span>5.5.2 src\\Card.js</span></a></h4><p>src\\Card.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React, { useRef } from &#39;react&#39;</span>
<span class="line">+import { useDrag, useDrop } from &#39;react-dnd&#39;;</span>
<span class="line">import { CARD } from &#39;./ItemTypes&#39;;</span>
<span class="line">const style = {</span>
<span class="line">    backgroundColor: &#39;red&#39;,</span>
<span class="line">    padding: &#39;5px&#39;,</span>
<span class="line">    margin: &#39;5px&#39;,</span>
<span class="line">    border: &#39;1px dashed gray&#39;,</span>
<span class="line">    cursor: &#39;move&#39;</span>
<span class="line">}</span>
<span class="line">export default function Card({ text, id, index, moveCard }) {</span>
<span class="line">    const ref = useRef(null);</span>
<span class="line">+   //useDrop hook 为您提供了一种将组件连接到 DnD 系统作为放置目标的方法</span>
<span class="line">+   // Collected Props: 包含从 collect 函数收集的属性的对象</span>
<span class="line">+   //DropTarget Ref: 放置目标的连接器函数。 这必须附加到 DOM 的放置目标部分</span>
<span class="line">+   const [, drop] = useDrop({</span>
<span class="line">+       //一个字符串或一个Symbol,这个放置目标只会对指定类型的拖拽源产生的项目做出反应</span>
<span class="line">+       accept: CARD,</span>
<span class="line">+       //收集功能。 它应该返回一个普通的属性对象，以返回以注入到您的组件属性中</span>
<span class="line">+       collect: (monitor) =&gt; ({}),</span>
<span class="line">+       //当在组件发生hover事件时调用</span>
<span class="line">+       hover(item, monitor) {</span>
<span class="line">+           //被拖动卡片的索引</span>
<span class="line">+           const dragIndex = item.index;</span>
<span class="line">+           //hover卡片的索引</span>
<span class="line">+           const hoverIndex = index;</span>
<span class="line">+           //如果一样什么都不做</span>
<span class="line">+           if (dragIndex === hoverIndex) {</span>
<span class="line">+               return;</span>
<span class="line">+           }</span>
<span class="line">+           //获取hover卡片的位置信息</span>
<span class="line">+           const { top, bottom } = ref.current.getBoundingClientRect();</span>
<span class="line">+           //获取hover卡片高度的一半</span>
<span class="line">+           const halfOfHoverHeight = (bottom - top) / 2;</span>
<span class="line">+           //获取鼠标最新的X和Y坐标</span>
<span class="line">+           const { y } = monitor.getClientOffset();</span>
<span class="line">+           const hoverClientY = y - top;</span>
<span class="line">+           if ((dragIndex &lt; hoverIndex &amp;&amp; hoverClientY &gt; halfOfHoverHeight)</span>
<span class="line">+               || (dragIndex &gt; hoverIndex &amp;&amp; hoverClientY &lt; halfOfHoverHeight)) {</span>
<span class="line">+               moveCard(dragIndex, hoverIndex);</span>
<span class="line">+               item.index = hoverIndex;</span>
<span class="line">+           }</span>
<span class="line">+       }</span>
<span class="line">+   });</span>
<span class="line">    //useDrag hook 提供了一种将组件作为拖动源连接到 DnD 系统的方法</span>
<span class="line">    //Collected Props: 包含从 collect 函数收集的属性的对象。 如果没有定义 collect 函数，则返回一个空对象</span>
<span class="line">    //DragSource Ref: 拖动源的连接器功能。 这必须附加到 DOM 的可拖动部分</span>
<span class="line">    const [{ isDragging }, drag] = useDrag({//spec</span>
<span class="line">        //必需的。 这必须是字符串或Symbol。 只有为相同类型注册的放置目标才会对此项目做出反应</span>
<span class="line">        type: CARD,</span>
<span class="line">        //item: 必需的 (对象或者函数) 当这是一个对象时，它是一个描述被拖动数据的普通 JavaScript 对象</span>
<span class="line">        item: () =&gt; ({ id, index }),</span>
<span class="line">        //collect:  收集功能。 它应该返回一个普通的属性对象，以返回以注入到您的组件属性中</span>
<span class="line">        //它接收两个参数，monitor 和 props</span>
<span class="line">        collect: (monitor) =&gt; ({//要收集的属性</span>
<span class="line">            isDragging: monitor.isDragging()</span>
<span class="line">        })</span>
<span class="line">    });</span>
<span class="line">    const opacity = isDragging ? 0.1 : 1;</span>
<span class="line">    drag(ref)</span>
<span class="line">+   drop(ref)</span>
<span class="line">    return (</span>
<span class="line">        &lt;div ref={ref} style={{ ...style, opacity }}&gt;</span>
<span class="line">            {text}</span>
<span class="line">        &lt;/div&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-实现provider" tabindex="-1"><a class="header-anchor" href="#_5-实现provider"><span>5.实现Provider</span></a></h2><h3 id="_5-1-react-dnd-index-js" tabindex="-1"><a class="header-anchor" href="#_5-1-react-dnd-index-js"><span>5.1 react-dnd\\index.js</span></a></h3><p>src\\react-dnd\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./core&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-core-index-js" tabindex="-1"><a class="header-anchor" href="#_5-2-core-index-js"><span>5.2 core\\index.js</span></a></h3><p>src\\react-dnd\\core\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> DndContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./DndContext&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> DndProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./DndProvider&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-dndcontext-js" tabindex="-1"><a class="header-anchor" href="#_5-3-dndcontext-js"><span>5.3 DndContext.js</span></a></h3><p>src\\react-dnd\\core\\DndContext.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> DndContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DndContext<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-dndprovider-js" tabindex="-1"><a class="header-anchor" href="#_5-4-dndprovider-js"><span>5.4 DndProvider.js</span></a></h3><p>src\\react-dnd\\core\\DndProvider.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> DndContext <span class="token keyword">from</span> <span class="token string">&#39;./DndContext&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createDragDropManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../dnd-core&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">DndProvider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> backend<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">dragDropManager</span><span class="token operator">:</span> <span class="token function">createDragDropManager</span><span class="token punctuation">(</span>backend<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>DndContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">{</span>children<span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>DndContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DndProvider<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-dnd-core-index-js" tabindex="-1"><a class="header-anchor" href="#_5-5-dnd-core-index-js"><span>5.5 dnd-core\\index.js</span></a></h3><p>src\\dnd-core\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> createDragDropManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./createDragDropManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-6-createdragdropmanager-js" tabindex="-1"><a class="header-anchor" href="#_5-6-createdragdropmanager-js"><span>5.6 createDragDropManager.js</span></a></h3><p>src\\dnd-core\\createDragDropManager.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">&#39;./reducers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> DragDropManagerImpl <span class="token keyword">from</span> <span class="token string">&#39;./classes/DragDropManagerImpl&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">createDragDropManager</span><span class="token punctuation">(</span><span class="token parameter">backendFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//创建redux仓库</span></span>
<span class="line">    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DragDropManagerImpl</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> backend <span class="token operator">=</span> <span class="token function">backendFactory</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    manager<span class="token punctuation">.</span><span class="token function">receiveBackend</span><span class="token punctuation">(</span>backend<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> manager<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> createDragDropManager<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-7-dragdropmanagerimpl-js" tabindex="-1"><a class="header-anchor" href="#_5-7-dragdropmanagerimpl-js"><span>5.7 DragDropManagerImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropManagerImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">DragDropManagerImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    store<span class="token punctuation">;</span></span>
<span class="line">    backend<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> store<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">receiveBackend</span><span class="token punctuation">(</span><span class="token parameter">backend</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>backend <span class="token operator">=</span> backend<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">getBackend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>backend<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DragDropManagerImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-8-reducers-index-js" tabindex="-1"><a class="header-anchor" href="#_5-8-reducers-index-js"><span>5.8 reducers\\index.js</span></a></h3><p>src\\dnd-core\\reducers\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> reducer<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-9-react-dnd-html5-backend-index-js" tabindex="-1"><a class="header-anchor" href="#_5-9-react-dnd-html5-backend-index-js"><span>5.9 react-dnd-html5-backend\\index.js</span></a></h3><p>src\\react-dnd-html5-backend\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> HTML5BackendImpl <span class="token keyword">from</span> <span class="token string">&#39;./HTML5BackendImpl&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">HTML5Backend</span><span class="token punctuation">(</span><span class="token parameter">manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HTML5BackendImpl</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-10-html5backendimpl-js" tabindex="-1"><a class="header-anchor" href="#_5-10-html5backendimpl-js"><span>5.10 HTML5BackendImpl.js</span></a></h3><p>src\\react-dnd-html5-backend\\HTML5BackendImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">HTML5BackendImpl</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> HTML5BackendImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-实现monitor" tabindex="-1"><a class="header-anchor" href="#_6-实现monitor"><span>6.实现Monitor</span></a></h2><ul><li>拖放本质上是有状态的。 要么正在进行拖动操作，要么不在。 要么有当前类型和当前项目，要么没有。 这种状态必须存在于某个地方</li><li>React DnD 通过监视器封装内部存储状态,并将此状态公开给您的组件</li><li>监视器允许您更新组件的属性以响应拖放状态的变化</li><li>对于需要跟踪拖放状态的每个组件，您可以定义一个收集函数，从监视器获取它的相关属性</li><li>React DnD 然后负责及时调用您的收集函数并将其返回值合并到组件的属性对象中</li></ul><h3 id="_6-1-react-dnd-index-js" tabindex="-1"><a class="header-anchor" href="#_6-1-react-dnd-index-js"><span>6.1 react-dnd\\index.js</span></a></h3><p>src\\react-dnd\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./core&#39;</span>
<span class="line">+export * from &#39;./hooks&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-hooks-index-js" tabindex="-1"><a class="header-anchor" href="#_6-2-hooks-index-js"><span>6.2 hooks\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as useDrag } from &#39;./useDrag&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-3-usedrag-index-js" tabindex="-1"><a class="header-anchor" href="#_6-3-usedrag-index-js"><span>6.3 useDrag\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> useDragSourceMonitor <span class="token keyword">from</span> <span class="token string">&#39;./useDragSourceMonitor&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDrag</span><span class="token punctuation">(</span><span class="token parameter">spec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> monitor <span class="token operator">=</span> <span class="token function">useDragSourceMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDrag<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-4-usedragsourcemonitor-js" tabindex="-1"><a class="header-anchor" href="#_6-4-usedragsourcemonitor-js"><span>6.4 useDragSourceMonitor.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\useDragSourceMonitor.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDragDropManager <span class="token keyword">from</span> <span class="token string">&#39;../useDragDropManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> DragSourceMonitorImpl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../internals&#39;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDragSourceMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token function">useDragDropManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">DragSourceMonitorImpl</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>manager<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDragSourceMonitor<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-5-usedragdropmanager-js" tabindex="-1"><a class="header-anchor" href="#_6-5-usedragdropmanager-js"><span>6.5 useDragDropManager.js</span></a></h3><p>src\\react-dnd\\hooks\\useDragDropManager.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> DndContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../core&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDragDropManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> dragDropManager <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>DndContext<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> dragDropManager<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDragDropManager<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-6-internals-index-js" tabindex="-1"><a class="header-anchor" href="#_6-6-internals-index-js"><span>6.6 internals\\index.js</span></a></h3><p>src\\react-dnd\\internals\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> DragSourceMonitorImpl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./DragSourceMonitorImpl&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-7-dragsourcemonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_6-7-dragsourcemonitorimpl-js"><span>6.7 DragSourceMonitorImpl.js</span></a></h3><p>src\\react-dnd\\internals\\DragSourceMonitorImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">DragSourceMonitorImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    internalMonitor</span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>internalMonitor <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getGlobalMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DragSourceMonitorImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-8-dnd-core-index-js" tabindex="-1"><a class="header-anchor" href="#_6-8-dnd-core-index-js"><span>6.8 dnd-core\\index.js</span></a></h3><p>src\\dnd-core\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as createDragDropManager } from &#39;./createDragDropManager&#39;;</span>
<span class="line">export { default as DragDropManagerImpl } from &#39;./classes/DragDropManagerImpl&#39;;</span>
<span class="line">+export { default as DragDropMonitorImpl } from &#39;./classes/DragDropMonitorImpl&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-9-createdragdropmanager-js" tabindex="-1"><a class="header-anchor" href="#_6-9-createdragdropmanager-js"><span>6.9 createDragDropManager.js</span></a></h3><p>src\\dnd-core\\createDragDropManager.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createStore } from &#39;redux&#39;;</span>
<span class="line">import reducer from &#39;./reducers&#39;;</span>
<span class="line">import DragDropManagerImpl from &#39;./classes/DragDropManagerImpl&#39;;</span>
<span class="line">+import DragDropMonitorImpl from &#39;./classes/DragDropMonitorImpl&#39;;</span>
<span class="line">function createDragDropManager(backendFactory) {</span>
<span class="line">    //创建redux仓库</span>
<span class="line">    const store = createStore(reducer);</span>
<span class="line">+   const globalMonitor = new DragDropMonitorImpl(store);</span>
<span class="line">+   const manager = new DragDropManagerImpl(store, globalMonitor);</span>
<span class="line">    const backend = backendFactory(manager);</span>
<span class="line">    manager.receiveBackend(backend);</span>
<span class="line">    return manager;</span>
<span class="line">}</span>
<span class="line">export default createDragDropManager;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-10-dragdropmonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_6-10-dragdropmonitorimpl-js"><span>6.10 DragDropMonitorImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropMonitorImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">DragDropMonitorImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    store</span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> store</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DragDropMonitorImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-11-dragdropmanagerimpl-js" tabindex="-1"><a class="header-anchor" href="#_6-11-dragdropmanagerimpl-js"><span>6.11 DragDropManagerImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropManagerImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class DragDropManagerImpl {</span>
<span class="line">    store;</span>
<span class="line">    backend;</span>
<span class="line">+   globalMonitor;</span>
<span class="line">+   constructor(store, globalMonitor) {</span>
<span class="line">        this.store = store;</span>
<span class="line">+       this.globalMonitor = globalMonitor;</span>
<span class="line">    }</span>
<span class="line">    receiveBackend(backend) {</span>
<span class="line">        this.backend = backend;</span>
<span class="line">    }</span>
<span class="line">    getBackend() {</span>
<span class="line">        return this.backend;</span>
<span class="line">    }</span>
<span class="line">+   getGlobalMonitor() {</span>
<span class="line">+        return this.globalMonitor;</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default DragDropManagerImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-实现registry" tabindex="-1"><a class="header-anchor" href="#_7-实现registry"><span>7.实现Registry</span></a></h2><ul><li>每一个拖动源和放置目标都会有一个唯一标识handlerId,生成规则为S或T加一个递增数字</li><li>Registry注册表里会存放handlerId和拖动源和放置目标的对应关系</li></ul><h3 id="_7-1-handlerregistryimpl-js" tabindex="-1"><a class="header-anchor" href="#_7-1-handlerregistryimpl-js"><span>7.1 HandlerRegistryImpl.js</span></a></h3><p>src\\dnd-core\\classes\\HandlerRegistryImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">HandlerRegistryImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    store<span class="token punctuation">;</span><span class="token comment">//redux仓库</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> store<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> HandlerRegistryImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-createdragdropmanager-js" tabindex="-1"><a class="header-anchor" href="#_7-2-createdragdropmanager-js"><span>7.2 createDragDropManager.js</span></a></h3><p>src\\dnd-core\\createDragDropManager.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createStore } from &#39;redux&#39;;</span>
<span class="line">import reducer from &#39;./reducers&#39;;</span>
<span class="line">+import HandlerRegistryImpl from &#39;./classes/HandlerRegistryImpl&#39;</span>
<span class="line">import DragDropManagerImpl from &#39;./classes/DragDropManagerImpl&#39;;</span>
<span class="line">import DragDropMonitorImpl from &#39;./classes/DragDropMonitorImpl&#39;;</span>
<span class="line">function createDragDropManager(backendFactory) {</span>
<span class="line">    //创建redux仓库</span>
<span class="line">    const store = createStore(reducer);</span>
<span class="line">+   const registry = new HandlerRegistryImpl(store);</span>
<span class="line">+   const globalMonitor = new DragDropMonitorImpl(store, registry);</span>
<span class="line">    const manager = new DragDropManagerImpl(store, globalMonitor);</span>
<span class="line">    const backend = backendFactory(manager);</span>
<span class="line">    manager.receiveBackend(backend);</span>
<span class="line">    return manager;</span>
<span class="line">}</span>
<span class="line">export default createDragDropManager;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-dragdropmonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_7-3-dragdropmonitorimpl-js"><span>7.3 DragDropMonitorImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropMonitorImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class DragDropMonitorImpl {</span>
<span class="line">    store</span>
<span class="line">+   registry</span>
<span class="line">    constructor(store, registry) {</span>
<span class="line">        this.store = store</span>
<span class="line">+       this.registry = registry;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default DragDropMonitorImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-usedragsourceconnector" tabindex="-1"><a class="header-anchor" href="#_8-usedragsourceconnector"><span>8.useDragSourceConnector</span></a></h2><ul><li>如果后端处理 DOM 事件，但是组件使用 React 来描述 DOM，后端如何知道要监听哪些 DOM 节点？</li><li>连接器允许您将预定义角色之一（拖动源或放置目标）分配给渲染函数中的 DOM 节点</li></ul><h3 id="_8-1-usedrag-index-js" tabindex="-1"><a class="header-anchor" href="#_8-1-usedrag-index-js"><span>8.1 useDrag\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import useDragSourceMonitor from &#39;./useDragSourceMonitor&#39;;</span>
<span class="line">+import useDragSourceConnector from &#39;./useDragSourceConnector&#39;;</span>
<span class="line">function useDrag(spec) {</span>
<span class="line">    const monitor = useDragSourceMonitor();</span>
<span class="line">+   const connector = useDragSourceConnector();</span>
<span class="line">+   console.log(connector);</span>
<span class="line">    return [{}, () =&gt; { }];</span>
<span class="line">}</span>
<span class="line">export default useDrag;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-usedragsourceconnector-js" tabindex="-1"><a class="header-anchor" href="#_8-2-usedragsourceconnector-js"><span>8.2 useDragSourceConnector.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\useDragSourceConnector.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDragDropManager <span class="token keyword">from</span> <span class="token string">&#39;../useDragDropManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> SourceConnector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../internals&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDragSourceConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token function">useDragDropManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> connector <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SourceConnector</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span><span class="token function">getBackend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>manager<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> connector<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDragSourceConnector<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-internals-index-js" tabindex="-1"><a class="header-anchor" href="#_8-3-internals-index-js"><span>8.3 internals\\index.js</span></a></h3><p>src\\react-dnd\\internals\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as DragSourceMonitorImpl } from &#39;./DragSourceMonitorImpl&#39;;</span>
<span class="line">+export { default as SourceConnector } from &#39;./SourceConnector&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-4-sourceconnector-js" tabindex="-1"><a class="header-anchor" href="#_8-4-sourceconnector-js"><span>8.4 SourceConnector.js</span></a></h3><p>src\\react-dnd\\internals\\SourceConnector.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">SourceConnector</span> <span class="token punctuation">{</span></span>
<span class="line">    backend</span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">backend</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>backend <span class="token operator">=</span> backend<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;连接React和DOM&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> SourceConnector<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-创建dragsource和dragtype" tabindex="-1"><a class="header-anchor" href="#_9-创建dragsource和dragtype"><span>9.创建DragSource和DragType</span></a></h2><ul><li>拖动源和放置目标可以将类型、项目、副作用和收集功能与您的组件联系在一起</li></ul><h3 id="_9-1-src-react-dnd-hooks-usedrag-index-js" tabindex="-1"><a class="header-anchor" href="#_9-1-src-react-dnd-hooks-usedrag-index-js"><span>9.1 src\\react-dnd\\hooks\\useDrag\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import useDragSourceMonitor from &#39;./useDragSourceMonitor&#39;;</span>
<span class="line">import useDragSourceConnector from &#39;./useDragSourceConnector&#39;;</span>
<span class="line">+import useRegisteredDragSource from &#39;./useRegisteredDragSource&#39;;</span>
<span class="line">function useDrag(spec) {</span>
<span class="line">//  const monitor = useDragSourceMonitor();</span>
<span class="line">    const connector = useDragSourceConnector();</span>
<span class="line">+   useRegisteredDragSource(spec, monitor, connector);</span>
<span class="line">    return [{}, () =&gt; { }];</span>
<span class="line">}</span>
<span class="line">export default useDrag;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-useregistereddragsource-js" tabindex="-1"><a class="header-anchor" href="#_9-2-useregistereddragsource-js"><span>9.2 useRegisteredDragSource.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\useRegisteredDragSource.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> useDragDropManager <span class="token keyword">from</span> <span class="token string">&#39;../useDragDropManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDragSource <span class="token keyword">from</span> <span class="token string">&#39;./useDragSource&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useDragType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./useDragType&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useRegisteredDragSource</span><span class="token punctuation">(</span><span class="token parameter">spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token function">useDragDropManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">useDragSource</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;handler&#39;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> itemType <span class="token operator">=</span> <span class="token function">useDragType</span><span class="token punctuation">(</span>spec<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>itemType<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useRegisteredDragSource<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-usedragsource-js" tabindex="-1"><a class="header-anchor" href="#_9-3-usedragsource-js"><span>9.3 useDragSource.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\useDragSource.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">/* eslint-disable react-hooks/exhaustive-deps */</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> DragSourceImpl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./DragSourceImpl&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDragSource</span><span class="token punctuation">(</span><span class="token parameter">spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DragSourceImpl</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>monitor<span class="token punctuation">,</span> connector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        handler<span class="token punctuation">.</span>spec <span class="token operator">=</span> spec<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handler<span class="token punctuation">,</span> spec<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> handler<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDragSource<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-4-dragsourceimpl-js" tabindex="-1"><a class="header-anchor" href="#_9-4-dragsourceimpl-js"><span>9.4 DragSourceImpl.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\DragSourceImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DragSourceImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    spec<span class="token punctuation">;</span></span>
<span class="line">    monitor<span class="token punctuation">;</span></span>
<span class="line">    connector<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>spec <span class="token operator">=</span> spec<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>monitor <span class="token operator">=</span> monitor<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>connector <span class="token operator">=</span> connector<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-5-usedragtype-js" tabindex="-1"><a class="header-anchor" href="#_9-5-usedragtype-js"><span>9.5 useDragType.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\useDragType.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useDragType</span><span class="token punctuation">(</span><span class="token parameter">spec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> spec<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token punctuation">[</span>spec<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-registersource" tabindex="-1"><a class="header-anchor" href="#_10-registersource"><span>10.registerSource</span></a></h2><ul><li>注册拖动源</li></ul><p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/addSource_1635002106824.png" alt=""></p><h3 id="_10-1-useregistereddragsource-js" tabindex="-1"><a class="header-anchor" href="#_10-1-useregistereddragsource-js"><span>10.1 useRegisteredDragSource.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\useRegisteredDragSource.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { useLayoutEffect } from &#39;react&#39;;</span>
<span class="line">import useDragDropManager from &#39;../useDragDropManager&#39;;</span>
<span class="line">import useDragSource from &#39;./useDragSource&#39;;</span>
<span class="line">import { useDragType } from &#39;./useDragType&#39;;</span>
<span class="line">+import { registerSource } from &#39;../../internals&#39;;</span>
<span class="line">function useRegisteredDragSource(spec, monitor, connector) {</span>
<span class="line">    const manager = useDragDropManager();</span>
<span class="line">    const handler = useDragSource(spec, monitor, connector);</span>
<span class="line">    const itemType = useDragType(spec);</span>
<span class="line">+   useLayoutEffect(function () {</span>
<span class="line">+       const handlerId = registerSource(itemType, handler, manager);</span>
<span class="line">+       monitor.receiveHandlerId(handlerId);</span>
<span class="line">+       connector.receiveHandlerId(handlerId);</span>
<span class="line">+       console.log(&#39;dragSources&#39;, manager.globalMonitor.registry.dragSources);</span>
<span class="line">+       console.log(&#39;types&#39;, manager.globalMonitor.registry.types);</span>
<span class="line">+   }, [connector, handler, itemType, manager, monitor]);</span>
<span class="line">}</span>
<span class="line">export default useRegisteredDragSource;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-2-dragsourcemonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_10-2-dragsourcemonitorimpl-js"><span>10.2 DragSourceMonitorImpl.js</span></a></h3><p>src\\react-dnd\\internals\\DragSourceMonitorImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class DragSourceMonitorImpl {</span>
<span class="line">    internalMonitor</span>
<span class="line">+   handlerId</span>
<span class="line">    constructor(manager) {</span>
<span class="line">        this.internalMonitor = manager.getGlobalMonitor();</span>
<span class="line">    }</span>
<span class="line">+   receiveHandlerId(handlerId) {</span>
<span class="line">+       this.handlerId = handlerId;</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default DragSourceMonitorImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-3-sourceconnector-js" tabindex="-1"><a class="header-anchor" href="#_10-3-sourceconnector-js"><span>10.3 SourceConnector.js</span></a></h3><p>src\\react-dnd\\internals\\SourceConnector.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class SourceConnector {</span>
<span class="line">    backend</span>
<span class="line">+   handlerId</span>
<span class="line">    constructor(backend) {</span>
<span class="line">        this.backend = backend;</span>
<span class="line">    }</span>
<span class="line">    connect() {</span>
<span class="line">        console.log(&#39;连接React和DOM&#39;);</span>
<span class="line">    }</span>
<span class="line">+   receiveHandlerId(handlerId) {</span>
<span class="line">+       this.handlerId = handlerId;</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export default SourceConnector;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-registersource-js" tabindex="-1"><a class="header-anchor" href="#_10-4-registersource-js"><span>10.4 registerSource.js</span></a></h3><p>src\\react-dnd\\internals\\registerSource.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">registerSource</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> registry <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> handlerId <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> handlerId<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> registerSource<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-5-internals-index-js" tabindex="-1"><a class="header-anchor" href="#_10-5-internals-index-js"><span>10.5 internals\\index.js</span></a></h3><p>src\\react-dnd\\internals\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as DragSourceMonitorImpl } from &#39;./DragSourceMonitorImpl&#39;;</span>
<span class="line">export { default as SourceConnector } from &#39;./SourceConnector&#39;;</span>
<span class="line">+export { default as registerSource } from &#39;./registerSource&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-6-dragdropmanagerimpl-js" tabindex="-1"><a class="header-anchor" href="#_10-6-dragdropmanagerimpl-js"><span>10.6 DragDropManagerImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropManagerImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class DragDropManagerImpl {</span>
<span class="line">    store;</span>
<span class="line">    backend;</span>
<span class="line">    globalMonitor;</span>
<span class="line">    constructor(store, globalMonitor) {</span>
<span class="line">        this.store = store;</span>
<span class="line">        this.globalMonitor = globalMonitor;</span>
<span class="line">    }</span>
<span class="line">    receiveBackend(backend) {</span>
<span class="line">        this.backend = backend;</span>
<span class="line">    }</span>
<span class="line">    getBackend() {</span>
<span class="line">        return this.backend;</span>
<span class="line">    }</span>
<span class="line">    getGlobalMonitor() {</span>
<span class="line">        return this.globalMonitor;</span>
<span class="line">    }</span>
<span class="line">+   getRegistry() {</span>
<span class="line">+       return this.globalMonitor.registry;</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default DragDropManagerImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-7-handlerregistryimpl-js" tabindex="-1"><a class="header-anchor" href="#_10-7-handlerregistryimpl-js"><span>10.7 HandlerRegistryImpl.js</span></a></h3><p>src\\dnd-core\\classes\\HandlerRegistryImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { HandlerRole } from &#39;../interfaces&#39;;</span>
<span class="line">+import { getNextUniqueId } from &#39;../utils&#39;;</span>
<span class="line">+import { addSource } from &#39;../actions/registry&#39;;</span>
<span class="line">class HandlerRegistryImpl {</span>
<span class="line">    store;//redux仓库</span>
<span class="line">+   types = new Map(); //不同handlerId的类型</span>
<span class="line">+   dragSources = new Map();//拖放来源</span>
<span class="line">    constructor(store) {</span>
<span class="line">        this.store = store;</span>
<span class="line">    }</span>
<span class="line">+   addSource(type, source) {</span>
<span class="line">+       const handlerId = this.addHandler(HandlerRole.SOURCE, type, source);</span>
<span class="line">+       this.store.dispatch(addSource(handlerId));</span>
<span class="line">+       return handlerId;</span>
<span class="line">+   }</span>
<span class="line">+   addHandler(role, type, handler) {</span>
<span class="line">+       const handlerId = getNextHandlerId(role);//获取下一个handleId</span>
<span class="line">+       this.types.set(handlerId, type);</span>
<span class="line">+       if (role === HandlerRole.SOURCE) {</span>
<span class="line">+           this.dragSources.set(handlerId, handler);</span>
<span class="line">+       }</span>
<span class="line">+       return handlerId;</span>
<span class="line">+   }</span>
<span class="line">+   getSource(handlerId) {</span>
<span class="line">+       return this.dragSources.get(handlerId);</span>
<span class="line">+   }</span>
<span class="line">+   getSourceType(handlerId) {</span>
<span class="line">+       return this.types.get(handlerId);</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">+function getNextHandlerId(role) {</span>
<span class="line">+    const id = getNextUniqueId().toString();</span>
<span class="line">+    switch (role) {</span>
<span class="line">+        case HandlerRole.SOURCE:</span>
<span class="line">+            return \`S\${id}\`;</span>
<span class="line">+        case HandlerRole.TARGET:</span>
<span class="line">+            return \`T\${id}\`;</span>
<span class="line">+        default:</span>
<span class="line">+            throw new Error(\`Unknown Handler Role: \${role}\`);</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line">export default HandlerRegistryImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-8-interfaces-js" tabindex="-1"><a class="header-anchor" href="#_10-8-interfaces-js"><span>10.8 interfaces.js</span></a></h3><p>src\\dnd-core\\interfaces.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">var</span> HandlerRole <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;SOURCE&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SOURCE&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;TARGET&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TARGET&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-9-getnextuniqueid-js" tabindex="-1"><a class="header-anchor" href="#_10-9-getnextuniqueid-js"><span>10.9 getNextUniqueId.js</span></a></h3><p>src\\dnd-core\\utils\\getNextUniqueId.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> nextUniqueId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getNextUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> nextUniqueId<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> getNextUniqueId<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-10-utils-index-js" tabindex="-1"><a class="header-anchor" href="#_10-10-utils-index-js"><span>10.10 utils\\index.js</span></a></h3><p>src\\dnd-core\\utils\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> getNextUniqueId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./getNextUniqueId&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_10-11-registry-js" tabindex="-1"><a class="header-anchor" href="#_10-11-registry-js"><span>10.11 registry.js</span></a></h3><p>src\\dnd-core\\actions\\registry.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD_SOURCE</span> <span class="token operator">=</span> <span class="token string">&#39;dnd-core/ADD_SOURCE&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addSource</span><span class="token punctuation">(</span><span class="token parameter">handlerId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ADD_SOURCE</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> handlerId <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-connectdragsource" tabindex="-1"><a class="header-anchor" href="#_11-connectdragsource"><span>11.connectDragSource</span></a></h2><ul><li>绑定拖动事件</li></ul><h3 id="_11-1-usedrag-index-js" tabindex="-1"><a class="header-anchor" href="#_11-1-usedrag-index-js"><span>11.1 useDrag\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import useDragSourceMonitor from &#39;./useDragSourceMonitor&#39;;</span>
<span class="line">import useDragSourceConnector from &#39;./useDragSourceConnector&#39;;</span>
<span class="line">import useRegisteredDragSource from &#39;./useRegisteredDragSource&#39;;</span>
<span class="line">+import useConnectDragSource from &#39;./useConnectDragSource&#39;;</span>
<span class="line">function useDrag(spec) {</span>
<span class="line">    const monitor = useDragSourceMonitor();</span>
<span class="line">    const connector = useDragSourceConnector();</span>
<span class="line">    useRegisteredDragSource(spec, monitor, connector);</span>
<span class="line">    return [</span>
<span class="line">        {},</span>
<span class="line">+       useConnectDragSource(connector)</span>
<span class="line">    ];</span>
<span class="line">}</span>
<span class="line">export default useDrag;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-useconnectdragsource-js" tabindex="-1"><a class="header-anchor" href="#_11-2-useconnectdragsource-js"><span>11.2 useConnectDragSource.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\useConnectDragSource.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useConnectDragSource</span><span class="token punctuation">(</span><span class="token parameter">connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> connector<span class="token punctuation">.</span>receiveDragSource<span class="token punctuation">,</span> <span class="token punctuation">[</span>connector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useConnectDragSource</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-3-sourceconnector-js" tabindex="-1"><a class="header-anchor" href="#_11-3-sourceconnector-js"><span>11.3 SourceConnector.js</span></a></h3><p>src\\react-dnd\\internals\\SourceConnector.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class SourceConnector {</span>
<span class="line">    backend</span>
<span class="line">    handlerId  //拖动源唯一标识</span>
<span class="line">+   dragSourceRef //DOM节点</span>
<span class="line">    constructor(backend) {</span>
<span class="line">        this.backend = backend;</span>
<span class="line">    }</span>
<span class="line">+   get dragSource() {</span>
<span class="line">+       return this.dragSourceRef &amp;&amp; this.dragSourceRef.current;</span>
<span class="line">+   }</span>
<span class="line">+   connect() {</span>
<span class="line">+       if (!this.handlerId || !this.dragSource) {</span>
<span class="line">+           return;</span>
<span class="line">+       }</span>
<span class="line">+       this.backend.connectDragSource(this.handlerId, this.dragSource);</span>
<span class="line">+   }</span>
<span class="line"></span>
<span class="line">    //useRegisteredDragSource中useLayoutEffect赋值</span>
<span class="line">    receiveHandlerId(handlerId) {</span>
<span class="line">        this.handlerId = handlerId;</span>
<span class="line">+       this.connect();</span>
<span class="line">    }</span>
<span class="line">+   receiveDragSource = (dragSourceRef) =&gt; {</span>
<span class="line">+       this.dragSourceRef = dragSourceRef;</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export default SourceConnector;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-4-html5backendimpl-js" tabindex="-1"><a class="header-anchor" href="#_11-4-html5backendimpl-js"><span>11.4 HTML5BackendImpl.js</span></a></h3><p>src\\react-dnd-html5-backend\\HTML5BackendImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class HTML5BackendImpl {</span>
<span class="line">+   dragStartSourceId</span>
<span class="line">+   connectDragSource(handleId, node) {</span>
<span class="line">+       node.setAttribute(&#39;draggable&#39;, &#39;true&#39;);</span>
<span class="line">+       node.addEventListener(&#39;dragstart&#39;, (e) =&gt; this.handleDragStart(e, handleId));</span>
<span class="line">+   }</span>
<span class="line">+   handleDragStart(e, handleId) {</span>
<span class="line">+       this.dragStartSourceId = handleId;</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default HTML5BackendImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-收集属性" tabindex="-1"><a class="header-anchor" href="#_12-收集属性"><span>12.收集属性</span></a></h2><h3 id="_12-1-usedrag-index-js" tabindex="-1"><a class="header-anchor" href="#_12-1-usedrag-index-js"><span>12.1 useDrag\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import useDragSourceMonitor from &#39;./useDragSourceMonitor&#39;;</span>
<span class="line">import useDragSourceConnector from &#39;./useDragSourceConnector&#39;;</span>
<span class="line">import useRegisteredDragSource from &#39;./useRegisteredDragSource&#39;;</span>
<span class="line">import useConnectDragSource from &#39;./useConnectDragSource&#39;;</span>
<span class="line">+import { useCollectedProps } from &#39;../useCollectedProps&#39;;</span>
<span class="line">function useDrag(spec) {</span>
<span class="line">    const monitor = useDragSourceMonitor();</span>
<span class="line">    const connector = useDragSourceConnector();</span>
<span class="line">    useRegisteredDragSource(spec, monitor, connector);</span>
<span class="line">    return [</span>
<span class="line">+       useCollectedProps(monitor, spec.collect),</span>
<span class="line">        useConnectDragSource(connector)</span>
<span class="line">    ];</span>
<span class="line">}</span>
<span class="line">export default useDrag;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-2-usecollectedprops-js" tabindex="-1"><a class="header-anchor" href="#_12-2-usecollectedprops-js"><span>12.2 useCollectedProps.js</span></a></h3><p>src\\react-dnd\\hooks\\useCollectedProps.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useLayoutEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> equal <span class="token keyword">from</span> <span class="token string">&#39;fast-deep-equal&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useCollectedProps</span><span class="token punctuation">(</span><span class="token parameter">monitor<span class="token punctuation">,</span> collect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">[</span>collected<span class="token punctuation">,</span> setCollected<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">collect</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> updateCollected <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> nextValue <span class="token operator">=</span> <span class="token function">collect</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">equal</span><span class="token punctuation">(</span>collected<span class="token punctuation">,</span> nextValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">setCollected</span><span class="token punctuation">(</span>nextValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>collect<span class="token punctuation">,</span> collected<span class="token punctuation">,</span> monitor<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> monitor<span class="token punctuation">.</span><span class="token function">subscribeToStateChange</span><span class="token punctuation">(</span>updateCollected<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>monitor<span class="token punctuation">,</span> updateCollected<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> collected<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-3-dragsourcemonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_12-3-dragsourcemonitorimpl-js"><span>12.3 DragSourceMonitorImpl.js</span></a></h3><p>src\\react-dnd\\internals\\DragSourceMonitorImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class DragSourceMonitorImpl {</span>
<span class="line">    internalMonitor</span>
<span class="line">    handlerId</span>
<span class="line">    constructor(manager) {</span>
<span class="line">        this.internalMonitor = manager.getGlobalMonitor();</span>
<span class="line">    }</span>
<span class="line">    receiveHandlerId(handlerId) {</span>
<span class="line">        this.handlerId = handlerId;</span>
<span class="line">    }</span>
<span class="line">+   subscribeToStateChange(listener) {</span>
<span class="line">+       return this.internalMonitor.subscribeToStateChange(listener);</span>
<span class="line">+   }</span>
<span class="line">+   isDragging() {</span>
<span class="line">+       return this.internalMonitor.isDraggingSource(this.handlerId);</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default DragSourceMonitorImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-4-dragdropmonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_12-4-dragdropmonitorimpl-js"><span>12.4 DragDropMonitorImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropMonitorImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class DragDropMonitorImpl {</span>
<span class="line">    store</span>
<span class="line">    registry</span>
<span class="line">    constructor(store, registry) {</span>
<span class="line">        this.store = store</span>
<span class="line">        this.registry = registry;</span>
<span class="line">    }</span>
<span class="line">+   subscribeToStateChange(listener) {</span>
<span class="line">+       return this.store.subscribe(listener);</span>
<span class="line">+   }</span>
<span class="line">+   getSourceId() {</span>
<span class="line">+       return &#39;S0&#39;;</span>
<span class="line">+   }</span>
<span class="line">+   isDraggingSource(handlerId) {</span>
<span class="line">+       return handlerId === this.getSourceId();</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default DragDropMonitorImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_13-绑定拖动事件" tabindex="-1"><a class="header-anchor" href="#_13-绑定拖动事件"><span>13.绑定拖动事件</span></a></h2><h3 id="_13-1-dragoperation-js" tabindex="-1"><a class="header-anchor" href="#_13-1-dragoperation-js"><span>13.1 dragOperation.js</span></a></h3><p>src\\dnd-core\\reducers\\dragOperation.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">BEGIN_DRAG</span><span class="token punctuation">,</span> <span class="token constant">END_DRAG</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../actions/dragDrop&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">itemType</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//拖动元素的类型</span></span>
<span class="line">    <span class="token literal-property property">item</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//拖动的元素</span></span>
<span class="line">    <span class="token literal-property property">sourceId</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">//来源的ID</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">BEGIN_DRAG</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token operator">...</span>state<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">itemType</span><span class="token operator">:</span> payload<span class="token punctuation">.</span>itemType<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">item</span><span class="token operator">:</span> payload<span class="token punctuation">.</span>item<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">sourceId</span><span class="token operator">:</span> payload<span class="token punctuation">.</span>sourceId</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">END_DRAG</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token operator">...</span>state<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">itemType</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">item</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">sourceId</span><span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-2-reducers-index-js" tabindex="-1"><a class="header-anchor" href="#_13-2-reducers-index-js"><span>13.2 reducers\\index.js</span></a></h3><p>src\\dnd-core\\reducers\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { reduce as dragOperation, } from &#39;./dragOperation&#39;;</span>
<span class="line">+import { combineReducers } from &#39;redux&#39;</span>
<span class="line">+const reducers = {</span>
<span class="line">+    dragOperation</span>
<span class="line">+};</span>
<span class="line">+export default combineReducers(reducers);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-3-dragdrop-index-js" tabindex="-1"><a class="header-anchor" href="#_13-3-dragdrop-index-js"><span>13.3 dragDrop\\index.js</span></a></h3><p>src\\dnd-core\\actions\\dragDrop\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createBeginDrag <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./beginDrag&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createEndDrag <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./endDrag&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createDragDropActions</span><span class="token punctuation">(</span><span class="token parameter">manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">beginDrag</span><span class="token operator">:</span> <span class="token function">createBeginDrag</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">endDrag</span><span class="token operator">:</span> <span class="token function">createEndDrag</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-4-types-js" tabindex="-1"><a class="header-anchor" href="#_13-4-types-js"><span>13.4 types.js</span></a></h3><p>src\\dnd-core\\actions\\dragDrop\\types.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">BEGIN_DRAG</span> <span class="token operator">=</span> <span class="token string">&#39;dnd-core/BEGIN_DRAG&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">END_DRAG</span> <span class="token operator">=</span> <span class="token string">&#39;dnd-core/END_DRAG&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-5-begindrag-js" tabindex="-1"><a class="header-anchor" href="#_13-5-begindrag-js"><span>13.5 beginDrag.js</span></a></h3><p>src\\dnd-core\\actions\\dragDrop\\beginDrag.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">BEGIN_DRAG</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createBeginDrag</span><span class="token punctuation">(</span><span class="token parameter">manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">beginDrag</span><span class="token punctuation">(</span><span class="token parameter">sourceId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> monitor <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getGlobalMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> registry <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> source <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span>sourceId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> item <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">beginDrag</span><span class="token punctuation">(</span>monitor<span class="token punctuation">,</span> sourceId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> itemType <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getSourceType</span><span class="token punctuation">(</span>sourceId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">BEGIN_DRAG</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                itemType<span class="token punctuation">,</span></span>
<span class="line">                item<span class="token punctuation">,</span></span>
<span class="line">                sourceId</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-6-dragsourceimpl-js" tabindex="-1"><a class="header-anchor" href="#_13-6-dragsourceimpl-js"><span>13.6 DragSourceImpl.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrag\\DragSourceImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export class DragSourceImpl {</span>
<span class="line">    spec;</span>
<span class="line">    monitor;</span>
<span class="line">    connector;</span>
<span class="line">    constructor(spec, monitor, connector) {</span>
<span class="line">        this.spec = spec;</span>
<span class="line">        this.monitor = monitor;</span>
<span class="line">        this.connector = connector;</span>
<span class="line">    }</span>
<span class="line">+   beginDrag() {</span>
<span class="line">+       const spec = this.spec;</span>
<span class="line">+       const monitor = this.monitor;</span>
<span class="line">+       return spec.item(monitor);</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-7-enddrag-js" tabindex="-1"><a class="header-anchor" href="#_13-7-enddrag-js"><span>13.7 endDrag.js</span></a></h3><p>src\\dnd-core\\actions\\dragDrop\\endDrag.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">END_DRAG</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createEndDrag</span><span class="token punctuation">(</span><span class="token parameter">manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">endDrag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">END_DRAG</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-8-dragdropmonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_13-8-dragdropmonitorimpl-js"><span>13.8 DragDropMonitorImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropMonitorImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">DragDropMonitorImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    store</span>
<span class="line">    registry</span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> registry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> store</span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>registry <span class="token operator">=</span> registry<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">subscribeToStateChange</span><span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token function">getSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dragOperation<span class="token punctuation">.</span>sourceId<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">isDraggingSource</span><span class="token punctuation">(</span><span class="token parameter">sourceId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> sourceId <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DragDropMonitorImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-9-dragdropmanagerimpl-js" tabindex="-1"><a class="header-anchor" href="#_13-9-dragdropmanagerimpl-js"><span>13.9 DragDropManagerImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropManagerImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { createDragDropActions } from &#39;../actions/dragDrop&#39;;</span>
<span class="line">+import { bindActionCreators } from &#39;redux&#39;;</span>
<span class="line">class DragDropManagerImpl {</span>
<span class="line">    store;</span>
<span class="line">    backend;</span>
<span class="line">    globalMonitor;</span>
<span class="line">    constructor(store, globalMonitor) {</span>
<span class="line">        this.store = store;</span>
<span class="line">        this.globalMonitor = globalMonitor;</span>
<span class="line">    }</span>
<span class="line">    receiveBackend(backend) {</span>
<span class="line">        this.backend = backend;</span>
<span class="line">+       this.backend.setup();</span>
<span class="line">    }</span>
<span class="line">    getBackend() {</span>
<span class="line">        return this.backend;</span>
<span class="line">    }</span>
<span class="line">    getGlobalMonitor() {</span>
<span class="line">        return this.globalMonitor;</span>
<span class="line">    }</span>
<span class="line">    getRegistry() {</span>
<span class="line">        return this.globalMonitor.registry;</span>
<span class="line">    }</span>
<span class="line">+   getActions() {</span>
<span class="line">+       const actions = createDragDropActions(this);</span>
<span class="line">+       return bindActionCreators(actions, this.store.dispatch);</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default DragDropManagerImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-10-html5backendimpl-js" tabindex="-1"><a class="header-anchor" href="#_13-10-html5backendimpl-js"><span>13.10 HTML5BackendImpl.js</span></a></h3><p>src\\react-dnd-html5-backend\\HTML5BackendImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class HTML5BackendImpl {</span>
<span class="line">    dragStartSourceId</span>
<span class="line">+   actions</span>
<span class="line">+   constructor(manager) {</span>
<span class="line">+       this.actions = manager.getActions();</span>
<span class="line">+   }</span>
<span class="line">+   setup() {</span>
<span class="line">+       this.addEventListeners(window);</span>
<span class="line">+   }</span>
<span class="line">+   addEventListeners(target) {</span>
<span class="line">+       target.addEventListener(&#39;dragstart&#39;, this.handleTopDragStart);</span>
<span class="line">+       target.addEventListener(&#39;dragend&#39;, this.handleTopDragEndCapture, true);</span>
<span class="line">+   }</span>
<span class="line">+   handleTopDragStart = (e) =&gt; {</span>
<span class="line">+       this.actions.beginDrag(this.dragStartSourceId);</span>
<span class="line">+   }</span>
<span class="line">+   handleTopDragEndCapture = () =&gt; {</span>
<span class="line">+       this.actions.endDrag();</span>
<span class="line">+   };</span>
<span class="line">    connectDragSource(handleId, node) {</span>
<span class="line">        node.setAttribute(&#39;draggable&#39;, &#39;true&#39;);</span>
<span class="line">        node.addEventListener(&#39;dragstart&#39;, (e) =&gt; this.handleDragStart(e, handleId));</span>
<span class="line">    }</span>
<span class="line">    handleDragStart(e, handleId) {</span>
<span class="line">        this.dragStartSourceId = handleId;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default HTML5BackendImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-复制usedrop" tabindex="-1"><a class="header-anchor" href="#_14-复制usedrop"><span>14.复制useDrop</span></a></h2><h3 id="_14-1-usedrop-index-js" tabindex="-1"><a class="header-anchor" href="#_14-1-usedrop-index-js"><span>14.1 useDrop\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrop\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> useDropTargetMonitor <span class="token keyword">from</span> <span class="token string">&#39;./useDropTargetMonitor&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDropTargetConnector <span class="token keyword">from</span> <span class="token string">&#39;./useDropTargetConnector&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useRegisteredDropTarget <span class="token keyword">from</span> <span class="token string">&#39;./useRegisteredDropTarget&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useConnectDropTarget <span class="token keyword">from</span> <span class="token string">&#39;./useConnectDropTarget&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useCollectedProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../useCollectedProps&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDrag</span><span class="token punctuation">(</span><span class="token parameter">spec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> monitor <span class="token operator">=</span> <span class="token function">useDropTargetMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> connector <span class="token operator">=</span> <span class="token function">useDropTargetConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">useRegisteredDropTarget</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token function">useCollectedProps</span><span class="token punctuation">(</span>monitor<span class="token punctuation">,</span> spec<span class="token punctuation">.</span>collect<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function">useConnectDropTarget</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDrag<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-2-usedroptargetmonitor-js" tabindex="-1"><a class="header-anchor" href="#_14-2-usedroptargetmonitor-js"><span>14.2 useDropTargetMonitor.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrop\\useDropTargetMonitor.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDragDropManager <span class="token keyword">from</span> <span class="token string">&#39;../useDragDropManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> DropTargetMonitorImpl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../internals&#39;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDropTargetMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token function">useDragDropManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">DropTargetMonitorImpl</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>manager<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDropTargetMonitor<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-3-droptargetmonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_14-3-droptargetmonitorimpl-js"><span>14.3 DropTargetMonitorImpl.js</span></a></h3><p>src\\react-dnd\\internals\\DropTargetMonitorImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">DragSourceMonitorImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    internalMonitor</span>
<span class="line">    handlerId</span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>internalMonitor <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getGlobalMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">receiveHandlerId</span><span class="token punctuation">(</span><span class="token parameter">handlerId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>handlerId <span class="token operator">=</span> handlerId<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">subscribeToStateChange</span><span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>internalMonitor<span class="token punctuation">.</span><span class="token function">subscribeToStateChange</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">isDragging</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>internalMonitor<span class="token punctuation">.</span><span class="token function">isDraggingSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">getItemType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>internalMonitor<span class="token punctuation">.</span><span class="token function">getItemType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>internalMonitor<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">getClientOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>internalMonitor<span class="token punctuation">.</span><span class="token function">getClientOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DragSourceMonitorImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-4-usedroptargetconnector-js" tabindex="-1"><a class="header-anchor" href="#_14-4-usedroptargetconnector-js"><span>14.4 useDropTargetConnector.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrop\\useDropTargetConnector.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDragDropManager <span class="token keyword">from</span> <span class="token string">&#39;../useDragDropManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> TargetConnector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../internals&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDropTargetConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token function">useDragDropManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> connector <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">TargetConnector</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span><span class="token function">getBackend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>manager<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> connector<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDropTargetConnector<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-5-targetconnector-js" tabindex="-1"><a class="header-anchor" href="#_14-5-targetconnector-js"><span>14.5 TargetConnector.js</span></a></h3><p>src\\react-dnd\\internals\\TargetConnector.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">TargetConnector</span> <span class="token punctuation">{</span></span>
<span class="line">    backend</span>
<span class="line">    handlerId  <span class="token comment">//拖动源唯一标识</span></span>
<span class="line">    dropTargetRef <span class="token comment">//DOM节点</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">backend</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>backend <span class="token operator">=</span> backend<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">get</span> <span class="token function">dropTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dropTargetRef <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dropTargetRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerId <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>dropTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>backend<span class="token punctuation">.</span><span class="token function">connectDropTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dropTarget<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//useRegisteredDragSource中useLayoutEffect赋值</span></span>
<span class="line">    <span class="token function">receiveHandlerId</span><span class="token punctuation">(</span><span class="token parameter">handlerId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>handlerId <span class="token operator">=</span> handlerId<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">receiveDropTarget</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dropTargetRef</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>dropTargetRef <span class="token operator">=</span> dropTargetRef<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> TargetConnector<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-6-useregistereddroptarget-js" tabindex="-1"><a class="header-anchor" href="#_14-6-useregistereddroptarget-js"><span>14.6 useRegisteredDropTarget.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrop\\useRegisteredDropTarget.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useLayoutEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDragDropManager <span class="token keyword">from</span> <span class="token string">&#39;../useDragDropManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> useDropTarget <span class="token keyword">from</span> <span class="token string">&#39;./useDropTarget&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> registerTarget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../internals&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useRegisteredDropTarget</span><span class="token punctuation">(</span><span class="token parameter">spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token function">useDragDropManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">useDropTarget</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> type <span class="token operator">=</span> spec<span class="token punctuation">.</span>type<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> handlerId <span class="token operator">=</span> <span class="token function">registerTarget</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> manager<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        monitor<span class="token punctuation">.</span><span class="token function">receiveHandlerId</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        connector<span class="token punctuation">.</span><span class="token function">receiveHandlerId</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>connector<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> type<span class="token punctuation">,</span> manager<span class="token punctuation">,</span> monitor<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useRegisteredDropTarget<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-7-usedroptarget-js" tabindex="-1"><a class="header-anchor" href="#_14-7-usedroptarget-js"><span>14.7 useDropTarget.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrop\\useDropTarget.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">/* eslint-disable react-hooks/exhaustive-deps */</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> DropTargetImpl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./DropTargetImpl&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useDropTarget</span><span class="token punctuation">(</span><span class="token parameter">spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DropTargetImpl</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>monitor<span class="token punctuation">,</span> connector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        handler<span class="token punctuation">.</span>spec <span class="token operator">=</span> spec<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handler<span class="token punctuation">,</span> spec<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> handler<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useDropTarget<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-8-droptargetimpl-js" tabindex="-1"><a class="header-anchor" href="#_14-8-droptargetimpl-js"><span>14.8 DropTargetImpl.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrop\\DropTargetImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DropTargetImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    spec<span class="token punctuation">;</span></span>
<span class="line">    monitor<span class="token punctuation">;</span></span>
<span class="line">    connector<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">spec<span class="token punctuation">,</span> monitor<span class="token punctuation">,</span> connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>spec <span class="token operator">=</span> spec<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>monitor <span class="token operator">=</span> monitor<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>connector <span class="token operator">=</span> connector<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">hover</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> spec <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spec<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> monitor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>monitor<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>spec<span class="token punctuation">.</span>hover<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            spec<span class="token punctuation">.</span><span class="token function">hover</span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> monitor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-9-registertarget-js" tabindex="-1"><a class="header-anchor" href="#_14-9-registertarget-js"><span>14.9 registerTarget.js</span></a></h3><p>src\\react-dnd\\internals\\registerTarget.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">registerTarget</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> target<span class="token punctuation">,</span> manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> registry <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> targetId <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">addTarget</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> targetId<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> registerTarget<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-10-useconnectdroptarget-js" tabindex="-1"><a class="header-anchor" href="#_14-10-useconnectdroptarget-js"><span>14.10 useConnectDropTarget.js</span></a></h3><p>src\\react-dnd\\hooks\\useDrop\\useConnectDropTarget.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">useConnectDropTarget</span><span class="token punctuation">(</span><span class="token parameter">connector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> connector<span class="token punctuation">.</span>receiveDropTarget<span class="token punctuation">,</span> <span class="token punctuation">[</span>connector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> useConnectDropTarget</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-11-hooks-index-js" tabindex="-1"><a class="header-anchor" href="#_14-11-hooks-index-js"><span>14.11 hooks\\index.js</span></a></h3><p>src\\react-dnd\\hooks\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as useDrag } from &#39;./useDrag&#39;;</span>
<span class="line">+export { default as useDrop } from &#39;./useDrop&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-12-internals-index-js" tabindex="-1"><a class="header-anchor" href="#_14-12-internals-index-js"><span>14.12 internals\\index.js</span></a></h3><p>src\\react-dnd\\internals\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export { default as DragSourceMonitorImpl } from &#39;./DragSourceMonitorImpl&#39;;</span>
<span class="line">+export { default as DropTargetMonitorImpl } from &#39;./DropTargetMonitorImpl&#39;;</span>
<span class="line">export { default as SourceConnector } from &#39;./SourceConnector&#39;;</span>
<span class="line">+export { default as TargetConnector } from &#39;./TargetConnector&#39;;</span>
<span class="line">export { default as registerSource } from &#39;./registerSource&#39;;</span>
<span class="line">+export { default as registerTarget } from &#39;./registerTarget&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_15-增加监听" tabindex="-1"><a class="header-anchor" href="#_15-增加监听"><span>15.增加监听</span></a></h2><h3 id="_15-1-src-react-dnd-html5-backend-html5backendimpl-js" tabindex="-1"><a class="header-anchor" href="#_15-1-src-react-dnd-html5-backend-html5backendimpl-js"><span>15.1 src\\react-dnd-html5-backend\\HTML5BackendImpl.js</span></a></h3><p>src\\react-dnd-html5-backend\\HTML5BackendImpl.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { getEventClientOffset } from &#39;./OffsetUtils&#39;;</span>
<span class="line">class HTML5BackendImpl {</span>
<span class="line">    dragStartSourceId</span>
<span class="line">    actions</span>
<span class="line">+   dragOverTargetId</span>
<span class="line">    constructor(manager) {</span>
<span class="line">        this.actions = manager.getActions();</span>
<span class="line">    }</span>
<span class="line">    setup() {</span>
<span class="line">        this.addEventListeners(window);</span>
<span class="line">    }</span>
<span class="line">    addEventListeners(target) {</span>
<span class="line">        target.addEventListener(&#39;dragstart&#39;, this.handleTopDragStart);</span>
<span class="line">+       target.addEventListener(&#39;dragover&#39;, this.handleTopDragOver);</span>
<span class="line">        target.addEventListener(&#39;dragend&#39;, this.handleTopDragEndCapture, true);</span>
<span class="line">    }</span>
<span class="line">    handleTopDragStart = (e) =&gt; {</span>
<span class="line">        this.actions.beginDrag(this.dragStartSourceId);</span>
<span class="line">    }</span>
<span class="line">    handleTopDragEndCapture = () =&gt; {</span>
<span class="line">        this.actions.endDrag();</span>
<span class="line">    };</span>
<span class="line">    connectDragSource(handleId, node) {</span>
<span class="line">        node.setAttribute(&#39;draggable&#39;, &#39;true&#39;);</span>
<span class="line">        node.addEventListener(&#39;dragstart&#39;, (e) =&gt; this.handleDragStart(e, handleId));</span>
<span class="line">    }</span>
<span class="line">    handleDragStart(e, handleId) {</span>
<span class="line">        this.dragStartSourceId = handleId;</span>
<span class="line">    }</span>
<span class="line">+   handleTopDragOver = (e) =&gt; {</span>
<span class="line">+       this.actions.hover(this.dragOverTargetId, {</span>
<span class="line">+           clientOffset: getEventClientOffset(e)</span>
<span class="line">+       });</span>
<span class="line">+   };</span>
<span class="line">+   handleDragOver(e, targetId) {</span>
<span class="line">+       this.dragOverTargetId = targetId;</span>
<span class="line">+   }</span>
<span class="line">+   connectDropTarget(targetId, node) {</span>
<span class="line">+       console.log(&#39;connectDropTarget&#39;, targetId);</span>
<span class="line">+       node.addEventListener(&#39;dragover&#39;, (e) =&gt; this.handleDragOver(e, targetId));</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line">export default HTML5BackendImpl;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-2-offsetutils-js" tabindex="-1"><a class="header-anchor" href="#_15-2-offsetutils-js"><span>15.2 OffsetUtils.js</span></a></h3><p>src\\react-dnd-html5-backend\\OffsetUtils.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 获取事件在浏览器可视区域的坐标</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">e</span> </span>
<span class="line"> * <span class="token keyword">@returns</span> </span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getEventClientOffset</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span><span class="token comment">//鼠标相对于浏览器窗口可视区域的X</span></span>
<span class="line">        <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span>clientY<span class="token comment">//鼠标相对于浏览器窗口可视区域的Y坐标</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_16-注册和监听" tabindex="-1"><a class="header-anchor" href="#_16-注册和监听"><span>16.注册和监听</span></a></h2><h3 id="_16-1-src-dnd-core-classes-dragdropmonitorimpl-js" tabindex="-1"><a class="header-anchor" href="#_16-1-src-dnd-core-classes-dragdropmonitorimpl-js"><span>16.1 src\\dnd-core\\classes\\DragDropMonitorImpl.js</span></a></h3><p>src\\dnd-core\\classes\\DragDropMonitorImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">DragDropMonitorImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    store</span>
<span class="line">    registry</span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> registry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> store</span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>registry <span class="token operator">=</span> registry<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">subscribeToStateChange</span><span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">getSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dragOperation<span class="token punctuation">.</span>sourceId<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">isDraggingSource</span><span class="token punctuation">(</span><span class="token parameter">sourceId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> sourceId <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dragOperation<span class="token punctuation">.</span>item<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token function">getItemType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dragOperation<span class="token punctuation">.</span>itemType<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token function">getClientOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dragOffset<span class="token punctuation">.</span>clientOffset<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> DragDropMonitorImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_16-2-src-dnd-core-classes-handlerregistryimpl-js" tabindex="-1"><a class="header-anchor" href="#_16-2-src-dnd-core-classes-handlerregistryimpl-js"><span>16.2 src\\dnd-core\\classes\\HandlerRegistryImpl.js</span></a></h3><p>src\\dnd-core\\classes\\HandlerRegistryImpl.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> HandlerRole <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../interfaces&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getNextUniqueId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">import</span> <span class="token punctuation">{</span> addSource<span class="token punctuation">,</span> addTarget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../actions/registry&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">HandlerRegistryImpl</span> <span class="token punctuation">{</span></span>
<span class="line">    store<span class="token punctuation">;</span><span class="token comment">//redux仓库</span></span>
<span class="line">    types <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//不同handlerId的类型</span></span>
<span class="line">    dragSources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//拖放来源</span></span>
<span class="line"><span class="token operator">+</span>   dropTargets <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//放置目标</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> store<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">addSource</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> handlerId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>HandlerRole<span class="token punctuation">.</span><span class="token constant">SOURCE</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addSource</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> handlerId<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">addHandler</span><span class="token punctuation">(</span><span class="token parameter">role<span class="token punctuation">,</span> type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> handlerId <span class="token operator">=</span> <span class="token function">getNextHandlerId</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取下一个handleId</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">===</span> HandlerRole<span class="token punctuation">.</span><span class="token constant">SOURCE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>dragSources<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">===</span> HandlerRole<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>           <span class="token keyword">this</span><span class="token punctuation">.</span>dropTargets<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> handlerId<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token parameter">handlerId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragSources<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">getSourceType</span><span class="token punctuation">(</span><span class="token parameter">handlerId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>handlerId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token function">addTarget</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">const</span> targetId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>HandlerRole<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTarget</span><span class="token punctuation">(</span>targetId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span> targetId<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token parameter">targetId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dropTargets<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token function">getTargetType</span><span class="token punctuation">(</span><span class="token parameter">targetId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>targetId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getNextHandlerId</span><span class="token punctuation">(</span><span class="token parameter">role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">getNextUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>role<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> HandlerRole<span class="token punctuation">.</span><span class="token constant">SOURCE</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">S</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">case</span> HandlerRole<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">T</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Unknown Handler Role: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>role<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> HandlerRegistryImpl<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_16-3-src-dnd-core-actions-registry-js" tabindex="-1"><a class="header-anchor" href="#_16-3-src-dnd-core-actions-registry-js"><span>16.3 src\\dnd-core\\actions\\registry.js</span></a></h3><p>src\\dnd-core\\actions\\registry.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const ADD_SOURCE = &#39;dnd-core/ADD_SOURCE&#39;;</span>
<span class="line">+export const ADD_TARGET = &#39;dnd-core/ADD_TARGET&#39;;</span>
<span class="line">export function addSource(handlerId) {</span>
<span class="line">    return {</span>
<span class="line">        type: ADD_SOURCE,</span>
<span class="line">        payload: { handlerId }</span>
<span class="line">    };</span>
<span class="line">}</span>
<span class="line">+export function addTarget(targetId) {</span>
<span class="line">+    return {</span>
<span class="line">+        type: ADD_TARGET,</span>
<span class="line">+        payload: {</span>
<span class="line">+            targetId</span>
<span class="line">+        },</span>
<span class="line">+    };</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_17-store" tabindex="-1"><a class="header-anchor" href="#_17-store"><span>17.store</span></a></h2><h3 id="_17-1-reducers-index-js" tabindex="-1"><a class="header-anchor" href="#_17-1-reducers-index-js"><span>17.1 reducers\\index.js</span></a></h3><p>src\\dnd-core\\reducers\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { reduce as dragOperation, } from &#39;./dragOperation&#39;;</span>
<span class="line">+import { reduce as dragOffset } from &#39;./dragOffset&#39;;</span>
<span class="line">import { combineReducers } from &#39;redux&#39;</span>
<span class="line">const reducers = {</span>
<span class="line">    dragOperation,</span>
<span class="line">+   dragOffset</span>
<span class="line">};</span>
<span class="line">export default combineReducers(reducers);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-2-dragoffset-js" tabindex="-1"><a class="header-anchor" href="#_17-2-dragoffset-js"><span>17.2 dragOffset.js</span></a></h3><p>src\\dnd-core\\reducers\\dragOffset.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">BEGIN_DRAG</span><span class="token punctuation">,</span> <span class="token constant">HOVER</span><span class="token punctuation">,</span> <span class="token constant">END_DRAG</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../actions/dragDrop&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">clientOffset</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">BEGIN_DRAG</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">clientOffset</span><span class="token operator">:</span> payload<span class="token punctuation">.</span>clientOffset<span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">HOVER</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">clientOffset</span><span class="token operator">:</span> payload<span class="token punctuation">.</span>clientOffset</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token constant">END_DRAG</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> initialState<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-3-dragdrop-index-js" tabindex="-1"><a class="header-anchor" href="#_17-3-dragdrop-index-js"><span>17.3 dragDrop\\index.js</span></a></h3><p>src\\dnd-core\\actions\\dragDrop\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createBeginDrag } from &#39;./beginDrag&#39;;</span>
<span class="line">import { createEndDrag } from &#39;./endDrag&#39;;</span>
<span class="line">+import { createHover } from &#39;./hover&#39;;</span>
<span class="line">export * from &#39;./types&#39;;</span>
<span class="line">export function createDragDropActions(manager) {</span>
<span class="line">    return {</span>
<span class="line">        beginDrag: createBeginDrag(manager),</span>
<span class="line">        endDrag: createEndDrag(manager),</span>
<span class="line">+       hover: createHover(manager)</span>
<span class="line">    };</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-4-hover-js" tabindex="-1"><a class="header-anchor" href="#_17-4-hover-js"><span>17.4 hover.js</span></a></h3><p>src\\dnd-core\\actions\\dragDrop\\hover.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HOVER</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createHover</span><span class="token punctuation">(</span><span class="token parameter">manager</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">hover</span><span class="token punctuation">(</span><span class="token parameter">targetId<span class="token punctuation">,</span> <span class="token punctuation">{</span> clientOffset <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> registry <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//HandlerRegistryImpl</span></span>
<span class="line">        <span class="token keyword">const</span> target <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span>targetId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//DropTargetImpl</span></span>
<span class="line">        <span class="token function">queueMicrotask</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">hover</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">HOVER</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                targetId<span class="token punctuation">,</span></span>
<span class="line">                clientOffset</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-5-src-dnd-core-actions-dragdrop-types-js" tabindex="-1"><a class="header-anchor" href="#_17-5-src-dnd-core-actions-dragdrop-types-js"><span>17.5 src\\dnd-core\\actions\\dragDrop\\types.js</span></a></h3><p>src\\dnd-core\\actions\\dragDrop\\types.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const BEGIN_DRAG = &#39;dnd-core/BEGIN_DRAG&#39;;</span>
<span class="line">export const END_DRAG = &#39;dnd-core/END_DRAG&#39;;</span>
<span class="line">+export const HOVER = &#39;dnd-core/HOVER&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,359)])])}const o=s(t,[["render",l]]),r=JSON.parse('{"path":"/strong/141.react-dnd.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/141.react-dnd.md"}');export{o as comp,r as data};
