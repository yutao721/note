import{_ as n,c as a,a as t,o as e}from"./app-CD1YpnS1.js";const p={};function o(l,s){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h2 id="_1-安装" tabindex="-1"><a class="header-anchor" href="#_1-安装"><span>1.安装</span></a></h2><h3 id="_1-1-安装mysql" tabindex="-1"><a class="header-anchor" href="#_1-1-安装mysql"><span>1.1.安装mysql</span></a></h3><ul><li><a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener noreferrer">mysql</a></li></ul><h3 id="_1-2-安装redis" tabindex="-1"><a class="header-anchor" href="#_1-2-安装redis"><span>1.2.安装redis</span></a></h3><ul><li><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">redis</a></li></ul><h3 id="_1-3-安装nginx" tabindex="-1"><a class="header-anchor" href="#_1-3-安装nginx"><span>1.3.安装nginx</span></a></h3><ul><li><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">nginx</a></li></ul><h2 id="_2-配置nginx" tabindex="-1"><a class="header-anchor" href="#_2-配置nginx"><span>2. 配置nginx</span></a></h2><h3 id="_2-1-nginx-conf" tabindex="-1"><a class="header-anchor" href="#_2-1-nginx-conf"><span>2.1 nginx.conf</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">http {</span>
<span class="line">    include       mime.types;</span>
<span class="line">    default_type  application/octet-stream;</span>
<span class="line"></span>
<span class="line">    log_format  main &#39;$time_iso8601    -    -    $remote_addr    $http_host    $status    $request_time    $request_length    $body_bytes_sent    15d04347-be16-b9ab-0029-24e4b6645950    -    -    9689c3ea-5155-2df7-a719-e90d2dedeb2c 937ba755-116a-18e6-0735-312cba23b00c    -    -    $request_uri    $http_user_agent    -    sample=-&amp;_UC_agent=-&amp;device_id=-&amp;-    -    -    -&#39;;</span>
<span class="line">    access_log  logs/access.log  main;</span>
<span class="line">    server {</span>
<span class="line">        listen       80;</span>
<span class="line">        server_name  localhost;</span>
<span class="line">        if ($time_iso8601 ~ &quot;^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2})&quot;) {</span>
<span class="line">         set $year $1;</span>
<span class="line">         set $month $2;</span>
<span class="line">         set $day $3;</span>
<span class="line">         set $hour $4;</span>
<span class="line">         set $minute $5;</span>
<span class="line">        }</span>
<span class="line">        access_log  logs/$year$month-$day-$hour-$minute.log  main;</span>
<span class="line">        location / {</span>
<span class="line">            root   html;</span>
<span class="line">            index  index.html index.htm;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        error_page   500 502 503 504  /50x.html;</span>
<span class="line">        location = /50x.html {</span>
<span class="line">            root   html;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">$time_iso8601</td><td style="text-align:left;">服务器时间的ISO 8610格式</td></tr><tr><td style="text-align:left;">$remote_addr</td><td style="text-align:left;">客户端地址</td></tr><tr><td style="text-align:left;">$http_host</td><td style="text-align:left;">主机名</td></tr><tr><td style="text-align:left;">$status</td><td style="text-align:left;">HTTP响应代码</td></tr><tr><td style="text-align:left;">$request_time</td><td style="text-align:left;">处理客户端请求使用的时间</td></tr><tr><td style="text-align:left;">$request_length</td><td style="text-align:left;">请求的长度</td></tr><tr><td style="text-align:left;">$body_bytes_sent</td><td style="text-align:left;">传输给客户端的字节数</td></tr><tr><td style="text-align:left;">$request_uri</td><td style="text-align:left;">包含一些客户端请求参数的原始URI</td></tr><tr><td style="text-align:left;">$http_user_agent</td><td style="text-align:left;">客户端用户代理</td></tr></tbody></table><h2 id="_3-下载项目" tabindex="-1"><a class="header-anchor" href="#_3-下载项目"><span>3. 下载项目</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>gitee<span class="token punctuation">.</span>com<span class="token operator">/</span>zhufengpeixun<span class="token operator">/</span>monitor<span class="token punctuation">.</span>git</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_4-埋点上报" tabindex="-1"><a class="header-anchor" href="#_4-埋点上报"><span>4.埋点上报</span></a></h2><h3 id="_4-1-安装" tabindex="-1"><a class="header-anchor" href="#_4-1-安装"><span>4.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cd monitor/sdk</span>
<span class="line">cnpm install</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-配置" tabindex="-1"><a class="header-anchor" href="#_4-2-配置"><span>4.2 配置</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">window<span class="token punctuation">.</span>dt <span class="token operator">&amp;&amp;</span> dt<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token string">&#39;template&#39;</span><span class="token punctuation">,</span> <span class="token comment">// [必填]项目id,</span></span>
<span class="line">  <span class="token literal-property property">uuid</span><span class="token operator">:</span> <span class="token string">&#39;uuid&#39;</span><span class="token punctuation">,</span> <span class="token comment">// [可选]设备唯一id, 用于计算uv数&amp;设备分布. 一般在cookie中可以取到, 没有uuid可用设备macidfa/imei替代. 或者在storage的key中存入随机数字, 模拟设备唯一id.</span></span>
<span class="line">  <span class="token literal-property property">ucid</span><span class="token operator">:</span> <span class="token string">&#39;ucid&#39;</span><span class="token punctuation">,</span> <span class="token comment">// [可选]用户ucid, 用于发生异常时追踪用户信息, 一般在cookie中可以取到, 没有可传空字符串</span></span>
<span class="line">  <span class="token literal-property property">is_test</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否为测试数据, 默认为false(测试模式下打点数据仅供浏览, 不会展示在系统中)</span></span>
<span class="line">  <span class="token literal-property property">record</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">time_on_page</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否监控用户在线时长数据, 默认为true</span></span>
<span class="line">    <span class="token literal-property property">performance</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否监控页面载入性能, 默认为true</span></span>
<span class="line">    <span class="token literal-property property">js_error</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//  是否监控页面报错信息, 默认为true</span></span>
<span class="line">    <span class="token comment">// 配置需要监控的页面报错类别, 仅在js_error为true时生效, 默认均为true(可以将配置改为false, 以屏蔽不需要报的错误类别)</span></span>
<span class="line">    <span class="token literal-property property">js_error_report_config</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token constant">ERROR_RUNTIME</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// js运行时报错</span></span>
<span class="line">      <span class="token constant">ERROR_SCRIPT</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// js资源加载失败</span></span>
<span class="line">      <span class="token constant">ERROR_STYLE</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// css资源加载失败</span></span>
<span class="line">      <span class="token constant">ERROR_IMAGE</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 图片资源加载失败</span></span>
<span class="line">      <span class="token constant">ERROR_AUDIO</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 音频资源加载失败</span></span>
<span class="line">      <span class="token constant">ERROR_VIDEO</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 视频资源加载失败</span></span>
<span class="line">      <span class="token constant">ERROR_CONSOLE</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// vue运行时报错</span></span>
<span class="line">      <span class="token constant">ERROR_TRY_CATCH</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 未catch错误</span></span>
<span class="line">      <span class="token comment">// 自定义检测函数, 上报前最后判断是否需要报告该错误</span></span>
<span class="line">      <span class="token comment">// 回调函数说明</span></span>
<span class="line">      <span class="token comment">// 传入参数 =&gt; </span></span>
<span class="line">      <span class="token comment">//            desc:  字符串, 错误描述</span></span>
<span class="line">      <span class="token comment">//            stack: 字符串, 错误堆栈信息</span></span>
<span class="line">      <span class="token comment">// 返回值 =&gt;  </span></span>
<span class="line">      <span class="token comment">//            true  : 上报打点请求</span></span>
<span class="line">      <span class="token comment">//            false : 不需要上报</span></span>
<span class="line">      <span class="token function-variable function">checkErrrorNeedReport</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">desc<span class="token punctuation">,</span> stack</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// 业务方的js版本号, 会随着打点数据一起上传, 方便区分数据来源</span></span>
<span class="line">  <span class="token comment">// 可以不填, 默认为1.0.0</span></span>
<span class="line">  <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// test.com/detail/1.html</span></span>
<span class="line">  <span class="token comment">// test.com/detail/2.html</span></span>
<span class="line">  <span class="token comment">// test.com/detail/3.html</span></span>
<span class="line">  <span class="token comment">// 这种页面来说, 虽然url不同, 但他们本质上是同一个页面</span></span>
<span class="line">  <span class="token comment">// 因此需要业务方传入一个处理函数, 根据当前url解析出真实的页面类型</span></span>
<span class="line">  <span class="token function-variable function">getPageType</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>location<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>location<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-监控类型" tabindex="-1"><a class="header-anchor" href="#_4-3-监控类型"><span>4.3 监控类型</span></a></h3><h4 id="_4-3-1-time-on-page-用户在线时长统计" tabindex="-1"><a class="header-anchor" href="#_4-3-1-time-on-page-用户在线时长统计"><span>4.3.1 time_on_page(用户在线时长统计)</span></a></h4><ul><li>t_r_duration_distribution</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 用户在线时长统计</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">OFFLINE_MILL</span> <span class="token operator">=</span> <span class="token number">15</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token comment">// 15分钟不操作认为不在线</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">SEND_MILL</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token comment">// 每5s打点一次</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> lastTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 检查是否监控用户在线时长</span></span>
<span class="line">  <span class="token keyword">const</span> isTimeOnPageFlagOn <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">    commonConfig<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token string">&#39;record&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;time_on_page&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CONFIG</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;record&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;time_on_page&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> isOldTimeOnPageFlagOn <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;online&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> needRecordTimeOnPage <span class="token operator">=</span> isTimeOnPageFlagOn <span class="token operator">||</span> isOldTimeOnPageFlagOn</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>needRecordTimeOnPage <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">debugLogger</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">config.record.time_on_page值为false, 跳过停留时长打点</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> duration <span class="token operator">=</span> now <span class="token operator">-</span> lastTime<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">&gt;</span> <span class="token constant">OFFLINE_MILL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    lastTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">&gt;</span> <span class="token constant">SEND_MILL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    lastTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">debugLogger</span><span class="token punctuation">(</span><span class="token string">&#39;发送用户留存时间埋点, 埋点内容 =&gt; &#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">duration_ms</span><span class="token operator">:</span> duration <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// 用户在线时长</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">product</span><span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">duration_ms</span><span class="token operator">:</span> duration <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;product&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">10001</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;duration_ms&quot;</span><span class="token operator">:</span> <span class="token number">21553</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-2-performance-页面载入性能" tabindex="-1"><a class="header-anchor" href="#_4-3-2-performance-页面载入性能"><span>4.3.2 performance(页面载入性能)</span></a></h4><p><img src="http://img.zhufengpeixun.cn/renderscope3.jpg" alt="renderscope3"></p><h4 id="_4-3-2-1-sdk-src-index-js" tabindex="-1"><a class="header-anchor" href="#_4-3-2-1-sdk-src-index-js"><span>4.3.2.1 sdk\\src\\index.js</span></a></h4><p>sdk\\src\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 检查是否监控性能指标</span></span>
<span class="line">  <span class="token keyword">const</span> isPerformanceFlagOn <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">    commonConfig<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token string">&#39;record&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;performance&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CONFIG</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;record&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;performance&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> isOldPerformanceFlagOn <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;performance&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> needRecordPerformance <span class="token operator">=</span> isPerformanceFlagOn <span class="token operator">||</span> isOldPerformanceFlagOn</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>needRecordPerformance <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">debugLogger</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">config.record.performance值为false, 跳过性能指标打点</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> performance <span class="token operator">=</span> window<span class="token punctuation">.</span>performance</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>performance<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 当前浏览器不支持</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;你的浏览器不支持 performance 接口&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">const</span> times <span class="token operator">=</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">debugLogger</span><span class="token punctuation">(</span><span class="token string">&#39;发送页面性能指标数据, 上报内容 =&gt; &#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">...</span>times<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;perf&#39;</span><span class="token punctuation">,</span> <span class="token number">20001</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">...</span>times<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;perf&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">20001</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;connectStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165386</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;navigationStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165383</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;loadEventEnd&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;domLoading&quot;</span><span class="token operator">:</span> <span class="token number">1592020165401</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;secureConnectionStart&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;fetchStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165386</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;domContentLoadedEventStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165630</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;responseStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165393</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;responseEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592020165394</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;domInteractive&quot;</span><span class="token operator">:</span> <span class="token number">1592020165630</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;domainLookupEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592020165386</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;redirectStart&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;requestStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165387</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;unloadEventEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592020165398</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;unloadEventStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165397</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;domComplete&quot;</span><span class="token operator">:</span> <span class="token number">1592020165630</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;domainLookupStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165386</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;loadEventStart&quot;</span><span class="token operator">:</span> <span class="token number">1592020165630</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;domContentLoadedEventEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592020165630</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;redirectEnd&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;connectEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592020165386</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-3-js-error-页面报错" tabindex="-1"><a class="header-anchor" href="#_4-3-3-js-error-页面报错"><span>4.3.3 js_error(页面报错)</span></a></h4><table><thead><tr><th style="text-align:left;">错误类型</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">ERROR_RUNTIME</td><td style="text-align:left;">js运行时报错</td></tr><tr><td style="text-align:left;">ERROR_SCRIPT</td><td style="text-align:left;">js资源加载失败</td></tr><tr><td style="text-align:left;">ERROR_IMAGE</td><td style="text-align:left;">图片资源加载失败</td></tr><tr><td style="text-align:left;">ERROR_AUDIO</td><td style="text-align:left;">音频资源加载失败</td></tr><tr><td style="text-align:left;">ERROR_VIDEO</td><td style="text-align:left;">视频资源加载失败</td></tr><tr><td style="text-align:left;">ERROR_CONSOLE</td><td style="text-align:left;">vue运行时报错</td></tr><tr><td style="text-align:left;">ERROR_TRY_CATCH</td><td style="text-align:left;">未catch错误</td></tr></tbody></table><h5 id="_4-3-3-1-error-runtime" tabindex="-1"><a class="header-anchor" href="#_4-3-3-1-error-runtime"><span>4.3.3.1 ERROR_RUNTIME</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 过滤 target 为 window 的异常，避免与上面的 onerror 重复</span></span>
<span class="line">    <span class="token keyword">var</span> errorTarget <span class="token operator">=</span> event<span class="token punctuation">.</span>target</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>errorTarget <span class="token operator">!==</span> window <span class="token operator">&amp;&amp;</span> errorTarget<span class="token punctuation">.</span>nodeName <span class="token operator">&amp;&amp;</span> <span class="token constant">LOAD_ERROR_TYPE</span><span class="token punctuation">[</span>errorTarget<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token function">formatLoadError</span><span class="token punctuation">(</span>errorTarget<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// onerror会被覆盖, 因此转为使用Listener进行监控</span></span>
<span class="line">      <span class="token keyword">let</span> <span class="token punctuation">{</span> message<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> event</span>
<span class="line">      <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token function">formatRuntimerError</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">formatRuntimerError</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ERROR_RUNTIME</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">desc</span><span class="token operator">:</span> message <span class="token operator">+</span> <span class="token string">&#39; at &#39;</span> <span class="token operator">+</span> source <span class="token operator">+</span> <span class="token string">&#39;:&#39;</span> <span class="token operator">+</span> lineno <span class="token operator">+</span> <span class="token string">&#39;:&#39;</span> <span class="token operator">+</span> colno<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">stack</span><span class="token operator">:</span> error <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>stack <span class="token operator">?</span> error<span class="token punctuation">.</span>stack <span class="token operator">:</span> <span class="token string">&#39;no stack&#39;</span> </span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_JS_RUNTIME_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Uncaught ReferenceError: a is not defined at http://localhost:9000/:53:21&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;stack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ReferenceError: a is not defined\\n    at http://localhost:9000/:53:21&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-2-load-error" tabindex="-1"><a class="header-anchor" href="#_4-3-3-2-load-error"><span>4.3.3.2 LOAD_ERROR</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">      <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;/error.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;/error.css&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;/error.gif&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>audio src<span class="token operator">=</span><span class="token string">&quot;/error.mp3&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>audio<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>video src<span class="token operator">=</span><span class="token string">&quot;/error.mp4&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">formatLoadError</span> <span class="token punctuation">(</span><span class="token parameter">errorTarget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">LOAD_ERROR_TYPE</span><span class="token punctuation">[</span>errorTarget<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">desc</span><span class="token operator">:</span> errorTarget<span class="token punctuation">.</span>baseURI <span class="token operator">+</span> <span class="token string">&#39;@&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>errorTarget<span class="token punctuation">.</span>src <span class="token operator">||</span> errorTarget<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">stack</span><span class="token operator">:</span> <span class="token string">&#39;no stack&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_SCRIPT_LOAD_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:9000/@http://localhost:9000/error.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;stack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no stack&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_CSS_LOAD_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:9000/@http://localhost:9000/error.css&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;stack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no stack&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_IMAGE_LOAD_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:9000/@http://localhost:9000/error.gif&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;stack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no stack&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_VIDEO_LOAD_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:9000/@http://localhost:9000/error.mp4&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;stack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no stack&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_AUDIO_LOAD_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:9000/@http://localhost:9000/error.mp3&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;stack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no stack&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-2-load-error-1" tabindex="-1"><a class="header-anchor" href="#_4-3-3-2-load-error-1"><span>4.3.3.2 LOAD_ERROR</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;vue error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_CONSOLE_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue error&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3-3-error-try-catch" tabindex="-1"><a class="header-anchor" href="#_4-3-3-3-error-try-catch"><span>4.3.3.3 ERROR_TRY_CATCH</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;未捕获错误&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">window<span class="token punctuation">.</span>dt<span class="token punctuation">.</span>tryJS<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>exec<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">exec<span class="token punctuation">.</span><span class="token function">_wrapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;error_no&quot;</span><span class="token operator">:</span> <span class="token string">&quot;页面报错_TRY_CATCH_ERROR&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;未捕获错误&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;stack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Error: 未捕获错误\\n    at Function.exec (http://localhost:9000/:56:17)\\n    at Function.func._wrapped (webpack-internal:///./src/js-tracker/try.js:31:21)\\n    at http://localhost:9000/:59:14&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-4-手工上报" tabindex="-1"><a class="header-anchor" href="#_4-3-4-手工上报"><span>4.3.4 手工上报</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//错误上报</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Elog <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function-variable function">error</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> detail<span class="token punctuation">,</span> extra</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> detail<span class="token punctuation">,</span> extra<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//产品数据上报</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Plog <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function-variable function">product</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> detail<span class="token punctuation">,</span> extra</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;product&#39;</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> detail<span class="token punctuation">,</span> extra<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//普通信息上报</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Ilog <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function-variable function">info</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> detail<span class="token punctuation">,</span> extra</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;info&#39;</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> detail<span class="token punctuation">,</span> extra<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">window<span class="token punctuation">.</span>dt<span class="token punctuation">.</span><span class="token function">product</span><span class="token punctuation">(</span><span class="token number">19999</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;product&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">19999</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-数据处理" tabindex="-1"><a class="header-anchor" href="#_5-数据处理"><span>5.数据处理</span></a></h2><h3 id="_5-1-安装server" tabindex="-1"><a class="header-anchor" href="#_5-1-安装server"><span>5.1 安装server</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cd server </span>
<span class="line">npm install</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-配置" tabindex="-1"><a class="header-anchor" href="#_5-2-配置"><span>5.2 配置</span></a></h3><h4 id="_5-2-1-配置mysql" tabindex="-1"><a class="header-anchor" href="#_5-2-1-配置mysql"><span>5.2.1 配置mysql</span></a></h4><p>server\\src\\configs\\mysql.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> development <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">&#39;3306&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;5f8b8a5d650637f8&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">&#39;platform&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-2-配置redis" tabindex="-1"><a class="header-anchor" href="#_5-2-2-配置redis"><span>5.2.2 配置redis</span></a></h4><p>server\\src\\configs\\redis.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> development <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">&#39;6379&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-数据解析" tabindex="-1"><a class="header-anchor" href="#_5-3-数据解析"><span>5.3 数据解析</span></a></h3><h3 id="_5-3-1-数据存储" tabindex="-1"><a class="header-anchor" href="#_5-3-1-数据存储"><span>5.3.1 数据存储</span></a></h3><h3 id="_5-3-1-1-表名说明" tabindex="-1"><a class="header-anchor" href="#_5-3-1-1-表名说明"><span>5.3.1.1 表名说明</span></a></h3><ul><li>所有表都以<code>t_</code>开头</li><li>原始表添加<code>_o</code>后缀，即<code>t_o_</code></li><li>结果表添加<code>-r</code>后续，即<code>t_r_</code></li><li>表名、字段名默认使用下划线方式命名，不区分大小写</li><li>数据库编码字符集为<code>utf8mb4</code></li><li>记录ID用<code>unsigned bigint</code></li><li>如果字段名有关键字，需要加<code>_c</code>前缀</li><li>所有表中必须有<code>update_time</code> 和<code>create_time</code>字段</li></ul><h3 id="_5-3-1-2-数据库表" tabindex="-1"><a class="header-anchor" href="#_5-3-1-2-数据库表"><span>5.3.1.2 数据库表</span></a></h3><p>t_o_project 项目名</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>display_name</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;项目名称&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_name</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;项目代号(替代项目id, 方便debug)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>c_desc</code> varchar(100) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;备注信息&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>rate</code> int(10) NOT NULL DEFAULT &#39;10000&#39; COMMENT &#39;数据抽样比率&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>is_delete</code> tinyint(1) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;是否已删除(1 =&gt; 是, 0 =&gt; 否)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;创建人ucid&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;更新人ucid&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_behavior_distribution</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>code</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;用户行为标识&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>name</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;用户点击名称&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>url</code> varchar(200) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;用户点击页面&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;点击总量&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(30) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计日期,格式根据统计尺度不同有三种可能, hour =&gt; YYYY-MM-DD_HH, day =&gt; YYYY-MM-DD, month =&gt; YYYY-MM&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(20) NOT NULL DEFAULT &#39;day&#39; COMMENT &#39;统计尺度(hour/day/month)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布详情记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_duration_distribution 用户停留时间表</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_stay_ms</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;总停留毫秒数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_uv</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;总uv数(从uv表中获取)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(30) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计日期,格式根据统计尺度不同有两种可能, day =&gt; YYYY-MM-DD, month =&gt; YYYY-MM&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(20) NOT NULL DEFAULT &#39;day&#39; COMMENT &#39;统计尺度(day/month)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布详情记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_http_error_distribution</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;http响应码总数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>http_code_2xx_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;http响应码2xx总数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>http_code_3xx_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;http响应码3xx总数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>http_code_4xx_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;http响应码4xx总数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>http_code_5xx_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;http响应码5xx总数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>http_code_other_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;其他http响应码总数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布详情记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(30) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计日期,格式根据统计尺度不同有三种可能, hour =&gt; YYYY-MM-DD_HH, day =&gt; YYYY-MM-DD, month =&gt; YYYY-MM&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(20) NOT NULL DEFAULT &#39;hour&#39; COMMENT &#39;统计尺度(hour/day/month)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_page_view</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;pv数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(30) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计日期,格式根据统计尺度不同有三种可能, hour =&gt; YYYY-MM-DD_HH, day =&gt; YYYY-MM-DD, month =&gt; YYYY-MM&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(20) NOT NULL DEFAULT &#39;hour&#39; COMMENT &#39;统计尺度(hour/day/month)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_system_browser</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>browser</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;浏览器品牌&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>browser_version</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;浏览器详情&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数量总和&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_month</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计时间段, YYYY-MM格式 =&gt; 2018-09&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_system_runtime_version</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>runtime_version</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;应用版本号&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数量总和&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_month</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计时间段, YYYY-MM格式 =&gt; 2018-09&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_system_device</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>device_vendor</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;设备制造商&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>device_model</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;设备详情&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数量总和&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_month</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计时间段, YYYY-MM格式 =&gt; 2018-09&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_system_os</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>os</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;操作系统名&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>os_version</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;操作系统版本&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数量总和&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_month</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计时间段, YYYY-MM格式 =&gt; 2018-09&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_unique_view</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;uv数&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(30) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计日期,格式根据统计尺度不同有三种可能, hour =&gt; YYYY-MM-DD_HH, day =&gt; YYYY-MM-DD, month =&gt; YYYY-MM&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(20) NOT NULL DEFAULT &#39;hour&#39; COMMENT &#39;统计尺度(hour/day/month)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_alarm_config</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;要报警项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>owner_ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;项目所有人id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_type</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;报警错误类型&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_name</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;要报警错误名字&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>time_range_s</code> int(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;报警时间范围_秒&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>max_error_count</code> int(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;报警错误数阈值&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>alarm_interval_s</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;报警时间间隔_秒&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>is_enable</code> tinyint(1) unsigned NOT NULL DEFAULT &#39;1&#39; COMMENT &#39;是否开启本条报警配置1：是0：否&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>note</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;配置说明&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>is_delete</code> tinyint(1) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;是否删除(1 =&gt; 是, 0 =&gt; 否)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;创建此记录的人&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;更新此记录的人&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建此记录的时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;更新此记录的时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_user</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>ucid</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;贝壳ucid&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>account</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;账户名,不能重复&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>email</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;邮箱&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>password_md5</code> varchar(32) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;md5后的password&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>nickname</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;昵称&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>role</code> varchar(50) NOT NULL DEFAULT &#39;dev&#39; COMMENT &#39;角色(dev =&gt; 开发者,admin =&gt; 管理员)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>register_type</code> varchar(20) NOT NULL DEFAULT &#39;site&#39; COMMENT &#39;注册类型(site =&gt; 网站注册, third =&gt; 第三方登录)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>avatar_url</code> varchar(200) NOT NULL DEFAULT &#39;<a href="http://ww1.sinaimg.cn/large/00749HCsly1fwofq2t1kaj30qn0qnaai.jpg&#39;" target="_blank" rel="noopener noreferrer">http://ww1.sinaimg.cn/large/00749HCsly1fwofq2t1kaj30qn0qnaai.jpg&#39;</a> COMMENT &#39;头像地址, 默认使用贝壳logo&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>mobile</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;手机号&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>is_delete</code> tinyint(1) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;是否删除(1 =&gt; 是, 0 =&gt; 否)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_project_member</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;项目参与者ucid&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>role</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;参与者角色(owner =&gt; 组长, dev =&gt; 成员)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>need_alarm</code> tinyint(1) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;是否需要报警(0 =&gt; 不需要, 1 =&gt; 需要)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>is_delete</code> tinyint(1) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;是否已删除(0 =&gt; 未删除, 1 =&gt; 已删除)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;创建者ucid&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;更新者ucid&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建此记录的时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;更新此记录的时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_new_user_summary</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>total_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数量总和&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计日期,格式根据统计尺度不同三两种可能, hour =&gt; YYYY-MM-DD_HH, day =&gt; YYYY-MM-DD, month =&gt; YYYY-MM&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(10) NOT NULL DEFAULT &#39;day&#39; COMMENT &#39;统计尺度(hour/day/month)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(10) NOT NULL DEFAULT 0 COMMENT &#39;城市分布详情记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_alarm_log</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>project_id</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;要报警项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>config_id</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;报警配置id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>send_at</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;报警时间戳&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_type</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;错误类型&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_name</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;错误名字&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>message</code> varchar(500) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;报警信息&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_monitor_1_202005</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_type</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;异常类型(目前是四种,分别对应前端的四种报错类型: api_data =&gt;前端数据结构报警, start_process =&gt; 启动过程异常, load_wv =&gt; Url加载空服务报警, api_code =&gt; 请求接口异常报警)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_name</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;错误名/错误代码,用于细分错误类别&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>http_code</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;http状态码, 没有则为0&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>monitor_ext_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;详情id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>during_ms</code> int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;接口请求时长, 单位毫秒&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>request_size_b</code> int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;接口请求体积, 单位b&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>response_size_b</code> int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;接口响应体积, 单位b&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>url</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;发生异常的url&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>country</code> varchar(10) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属国家&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>province</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属省份&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属城市&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>log_at</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;日志记录时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>md5</code> char(32) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;记录生成MD5&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_monitor_ext_1_202005</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>ext_json</code> text COMMENT &#39;异常记录扩展信息&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_uv_record_1_202005</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;项目id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>uuid</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;设备唯一标识&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>country</code> varchar(10) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属国家&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>province</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属省份&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属城市&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>visit_at_hour</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;访问日期, 数据格式为 YYYY-MM-DD_HH demo =&gt; 2018-08-02_23&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>pv_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;时间段内同一uuid访问次数, 用于计算总pv&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_city_distribution_1_202005</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_json</code> text COMMENT &#39;扩展字段&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_performance_1_202005</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>sum_indicator_value</code> bigInt(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;性能指标求和&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>pv</code> bigInt(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;性能指标pv数,用于计算平均时长&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>indicator</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;性能指标:DNS响应时间/TCP时间/404数量/etc&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>url</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;页面url&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribute_id</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布详情记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计日期,格式根据统计尺度不同有四种可能, minute =&gt; YYYY-MM-DD_HH:mm, hour =&gt; YYYY-MM-DD_HH, day =&gt; YYYY-MM-DD, month =&gt; YYYY-MM&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(10) NOT NULL DEFAULT &#39;minute&#39; COMMENT &#39;统计尺度(minute/hour/day/month)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_system_collection_1</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>uuid</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;设备唯一标识&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>browser</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;浏览器品牌&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>browser_version</code> varchar(100) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;浏览器版本详情&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>engine</code> varchar(100) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;内核名称&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>engine_version</code> varchar(100) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;内核版本详情&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>device_vendor</code> varchar(100) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;手机品牌&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>device_model</code> varchar(100) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;手机型号&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>os</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;操作系统&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>os_version</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;操作系统详情&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>country</code> varchar(10) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属国家&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>province</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属省份&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属城市&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>runtime_version</code> varchar(50) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;应用版本&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>visit_at_month</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;访问日期, 数据格式为 YYYY-MM demo =&gt; 2018-09&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>log_at</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;日志记录时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数据库更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_o_user_first_login_at_1</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>ucid</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;用户id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>first_visit_at</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;用户首次访问时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>country</code> varchar(10) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属国家&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>province</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属省份&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city</code> varchar(15) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;所属城市&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><p>t_r_error_summary_1_202005</p><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">备注</th></tr></thead><tbody><tr><td style="text-align:left;"><code>id</code> bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;记录id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_type</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;错误类型&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_name</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;错误名字&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>url_path</code> varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;错误URL_PATH&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>city_distribution_id</code> bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;城市分布详情id&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_at_time</code> varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;统计时间(按类型不同,day:YYYY-MM-DD;hour:YYYY-MM-DD_HH;minute:YYYY-MM-DD_HH:mm)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>count_type</code> varchar(10) NOT NULL DEFAULT &#39;day&#39; COMMENT &#39;统计类型(day天,hour小时,minute分)&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>error_count</code> int(10) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;数量总和&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>create_time</code> int(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建时间&#39;</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"><code>update_time</code> int(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;更新时间&#39;</td><td style="text-align:left;"></td></tr></tbody></table><h3 id="_5-3-2-指令" tabindex="-1"><a class="header-anchor" href="#_5-3-2-指令"><span>5.3.2 指令</span></a></h3><h4 id="_5-3-2-1-指令帮助" tabindex="-1"><a class="header-anchor" href="#_5-3-2-1-指令帮助"><span>5.3.2.1 指令帮助</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js <span class="token operator">-</span>h</span>
<span class="line"><span class="token literal-property property">Usage</span><span class="token operator">:</span></span>
<span class="line">  command <span class="token punctuation">[</span>arguments<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">Global Options<span class="token operator">:</span></span>
<span class="line">  <span class="token operator">--</span>env                            Set <span class="token constant">NODE_ENV</span> before running the commands</span>
<span class="line">  <span class="token operator">--</span>no<span class="token operator">-</span>ansi                        Disable colored output</span>
<span class="line"></span>
<span class="line">Available Commands<span class="token operator">:</span></span>
<span class="line"> Command</span>
<span class="line">  <span class="token literal-property property">Command</span><span class="token operator">:</span>Demo                     解析nginx日志<span class="token punctuation">,</span> 分析pv</span>
<span class="line"> CreateCache</span>
<span class="line">  <span class="token literal-property property">CreateCache</span><span class="token operator">:</span>UpdatePerOneMinute   <span class="token punctuation">[</span>每<span class="token number">10</span>分钟执行一次<span class="token punctuation">]</span> 主动调用方法<span class="token punctuation">,</span> 更新Redis缓存<span class="token punctuation">,</span> 每<span class="token number">10</span>分钟更新一次</span>
<span class="line"> Parse</span>
<span class="line">  <span class="token literal-property property">Parse</span><span class="token operator">:</span>Device                     <span class="token punctuation">[</span>按天<span class="token punctuation">]</span> 解析nginx日志<span class="token punctuation">,</span> 分析指定时间范围Device</span>
<span class="line">  <span class="token literal-property property">Parse</span><span class="token operator">:</span>MenuClick                  <span class="token punctuation">[</span>按天<span class="token punctuation">]</span> 解析nginx日志<span class="token punctuation">,</span> 用户点击情况</span>
<span class="line">  <span class="token literal-property property">Parse</span><span class="token operator">:</span>Monitor                    <span class="token punctuation">[</span>按分钟<span class="token punctuation">]</span> 解析nginx日志<span class="token punctuation">,</span> 分析Monitor</span>
<span class="line">  <span class="token literal-property property">Parse</span><span class="token operator">:</span>Performance                <span class="token punctuation">[</span>按小时<span class="token punctuation">]</span> 解析nginx日志<span class="token punctuation">,</span> 分析分钟级别的指定时间范围内的性能指标</span>
<span class="line">  <span class="token literal-property property">Parse</span><span class="token operator">:</span>TimeOnSiteByHour           <span class="token punctuation">[</span>按小时<span class="token punctuation">]</span> 解析nginx日志<span class="token punctuation">,</span> 分析记录指定时间范围内用户停留时长</span>
<span class="line">  <span class="token literal-property property">Parse</span><span class="token operator">:</span><span class="token constant">UV</span>                         <span class="token punctuation">[</span>按小时<span class="token punctuation">]</span> 解析nginx日志<span class="token punctuation">,</span> 分析记录指定时间范围内的uv</span>
<span class="line">  <span class="token literal-property property">Parse</span><span class="token operator">:</span>UserFirstLoginAt           <span class="token punctuation">[</span>按天<span class="token punctuation">]</span> 解析nginx日志<span class="token punctuation">,</span> 记录用户首次登陆时间</span>
<span class="line"> SaveLog</span>
<span class="line">  <span class="token literal-property property">SaveLog</span><span class="token operator">:</span>Nginx                    每一分钟读取Nginx日志文件，并解析</span>
<span class="line"> Summary</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>Error                    <span class="token punctuation">[</span>按分钟<span class="token operator">/</span>按小时<span class="token operator">/</span>按天<span class="token punctuation">]</span> 根据历史数据<span class="token punctuation">,</span> 汇总分析错误数</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>HttpError                <span class="token punctuation">[</span>按天<span class="token operator">/</span>按月<span class="token punctuation">]</span> 基于数据表做统计<span class="token punctuation">,</span> 统计http error分布情况</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>NewUser                  <span class="token punctuation">[</span>按小时<span class="token operator">/</span>按天<span class="token operator">/</span>按月<span class="token punctuation">]</span> 根据历史数据<span class="token punctuation">,</span> 汇总分析记录指定时间范围内的新增用户数</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>Performance              <span class="token punctuation">[</span>按小时<span class="token operator">/</span>按天<span class="token operator">/</span>按月<span class="token punctuation">]</span> 根据历史数据<span class="token punctuation">,</span> 汇总分析记录指定时间范围内的性能指标数据</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>SystemBrowser            <span class="token punctuation">[</span>按月<span class="token punctuation">]</span> 基于数据库统计浏览器占比</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>SystemDevice             <span class="token punctuation">[</span>按月<span class="token punctuation">]</span> 基于数据库统计设备占比</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>SystemOS                 <span class="token punctuation">[</span>按月<span class="token punctuation">]</span>基于数据库统计操作系统占比</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>SystemRuntimeVersion     <span class="token punctuation">[</span>按月<span class="token punctuation">]</span> 基于数据库统计浏览器占比</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span>TimeOnSite               <span class="token punctuation">[</span>按天<span class="token operator">/</span>按月<span class="token punctuation">]</span> 根据历史数据<span class="token punctuation">,</span> 汇总分析记录指定时间范围内用户停留时长</span>
<span class="line">  <span class="token literal-property property">Summary</span><span class="token operator">:</span><span class="token constant">UV</span>                       <span class="token punctuation">[</span>按小时<span class="token operator">/</span>按天<span class="token operator">/</span>按月<span class="token punctuation">]</span> 根据历史数据<span class="token punctuation">,</span> 汇总分析记录指定时间范围内的uv</span>
<span class="line"> Task</span>
<span class="line">  <span class="token literal-property property">Task</span><span class="token operator">:</span>Manager                     任务调度主进程<span class="token punctuation">,</span> 只能启动一次</span>
<span class="line"> Utils</span>
<span class="line">  <span class="token literal-property property">Utils</span><span class="token operator">:</span>CleanOldLog                只保留当前月内数据<span class="token punctuation">,</span> 每月<span class="token number">20</span>号之后自动删除上个月数据</span>
<span class="line">  <span class="token literal-property property">Utils</span><span class="token operator">:</span>GenerateSQL                生成项目在指定日期范围内的建表<span class="token constant">SQL</span></span>
<span class="line">  <span class="token literal-property property">Utils</span><span class="token operator">:</span>TemplateSQL                生成项目在指定日期范围内的建表<span class="token constant">SQL</span></span>
<span class="line">  <span class="token literal-property property">Utils</span><span class="token operator">:</span>Test                       专业粘贴调试代码</span>
<span class="line">  <span class="token literal-property property">Utils</span><span class="token operator">:</span>TestUC                     测试<span class="token constant">UC</span>接口</span>
<span class="line"> WatchDog</span>
<span class="line">  <span class="token literal-property property">WatchDog</span><span class="token operator">:</span>Alarm                   <span class="token punctuation">[</span>根据报警配置<span class="token punctuation">]</span> 监测每一条报警配置对应的项目错误</span>
<span class="line">  <span class="token literal-property property">WatchDog</span><span class="token operator">:</span>Saas                    <span class="token punctuation">[</span>按分钟<span class="token punctuation">]</span> 检查最近<span class="token number">5</span>分钟内错误数是否超出阈值<span class="token punctuation">,</span> 自动报警</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-2-初始化数据库" tabindex="-1"><a class="header-anchor" href="#_5-3-2-2-初始化数据库"><span>5.3.2.2 初始化数据库</span></a></h4><ul><li>创建<code>platform</code>数据库</li><li><code>npm run watch</code></li><li><code>node dist/fee.js Utils:GenerateSQL 1 &#39;2020-06&#39; &#39;2020-06&#39; &gt; init.sql</code></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//id, 抽样比率, 项目名(展示), 项目id, 负责人信息</span></span>
<span class="line"><span class="token constant">REPLACE</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">t_o_project</span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">rate</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">display_name</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">project_name</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">c_desc</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">is_delete</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">create_ucid</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">update_ucid</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">create_time</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">update_time</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&#39;示例项目&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;template&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;负责人&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-3-savelog-nginx" tabindex="-1"><a class="header-anchor" href="#_5-3-2-3-savelog-nginx"><span>5.3.2.3 SaveLog:Nginx</span></a></h4><ul><li>每一分钟读取Nginx日志文件，并解析</li></ul><p>server\\src\\library\\nginx\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> logPath <span class="token operator">=</span> appConfig<span class="token punctuation">.</span>absoluteLogPath</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>server\\src\\configs\\app.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> development <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;fee监控平台开发环境&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">absoluteLogPath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../../&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;log&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">node dist/fee.js SaveLog:Nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">收到数据<span class="token punctuation">,</span> 当前共记录<span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>条数据</span>
<span class="line">清洗后的日志路径 <span class="token constant">C</span><span class="token operator">:</span>\\afirst\\monitor\\server\\log\\nginx\\raw\\month_202006\\day_13\\<span class="token number">16</span>\\<span class="token number">14</span><span class="token punctuation">.</span>log</span>
<span class="line"></span>
<span class="line">清洗后的日志路径 <span class="token constant">C</span><span class="token operator">:</span>\\afirst\\monitor\\server\\log\\nginx\\json\\month_202006\\day_13\\<span class="token number">16</span>\\<span class="token number">14</span><span class="token punctuation">.</span>log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;perf&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">20001</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;connectStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791666</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;navigationStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791361</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;loadEventEnd&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;domLoading&quot;</span><span class="token operator">:</span> <span class="token number">1592036791677</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;secureConnectionStart&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;fetchStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791362</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;domContentLoadedEventStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791976</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;responseStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791669</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;responseEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592036791670</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;domInteractive&quot;</span><span class="token operator">:</span> <span class="token number">1592036791976</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;domainLookupEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592036791365</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;redirectStart&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;requestStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791667</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;unloadEventEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592036791674</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;unloadEventStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791674</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;domComplete&quot;</span><span class="token operator">:</span> <span class="token number">1592036791976</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;domainLookupStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791365</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;loadEventStart&quot;</span><span class="token operator">:</span> <span class="token number">1592036791976</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;domContentLoadedEventEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592036791976</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;redirectEnd&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;connectEnd&quot;</span><span class="token operator">:</span> <span class="token number">1592036791667</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;common&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;template&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;uuid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uuid2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;ucid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ucid&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;is_test&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;record&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;time_on_page&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;performance&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;js_error&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;js_error_report_config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_RUNTIME&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_SCRIPT&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_STYLE&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_IMAGE&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_AUDIO&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_VIDEO&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_CONSOLE&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string-property property">&quot;ERROR_TRY_CATCH&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b47ca710747e96f1c523ebab8022c19e9abaa56b&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">1592036791977</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;runtime_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;sdk_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.40&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;page_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:9000/&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;md5&quot;</span><span class="token operator">:</span> <span class="token string">&quot;382eecc357bb7c6629e139eb7eb6509e&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;project_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;project_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;template&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">1592036792</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ua&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;ua&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mobile Safari&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;13.0.3&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;major&quot;</span><span class="token operator">:</span> <span class="token string">&quot;13&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;engine&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WebKit&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;605.1.15&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;os&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;iOS&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;13.2.3&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;device&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;vendor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mobile&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;cpu&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;59.109.146.215&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;country&quot;</span><span class="token operator">:</span> <span class="token string">&quot;中国&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;province&quot;</span><span class="token operator">:</span> <span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;北京&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-4-parse-performance" tabindex="-1"><a class="header-anchor" href="#_5-3-2-4-parse-performance"><span>5.3.2.4 Parse:Performance</span></a></h4><ul><li>[按小时] 解析nginx日志, 分析分钟级别的指定时间范围内的性能指标</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Parse<span class="token operator">:</span>Performance <span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">13_16</span><span class="token operator">:</span><span class="token number">26</span>  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">13_16</span><span class="token operator">:</span><span class="token number">26</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span>项目<span class="token constant">ID</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span>指标<span class="token punctuation">,</span>汇总的时间<span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span>国家<span class="token punctuation">,</span>省<span class="token punctuation">,</span>市<span class="token punctuation">]</span><span class="token punctuation">,</span>value：<span class="token punctuation">{</span><span class="token literal-property property">指标和</span><span class="token operator">:</span><span class="token number">614</span><span class="token punctuation">,</span><span class="token literal-property property">pv和</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;localhost:9000/&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tcp_connect_ms&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2020-06-13_16:26&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span><span class="token string">&quot;中国&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>value：<span class="token punctuation">{</span><span class="token string-property property">&quot;sum_indicator_value&quot;</span><span class="token operator">:</span><span class="token number">614</span><span class="token punctuation">,</span><span class="token string-property property">&quot;pv&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-5-summary-performance" tabindex="-1"><a class="header-anchor" href="#_5-3-2-5-summary-performance"><span>5.3.2.5 Summary:Performance</span></a></h4><ul><li>[按小时/按天/按月] 根据历史数据, 汇总分析记录指定时间范围内的性能指标数据</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>Performance <span class="token string">&quot;2020-06-13 16&quot;</span> hour</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>Performance <span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">13</span> day</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>Performance <span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span> month</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-5-parse-timeonsitebyhour" tabindex="-1"><a class="header-anchor" href="#_5-3-2-5-parse-timeonsitebyhour"><span>5.3.2.5 Parse:TimeOnSiteByHour</span></a></h4><ul><li>[按小时] 解析nginx日志, 分析记录指定时间范围内用户停留时长</li><li>t_r_city_distribution_1_202006</li><li>t_r_duration_distribution</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js SaveLog<span class="token operator">:</span>Nginx</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Parse<span class="token operator">:</span>TimeOnSiteByHour <span class="token string">&quot;2020-06-13 22:30&quot;</span>  <span class="token string">&quot;2020-06-13 22:30&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-6-summary-timeonsite" tabindex="-1"><a class="header-anchor" href="#_5-3-2-6-summary-timeonsite"><span>5.3.2.6 Summary:TimeOnSite</span></a></h4><ul><li>[按小时] 解析nginx日志, 分析记录指定时间范围内用户停留时长</li><li>t_r_duration_distribution</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>TimeOnSite <span class="token string">&quot;2020-06 13&quot;</span>  day</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>TimeOnSite <span class="token string">&quot;2020-06&quot;</span>  month</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-7-parse-monitor" tabindex="-1"><a class="header-anchor" href="#_5-3-2-7-parse-monitor"><span>5.3.2.7 Parse:Monitor</span></a></h4><ul><li>[按分钟] 解析nginx日志, 分析Monitor</li><li>t_o_monitor_1_202006</li><li>t_o_monitor_ext_1_202006</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Parse<span class="token operator">:</span>Monitor <span class="token string">&quot;2020-06-13 22:35&quot;</span>  <span class="token string">&quot;2020-06-13 22:35&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_5-3-2-8-summary-error" tabindex="-1"><a class="header-anchor" href="#_5-3-2-8-summary-error"><span>5.3.2.8 Summary:Error</span></a></h4><ul><li>[按分钟/按小时/按天] 根据历史数据, 汇总分析错误数</li><li>t_r_error_summary_1_202006<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>Error <span class="token string">&quot;2020-06-13 22:35&quot;</span>  minute</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>Error <span class="token string">&quot;2020-06-13 22&quot;</span> hour</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>Error <span class="token string">&quot;2020-06-13&quot;</span> day</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_5-3-2-9-parse-device" tabindex="-1"><a class="header-anchor" href="#_5-3-2-9-parse-device"><span>5.3.2.9 Parse:Device</span></a></h4><ul><li>[按天] 解析nginx日志, 分析指定时间范围Device</li><li>t_o_system_collection_1</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Parse<span class="token operator">:</span>Device <span class="token string">&quot;2020-06-13 22:58&quot;</span>  <span class="token string">&quot;2020-06-13 22:58&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">projectMap<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;2020-06&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;uuid&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;browser&quot;</span><span class="token operator">:</span><span class="token string">&quot;Mobile Safari&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-10-summary" tabindex="-1"><a class="header-anchor" href="#_5-3-2-10-summary"><span>5.3.2.10 Summary</span></a></h4><ul><li><p>Summary:SystemBrowser [按月] 基于数据库统计浏览器占比</p></li><li><p>Summary:SystemDevice [按月] 基于数据库统计设备占比</p></li><li><p>Summary:SystemOS [按月]基于数据库统计操作系统占比</p></li><li><p>Summary:SystemRuntimeVersion [按月] 基于数据库统计浏览器占比</p></li><li><p>t_r_system_browser</p></li><li><p>t_r_system_device</p></li><li><p>t_r_system_os</p></li><li><p>t_r_system_runtime_version</p></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>SystemBrowser <span class="token string">&quot;2020-06&quot;</span>  month</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>SystemDevice <span class="token string">&quot;2020-06&quot;</span>  month</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>SystemOS <span class="token string">&quot;2020-06&quot;</span>  month</span>
<span class="line">node dist<span class="token operator">/</span>fee<span class="token punctuation">.</span>js Summary<span class="token operator">:</span>SystemRuntimeVersion <span class="token string">&quot;2020-06&quot;</span>  month</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-计划任务" tabindex="-1"><a class="header-anchor" href="#_6-计划任务"><span>6.计划任务</span></a></h2><ul><li>server\\src\\commands\\task\\manage.js</li></ul><h3 id="_6-1-任务执行周期" tabindex="-1"><a class="header-anchor" href="#_6-1-任务执行周期"><span>6.1 任务执行周期</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token number">1.</span>  <span class="token function">每分钟一次</span><span class="token punctuation">(</span>准实时<span class="token punctuation">)</span></span>
<span class="line">    <span class="token number">1.</span>  原始数据入库</span>
<span class="line">        <span class="token number">1.</span>  <span class="token function">错误数据入库</span><span class="token punctuation">(</span>延迟<span class="token number">2</span>分钟<span class="token punctuation">)</span></span>
<span class="line">    <span class="token number">2.</span>  按分钟统计</span>
<span class="line">        <span class="token number">1.</span>  <span class="token function">错误数据统计</span><span class="token punctuation">(</span>延迟<span class="token number">2</span>分钟<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2.</span>  每<span class="token number">10</span>分钟一次</span>
<span class="line">    <span class="token number">1.</span>  原始数据入库</span>
<span class="line">        <span class="token number">1.</span>  uv</span>
<span class="line">        <span class="token number">2.</span>  页面性能指标</span>
<span class="line">        <span class="token number">3.</span>  用户停留时长</span>
<span class="line">    <span class="token number">2.</span>  按小时统计</span>
<span class="line">        <span class="token number">1.</span>  uv</span>
<span class="line">        <span class="token number">2.</span>  新用户数</span>
<span class="line">        <span class="token number">3.</span>  页面性能指标</span>
<span class="line">        <span class="token number">4.</span>  错误数据统计</span>
<span class="line"><span class="token number">3.</span>  每小时一次</span>
<span class="line">    <span class="token number">1.</span>  原始数据入库</span>
<span class="line">        <span class="token number">1.</span>  设备数据</span>
<span class="line">        <span class="token number">2.</span>  用户点击</span>
<span class="line">        <span class="token number">3.</span>  首次登陆用户</span>
<span class="line">    <span class="token number">2.</span>  <span class="token function">按天统计</span><span class="token punctuation">(</span>当天<span class="token punctuation">)</span></span>
<span class="line">        <span class="token number">1.</span>  uv</span>
<span class="line">        <span class="token number">2.</span>  新用户数</span>
<span class="line">        <span class="token number">3.</span>  页面性能指标</span>
<span class="line">        <span class="token number">4.</span>  错误数据统计</span>
<span class="line">        <span class="token number">5.</span>  用户停留时长</span>
<span class="line"><span class="token number">4.</span>  每六小时一次</span>
<span class="line">    <span class="token number">1.</span>  <span class="token function">按天统计</span><span class="token punctuation">(</span>昨日<span class="token punctuation">)</span></span>
<span class="line">        <span class="token number">1.</span>  uv</span>
<span class="line">        <span class="token number">2.</span>  新用户数</span>
<span class="line">        <span class="token number">3.</span>  页面性能指标</span>
<span class="line">        <span class="token number">4.</span>  错误数据统计</span>
<span class="line">        <span class="token number">5.</span>  用户停留时长</span>
<span class="line">    <span class="token number">2.</span>  按月统计</span>
<span class="line">        <span class="token number">1.</span>  uv</span>
<span class="line">        <span class="token number">2.</span>  新用户数</span>
<span class="line">        <span class="token number">3.</span>  页面性能指标</span>
<span class="line">        <span class="token number">4.</span>  错误数据统计</span>
<span class="line">        <span class="token number">5.</span>  用户停留时长</span>
<span class="line">        <span class="token number">6.</span>  操作系统分布</span>
<span class="line">        <span class="token number">7.</span>  设备分布</span>
<span class="line">        <span class="token number">8.</span>  浏览器分布</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-执行任务" tabindex="-1"><a class="header-anchor" href="#_6-2-执行任务"><span>6.2 执行任务</span></a></h3><ul><li><a href="https://cron.qqe2.com/" target="_blank" rel="noopener noreferrer">cron</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">node dist/fee.js Task:saveLog</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token function">handle</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span></span>
<span class="line">    schedule<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span><span class="token string">&#39;0 */1 * * * * *&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      that<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;registerTaskRepeatPer1Minute 开始执行&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      that<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;SaveLog:Nginx&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">*</span>  <span class="token operator">*</span>  <span class="token operator">*</span>  <span class="token operator">*</span>  <span class="token operator">*</span>  <span class="token operator">*</span></span>
<span class="line">┬ ┬ ┬ ┬ ┬ ┬</span>
<span class="line">│ │ │ │ │  <span class="token operator">|</span></span>
<span class="line">│ │ │ │ │ └ day <span class="token keyword">of</span> <span class="token function">week</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span> or <span class="token number">7</span> is Sun<span class="token punctuation">)</span></span>
<span class="line">│ │ │ │ └───── <span class="token function">month</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">12</span><span class="token punctuation">)</span></span>
<span class="line">│ │ │ └────────── day <span class="token keyword">of</span> <span class="token function">month</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">31</span><span class="token punctuation">)</span></span>
<span class="line">│ │ └─────────────── <span class="token function">hour</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">23</span><span class="token punctuation">)</span></span>
<span class="line">│ └──────────────────── <span class="token function">minute</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">59</span><span class="token punctuation">)</span></span>
<span class="line">└───────────────────────── <span class="token function">second</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token constant">OPTIONAL</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-前台展示" tabindex="-1"><a class="header-anchor" href="#_7-前台展示"><span>7.前台展示</span></a></h2><h3 id="_7-1-启动接口" tabindex="-1"><a class="header-anchor" href="#_7-1-启动接口"><span>7.1 启动接口</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">node dist/app.js</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>behavior<span class="token operator">/</span>menu</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>behavior<span class="token operator">/</span>online</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>os</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>browser<span class="token operator">/</span>list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>browser</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>browser<span class="token operator">/</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>runtimeVersion</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>error<span class="token operator">/</span>viser<span class="token operator">/</span>area<span class="token operator">/</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>error<span class="token operator">/</span>log<span class="token operator">/</span>list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>error<span class="token operator">/</span>distribution<span class="token operator">/</span>url</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>error<span class="token operator">/</span>distribution<span class="token operator">/</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>error<span class="token operator">/</span>distribution<span class="token operator">/</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>error<span class="token operator">/</span>distribution<span class="token operator">/</span></span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>log<span class="token operator">/</span>content<span class="token operator">/</span>test</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>config<span class="token operator">/</span>add</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>config<span class="token operator">/</span>query</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>config<span class="token operator">/</span>list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>config<span class="token operator">/</span><span class="token keyword">delete</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>config<span class="token operator">/</span>update</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>config<span class="token operator">/</span>error_name_list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>config<span class="token operator">/</span>error_type_list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>log</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>alarm<span class="token operator">/</span>log<span class="token operator">/</span>line</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>detail</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>search</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>update</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span><span class="token keyword">delete</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>search_uc</span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>register</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>modify<span class="token operator">/</span>password</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>modify<span class="token operator">/</span>msg</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>user<span class="token operator">/</span>destroy</span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>login<span class="token operator">/</span>site</span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>login<span class="token operator">/</span>uc</span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>logout</span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>login<span class="token operator">/</span>normal</span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>login<span class="token operator">/</span>type</span>
<span class="line"><span class="token function">不需要登录</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>login</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>item<span class="token operator">/</span>detail</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>item<span class="token operator">/</span>add</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>item<span class="token operator">/</span>list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>item<span class="token operator">/</span><span class="token keyword">delete</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">但不需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>item<span class="token operator">/</span>update</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>member<span class="token operator">/</span>add</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>member<span class="token operator">/</span>list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>member<span class="token operator">/</span><span class="token keyword">delete</span></span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> post</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>member<span class="token operator">/</span>update</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>summary<span class="token operator">/</span>new_user<span class="token operator">/</span>distribution_line</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>project<span class="token operator">/</span>summary<span class="token operator">/</span>new_user<span class="token operator">/</span>distribution_map</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>performance<span class="token operator">/</span>url_list</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>performance<span class="token operator">/</span>url<span class="token operator">/</span>overview</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>performance<span class="token operator">/</span>project<span class="token operator">/</span>overview</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>performance<span class="token operator">/</span>url<span class="token operator">/</span>line_chart</span>
<span class="line">需要登录<span class="token punctuation">,</span><span class="token function">也需要检验项目权限</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Method</span><span class="token operator">:</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token operator">/</span>api<span class="token operator">/</span>uv<span class="token operator">/</span>count</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-启动前台" tabindex="-1"><a class="header-anchor" href="#_7-2-启动前台"><span>7.2 启动前台</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cd client</span>
<span class="line">cnpm i </span>
<span class="line">npm run start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-前端应用" tabindex="-1"><a class="header-anchor" href="#_7-3-前端应用"><span>7.3 前端应用</span></a></h3><p>client\\src\\router\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token constant">LOGIN_PAGE_NAME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 未登录且要跳转的页面不是登录页</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token constant">LOGIN_PAGE_NAME</span> <span class="token comment">// 跳转到登录页</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server\\src\\routes\\api\\user\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> register <span class="token operator">=</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token function">routerConfigBuilder</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user/register&#39;</span><span class="token punctuation">,</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token constant">METHOD_TYPE_POST</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> body <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;body&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server\\src\\model\\project\\user.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">register</span> <span class="token punctuation">(</span><span class="token parameter">account<span class="token punctuation">,</span> userInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> tableName <span class="token operator">=</span> <span class="token function">getTableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// t_o_user</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-页面性能" tabindex="-1"><a class="header-anchor" href="#_7-4-页面性能"><span>7.4 页面性能</span></a></h3><p><a href="http://localhost:8080/project/1/monitor/performance" target="_blank" rel="noopener noreferrer">http://localhost:8080/project/1/monitor/performance</a></p><h4 id="_7-4-1-urllist" tabindex="-1"><a class="header-anchor" href="#_7-4-1-urllist"><span>7.4.1 urlList</span></a></h4><ul><li>用来提供某时间范围内的URL性能列表，因为在查看性能指标的时候会按页面的URL来进行，所以在页面的初始阶段会提供一个接口函数来获取 这些性能指标对应的URL列表</li></ul><p>client\\src\\view\\performance\\index.vue</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">    <span class="token keyword">async</span> <span class="token function">getUrlList</span> <span class="token punctuation">(</span><span class="token parameter">params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token punctuation">{</span></span>
<span class="line">        st<span class="token punctuation">,</span></span>
<span class="line">        et<span class="token punctuation">,</span></span>
<span class="line">        summaryBy</span>
<span class="line">      <span class="token punctuation">}</span> <span class="token operator">=</span> params</span>
<span class="line">      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUrlList</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">st</span><span class="token operator">:</span> st <span class="token operator">||</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>dateRange<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">et</span><span class="token operator">:</span> et <span class="token operator">||</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>dateRange<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">summaryBy</span><span class="token operator">:</span> summaryBy <span class="token operator">||</span> <span class="token string">&#39;minute&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>urlData <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> item</span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;urlData&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTimeDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTimeLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>urlColumns<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>urlLoading <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>client\\src\\api\\performance\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchUrlList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">project/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">getProjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api/performance/url_list</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token operator">...</span>params</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">Request <span class="token constant">URL</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3000</span><span class="token operator">/</span>project<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>api<span class="token operator">/</span>performance<span class="token operator">/</span>url_list<span class="token operator">?</span>st<span class="token operator">=</span><span class="token number">1591977600000</span><span class="token operator">&amp;</span>et<span class="token operator">=</span><span class="token number">1592051809707</span><span class="token operator">&amp;</span>summaryBy<span class="token operator">=</span>minute</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>server\\src\\routes\\api\\performance\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> urlList <span class="token operator">=</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token function">routerConfigBuilder</span><span class="token punctuation">(</span><span class="token string">&#39;/api/performance/url_list&#39;</span><span class="token punctuation">,</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token constant">METHOD_TYPE_GET</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> projectId <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;fee&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;project&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;projectId&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;projectId &#39;</span><span class="token punctuation">,</span>projectId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> request <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// 获取开始&amp;结束时间</span></span>
<span class="line">  <span class="token keyword">let</span> startAt <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;st&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">let</span> endAt <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;et&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> summaryBy <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;summaryBy&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">DATE_FORMAT</span><span class="token punctuation">.</span><span class="token constant">UNIT</span><span class="token punctuation">.</span><span class="token constant">DAY</span><span class="token punctuation">,</span> <span class="token constant">DATE_FORMAT</span><span class="token punctuation">.</span><span class="token constant">UNIT</span><span class="token punctuation">.</span><span class="token constant">HOUR</span><span class="token punctuation">,</span> <span class="token constant">DATE_FORMAT</span><span class="token punctuation">.</span><span class="token constant">UNIT</span><span class="token punctuation">.</span><span class="token constant">MINUTE</span><span class="token punctuation">]</span><span class="token punctuation">,</span> summaryBy<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">API_RES</span><span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">summaryBy参数不正确</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> currentStamp <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>startAt<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    startAt <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>startAt <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    startAt <span class="token operator">=</span> currentStamp</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>endAt<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    endAt <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>endAt <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    endAt <span class="token operator">=</span> currentStamp</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">let</span> urlList <span class="token operator">=</span> <span class="token keyword">await</span> MPerformance<span class="token punctuation">.</span><span class="token function">getDistinctUrlListInRange</span><span class="token punctuation">(</span>projectId<span class="token punctuation">,</span> MPerformance<span class="token punctuation">.</span><span class="token constant">INDICATOR_TYPE_LIST</span><span class="token punctuation">,</span> startAt<span class="token punctuation">,</span> endAt<span class="token punctuation">,</span> summaryBy<span class="token punctuation">)</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">API_RES</span><span class="token punctuation">.</span><span class="token function">showResult</span><span class="token punctuation">(</span>urlList<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server\\src\\model\\parse\\performance.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getDistinctUrlListInRange</span> <span class="token punctuation">(</span><span class="token parameter">projectId<span class="token punctuation">,</span> indicatorList<span class="token punctuation">,</span> startAt<span class="token punctuation">,</span> endAt<span class="token punctuation">,</span> countType <span class="token operator">=</span> <span class="token constant">DATE_FORMAT</span><span class="token punctuation">.</span><span class="token constant">UNIT</span><span class="token punctuation">.</span><span class="token constant">MINUTE</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> tableName <span class="token keyword">of</span> tableNameList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;tableName,countType,indicatorList,countAtTimeList&#39;</span><span class="token punctuation">,</span>tableName<span class="token punctuation">,</span>countType<span class="token punctuation">,</span>indicatorList<span class="token punctuation">,</span>countAtTimeList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> rawRecordList <span class="token operator">=</span> <span class="token keyword">await</span> Knex</span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">count_type</span><span class="token operator">:</span> countType</span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token string">&#39;indicator&#39;</span><span class="token punctuation">,</span> indicatorList<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token string">&#39;count_at_time&#39;</span><span class="token punctuation">,</span> countAtTimeList<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        Logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;查询失败, 错误原因 =&gt;&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> rawRecord <span class="token keyword">of</span> rawRecordList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>rawRecord<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> url <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>rawRecord<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        urlList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// performance distinctUrlList[&quot;localhost:9000/&quot;]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-4-2-linechartdata" tabindex="-1"><a class="header-anchor" href="#_7-4-2-linechartdata"><span>7.4.2 lineChartData</span></a></h4><ul><li>在获取 URL之后，根据对应的时间参数提供参数时间范围内的提定URL下面的所有指标折线图</li></ul><p>client\\src\\view\\performance\\index.vue</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token function">getTimeDetail</span> <span class="token punctuation">(</span><span class="token parameter">params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token punctuation">{</span></span>
<span class="line">        st<span class="token punctuation">,</span></span>
<span class="line">        et<span class="token punctuation">,</span></span>
<span class="line">        url<span class="token punctuation">,</span></span>
<span class="line">        summaryBy</span>
<span class="line">      <span class="token punctuation">}</span> <span class="token operator">=</span> params</span>
<span class="line">      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchTimeDetail</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">st</span><span class="token operator">:</span> st <span class="token operator">||</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>dateRange<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">et</span><span class="token operator">:</span> et <span class="token operator">||</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>dateRange<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">url</span><span class="token operator">:</span> url <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">summaryBy</span><span class="token operator">:</span> summaryBy <span class="token operator">||</span> <span class="token string">&#39;hour&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">const</span> dv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSet<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span></span>
<span class="line">      dv<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;rename&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">dns_lookup_ms</span><span class="token operator">:</span> <span class="token string">&#39;DNS查询耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">response_request_ms</span><span class="token operator">:</span> <span class="token string">&#39;请求响应耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">dom_parse_ms</span><span class="token operator">:</span> <span class="token string">&#39;DOM解析耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">response_transfer_ms</span><span class="token operator">:</span> <span class="token string">&#39;内容传输耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">load_resource_ms</span><span class="token operator">:</span> <span class="token string">&#39;资源加载耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">dom_ready_ms</span><span class="token operator">:</span> <span class="token string">&#39;DOM_READY_耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">first_render_ms</span><span class="token operator">:</span> <span class="token string">&#39;首次渲染耗&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">first_response_ms</span><span class="token operator">:</span> <span class="token string">&#39;首次可交互耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">first_tcp_ms</span><span class="token operator">:</span> <span class="token string">&#39;首包时间耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">load_complete_ms</span><span class="token operator">:</span> <span class="token string">&#39;页面完全加载耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">ssl_connect_ms</span><span class="token operator">:</span> <span class="token string">&#39;SSL连接耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">tcp_connect_ms</span><span class="token operator">:</span> <span class="token string">&#39;TCP链接耗时&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      dv<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fold&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&#39;DNS查询耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;请求响应耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;DOM解析耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;内容传输耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;资源加载耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;DOM_READY_耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;首次渲染耗&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;首次可交互耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;首包时间耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;页面完全加载耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;SSL连接耗时&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&#39;TCP链接耗时&#39;</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;type&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;ms&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">const</span> data <span class="token operator">=</span> dv<span class="token punctuation">.</span>rows</span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>lineData <span class="token operator">=</span> data</span>
<span class="line">      <span class="token keyword">const</span> scale <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">&#39;ms&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">sync</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&#39;ms&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">formatter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value <span class="token operator">+</span> <span class="token string">&#39; ms&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">dataKey</span><span class="token operator">:</span> <span class="token string">&#39;index_timestamp_ms&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;time&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">tickCount</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">mask</span><span class="token operator">:</span> <span class="token string">&#39;MM-DD HH:mm&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>lineScale <span class="token operator">=</span> scale</span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lineData <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lineScale<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>isSpinShowDetail <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchTimeDetail</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">project/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">getProjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api/performance/url/line_chart</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token operator">...</span>params</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3000</span><span class="token operator">/</span>project<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>api<span class="token operator">/</span>performance<span class="token operator">/</span>url<span class="token operator">/</span>line_chart<span class="token operator">?</span>st<span class="token operator">=</span><span class="token number">1591977600000</span><span class="token operator">&amp;</span>et<span class="token operator">=</span><span class="token number">1592053122452</span><span class="token operator">&amp;</span>url<span class="token operator">=</span>localhost<span class="token operator">:</span><span class="token number">9000</span><span class="token operator">%</span>2F<span class="token operator">&amp;</span>summaryBy<span class="token operator">=</span>hour</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>server\\src\\routes\\api\\performance\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> lineChartData <span class="token operator">=</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token function">routerConfigBuilder</span><span class="token punctuation">(</span><span class="token string">&#39;/api/performance/url/line_chart&#39;</span><span class="token punctuation">,</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token constant">METHOD_TYPE_GET</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> projectId <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;fee&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;project&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;projectId&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">let</span> request <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">API_RES</span><span class="token punctuation">.</span><span class="token function">showResult</span><span class="token punctuation">(</span>resultList<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>server\\src\\model\\parse\\performance.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getDistinctUrlListInRange</span> <span class="token punctuation">(</span><span class="token parameter">projectId<span class="token punctuation">,</span> indicatorList<span class="token punctuation">,</span> startAt<span class="token punctuation">,</span> endAt<span class="token punctuation">,</span> countType <span class="token operator">=</span> <span class="token constant">DATE_FORMAT</span><span class="token punctuation">.</span><span class="token constant">UNIT</span><span class="token punctuation">.</span><span class="token constant">MINUTE</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-4-3-urloverview" tabindex="-1"><a class="header-anchor" href="#_7-4-3-urloverview"><span>7.4.3 urlOverview</span></a></h4><ul><li>在获取 URL之后，可以根据此接口提供的时间范围指定的URL的各项指标平均值</li></ul><p>client\\src\\view\\performance\\index.vue</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token function">getTimeLine</span> <span class="token punctuation">(</span><span class="token parameter">params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token punctuation">{</span>st<span class="token punctuation">,</span>et<span class="token punctuation">}</span> <span class="token operator">=</span> params</span>
<span class="line">      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchTimeLine</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">st</span><span class="token operator">:</span> st <span class="token operator">||</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>dateRange<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">et</span><span class="token operator">:</span> et <span class="token operator">||</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>dateRange<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">summaryBy</span><span class="token operator">:</span> <span class="token string">&#39;minute&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>client\\src\\api\\performance\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchTimeLine</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">project/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">getProjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api/performance/url/overview</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token operator">...</span>params</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3000</span><span class="token operator">/</span>project<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>api<span class="token operator">/</span>performance<span class="token operator">/</span>url<span class="token operator">/</span>overview<span class="token operator">?</span>st<span class="token operator">=</span><span class="token number">1591977600000</span><span class="token operator">&amp;</span>et<span class="token operator">=</span><span class="token number">1592054332424</span><span class="token operator">&amp;</span>url<span class="token operator">=</span>localhost<span class="token operator">:</span><span class="token number">9000</span><span class="token operator">%</span>2F<span class="token operator">&amp;</span>summaryBy<span class="token operator">=</span>minute</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>server\\src\\routes\\api\\performance\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> urlOverview <span class="token operator">=</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token function">routerConfigBuilder</span><span class="token punctuation">(</span><span class="token string">&#39;/api/performance/url/overview&#39;</span><span class="token punctuation">,</span> RouterConfigBuilder<span class="token punctuation">.</span><span class="token constant">METHOD_TYPE_GET</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> projectId <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;fee&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;project&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;projectId&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">let</span> request <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUrlOverviewInSameMonth</span> <span class="token punctuation">(</span><span class="token parameter">projectId<span class="token punctuation">,</span> urlList<span class="token punctuation">,</span> startAt<span class="token punctuation">,</span> endAt<span class="token punctuation">,</span> countType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><a href="https://gitee.com/zhufengpeixun/front-monitor" target="_blank" rel="noopener noreferrer">front-monitor</a></li><li><code>node dist/fee.js Utils:TemplateSQL</code></li></ul>`,211)])])}const i=n(p,[["render",o]]),r=JSON.parse('{"path":"/strong/101.2.monitor.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/101.2.monitor.md"}');export{i as comp,r as data};
