import{_ as s,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function i(l,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h2 id="_1-create-vite" tabindex="-1"><a class="header-anchor" href="#_1-create-vite"><span>1.create-vite</span></a></h2><h3 id="_1-1-create-vite简介" tabindex="-1"><a class="header-anchor" href="#_1-1-create-vite简介"><span>1.1 create-vite简介</span></a></h3><ul><li>[vite官网](https://cn.vitejs.dev/guide/</li><li><a href="https://www.npmjs.com/package/create-vite" target="_blank" rel="noopener noreferrer">create-vite包</a></li><li><a href="https://github.com/vitejs/vite/tree/main/packages/create-vite" target="_blank" rel="noopener noreferrer">create-vite源码</a></li></ul><h3 id="_1-2-使用" tabindex="-1"><a class="header-anchor" href="#_1-2-使用"><span>1.2 使用</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">npm init vite</span>
<span class="line">Need to install the following packages<span class="token operator">:</span></span>
<span class="line">  create<span class="token operator">-</span>vite</span>
<span class="line">Ok to proceed<span class="token operator">?</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span> y</span>
<span class="line">√ Project name<span class="token operator">:</span> <span class="token operator">...</span> vite<span class="token operator">-</span>project</span>
<span class="line">√ Select a framework<span class="token operator">:</span> » react</span>
<span class="line">√ Select a variant<span class="token operator">:</span> » react</span>
<span class="line"></span>
<span class="line">Scaffolding project <span class="token keyword">in</span> <span class="token constant">C</span><span class="token operator">:</span>\\aprepare\\t1\\vite<span class="token operator">-</span>project<span class="token operator">...</span></span>
<span class="line"></span>
<span class="line">Done<span class="token punctuation">.</span> Now run<span class="token operator">:</span></span>
<span class="line"></span>
<span class="line">  cd vite<span class="token operator">-</span>project</span>
<span class="line">  npm install</span>
<span class="line">  npm run dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-create-vite源码调试" tabindex="-1"><a class="header-anchor" href="#_1-3-create-vite源码调试"><span>1.3 create-vite源码调试</span></a></h3><ul><li><a href="https://www.npmjs.com/package/minimist" target="_blank" rel="noopener noreferrer">minimist</a>解析参数选项,类似的还有<a href="https://www.npmjs.com/package/yargs" target="_blank" rel="noopener noreferrer">yargs</a>和<a href="https://www.npmjs.com/package/commander" target="_blank" rel="noopener noreferrer">commander</a></li><li><a href="https://www.npmjs.com/package/kolorist" target="_blank" rel="noopener noreferrer">kolorist</a>在控制台打印颜色,类似的还有<a href="https://www.npmjs.com/package/chalk" target="_blank" rel="noopener noreferrer">chalk</a></li><li><a href="https://www.npmjs.com/package/prompts" target="_blank" rel="noopener noreferrer">prompts</a>交互式命令行，类似还有<a href="https://www.npmjs.com/package/inquirer" target="_blank" rel="noopener noreferrer">inquirer</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>vitejs<span class="token operator">/</span>vite<span class="token punctuation">.</span>git</span>
<span class="line">cd vite</span>
<span class="line">yarn install</span>
<span class="line">packages\\create<span class="token operator">-</span>vite\\index<span class="token punctuation">.</span>js</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>.vscode\\launch.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pwa-node&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch Program&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;skipFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token string">&quot;&lt;node_internals&gt;/**&quot;</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\${workspaceFolder}\\\\packages\\\\create-vite\\\\index.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;vite-project&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-create-vite功能" tabindex="-1"><a class="header-anchor" href="#_1-4-create-vite功能"><span>1.4 create-vite功能</span></a></h3><ul><li>[√] 支持参数解析</li><li>[√] 支持自定义项目名</li><li>[√] 支持空目录检查</li><li>[√] 支持静态项目模板</li><li>[×] 不支持lerna <a href="https://github.com/lerna/lerna" target="_blank" rel="noopener noreferrer">lerna</a></li><li>[×] 不支持文件异步写入 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持多进程执行命令 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持执行动态<code>node</code>命令 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持自动安装依赖 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持自动启动服务 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持参数配置 <a href="https://github.com/yarnpkg/yarn" target="_blank" rel="noopener noreferrer">yarn</a></li><li>[×] 不支持<code>gitub</code>和<code>gitee</code>仓库动态读取</li><li>[×] 不支持模板标签选择</li><li>[×] 不支持动态模板渲染</li><li>[×] 不支持插件化配置技术栈 <a href="https://github.com/vuejs/vue-cli" target="_blank" rel="noopener noreferrer">vue-cli</a></li></ul><h2 id="_2-初始化项目" tabindex="-1"><a class="header-anchor" href="#_2-初始化项目"><span>2.初始化项目</span></a></h2><h3 id="_2-1-lerna初始化" tabindex="-1"><a class="header-anchor" href="#_2-1-lerna初始化"><span>2.1 lerna初始化</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir vite100</span>
<span class="line">cd vite100</span>
<span class="line">lerna init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-使用yarn-workspace" tabindex="-1"><a class="header-anchor" href="#_2-2-使用yarn-workspace"><span>2.2 使用yarn workspace</span></a></h3><ul><li>开发多个互相依赖的package时，workspace会自动对package的引用设置软链接(symlink),比yarn link更加方便，且链接仅局限在当前workspace中，不会对整个系统造成影响</li><li>所有package的依赖会安装在根目录的<code>node_modules</code>下，节省磁盘空间，且给了yarn更大的依赖优化空间</li><li>Yarn workspace只会在根目录安装一个node_modules，这有利于提升依赖的安装效率和不同package间的版本复用。而Lerna默认会进到每一个package中运行yarn/npm install，并在每个package中创建一个node_modules</li><li>yarn官方推荐的方案，是集成yarn workspace和lerna,使用yarn workspace来管理依赖，使用lerna来管理npm包的版本发布</li></ul><h4 id="_2-2-1-lerna-json" tabindex="-1"><a class="header-anchor" href="#_2-2-1-lerna-json"><span>2.2.1 lerna.json</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;packages&quot;: [</span>
<span class="line">    &quot;packages/*&quot;</span>
<span class="line">  ],</span>
<span class="line">  &quot;version&quot;: &quot;0.0.0&quot;,</span>
<span class="line">+ &quot;npmClient&quot;: &quot;yarn&quot;,</span>
<span class="line">+ &quot;useWorkspaces&quot;: true</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-package-json" tabindex="-1"><a class="header-anchor" href="#_2-2-2-package-json"><span>2.2.2 package.json</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;name&quot;: &quot;root&quot;,</span>
<span class="line">  &quot;private&quot;: true,</span>
<span class="line">  &quot;devDependencies&quot;: {</span>
<span class="line">    &quot;lerna&quot;: &quot;^4.0.0&quot;</span>
<span class="line">  },</span>
<span class="line">+  &quot;workspaces&quot;: [</span>
<span class="line">+    &quot;packages/*&quot;</span>
<span class="line">+ ]  </span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-创建子包" tabindex="-1"><a class="header-anchor" href="#_2-3-创建子包"><span>2.3 创建子包</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">lerna create @vite100<span class="token operator">/</span>config <span class="token operator">-</span>y <span class="token comment">//配置项</span></span>
<span class="line">lerna create @vite100<span class="token operator">/</span>create <span class="token operator">-</span>y <span class="token comment">//创建项目</span></span>
<span class="line">lerna create vite100 <span class="token operator">-</span>y  <span class="token comment">//核心命令</span></span>
<span class="line">lerna create @vite100<span class="token operator">/</span>settings <span class="token operator">-</span>y  <span class="token comment">//常量定义</span></span>
<span class="line">lerna create @vite100<span class="token operator">/</span>utils <span class="token operator">-</span>y <span class="token comment">//工具方法</span></span>
<span class="line">lerna create @vite100<span class="token operator">/</span>cli<span class="token operator">-</span>plugin<span class="token operator">-</span>router <span class="token operator">-</span>y <span class="token comment">//工具方法</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-安装依赖" tabindex="-1"><a class="header-anchor" href="#_2-4-安装依赖"><span>2.4 安装依赖</span></a></h3><ul><li><a href="https://www.npmjs.com/package/fs-extra" target="_blank" rel="noopener noreferrer">fs-extra</a> 加强版的读写模块</li><li><a href="https://www.npmjs.com/package/clone-git-repo" target="_blank" rel="noopener noreferrer">clone-git-repo</a> 克隆git仓库</li><li><a href="https://www.npmjs.com/package/axios" target="_blank" rel="noopener noreferrer">axios</a> 请求接口</li><li><a href="https://www.npmjs.com/package/cross-spawn" target="_blank" rel="noopener noreferrer">cross-spawn</a> 开启子进程</li><li><a href="https://www.npmjs.com/package/userhome" target="_blank" rel="noopener noreferrer">userhome</a> 获取用户主目录</li><li><a href="https://www.npmjs.com/package/chalk" target="_blank" rel="noopener noreferrer">chalk</a> 控制台打印彩色文字</li><li><a href="https://www.npmjs.com/package/ejs" target="_blank" rel="noopener noreferrer">ejs</a> 模板渲染</li><li><a href="https://www.npmjs.com/package/execa" target="_blank" rel="noopener noreferrer">execa</a> 通过子进程执行命令</li><li><a href="https://www.npmjs.com/package/glob" target="_blank" rel="noopener noreferrer">glob</a> 按模式匹配文件</li><li><a href="https://www.npmjs.com/package/inquirer" target="_blank" rel="noopener noreferrer">inquirer</a> 交互式命令行选择</li><li><a href="https://www.npmjs.com/package/isbinaryfile" target="_blank" rel="noopener noreferrer">isbinaryfile</a> 判断是否是二进制文件</li><li><a href="https://www.npmjs.com/package/vue-codemod" target="_blank" rel="noopener noreferrer">vue-codemod</a> 通过AST修改源代码</li><li><a href="https://www.npmjs.com/package/jscodeshift" target="_blank" rel="noopener noreferrer">jscodeshift</a> 通过语法树修改源代码</li><li><a href="vite100">vite100</a> 核心命令</li><li><a href="@vite100/settings">@vite100/settings</a> 常量配置</li><li><a href="@vite100/utils">@vite100/utils</a> 帮助方法</li><li><a href="@vite100/config">@vite100/config</a> 配置参数</li><li><a href="@vite100/create">@vite100/create</a> 创建项目</li></ul><h4 id="_2-4-1-config-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-1-config-package-json"><span>2.4.1 config\\package.json</span></a></h4><p>packages\\config\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite100/settings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite100/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;fs-extra&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;userhome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-2-create-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-2-create-package-json"><span>2.4.2 create\\package.json</span></a></h4><p>packages\\create\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite100/settings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite100/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;chalk&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.1.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;clone-git-repo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ejs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.6&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;execa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.1.1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;fs-extra&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;glob&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.1.7&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;inquirer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.1.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;isbinaryfile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.8&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;vue-codemod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.5&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-3-utils-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-3-utils-package-json"><span>2.4.3 utils\\package.json</span></a></h4><p>packages\\utils\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite100/settings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.21.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;cross-spawn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.0.3&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;userhome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;npmlog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ora&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;userhome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-4-vite100-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-4-vite100-package-json"><span>2.4.4 vite100\\package.json</span></a></h4><p>packages\\vite100\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite100/config&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite100/create&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-5-publishconfig" tabindex="-1"><a class="header-anchor" href="#_2-4-5-publishconfig"><span>2.4.5 publishConfig</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://registry.npmjs.org&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/vite41_1630771189288.jpg" alt="vite100"></p><h3 id="_2-5-配置命令" tabindex="-1"><a class="header-anchor" href="#_2-5-配置命令"><span>2.5 配置命令</span></a></h3><h4 id="_2-5-1-package-json" tabindex="-1"><a class="header-anchor" href="#_2-5-1-package-json"><span>2.5.1 package.json</span></a></h4><p>packages\\vite100\\package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;name&quot;: &quot;vite100&quot;,</span>
<span class="line">  &quot;version&quot;: &quot;0.0.0&quot;,</span>
<span class="line">  &quot;dependencies&quot;: {</span>
<span class="line">    &quot;@vite100/config&quot;:&quot;^0.0.0&quot;,</span>
<span class="line">    &quot;@vite100/create&quot;:&quot;^0.0.0&quot;</span>
<span class="line">  },</span>
<span class="line">+ &quot;bin&quot;:{</span>
<span class="line">+   &quot;vite100&quot;: &quot;index.js&quot;</span>
<span class="line">+ }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-2-index-js" tabindex="-1"><a class="header-anchor" href="#_2-5-2-index-js"><span>2.5.2 index.js</span></a></h4><p>packages\\vite100\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> </span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token keyword">let</span> argv <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-3-link" tabindex="-1"><a class="header-anchor" href="#_2-5-3-link"><span>2.5.3 link</span></a></h4><ul><li>一定要先添加\`</li><li>这种情况可以<code>vite100\\packages\\vite100</code>目录中执行<code>yarn unlink</code>，再重新link</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn link</span>
<span class="line">yarn global bin </span>
<span class="line">C:\\Users\\zhangrenyang\\AppData\\Local\\Yarn\\bin</span>
<span class="line">C:\\Users\\zhangrenyang\\AppData\\Local\\Yarn\\Data\\link\\vite100</span>
<span class="line">npm bin -g</span>
<span class="line">C:\\Users\\zhangrenyang\\AppData\\Roaming\\npm</span>
<span class="line">vite100 create vite-project</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-实现配置命令" tabindex="-1"><a class="header-anchor" href="#_3-实现配置命令"><span>3.实现配置命令</span></a></h2><h3 id="_3-1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_3-1-安装依赖"><span>3.1 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn workspace @vite100/config  add userhome fs-extra</span>
<span class="line">yarn workspace @vite100/utils  add cross-spawn userhome fs-extra</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-settings-index-js" tabindex="-1"><a class="header-anchor" href="#_3-2-settings-index-js"><span>3.2 settings\\index.js</span></a></h3><p>packages\\settings\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//执行命令脚本</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token constant">COMMAND_SOURCE</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">const args = JSON.parse(process.argv[1]);</span>
<span class="line">const factory = require(&#39;.&#39;);</span>
<span class="line">factory(args);</span>
<span class="line"></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line"><span class="token comment">//配置文件名称</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token constant">RC_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;.vite100rc&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-config-js" tabindex="-1"><a class="header-anchor" href="#_3-3-config-js"><span>3.3 config.js</span></a></h3><p>packages\\utils\\config.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> userhome <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;userhome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs-extra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">RC_NAME</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vite100/settings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> configPath <span class="token operator">=</span> <span class="token function">userhome</span><span class="token punctuation">(</span><span class="token constant">RC_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>configPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  config <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readJSONSync</span><span class="token punctuation">(</span>configPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">config<span class="token punctuation">.</span>configPath<span class="token operator">=</span>configPath<span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-executenodescript-js" tabindex="-1"><a class="header-anchor" href="#_3-4-executenodescript-js"><span>3.4 executeNodeScript.js</span></a></h3><p>packages\\utils\\executeNodeScript.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cross-spawn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">executeNodeScript</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cwd <span class="token punctuation">}</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> childProcess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span></span>
<span class="line">        process<span class="token punctuation">.</span>execPath<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&quot;-e&quot;</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token string">&quot;--&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> cwd<span class="token punctuation">,</span> <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      childProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> executeNodeScript<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-log-js" tabindex="-1"><a class="header-anchor" href="#_3-5-log-js"><span>3.5 log.js</span></a></h3><p>packages\\utils\\log.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;npmlog&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">log<span class="token punctuation">.</span>heading <span class="token operator">=</span> <span class="token string">&#39;vite100&#39;</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> log<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-utils-index-js" tabindex="-1"><a class="header-anchor" href="#_3-6-utils-index-js"><span>3.6 utils\\index.js</span></a></h3><p>packages\\utils\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">exports<span class="token punctuation">.</span>log <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./log&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span>executeNodeScript <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./executeNodeScript&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-config-command-js" tabindex="-1"><a class="header-anchor" href="#_3-7-config-command-js"><span>3.7 config\\command.js</span></a></h3><p>packages\\config\\command.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>executeNodeScript<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite100/utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">COMMAND_SOURCE</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite100/settings&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token string">&quot;config [key] [value]&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;设置或查看配置项,比如GIT_TYPE设置仓库类型，ORG_NAME设置组织名&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">handler</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//await executeNodeScript({ cwd: __dirname }, COMMAND_SOURCE,argv);</span></span>
<span class="line">    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> command<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-8-config-index-js" tabindex="-1"><a class="header-anchor" href="#_3-8-config-index-js"><span>3.8 config\\index.js</span></a></h3><p>packages\\config\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs-extra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> log <span class="token punctuation">,</span>config<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vite100/utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> key<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> argv<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    config<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeJSON</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>configPath<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">spaces</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;vite100&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;(%s=%s)配置成功保存至%s&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> config<span class="token punctuation">.</span>configPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;%s=%s&#39;</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span> config<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> factory<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-9-vite100-index-js" tabindex="-1"><a class="header-anchor" href="#_3-9-vite100-index-js"><span>3.9 vite100\\index.js</span></a></h3><p>packages\\vite100\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">const yargs = require(&quot;yargs/yargs&quot;);</span>
<span class="line">const configCmd = require(&quot;@vite100/config/command&quot;);</span>
<span class="line">async function main() {</span>
<span class="line">    const cli = yargs();</span>
<span class="line">    cli</span>
<span class="line">    .usage(\`Usage: vite100 &lt;command&gt; [options]\`)</span>
<span class="line">    .demandCommand(1, &quot;至少需要一个命令&quot;)</span>
<span class="line">    .strict() </span>
<span class="line">    .recommendCommands()</span>
<span class="line">+   .command(configCmd)</span>
<span class="line">    .parse(process.argv.slice(2));</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">main().catch((err) =&gt; {</span>
<span class="line">    console.error(err);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-创建项目目录" tabindex="-1"><a class="header-anchor" href="#_4-创建项目目录"><span>4.创建项目目录</span></a></h2><h3 id="_4-1-create-command-js" tabindex="-1"><a class="header-anchor" href="#_4-1-create-command-js"><span>4.1 create\\command.js</span></a></h3><p>packages\\create\\command.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">COMMAND_SOURCE</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite100/settings&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>executeNodeScript<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite100/utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token string">&quot;create &lt;name&gt;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;创建项目&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    yargs<span class="token punctuation">.</span><span class="token function">positional</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;项目名称&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">handler</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">projectName</span><span class="token operator">:</span>argv<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token literal-property property">workingDirectory</span><span class="token operator">:</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//await executeNodeScript({ cwd: __dirname }, COMMAND_SOURCE,args);</span></span>
<span class="line">    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> command<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-create-index-js" tabindex="-1"><a class="header-anchor" href="#_4-2-create-index-js"><span>4.2 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs-extra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> execa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;execa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> red <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chalk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> config<span class="token punctuation">,</span> log <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vite100/utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> workingDirectory<span class="token punctuation">,</span> projectName <span class="token punctuation">}</span> <span class="token operator">=</span> argv<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">GIT_TYPE</span><span class="token punctuation">,</span> <span class="token constant">ORG_NAME</span> <span class="token punctuation">}</span> <span class="token operator">=</span> config<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">GIT_TYPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 尚未配置仓库类型!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">ORG_NAME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 尚未配置组织名称!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> projectDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>workingDirectory<span class="token punctuation">,</span> projectName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;vite100&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;创建的项目目录为%s&quot;</span><span class="token punctuation">,</span> projectDir<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-vite100-index-js" tabindex="-1"><a class="header-anchor" href="#_4-3-vite100-index-js"><span>4.3 vite100\\index.js</span></a></h3><p>packages\\vite100\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">const yargs = require(&quot;yargs/yargs&quot;);</span>
<span class="line">const configCmd = require(&quot;@vite100/config/command&quot;);</span>
<span class="line">+const createCmd = require(&quot;@vite100/create/command&quot;);</span>
<span class="line">async function main() {</span>
<span class="line">    const cli = yargs();</span>
<span class="line">    cli</span>
<span class="line">    .usage(\`Usage: vite100 &lt;command&gt; [options]\`)</span>
<span class="line">    .demandCommand(1, &quot;至少需要一个命令&quot;)</span>
<span class="line">    .strict() </span>
<span class="line">    .recommendCommands()</span>
<span class="line">+   .command(createCmd)</span>
<span class="line">    .command(configCmd)</span>
<span class="line">    .parse(process.argv.slice(2));</span>
<span class="line"> }</span>
<span class="line"></span>
<span class="line"> main().catch((err) =&gt; {</span>
<span class="line">     console.error(err);</span>
<span class="line"> });</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-获取选择项" tabindex="-1"><a class="header-anchor" href="#_5-获取选择项"><span>5. 获取选择项</span></a></h2><h3 id="_5-1-router-js" tabindex="-1"><a class="header-anchor" href="#_5-1-router-js"><span>5.1 router.js</span></a></h3><p>packages\\create\\lib\\promptModules\\router.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">cli</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    cli<span class="token punctuation">.</span><span class="token function">injectFeature</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Router&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;router&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;请选择路由模式&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">link</span><span class="token operator">:</span> <span class="token string">&#39;https://www.npmjs.com/package/react-router-dom&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    cli<span class="token punctuation">.</span><span class="token function">injectPrompt</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;historyMode&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">when</span><span class="token operator">:</span> <span class="token parameter">answers</span> <span class="token operator">=&gt;</span> answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;router&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请选择history的模式&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;list&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">choices</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;hash&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;hash&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;browser&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;browser&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;browser&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    cli<span class="token punctuation">.</span><span class="token function">injectPrompt</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;appTitle&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">when</span><span class="token operator">:</span> <span class="token parameter">answers</span> <span class="token operator">=&gt;</span> answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;router&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入根组件的标题&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;text&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;AppTitle&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    cli<span class="token punctuation">.</span><span class="token function">onPromptComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> projectOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;router&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            projectOptions<span class="token punctuation">.</span>historyMode <span class="token operator">=</span>answers<span class="token punctuation">.</span>historyMode<span class="token punctuation">;</span></span>
<span class="line">            projectOptions<span class="token punctuation">.</span>appTitle<span class="token operator">=</span>answers<span class="token punctuation">.</span>appTitle<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-getpromptmodules-js" tabindex="-1"><a class="header-anchor" href="#_5-2-getpromptmodules-js"><span>5.2 getPromptModules.js</span></a></h3><p>packages\\create\\lib\\getPromptModules.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">getPromptModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&#39;router&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./promptModules/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> getPromptModules<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-create-index-js" tabindex="-1"><a class="header-anchor" href="#_5-3-create-index-js"><span>5.3 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const path = require(&quot;path&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const { config, log } = require(&quot;@vite100/utils&quot;);</span>
<span class="line">+const getPromptModules = require(&#39;./lib/getPromptModules&#39;);</span>
<span class="line">async function create(argv) {</span>
<span class="line">    const { workingDirectory, projectName } = argv;</span>
<span class="line">    const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">    if (!GIT_TYPE) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置仓库类型!&quot;);</span>
<span class="line">    }</span>
<span class="line">    if (!ORG_NAME) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置组织名称!&quot;);</span>
<span class="line">    }</span>
<span class="line">    const projectDir = path.join(workingDirectory, projectName);</span>
<span class="line">    log.info(&quot;vite100&quot;, &quot;创建的项目目录为%s&quot;, projectDir);</span>
<span class="line">+   let promptModules = getPromptModules();</span>
<span class="line">+   console.info(&quot;选择项promptModules&quot;, promptModules);</span>
<span class="line">}</span>
<span class="line">module.exports = (...args) =&gt; {</span>
<span class="line">    return create(...args).catch(err =&gt; {</span>
<span class="line">        console.error(err);</span>
<span class="line">    });</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-获取回答" tabindex="-1"><a class="header-anchor" href="#_6-获取回答"><span>6. 获取回答</span></a></h2><h3 id="_6-1-promptmoduleapi-js" tabindex="-1"><a class="header-anchor" href="#_6-1-promptmoduleapi-js"><span>6.1 PromptModuleAPI.js</span></a></h3><p>packages\\create\\lib\\PromptModuleAPI.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">PromptModuleAPI</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">creator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>creator <span class="token operator">=</span> creator<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//插入特性</span></span>
<span class="line">    <span class="token function">injectFeature</span><span class="token punctuation">(</span><span class="token parameter">feature</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>featurePrompt<span class="token punctuation">.</span>choices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//插入选项</span></span>
<span class="line">    <span class="token function">injectPrompt</span><span class="token punctuation">(</span><span class="token parameter">prompt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>injectedPrompts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//选择完成后的回调</span></span>
<span class="line">    <span class="token function">onPromptComplete</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>promptCompleteCbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> PromptModuleAPI<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-creator-js" tabindex="-1"><a class="header-anchor" href="#_6-2-creator-js"><span>6.2 Creator.js</span></a></h3><p>packages\\create\\lib\\Creator.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> prompt <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;inquirer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> PromptModuleAPI <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./PromptModuleAPI&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> defaultFeaturePrompt <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;features&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;checkbox&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;请选择项目特性:&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">choices</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Creator</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">projectName<span class="token punctuation">,</span> projectDir<span class="token punctuation">,</span> promptModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>projectName <span class="token operator">=</span> projectName<span class="token punctuation">;</span><span class="token comment">//项目名称</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>projectDir <span class="token operator">=</span> projectDir<span class="token punctuation">;</span><span class="token comment">//项目路径</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>featurePrompt <span class="token operator">=</span> defaultFeaturePrompt<span class="token punctuation">;</span><span class="token comment">//默认选项框</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>injectedPrompts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//插入插入的选择框</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>promptCompleteCbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//选择结束之后的回调</span></span>
<span class="line">        <span class="token keyword">const</span> promptModuleAPI <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PromptModuleAPI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        promptModules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">module</span><span class="token punctuation">(</span>promptModuleAPI<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//获取选择项</span></span>
<span class="line">        <span class="token keyword">const</span> projectOptions <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>projectOptions <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">promptAndResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;projectOptions&#39;</span><span class="token punctuation">,</span>projectOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//{historyMode: &#39;browser&#39;,appTitle: &#39;AppTitle&#39;}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token function">promptAndResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> prompts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>featurePrompt<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>injectedPrompts<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> answers <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">prompt</span><span class="token punctuation">(</span>prompts<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> projectOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>promptCompleteCbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>answers<span class="token punctuation">,</span> projectOptions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> projectOptions<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Creator<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-create-index-js" tabindex="-1"><a class="header-anchor" href="#_6-3-create-index-js"><span>6.3 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const path = require(&quot;path&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const { config, log } = require(&quot;@vite100/utils&quot;);</span>
<span class="line">const getPromptModules = require(&#39;./lib/getPromptModules&#39;);</span>
<span class="line">+const Creator = require(&#39;./lib/Creator&#39;);</span>
<span class="line">async function create(argv) {</span>
<span class="line">    const { workingDirectory, projectName } = argv;</span>
<span class="line">    const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">    if (!GIT_TYPE) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置仓库类型!&quot;);</span>
<span class="line">    }</span>
<span class="line">    if (!ORG_NAME) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置组织名称!&quot;);</span>
<span class="line">    }</span>
<span class="line">    const projectDir = path.join(workingDirectory, projectName);</span>
<span class="line">    log.info(&quot;vite100&quot;, &quot;创建的项目目录为%s&quot;, projectDir);</span>
<span class="line">    let promptModules = getPromptModules();</span>
<span class="line">    console.info(&quot;选择项promptModules&quot;, promptModules);</span>
<span class="line">+   let creator = new Creator(projectName, projectDir, promptModules);</span>
<span class="line">+   await creator.create();</span>
<span class="line">}</span>
<span class="line">module.exports = (...args) =&gt; {</span>
<span class="line">    return create(...args).catch(err =&gt; {</span>
<span class="line">        console.error(err);</span>
<span class="line">    });</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-准备项目目录" tabindex="-1"><a class="header-anchor" href="#_7-准备项目目录"><span>7. 准备项目目录</span></a></h2><h3 id="_7-1-creator-js" tabindex="-1"><a class="header-anchor" href="#_7-1-creator-js"><span>7.1 Creator.js</span></a></h3><p>packages\\create\\lib\\Creator.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">+const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">+const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const PromptModuleAPI = require(&quot;./PromptModuleAPI&quot;);</span>
<span class="line">+const { log } = require(&quot;@vite100/utils&quot;);</span>
<span class="line">const defaultFeaturePrompt = {</span>
<span class="line">    name: &quot;features&quot;,</span>
<span class="line">    type: &quot;checkbox&quot;,</span>
<span class="line">    message: &quot;请选择项目特性:&quot;,</span>
<span class="line">    choices: [],</span>
<span class="line">}</span>
<span class="line">class Creator {</span>
<span class="line">    constructor(projectName, projectDir, promptModules) {</span>
<span class="line">        this.projectName = projectName;//项目名称</span>
<span class="line">        this.projectDir = projectDir;//项目路径</span>
<span class="line">        this.featurePrompt = defaultFeaturePrompt;//默认选项框</span>
<span class="line">        this.injectedPrompts = [];//插入插入的选择框</span>
<span class="line">        this.promptCompleteCbs = [];//选择结束之后的回调</span>
<span class="line">        const promptModuleAPI = new PromptModuleAPI(this);</span>
<span class="line">        promptModules.forEach((module) =&gt; module(promptModuleAPI));</span>
<span class="line">    }</span>
<span class="line">    async create() {</span>
<span class="line">        //获取选择项</span>
<span class="line">        const projectOptions = (this.projectOptions = await this.promptAndResolve());</span>
<span class="line">        console.log(&#39;projectOptions&#39;, projectOptions);</span>
<span class="line">        //{historyMode: &#39;browser&#39;,appTitle: &#39;AppTitle&#39;}</span>
<span class="line">+       //准备项目目录</span>
<span class="line">+       await this.prepareProjectDir();</span>
<span class="line">    }</span>
<span class="line">+   async prepareProjectDir() {</span>
<span class="line">+       let { projectDir } = this;</span>
<span class="line">+       try {</span>
<span class="line">+           await fs.access(projectDir);</span>
<span class="line">+           const files = await fs.readdir(projectDir);</span>
<span class="line">+           if (files.length &gt; 0) {</span>
<span class="line">+               const { overwrite } = await prompt({</span>
<span class="line">+                   type: &quot;confirm&quot;,</span>
<span class="line">+                   name: &quot;overwrite&quot;,</span>
<span class="line">+                   message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">+               });</span>
<span class="line">+               if (overwrite) {</span>
<span class="line">+                   await fs.emptyDir(projectDir);</span>
<span class="line">+               } else {</span>
<span class="line">+                   throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">+               }</span>
<span class="line">+           }</span>
<span class="line">+       } catch (error) {</span>
<span class="line">+           await fs.mkdirp(projectDir);</span>
<span class="line">+       }</span>
<span class="line">+       log.info(&quot;vite100&quot;, &quot;%s目录已经准备就绪&quot;, projectDir);</span>
<span class="line">+   }</span>
<span class="line">    async promptAndResolve() {</span>
<span class="line">        let prompts = [this.featurePrompt, ...this.injectedPrompts];</span>
<span class="line">        let answers = await prompt(prompts);</span>
<span class="line">        let projectOptions = { plugins: {}, };</span>
<span class="line">        this.promptCompleteCbs.forEach((cb) =&gt; cb(answers, projectOptions));</span>
<span class="line">        return projectOptions;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">module.exports = Creator;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-下载模板" tabindex="-1"><a class="header-anchor" href="#_8-下载模板"><span>8. 下载模板</span></a></h2><h3 id="_8-1-request-js" tabindex="-1"><a class="header-anchor" href="#_8-1-request-js"><span>8.1 request.js</span></a></h3><p>packages\\utils\\request.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">GIT_TYPE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">GITEE</span> <span class="token operator">=</span> <span class="token string">&quot;https://gitee.com/api/v5&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">GITHUB</span> <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token constant">GIT_TYPE</span> <span class="token operator">===</span> <span class="token string">&quot;gitee&quot;</span> <span class="token operator">?</span> <span class="token constant">GITEE</span> <span class="token operator">:</span> <span class="token constant">GITHUB</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token constant">BASE_URL</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> request<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-withloading-js" tabindex="-1"><a class="header-anchor" href="#_8-2-withloading-js"><span>8.2 withLoading.js</span></a></h3><p>packages\\utils\\withLoading.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">withLoading</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;ora&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> spinner <span class="token operator">=</span> ora<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  spinner<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> withLoading<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-utils-index-js" tabindex="-1"><a class="header-anchor" href="#_8-3-utils-index-js"><span>8.3 utils\\index.js</span></a></h3><p>packages\\utils\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">exports.log = require(&#39;./log&#39;);</span>
<span class="line">exports.executeNodeScript = require(&#39;./executeNodeScript&#39;);</span>
<span class="line">exports.config = require(&#39;./config&#39;);</span>
<span class="line">+exports.withLoading = require(&#39;./withLoading&#39;);</span>
<span class="line">+exports.request = require(&#39;./request&#39;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-4-settings-index-js" tabindex="-1"><a class="header-anchor" href="#_8-4-settings-index-js"><span>8.4 settings\\index.js</span></a></h3><p>packages\\settings\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//执行命令脚本</span>
<span class="line">exports.COMMAND_SOURCE = \`</span>
<span class="line">const args = JSON.parse(process.argv[1]);</span>
<span class="line">const factory = require(&#39;.&#39;);</span>
<span class="line">factory(args);</span>
<span class="line">\`</span>
<span class="line">//配置文件名称</span>
<span class="line">exports.RC_NAME = &quot;.vite100rc&quot;;</span>
<span class="line"></span>
<span class="line">+//模板存放名称</span>
<span class="line">+exports.TEMPLATES = &quot;.vite100_templates&quot;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-5-creator-js" tabindex="-1"><a class="header-anchor" href="#_8-5-creator-js"><span>8.5 Creator.js</span></a></h3><p>packages\\create\\lib\\Creator.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">+const userhome = require(&quot;userhome&quot;);</span>
<span class="line">+const {promisify} = require(&#39;util&#39;);</span>
<span class="line">+const clone = promisify(require(&#39;clone-git-repo&#39;));</span>
<span class="line">const PromptModuleAPI = require(&quot;./PromptModuleAPI&quot;);</span>
<span class="line">+const { log,config,withLoading ,request} = require(&quot;@vite100/utils&quot;);</span>
<span class="line">+const { TEMPLATES } = require(&quot;@vite100/settings&quot;);</span>
<span class="line">const defaultFeaturePrompt = {</span>
<span class="line">    name: &quot;features&quot;,</span>
<span class="line">    type: &quot;checkbox&quot;,</span>
<span class="line">    message: &quot;请选择项目特性:&quot;,</span>
<span class="line">    choices: [],</span>
<span class="line">}</span>
<span class="line">class Creator {</span>
<span class="line">    constructor(projectName, projectDir, promptModules) {</span>
<span class="line">        this.projectName = projectName;//项目名称</span>
<span class="line">        this.projectDir = projectDir;//项目路径</span>
<span class="line">        this.featurePrompt = defaultFeaturePrompt;//默认选项框</span>
<span class="line">        this.injectedPrompts = [];//插入插入的选择框</span>
<span class="line">        this.promptCompleteCbs = [];//选择结束之后的回调</span>
<span class="line">        const promptModuleAPI = new PromptModuleAPI(this);</span>
<span class="line">        promptModules.forEach((module) =&gt; module(promptModuleAPI));</span>
<span class="line">    }</span>
<span class="line">    async create() {</span>
<span class="line">        //获取选择项</span>
<span class="line">        const projectOptions = (this.projectOptions = await this.promptAndResolve());</span>
<span class="line">        console.log(&#39;projectOptions&#39;, projectOptions);</span>
<span class="line">        //{historyMode: &#39;browser&#39;,appTitle: &#39;AppTitle&#39;}</span>
<span class="line">        //准备项目目录</span>
<span class="line">        await this.prepareProjectDir();</span>
<span class="line">+       //下载模板，给templateDir赋值</span>
<span class="line">+       await this.downloadTemplate();</span>
<span class="line">    }</span>
<span class="line">+    async downloadTemplate() {</span>
<span class="line">+        const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">+        let repos = await withLoading(&quot;读取模板列表&quot;, async () =&gt;</span>
<span class="line">+            request.get(\`/orgs/\${ORG_NAME}/repos\`)</span>
<span class="line">+        );</span>
<span class="line">+        let { repo } = await prompt({</span>
<span class="line">+            name: &quot;repo&quot;,</span>
<span class="line">+            type: &quot;list&quot;,</span>
<span class="line">+            message: &quot;请选择模板&quot;,</span>
<span class="line">+            choices: repos.map((repo) =&gt; repo.name)</span>
<span class="line">+        });</span>
<span class="line">+        let tags = await withLoading(&quot;读取标签列表&quot;, async () =&gt;</span>
<span class="line">+            request.get(\`/repos/\${ORG_NAME}/\${repo}/tags\`)</span>
<span class="line">+        );</span>
<span class="line">+        let { tag } = await prompt({</span>
<span class="line">+            name: &quot;tag&quot;,</span>
<span class="line">+            type: &quot;list&quot;,</span>
<span class="line">+            message: &quot;请选择版本&quot;,</span>
<span class="line">+            choices: tags,</span>
<span class="line">+        });</span>
<span class="line">+        let repository = GIT_TYPE + \`:\${ORG_NAME}/\${repo}\`;</span>
<span class="line"> +        if (tag) repository += \`</span>
<span class="line">+        const downloadDirectory = userhome(TEMPLATES);</span>
<span class="line">+        let templateDir = (this.templateDir = \`\${downloadDirectory}/\${repo}/\${tag}\`);</span>
<span class="line">+        log.info(&quot;vite3&quot;, &quot;准备下载模板到%s&quot;, templateDir);</span>
<span class="line">+        try {</span>
<span class="line">+            await fs.access(templateDir);</span>
<span class="line">+        } catch (error) {</span>
<span class="line">+            log.info(&quot;vite100&quot;, &quot;从仓库下载%s&quot;, repository);</span>
<span class="line">+            await clone(repository, templateDir, { clone: true });</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">    async prepareProjectDir() {</span>
<span class="line">        let { projectDir } = this;</span>
<span class="line">        try {</span>
<span class="line">            await fs.access(projectDir);</span>
<span class="line">            const files = await fs.readdir(projectDir);</span>
<span class="line">            if (files.length &gt; 0) {</span>
<span class="line">                const { overwrite } = await prompt({</span>
<span class="line">                    type: &quot;confirm&quot;,</span>
<span class="line">                    name: &quot;overwrite&quot;,</span>
<span class="line">                    message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">                });</span>
<span class="line">                if (overwrite) {</span>
<span class="line">                    await fs.emptyDir(projectDir);</span>
<span class="line">                } else {</span>
<span class="line">                    throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">                }</span>
<span class="line">            }</span>
<span class="line">        } catch (error) {</span>
<span class="line">            await fs.mkdirp(projectDir);</span>
<span class="line">        }</span>
<span class="line">        log.info(&quot;vite100&quot;, &quot;%s目录已经准备就绪&quot;, projectDir);</span>
<span class="line">    }</span>
<span class="line">    async promptAndResolve() {</span>
<span class="line">        let prompts = [this.featurePrompt, ...this.injectedPrompts];</span>
<span class="line">        let answers = await prompt(prompts);</span>
<span class="line">        let projectOptions = { plugins: {}, };</span>
<span class="line">        this.promptCompleteCbs.forEach((cb) =&gt; cb(answers, projectOptions));</span>
<span class="line">        return projectOptions;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">module.exports = Creator;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-启动项目" tabindex="-1"><a class="header-anchor" href="#_9-启动项目"><span>9.启动项目</span></a></h2><h3 id="_9-1-creator-js" tabindex="-1"><a class="header-anchor" href="#_9-1-creator-js"><span>9.1 Creator.js</span></a></h3><p>packages\\create\\lib\\Creator.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const userhome = require(&quot;userhome&quot;);</span>
<span class="line">const {promisify} = require(&#39;util&#39;);</span>
<span class="line">+const execa = require(&quot;execa&quot;);</span>
<span class="line">const clone = promisify(require(&#39;clone-git-repo&#39;));</span>
<span class="line">const PromptModuleAPI = require(&quot;./PromptModuleAPI&quot;);</span>
<span class="line">const { log,config,withLoading ,request} = require(&quot;@vite100/utils&quot;);</span>
<span class="line">const { TEMPLATES } = require(&quot;@vite100/settings&quot;);</span>
<span class="line">const defaultFeaturePrompt = {</span>
<span class="line">    name: &quot;features&quot;,</span>
<span class="line">    type: &quot;checkbox&quot;,</span>
<span class="line">    message: &quot;请选择项目特性:&quot;,</span>
<span class="line">    choices: [],</span>
<span class="line">}</span>
<span class="line">class Creator {</span>
<span class="line">    constructor(projectName, projectDir, promptModules) {</span>
<span class="line">        this.projectName = projectName;//项目名称</span>
<span class="line">        this.projectDir = projectDir;//项目路径</span>
<span class="line">        this.featurePrompt = defaultFeaturePrompt;//默认选项框</span>
<span class="line">        this.injectedPrompts = [];//插入插入的选择框</span>
<span class="line">        this.promptCompleteCbs = [];//选择结束之后的回调</span>
<span class="line">        const promptModuleAPI = new PromptModuleAPI(this);</span>
<span class="line">        promptModules.forEach((module) =&gt; module(promptModuleAPI));</span>
<span class="line">    }</span>
<span class="line">    async create() {</span>
<span class="line">        //获取选择项</span>
<span class="line">        const projectOptions = (this.projectOptions = await this.promptAndResolve());</span>
<span class="line">        console.log(&#39;projectOptions&#39;, projectOptions);</span>
<span class="line">        //{historyMode: &#39;browser&#39;,appTitle: &#39;AppTitle&#39;}</span>
<span class="line">        //准备项目目录</span>
<span class="line">        await this.prepareProjectDir();</span>
<span class="line">        //下载模板，给templateDir赋值</span>
<span class="line">        await this.downloadTemplate();</span>
<span class="line">         //把项目拷贝到模板中</span>
<span class="line">+       await fs.copy(this.templateDir, this.projectDir);</span>
<span class="line">+        //初始化git仓库</span>
<span class="line">+       await execa(&quot;git&quot;, [&quot;init&quot;], { cwd: this.projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line">+       log.info(&quot;vite100&quot;, &quot;在%s安装依赖&quot;, this.projectDir);</span>
<span class="line">+       await execa(&quot;npm&quot;, [&quot;install&quot;], { cwd: this.projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line">    }</span>
<span class="line">    async downloadTemplate() {</span>
<span class="line">        const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">        let repos = await withLoading(&quot;读取模板列表&quot;, async () =&gt;</span>
<span class="line">            request.get(\`/orgs/\${ORG_NAME}/repos\`)</span>
<span class="line">        );</span>
<span class="line">        let { repo } = await prompt({</span>
<span class="line">            name: &quot;repo&quot;,</span>
<span class="line">            type: &quot;list&quot;,</span>
<span class="line">            message: &quot;请选择模板&quot;,</span>
<span class="line">            choices: repos.map((repo) =&gt; repo.name)</span>
<span class="line">        });</span>
<span class="line">        let tags = await withLoading(&quot;读取标签列表&quot;, async () =&gt;</span>
<span class="line">            request.get(\`/repos/\${ORG_NAME}/\${repo}/tags\`)</span>
<span class="line">        );</span>
<span class="line">        let { tag } = await prompt({</span>
<span class="line">            name: &quot;tag&quot;,</span>
<span class="line">            type: &quot;list&quot;,</span>
<span class="line">            message: &quot;请选择版本&quot;,</span>
<span class="line">            choices: tags,</span>
<span class="line">        });</span>
<span class="line">        let repository = GIT_TYPE + \`:\${ORG_NAME}/\${repo}\`;</span>
<span class="line">         if (tag) repository += \`</span>
<span class="line">        const downloadDirectory = userhome(TEMPLATES);</span>
<span class="line">        let templateDir = (this.templateDir = \`\${downloadDirectory}/\${repo}/\${tag}\`);</span>
<span class="line">        log.info(&quot;vite3&quot;, &quot;准备下载模板到%s&quot;, templateDir);</span>
<span class="line">        try {</span>
<span class="line">            await fs.access(templateDir);</span>
<span class="line">        } catch (error) {</span>
<span class="line">            log.info(&quot;vite100&quot;, &quot;从仓库下载%s&quot;, repository);</span>
<span class="line">            await clone(repository, templateDir, { clone: true });</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">    async prepareProjectDir() {</span>
<span class="line">        let { projectDir } = this;</span>
<span class="line">        try {</span>
<span class="line">            await fs.access(projectDir);</span>
<span class="line">            const files = await fs.readdir(projectDir);</span>
<span class="line">            if (files.length &gt; 0) {</span>
<span class="line">                const { overwrite } = await prompt({</span>
<span class="line">                    type: &quot;confirm&quot;,</span>
<span class="line">                    name: &quot;overwrite&quot;,</span>
<span class="line">                    message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">                });</span>
<span class="line">                if (overwrite) {</span>
<span class="line">                    await fs.emptyDir(projectDir);</span>
<span class="line">                } else {</span>
<span class="line">                    throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">                }</span>
<span class="line">            }</span>
<span class="line">        } catch (error) {</span>
<span class="line">            await fs.mkdirp(projectDir);</span>
<span class="line">        }</span>
<span class="line">        log.info(&quot;vite100&quot;, &quot;%s目录已经准备就绪&quot;, projectDir);</span>
<span class="line">    }</span>
<span class="line">    async promptAndResolve() {</span>
<span class="line">        let prompts = [this.featurePrompt, ...this.injectedPrompts];</span>
<span class="line">        let answers = await prompt(prompts);</span>
<span class="line">        let projectOptions = { plugins: {}, };</span>
<span class="line">        this.promptCompleteCbs.forEach((cb) =&gt; cb(answers, projectOptions));</span>
<span class="line">        return projectOptions;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">module.exports = Creator;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-create-index-js" tabindex="-1"><a class="header-anchor" href="#_9-2-create-index-js"><span>9.2 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const path = require(&quot;path&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">+const execa = require(&quot;execa&quot;);</span>
<span class="line">const { config, log } = require(&quot;@vite100/utils&quot;);</span>
<span class="line">const getPromptModules = require(&#39;./lib/getPromptModules&#39;);</span>
<span class="line">const Creator = require(&#39;./lib/Creator&#39;);</span>
<span class="line">async function create(argv) {</span>
<span class="line">    const { workingDirectory, projectName } = argv;</span>
<span class="line">    const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">    if (!GIT_TYPE) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置仓库类型!&quot;);</span>
<span class="line">    }</span>
<span class="line">    if (!ORG_NAME) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置组织名称!&quot;);</span>
<span class="line">    }</span>
<span class="line">    const projectDir = path.join(workingDirectory, projectName);</span>
<span class="line">    log.info(&quot;vite100&quot;, &quot;创建的项目目录为%s&quot;, projectDir);</span>
<span class="line">    let promptModules = getPromptModules();</span>
<span class="line">    console.info(&quot;选择项promptModules&quot;, promptModules);</span>
<span class="line">    let creator = new Creator(projectName, projectDir, promptModules);</span>
<span class="line">    await creator.create();</span>
<span class="line">+   log.info(&quot;vite100&quot;, &quot;启动服务&quot;);</span>
<span class="line">+   await execa(&quot;npm&quot;, [&quot;run&quot;, &quot;dev&quot;], { cwd: projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line">}</span>
<span class="line">module.exports = (...args) =&gt; {</span>
<span class="line">    return create(...args).catch(err =&gt; {</span>
<span class="line">        console.error(err);</span>
<span class="line">    });</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-添加路由插件" tabindex="-1"><a class="header-anchor" href="#_10-添加路由插件"><span>10.添加路由插件</span></a></h2><h3 id="_10-1-router-js" tabindex="-1"><a class="header-anchor" href="#_10-1-router-js"><span>10.1 router.js</span></a></h3><p>packages\\create\\lib\\promptModules\\router.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">module.exports = cli =&gt; {</span>
<span class="line">    cli.injectFeature({</span>
<span class="line">        name: &#39;Router&#39;,</span>
<span class="line">        value: &#39;router&#39;,</span>
<span class="line">        description: &#39;请选择路由模式&#39;,</span>
<span class="line">        link: &#39;https://www.npmjs.com/package/react-router-dom&#39;</span>
<span class="line">    })</span>
<span class="line">    cli.injectPrompt({</span>
<span class="line">        name: &#39;historyMode&#39;,</span>
<span class="line">        when: answers =&gt; answers.features.includes(&#39;router&#39;),</span>
<span class="line">        message: &#39;请选择history的模式&#39;,</span>
<span class="line">        type: &#39;list&#39;,</span>
<span class="line">        choices: [</span>
<span class="line">            {</span>
<span class="line">                name: &#39;hash&#39;,</span>
<span class="line">                value: &#39;hash&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                name: &#39;browser&#39;,</span>
<span class="line">                value: &#39;browser&#39;</span>
<span class="line">            }</span>
<span class="line">        ],</span>
<span class="line">        default: &#39;browser&#39;</span>
<span class="line">    })</span>
<span class="line">    cli.injectPrompt({</span>
<span class="line">        name: &#39;appTitle&#39;,</span>
<span class="line">        when: answers =&gt; answers.features.includes(&#39;router&#39;),</span>
<span class="line">        message: &#39;请输入根组件的标题&#39;,</span>
<span class="line">        type: &#39;text&#39;,</span>
<span class="line">        default: &#39;AppTitle&#39;</span>
<span class="line">    })</span>
<span class="line">    cli.onPromptComplete((answers, projectOptions) =&gt; {</span>
<span class="line">        if (answers.features.includes(&#39;router&#39;)) {</span>
<span class="line">+            projectOptions.plugins[&#39;cli-plugin-router&#39;] = {</span>
<span class="line">+                historyMode: answers.historyMode</span>
<span class="line">+            }</span>
<span class="line">            projectOptions.historyMode =answers.historyMode;</span>
<span class="line">            projectOptions.appTitle=answers.appTitle;</span>
<span class="line">        }</span>
<span class="line">    })</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-2-creator-js" tabindex="-1"><a class="header-anchor" href="#_10-2-creator-js"><span>10.2 Creator.js</span></a></h3><p>packages\\create\\lib\\Creator.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">+const path = require(&quot;path&quot;);</span>
<span class="line">const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const userhome = require(&quot;userhome&quot;);</span>
<span class="line">const {promisify} = require(&#39;util&#39;);</span>
<span class="line">const execa = require(&quot;execa&quot;);</span>
<span class="line">const clone = promisify(require(&#39;clone-git-repo&#39;));</span>
<span class="line">const PromptModuleAPI = require(&quot;./PromptModuleAPI&quot;);</span>
<span class="line">const { log,config,withLoading ,request} = require(&quot;@vite100/utils&quot;);</span>
<span class="line">const { TEMPLATES } = require(&quot;@vite100/settings&quot;);</span>
<span class="line">const defaultFeaturePrompt = {</span>
<span class="line">    name: &quot;features&quot;,</span>
<span class="line">    type: &quot;checkbox&quot;,</span>
<span class="line">    message: &quot;请选择项目特性:&quot;,</span>
<span class="line">    choices: [],</span>
<span class="line">}</span>
<span class="line">class Creator {</span>
<span class="line">    constructor(projectName, projectDir, promptModules) {</span>
<span class="line">        this.projectName = projectName;//项目名称</span>
<span class="line">        this.projectDir = projectDir;//项目路径</span>
<span class="line">        this.featurePrompt = defaultFeaturePrompt;//默认选项框</span>
<span class="line">        this.injectedPrompts = [];//插入插入的选择框</span>
<span class="line">        this.promptCompleteCbs = [];//选择结束之后的回调</span>
<span class="line">+       this.plugins = [];//插件</span>
<span class="line">        const promptModuleAPI = new PromptModuleAPI(this);</span>
<span class="line">        promptModules.forEach((module) =&gt; module(promptModuleAPI));</span>
<span class="line">    }</span>
<span class="line">    async create() {</span>
<span class="line">        //获取选择项</span>
<span class="line">        const projectOptions = (this.projectOptions = await this.promptAndResolve());</span>
<span class="line">        console.log(&#39;projectOptions&#39;, projectOptions);</span>
<span class="line">        //{historyMode: &#39;browser&#39;,appTitle: &#39;AppTitle&#39;}</span>
<span class="line">        //准备项目目录</span>
<span class="line">        await this.prepareProjectDir();</span>
<span class="line">        //下载模板，给templateDir赋值</span>
<span class="line">        await this.downloadTemplate();</span>
<span class="line">         //把项目拷贝到模板中</span>
<span class="line">        await fs.copy(this.templateDir, this.projectDir);</span>
<span class="line">+       const pkgPath = path.join(this.projectDir, &#39;package.json&#39;);</span>
<span class="line">+       let pkg = (this.pkg = await fs.readJSON(pkgPath));</span>
<span class="line">+       const deps = Reflect.ownKeys(projectOptions.plugins);</span>
<span class="line">+       deps.forEach(dep =&gt; pkg.devDependencies[dep] = \`latest\`);</span>
<span class="line">+       await fs.writeJSON(pkgPath,pkg,{spaces:2});</span>
<span class="line">         //初始化git仓库</span>
<span class="line">        await execa(&quot;git&quot;, [&quot;init&quot;], { cwd: this.projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line">        log.info(&quot;vite100&quot;, &quot;在%s安装依赖&quot;, this.projectDir);</span>
<span class="line">        await execa(&quot;npm&quot;, [&quot;install&quot;], { cwd: this.projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line"></span>
<span class="line">    }</span>
<span class="line">    async downloadTemplate() {</span>
<span class="line">        const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">        let repos = await withLoading(&quot;读取模板列表&quot;, async () =&gt;</span>
<span class="line">            request.get(\`/orgs/\${ORG_NAME}/repos\`)</span>
<span class="line">        );</span>
<span class="line">        let { repo } = await prompt({</span>
<span class="line">            name: &quot;repo&quot;,</span>
<span class="line">            type: &quot;list&quot;,</span>
<span class="line">            message: &quot;请选择模板&quot;,</span>
<span class="line">            choices: repos.map((repo) =&gt; repo.name)</span>
<span class="line">        });</span>
<span class="line">        let tags = await withLoading(&quot;读取标签列表&quot;, async () =&gt;</span>
<span class="line">            request.get(\`/repos/\${ORG_NAME}/\${repo}/tags\`)</span>
<span class="line">        );</span>
<span class="line">        let { tag } = await prompt({</span>
<span class="line">            name: &quot;tag&quot;,</span>
<span class="line">            type: &quot;list&quot;,</span>
<span class="line">            message: &quot;请选择版本&quot;,</span>
<span class="line">            choices: tags,</span>
<span class="line">        });</span>
<span class="line">        let repository = GIT_TYPE + \`:\${ORG_NAME}/\${repo}\`;</span>
<span class="line">         if (tag) repository += \`</span>
<span class="line">        const downloadDirectory = userhome(TEMPLATES);</span>
<span class="line">        let templateDir = (this.templateDir = \`\${downloadDirectory}/\${repo}/\${tag}\`);</span>
<span class="line">        log.info(&quot;vite3&quot;, &quot;准备下载模板到%s&quot;, templateDir);</span>
<span class="line">        try {</span>
<span class="line">            await fs.access(templateDir);</span>
<span class="line">        } catch (error) {</span>
<span class="line">            log.info(&quot;vite100&quot;, &quot;从仓库下载%s&quot;, repository);</span>
<span class="line">            await clone(repository, templateDir, { clone: true });</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">    async prepareProjectDir() {</span>
<span class="line">        let { projectDir } = this;</span>
<span class="line">        try {</span>
<span class="line">            await fs.access(projectDir);</span>
<span class="line">            const files = await fs.readdir(projectDir);</span>
<span class="line">            if (files.length &gt; 0) {</span>
<span class="line">                const { overwrite } = await prompt({</span>
<span class="line">                    type: &quot;confirm&quot;,</span>
<span class="line">                    name: &quot;overwrite&quot;,</span>
<span class="line">                    message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">                });</span>
<span class="line">                if (overwrite) {</span>
<span class="line">                    await fs.emptyDir(projectDir);</span>
<span class="line">                } else {</span>
<span class="line">                    throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">                }</span>
<span class="line">            }</span>
<span class="line">        } catch (error) {</span>
<span class="line">            await fs.mkdirp(projectDir);</span>
<span class="line">        }</span>
<span class="line">        log.info(&quot;vite100&quot;, &quot;%s目录已经准备就绪&quot;, projectDir);</span>
<span class="line">    }</span>
<span class="line">    async promptAndResolve() {</span>
<span class="line">        let prompts = [this.featurePrompt, ...this.injectedPrompts];</span>
<span class="line">        let answers = await prompt(prompts);</span>
<span class="line">        let projectOptions = { plugins: {}, };</span>
<span class="line">        this.promptCompleteCbs.forEach((cb) =&gt; cb(answers, projectOptions));</span>
<span class="line">        return projectOptions;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">module.exports = Creator;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-解析并应用插件" tabindex="-1"><a class="header-anchor" href="#_11-解析并应用插件"><span>11. 解析并应用插件</span></a></h2><h3 id="_11-1-mergedeps-js" tabindex="-1"><a class="header-anchor" href="#_11-1-mergedeps-js"><span>11.1 mergeDeps.js</span></a></h3><p>packages\\utils\\mergeDeps.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">mergeDeps</span><span class="token punctuation">(</span><span class="token parameter">sourceDeps<span class="token punctuation">,</span> depsToInject</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> result <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> sourceDeps<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> depName <span class="token keyword">in</span> depsToInject<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        result<span class="token punctuation">[</span>depName<span class="token punctuation">]</span> <span class="token operator">=</span> depsToInject<span class="token punctuation">[</span>depName<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mergeDeps<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-loadmodule-js" tabindex="-1"><a class="header-anchor" href="#_11-2-loadmodule-js"><span>11.2 loadModule.js</span></a></h3><p>packages\\utils\\loadModule.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> Module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;module&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">loadModule</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> Module<span class="token punctuation">.</span><span class="token function">createRequire</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span><span class="token string">&#39;package.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loadModule<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-3-extractcalldir-js" tabindex="-1"><a class="header-anchor" href="#_11-3-extractcalldir-js"><span>11.3 extractCallDir.js</span></a></h3><p>packages\\utils\\extractCallDir.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">extractCallDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    Error<span class="token punctuation">.</span><span class="token function">captureStackTrace</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> callSite <span class="token operator">=</span> obj<span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">const</span> namedStackRegExp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\s\\((.*):\\d+:\\d+\\)$</span><span class="token regex-delimiter">/</span></span></span>
<span class="line">    <span class="token keyword">let</span> matchResult <span class="token operator">=</span> callSite<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>namedStackRegExp<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> fileName <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> extractCallDir<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-4-writefiletree-js" tabindex="-1"><a class="header-anchor" href="#_11-4-writefiletree-js"><span>11.4 writeFileTree.js</span></a></h3><p>packages\\utils\\writeFileTree.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs-extra&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">writeFileTree</span><span class="token punctuation">(</span><span class="token parameter">projectDir<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> content <span class="token operator">=</span> files<span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&#39;.ejs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> file <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>projectDir<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        fs<span class="token punctuation">.</span><span class="token function">ensureDirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//先确保文件所在的目录 是存在</span></span>
<span class="line">        fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> writeFileTree<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-5-utils-index-js" tabindex="-1"><a class="header-anchor" href="#_11-5-utils-index-js"><span>11.5 utils\\index.js</span></a></h3><p>packages\\utils\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+const path = require(&#39;path&#39;);</span>
<span class="line">exports.log = require(&#39;./log&#39;);</span>
<span class="line">exports.executeNodeScript = require(&#39;./executeNodeScript&#39;);</span>
<span class="line">exports.config = require(&#39;./config&#39;);</span>
<span class="line">exports.withLoading = require(&#39;./withLoading&#39;);</span>
<span class="line">exports.request = require(&#39;./request&#39;);</span>
<span class="line">+exports.loadModule = require(&#39;./loadModule&#39;);</span>
<span class="line">+exports.mergeDeps = require(&#39;./mergeDeps&#39;);</span>
<span class="line">+exports.extractCallDir = require(&#39;./extractCallDir&#39;);</span>
<span class="line">+exports.writeFileTree = require(&#39;./writeFileTree&#39;);</span>
<span class="line">+exports.isObject = val =&gt; typeof val === &#39;object&#39;;</span>
<span class="line">+exports.isString = val =&gt; typeof val === &#39;string&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-6-generatorapi-js" tabindex="-1"><a class="header-anchor" href="#_11-6-generatorapi-js"><span>11.6 GeneratorAPI.js</span></a></h3><p>packages\\create\\lib\\GeneratorAPI.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;ejs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;util&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;glob&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> isBinaryFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;isbinaryfile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> runTransformation <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;vue-codemod&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> isObject<span class="token punctuation">,</span> isString<span class="token punctuation">,</span> extractCallDir<span class="token punctuation">,</span> mergeDeps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vite100/utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">GeneratorAPI</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> projectOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>creator <span class="token operator">=</span> creator<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>projectOptions <span class="token operator">=</span> projectOptions<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//插入文件处理中间件</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token function">_injectFileMiddleware</span><span class="token punctuation">(</span><span class="token parameter">middleware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>fileMiddlewares<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//渲染拷贝文件</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> baseDir <span class="token operator">=</span> <span class="token function">extractCallDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            source <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> source<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_injectFileMiddleware</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> projectOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> templateFiles <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">&#39;**/*&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">cwd</span><span class="token operator">:</span> source<span class="token punctuation">,</span> <span class="token literal-property property">nodir</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> templateFiles<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">let</span> templateFile <span class="token operator">=</span> templateFiles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    files<span class="token punctuation">[</span>templateFile<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">renderFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> templateFile<span class="token punctuation">)</span><span class="token punctuation">,</span> projectOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//扩展依赖包</span></span>
<span class="line">    <span class="token function">extendPackage</span><span class="token punctuation">(</span><span class="token parameter">toMerge</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>pkg<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> toMerge<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> value <span class="token operator">=</span> toMerge<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> existing <span class="token operator">=</span> pkg<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&#39;dependencies&#39;</span> <span class="token operator">||</span> key <span class="token operator">===</span> <span class="token string">&#39;devDependencies&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                pkg<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mergeDeps</span><span class="token punctuation">(</span>existing <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                pkg<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//转译脚本</span></span>
<span class="line">    <span class="token function">transformScript</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> codemod<span class="token punctuation">,</span> projectOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_injectFileMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            files<span class="token punctuation">[</span>file<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">runTransformation</span><span class="token punctuation">(</span></span>
<span class="line">                <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">path</span><span class="token operator">:</span> file<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">source</span><span class="token operator">:</span> files<span class="token punctuation">[</span>file<span class="token punctuation">]</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                codemod<span class="token punctuation">,</span></span>
<span class="line">                projectOptions</span>
<span class="line">            <span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//插入导入语句</span></span>
<span class="line">    <span class="token function">injectImport</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> newImport</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> imports <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>imports<span class="token punctuation">[</span>file<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>creator<span class="token punctuation">.</span>imports<span class="token punctuation">[</span>file<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        imports<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newImport<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//入口文件的路径</span></span>
<span class="line">    <span class="token keyword">get</span> <span class="token function">entryFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&#39;src/index.js&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//渲染文件</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">renderFile</span><span class="token punctuation">(</span><span class="token parameter">templatePath<span class="token punctuation">,</span> projectOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">isBinaryFile</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> ejs<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> projectOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> GeneratorAPI<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-7-injectimports-js" tabindex="-1"><a class="header-anchor" href="#_11-7-injectimports-js"><span>11.7 injectImports.js</span></a></h3><p>packages\\create\\lib\\codemods\\injectImports.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">injectImports</span><span class="token punctuation">(</span><span class="token parameter">fileInfo<span class="token punctuation">,</span> api<span class="token punctuation">,</span> <span class="token punctuation">{</span> imports <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> jscodeshift <span class="token operator">=</span> api<span class="token punctuation">.</span>jscodeshift</span>
<span class="line">    <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">jscodeshift</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span>source<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> declarations <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>jscodeshift<span class="token punctuation">.</span>ImportDeclaration<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">toImportAST</span> <span class="token operator">=</span> <span class="token parameter">imp</span> <span class="token operator">=&gt;</span> <span class="token function">jscodeshift</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>imp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">const</span> importASTNodes <span class="token operator">=</span> imports<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>toImportAST<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>declarations<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        declarations<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span>importASTNodes<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>node<span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token operator">...</span>importASTNodes<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> root<span class="token punctuation">.</span><span class="token function">toSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> injectImports<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-8-creator-js" tabindex="-1"><a class="header-anchor" href="#_11-8-creator-js"><span>11.8 Creator.js</span></a></h3><p>packages\\create\\lib\\Creator.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">const path = require(&quot;path&quot;);</span>
<span class="line">const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const userhome = require(&quot;userhome&quot;);</span>
<span class="line">const {promisify} = require(&#39;util&#39;);</span>
<span class="line">const execa = require(&quot;execa&quot;);</span>
<span class="line">+const glob = promisify(require(&#39;glob&#39;));</span>
<span class="line">const clone = promisify(require(&#39;clone-git-repo&#39;));</span>
<span class="line">+const { runTransformation } = require(&#39;vue-codemod&#39;)</span>
<span class="line">const PromptModuleAPI = require(&quot;./PromptModuleAPI&quot;);</span>
<span class="line">+const GeneratorAPI = require(&#39;./GeneratorAPI&#39;);</span>
<span class="line">+const { isBinaryFile } = require(&#39;isbinaryfile&#39;);</span>
<span class="line">+const { log,config,withLoading ,request,loadModule,writeFileTree} = require(&quot;@vite100/utils&quot;);</span>
<span class="line">const { TEMPLATES } = require(&quot;@vite100/settings&quot;);</span>
<span class="line">const defaultFeaturePrompt = {</span>
<span class="line">    name: &quot;features&quot;,</span>
<span class="line">    type: &quot;checkbox&quot;,</span>
<span class="line">    message: &quot;请选择项目特性:&quot;,</span>
<span class="line">    choices: [],</span>
<span class="line">}</span>
<span class="line">class Creator {</span>
<span class="line">    constructor(projectName, projectDir, promptModules) {</span>
<span class="line">        this.projectName = projectName;//项目名称</span>
<span class="line">        this.projectDir = projectDir;//项目路径</span>
<span class="line">        this.featurePrompt = defaultFeaturePrompt;//默认选项框</span>
<span class="line">        this.injectedPrompts = [];//插入插入的选择框</span>
<span class="line">        this.promptCompleteCbs = [];//选择结束之后的回调</span>
<span class="line">        this.plugins = [];//插件</span>
<span class="line">+       this.fileMiddlewares = [];//文件中间件</span>
<span class="line">+       this.files = {};//最终输出的文件列表</span>
<span class="line">+       this.pkg = {};//我描述内容</span>
<span class="line">+       this.imports={};//额外的导入语句</span>
<span class="line">        const promptModuleAPI = new PromptModuleAPI(this);</span>
<span class="line">        promptModules.forEach((module) =&gt; module(promptModuleAPI));</span>
<span class="line">    }</span>
<span class="line">    async create() {</span>
<span class="line">        //获取选择项</span>
<span class="line">        const projectOptions = (this.projectOptions = await this.promptAndResolve());</span>
<span class="line">        console.log(&#39;projectOptions&#39;, projectOptions);</span>
<span class="line">        //{historyMode: &#39;browser&#39;,appTitle: &#39;AppTitle&#39;}</span>
<span class="line">        //准备项目目录</span>
<span class="line">        await this.prepareProjectDir();</span>
<span class="line">        //下载模板，给templateDir赋值</span>
<span class="line">        await this.downloadTemplate();</span>
<span class="line">         //把项目拷贝到模板中</span>
<span class="line">        await fs.copy(this.templateDir, this.projectDir);</span>
<span class="line">        const pkgPath = path.join(this.projectDir, &#39;package.json&#39;);</span>
<span class="line">        let pkg = (this.pkg = await fs.readJSON(pkgPath));</span>
<span class="line">        const deps = Reflect.ownKeys(projectOptions.plugins);</span>
<span class="line">        deps.forEach(dep =&gt; pkg.devDependencies[dep] = \`latest\`);</span>
<span class="line">        await fs.writeJSON(pkgPath,pkg,{spaces:2});</span>
<span class="line">         //初始化git仓库</span>
<span class="line">        await execa(&quot;git&quot;, [&quot;init&quot;], { cwd: this.projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line">        log.info(&quot;vite100&quot;, &quot;在%s安装依赖&quot;, this.projectDir);</span>
<span class="line">        await execa(&quot;npm&quot;, [&quot;install&quot;], { cwd: this.projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line">+       //解析插件,拿到插件的generator方法</span>
<span class="line">+       const resolvedPlugins = await this.resolvePlugins(projectOptions.plugins);</span>
<span class="line">+       //应用插件</span>
<span class="line">+       await this.applyPlugins(resolvedPlugins);</span>
<span class="line">+       await this.initFiles();</span>
<span class="line">+       //准备文件内容</span>
<span class="line">+       await this.renderFiles();</span>
<span class="line">+       //删除插件的依赖</span>
<span class="line">+       deps.forEach(dep =&gt;  delete pkg.devDependencies[dep]);</span>
<span class="line">+       this.files[&#39;package.json&#39;] = JSON.stringify(pkg,null,2);</span>
<span class="line">+       //把文件写入硬盘</span>
<span class="line">+       await writeFileTree(this.projectDir, this.files);</span>
<span class="line">+       //重新安装额外的依赖</span>
<span class="line">+       await execa(&quot;npm&quot;, [&quot;install&quot;], { cwd: this.projectDir, stdio: &quot;inherit&quot; });</span>
<span class="line">    }</span>
<span class="line">+   async initFiles(){</span>
<span class="line">+       const projectFiles = await glob(&#39;**/*&#39;, { cwd: this.projectDir, nodir: true });</span>
<span class="line">+       for (let i = 0; i &lt; projectFiles.length; i++) {</span>
<span class="line">+           let projectFile = projectFiles[i];</span>
<span class="line">+           let projectFilePath = path.join(this.projectDir,projectFile);</span>
<span class="line">+           let content;</span>
<span class="line">+           if (await isBinaryFile(projectFilePath)) {</span>
<span class="line">+               content =  await fs.readFile(projectFilePath);</span>
<span class="line">+           }else{</span>
<span class="line">+               content =  await fs.readFile(projectFilePath,&#39;utf8&#39;);</span>
<span class="line">+           }</span>
<span class="line">+           this.files[projectFile] = content;</span>
<span class="line">+       }</span>
<span class="line">+   }</span>
<span class="line">+    async renderFiles() {</span>
<span class="line">+        const {files,projectOptions} = this;</span>
<span class="line">+        for (const middleware of this.fileMiddlewares) {</span>
<span class="line">+          await middleware(files,projectOptions);</span>
<span class="line">+        }</span>
<span class="line">+        Object.keys(files).forEach(file =&gt; {</span>
<span class="line">+          let imports = this.imports[file]</span>
<span class="line">+          if (imports &amp;&amp; imports.length &gt; 0) {</span>
<span class="line">+            files[file] = runTransformation(</span>
<span class="line">+              { path: file, source: files[file] },</span>
<span class="line">+              require(&#39;./codemods/injectImports&#39;),</span>
<span class="line">+              { imports }</span>
<span class="line">+            )</span>
<span class="line">+          }</span>
<span class="line">+        })</span>
<span class="line">+      }</span>
<span class="line">+    async resolvePlugins(rawPlugins) {</span>
<span class="line">+        const plugins = [];</span>
<span class="line">+        for (const id of Reflect.ownKeys(rawPlugins)) {</span>
<span class="line">+          const apply = loadModule(\`\${id}/generator\`, this.projectDir);</span>
<span class="line">+          let options = rawPlugins[id];</span>
<span class="line">+          plugins.push({ id, apply, options });</span>
<span class="line">+        }</span>
<span class="line">+        return plugins;</span>
<span class="line">+    }</span>
<span class="line">+    async applyPlugins(plugins) {</span>
<span class="line">+        for (const plugin of plugins) {</span>
<span class="line">+          const { id, apply, options } = plugin;</span>
<span class="line">+          const generatorAPI = new GeneratorAPI(id, this, options);</span>
<span class="line">+          await apply(generatorAPI, options);</span>
<span class="line">+        }</span>
<span class="line">+      }</span>
<span class="line">    async downloadTemplate() {</span>
<span class="line">        const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">        let repos = await withLoading(&quot;读取模板列表&quot;, async () =&gt;</span>
<span class="line">            request.get(\`/orgs/\${ORG_NAME}/repos\`)</span>
<span class="line">        );</span>
<span class="line">        let { repo } = await prompt({</span>
<span class="line">            name: &quot;repo&quot;,</span>
<span class="line">            type: &quot;list&quot;,</span>
<span class="line">            message: &quot;请选择模板&quot;,</span>
<span class="line">            choices: repos.map((repo) =&gt; repo.name)</span>
<span class="line">        });</span>
<span class="line">        let tags = await withLoading(&quot;读取标签列表&quot;, async () =&gt;</span>
<span class="line">            request.get(\`/repos/\${ORG_NAME}/\${repo}/tags\`)</span>
<span class="line">        );</span>
<span class="line">        let { tag } = await prompt({</span>
<span class="line">            name: &quot;tag&quot;,</span>
<span class="line">            type: &quot;list&quot;,</span>
<span class="line">            message: &quot;请选择版本&quot;,</span>
<span class="line">            choices: tags,</span>
<span class="line">        });</span>
<span class="line">        let repository = GIT_TYPE + \`:\${ORG_NAME}/\${repo}\`;</span>
<span class="line">         if (tag) repository += \`</span>
<span class="line">        const downloadDirectory = userhome(TEMPLATES);</span>
<span class="line">        let templateDir = (this.templateDir = \`\${downloadDirectory}/\${repo}/\${tag}\`);</span>
<span class="line">        log.info(&quot;vite3&quot;, &quot;准备下载模板到%s&quot;, templateDir);</span>
<span class="line">        try {</span>
<span class="line">            await fs.access(templateDir);</span>
<span class="line">        } catch (error) {</span>
<span class="line">            log.info(&quot;vite100&quot;, &quot;从仓库下载%s&quot;, repository);</span>
<span class="line">            await clone(repository, templateDir, { clone: true });</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">    async prepareProjectDir() {</span>
<span class="line">        let { projectDir } = this;</span>
<span class="line">        try {</span>
<span class="line">            await fs.access(projectDir);</span>
<span class="line">            const files = await fs.readdir(projectDir);</span>
<span class="line">            if (files.length &gt; 0) {</span>
<span class="line">                const { overwrite } = await prompt({</span>
<span class="line">                    type: &quot;confirm&quot;,</span>
<span class="line">                    name: &quot;overwrite&quot;,</span>
<span class="line">                    message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">                });</span>
<span class="line">                if (overwrite) {</span>
<span class="line">                    await fs.emptyDir(projectDir);</span>
<span class="line">                } else {</span>
<span class="line">                    throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">                }</span>
<span class="line">            }</span>
<span class="line">        } catch (error) {</span>
<span class="line">            await fs.mkdirp(projectDir);</span>
<span class="line">        }</span>
<span class="line">        log.info(&quot;vite100&quot;, &quot;%s目录已经准备就绪&quot;, projectDir);</span>
<span class="line">    }</span>
<span class="line">    async promptAndResolve() {</span>
<span class="line">        let prompts = [this.featurePrompt, ...this.injectedPrompts];</span>
<span class="line">        let answers = await prompt(prompts);</span>
<span class="line">        let projectOptions = { plugins: {}, };</span>
<span class="line">        this.promptCompleteCbs.forEach((cb) =&gt; cb(answers, projectOptions));</span>
<span class="line">        return projectOptions;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">module.exports = Creator;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-实现插件" tabindex="-1"><a class="header-anchor" href="#_12-实现插件"><span>12. 实现插件</span></a></h2><h3 id="_12-1-app-js-ejs" tabindex="-1"><a class="header-anchor" href="#_12-1-app-js-ejs"><span>12.1 App.js.ejs</span></a></h3><p>packages\\cli-plugin-router\\template\\src\\App.js.ejs</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%=</span>appTitle<span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-2-routesconfig-js" tabindex="-1"><a class="header-anchor" href="#_12-2-routesconfig-js"><span>12.2 routesConfig.js</span></a></h3><p>packages\\cli-plugin-router\\template\\src\\routesConfig.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">component</span><span class="token operator">:</span> App</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-3-generator-js" tabindex="-1"><a class="header-anchor" href="#_12-3-generator-js"><span>12.3 generator.js</span></a></h3><p>packages\\cli-plugin-router\\generator.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;./template&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">injectImport</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>entryFile<span class="token punctuation">,</span></span>
<span class="line">        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">import {</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>options<span class="token punctuation">.</span>historyMode <span class="token operator">===</span> <span class="token string">&#39;hash&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;HashRouter&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;BrowserRouter&#39;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> as Router,Route} from &#39;react-router-dom&#39;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">injectImport</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>entryFile<span class="token punctuation">,</span></span>
<span class="line">        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">import routesConfig from &#39;./routesConfig&#39;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">injectImport</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>entryFile<span class="token punctuation">,</span></span>
<span class="line">        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">import { renderRoutes } from &quot;react-router-config&quot;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">transformScript</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>entryFile<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./injectRouter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    api<span class="token punctuation">.</span><span class="token function">extendPackage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&#39;react-router-dom&#39;</span><span class="token operator">:</span> <span class="token string">&#39;latest&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&#39;react-router-config&#39;</span><span class="token operator">:</span> <span class="token string">&#39;latest&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-4-injectrouter-js" tabindex="-1"><a class="header-anchor" href="#_12-4-injectrouter-js"><span>12.4 injectRouter.js</span></a></h3><p>packages\\cli-plugin-router\\injectRouter.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> api</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> jscodeshift <span class="token operator">=</span> api<span class="token punctuation">.</span>jscodeshift</span>
<span class="line">    <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">jscodeshift</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>source<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> appImportDeclaration <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>jscodeshift<span class="token punctuation">.</span>ImportDeclaration<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>specifiers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>local<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;App&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>appImportDeclaration<span class="token punctuation">)</span></span>
<span class="line">        appImportDeclaration<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> appJSXElement <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>jscodeshift<span class="token punctuation">.</span>JSXElement<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>openingElement<span class="token punctuation">.</span>name<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;App&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>appJSXElement<span class="token punctuation">)</span></span>
<span class="line">     appJSXElement<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">         <span class="token keyword">return</span> jscodeshift<span class="token punctuation">.</span><span class="token function">jsxElement</span><span class="token punctuation">(</span></span>
<span class="line">            jscodeshift<span class="token punctuation">.</span><span class="token function">jsxOpeningElement</span><span class="token punctuation">(</span>jscodeshift<span class="token punctuation">.</span><span class="token function">jsxIdentifier</span><span class="token punctuation">(</span><span class="token string">&#39;Router&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> jscodeshift<span class="token punctuation">.</span><span class="token function">jsxClosingElement</span><span class="token punctuation">(</span>jscodeshift<span class="token punctuation">.</span><span class="token function">jsxIdentifier</span><span class="token punctuation">(</span><span class="token string">&#39;Router&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">                jscodeshift<span class="token punctuation">.</span><span class="token function">jsxExpressionContainer</span><span class="token punctuation">(</span></span>
<span class="line">                    jscodeshift<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>jscodeshift<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;renderRoutes&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span>jscodeshift<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;routesConfig&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span></span>
<span class="line">         <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> root<span class="token punctuation">.</span><span class="token function">toSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_13-发布" tabindex="-1"><a class="header-anchor" href="#_13-发布"><span>13.发布</span></a></h2><h3 id="_13-1-创建组织" tabindex="-1"><a class="header-anchor" href="#_13-1-创建组织"><span>13.1 创建组织</span></a></h3><ul><li><a href="https://www.npmjs.com/org/create" target="_blank" rel="noopener noreferrer">create</a></li></ul><h3 id="_13-2-发布" tabindex="-1"><a class="header-anchor" href="#_13-2-发布"><span>13.2 发布</span></a></h3><p>package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://registry.npmjs.org&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm whoami</span>
<span class="line">npm login</span>
<span class="line">zhangrenyang2000</span>
<span class="line">lerna publish</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-参考" tabindex="-1"><a class="header-anchor" href="#_14-参考"><span>14.参考</span></a></h2><h3 id="_14-1-lerna" tabindex="-1"><a class="header-anchor" href="#_14-1-lerna"><span>14.1 lerna</span></a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">lerna bootstrap</td><td style="text-align:left;">安装依赖</td></tr><tr><td style="text-align:left;">lerna clean</td><td style="text-align:left;">删除各个包下的node_modules</td></tr><tr><td style="text-align:left;">lerna init</td><td style="text-align:left;">创建新的lerna库</td></tr><tr><td style="text-align:left;">lerna list</td><td style="text-align:left;">查看本地包列表</td></tr><tr><td style="text-align:left;">lerna changed</td><td style="text-align:left;">显示自上次release tag以来有修改的包， 选项通 list</td></tr><tr><td style="text-align:left;">lerna diff</td><td style="text-align:left;">显示自上次release tag以来有修改的包的差异， 执行 git diff</td></tr><tr><td style="text-align:left;">lerna exec</td><td style="text-align:left;">在每个包目录下执行任意命令</td></tr><tr><td style="text-align:left;">lerna run</td><td style="text-align:left;">执行每个包package.json中的脚本命令</td></tr><tr><td style="text-align:left;">lerna add</td><td style="text-align:left;">添加一个包的版本为各个包的依赖</td></tr><tr><td style="text-align:left;">lerna import</td><td style="text-align:left;">引入package</td></tr><tr><td style="text-align:left;">lerna link</td><td style="text-align:left;">链接互相引用的库</td></tr><tr><td style="text-align:left;">lerna create</td><td style="text-align:left;">新建package</td></tr><tr><td style="text-align:left;">lerna publish</td><td style="text-align:left;">发布</td></tr></tbody></table><h3 id="_14-3-yarn" tabindex="-1"><a class="header-anchor" href="#_14-3-yarn"><span>14.3 yarn</span></a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">yarn -v</td><td style="text-align:left;">查看yarn版本</td></tr><tr><td style="text-align:left;">yarn config list</td><td style="text-align:left;">查看yarn的所有配置</td></tr><tr><td style="text-align:left;">yarn config set registry <a href="https://registry.npm.taobao.org/" target="_blank" rel="noopener noreferrer">https://registry.npm.taobao.org/</a></td><td style="text-align:left;">修改yarn的源镜像为淘宝源</td></tr><tr><td style="text-align:left;">yarn config set global-folder &quot;D:\\RTE\\Yarn\\global&quot;</td><td style="text-align:left;">修改全局安装目录, 先创建好目录(global), 我放在了Yarn安装目录下(D:\\RTE\\Yarn\\global)</td></tr><tr><td style="text-align:left;">yarn config set prefix &quot;D:\\RTE\\Yarn\\global\\&quot;</td><td style="text-align:left;">修改全局安装目录的bin目录位置</td></tr><tr><td style="text-align:left;">yarn config set cache-folder &quot;D:\\RTE\\Yarn\\cache&quot;</td><td style="text-align:left;">修改全局缓存目录, 先创建好目录(cache), 和global放在同一层目录下</td></tr><tr><td style="text-align:left;">yarn config list</td><td style="text-align:left;">查看所有配置</td></tr><tr><td style="text-align:left;">yarn global bin</td><td style="text-align:left;">查看当前yarn的bin的位置</td></tr><tr><td style="text-align:left;">yarn global dir</td><td style="text-align:left;">查看当前yarn的全局安装位置</td></tr></tbody></table><h3 id="_14-4-workspace" tabindex="-1"><a class="header-anchor" href="#_14-4-workspace"><span>14.4 workspace</span></a></h3><ul><li><a href="https://yarn.bootcss.com/docs/" target="_blank" rel="noopener noreferrer">yarn官网</a></li><li>yarn add &lt;package...&gt; [--ignore-workspace-root-check/-W]</li><li>yarn add &lt;package...&gt; [--dev/-D]</li></ul><table><thead><tr><th style="text-align:left;">作用</th><th style="text-align:left;">命令</th></tr></thead><tbody><tr><td style="text-align:left;">查看工作空间信息</td><td style="text-align:left;">yarn workspaces info</td></tr><tr><td style="text-align:left;">给所有的空间添加依赖</td><td style="text-align:left;">yarn workspaces run add lodash</td></tr><tr><td style="text-align:left;">给根空间添加依赖</td><td style="text-align:left;">yarn add -W -D typescript jest</td></tr><tr><td style="text-align:left;">给某个项目添加依赖</td><td style="text-align:left;">yarn workspace create-react-app3 add commander</td></tr><tr><td style="text-align:left;">删除所有的 node_modules</td><td style="text-align:left;">lerna clean 等于 yarn workspaces run clean</td></tr><tr><td style="text-align:left;">安装和link所有的名</td><td style="text-align:left;">yarn install 等于 lerna bootstrap --npm-client yarn --use-workspaces</td></tr><tr><td style="text-align:left;">重新获取所有的 node_modules</td><td style="text-align:left;">yarn install --force</td></tr><tr><td style="text-align:left;">查看缓存目录</td><td style="text-align:left;">yarn cache dir</td></tr><tr><td style="text-align:left;">清除本地缓存</td><td style="text-align:left;">yarn cache clean</td></tr><tr><td style="text-align:left;">在所有package中运行指定的命令</td><td style="text-align:left;">yarn workspaces run</td></tr></tbody></table><h3 id="_14-3-yargs" tabindex="-1"><a class="header-anchor" href="#_14-3-yargs"><span>14.3 yargs</span></a></h3><ul><li><a href="https://www.npmjs.com/package/yargs" target="_blank" rel="noopener noreferrer">yargs</a>帮助你构建交互命令行工具，可以解析参数生成优雅的用户界面</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;yargs/yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> cli <span class="token operator">=</span> <span class="token function">yargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">cli</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Usage: vite100 &lt;command&gt; [options]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">demandCommand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;至少需要一个命令&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">strict</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">recommendCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token string">&quot;create &lt;name&gt;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;创建项目&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            yargs<span class="token punctuation">.</span><span class="token function">positional</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;项目名称&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">           <span class="token comment">//{ _: [ &#39;create&#39; ], &#39;$0&#39;: &#39;doc\\\\1.yargs.js&#39;, name: &#39;p1&#39; }</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-5-node-e" tabindex="-1"><a class="header-anchor" href="#_14-5-node-e"><span>14.5 node -e</span></a></h3><ul><li>[node -e](https://nodejs.org/api/cli.html</li><li>-e, --eval &quot;script&quot;</li><li>设置<code>stdion: &#39;inherit&#39;</code>,当执行代码时,子进程将会继承主进程的stdin、stdout和stderr</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node <span class="token operator">-</span>e <span class="token string">&quot;console.log(process.argv)&quot;</span> <span class="token operator">--</span> a b</span>
<span class="line">node <span class="token operator">-</span>e <span class="token string">&quot;console.log(JSON.parse(process.argv[1]))&quot;</span> <span class="token operator">--</span> <span class="token string">&quot;{\\&quot;name\\&quot;:\\&quot;zhufeng\\&quot;}&quot;</span></span>
<span class="line">node <span class="token operator">-</span>e <span class="token string">&quot;console.log(process.cwd())&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cross-spawn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">executeNodeScript</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cwd <span class="token punctuation">}</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> childProcess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span></span>
<span class="line">        process<span class="token punctuation">.</span>execPath<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&quot;-e&quot;</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token string">&quot;--&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> cwd<span class="token punctuation">,</span> <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      childProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> executeNodeScript<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-6-clone" tabindex="-1"><a class="header-anchor" href="#_14-6-clone"><span>14.6 clone</span></a></h3><ul><li><a href="https://www.npmjs.com/package/clone-git-repo" target="_blank" rel="noopener noreferrer">clone-git-repo</a>用来克隆和下载仓库</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;clone-git-repo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token keyword">let</span> repository <span class="token operator">=</span> &#39;gitee<span class="token operator">:</span>zhufengtemplate<span class="token operator">/</span>template<span class="token operator">-</span>react</span>
<span class="line"><span class="token function">clone</span><span class="token punctuation">(</span>repository<span class="token punctuation">,</span><span class="token string">&#39;./output&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">clone</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-7-jscodeshift" tabindex="-1"><a class="header-anchor" href="#_14-7-jscodeshift"><span>14.7 jscodeshift</span></a></h3><ul><li><a href="https://www.npmjs.com/package/jscodeshift" target="_blank" rel="noopener noreferrer">jscodeshift</a>是一个执行代码更改的工具包</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> jscodeshift <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;jscodeshift&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> ast <span class="token operator">=</span>  <span class="token function">jscodeshift</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">import ReactDOM from &quot;react-dom&quot;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ast<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-8-vue-codemod" tabindex="-1"><a class="header-anchor" href="#_14-8-vue-codemod"><span>14.8 vue-codemod</span></a></h3><ul><li><a href="https://www.npmjs.com/package/vue-codemod" target="_blank" rel="noopener noreferrer">vue-codemod</a>包含了代码变量脚本的工具集</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> runTransformation <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;vue-codemod&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token string">&#39;index.js&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> source <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">import React from &#39;react&#39;;</span>
<span class="line"></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> imports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;import ReactDOM from &quot;react-dom&quot;&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> transformed <span class="token operator">=</span> <span class="token function">runTransformation</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> file<span class="token punctuation">,</span> source <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    injectImports<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> imports <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>transformed<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">injectImports</span><span class="token punctuation">(</span><span class="token parameter">fileInfo<span class="token punctuation">,</span> api<span class="token punctuation">,</span> <span class="token punctuation">{</span> imports <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> jscodeshift <span class="token operator">=</span> api<span class="token punctuation">.</span>jscodeshift</span>
<span class="line">    <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">jscodeshift</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span>source<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> declarations <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>jscodeshift<span class="token punctuation">.</span>ImportDeclaration<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">toImportAST</span> <span class="token operator">=</span> <span class="token parameter">imp</span> <span class="token operator">=&gt;</span> <span class="token function">jscodeshift</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>imp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">const</span> importASTNodes <span class="token operator">=</span> imports<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>toImportAST<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>declarations<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        declarations<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span>importASTNodes<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>node<span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token operator">...</span>importASTNodes<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> root<span class="token punctuation">.</span><span class="token function">toSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,210)])])}const o=s(t,[["render",i]]),r=JSON.parse('{"path":"/strong/139.cli.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/139.cli.md"}');export{o as comp,r as data};
