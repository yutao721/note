import{_ as n,c as a,a as e,o as t}from"./app-CD1YpnS1.js";const p={};function l(i,s){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-serverless是什么" tabindex="-1"><a class="header-anchor" href="#_1-serverless是什么"><span>1. Serverless是什么？</span></a></h2><h3 id="_1-1-serverless是什么" tabindex="-1"><a class="header-anchor" href="#_1-1-serverless是什么"><span>1.1 Serverless是什么？</span></a></h3><ul><li>无服务器架构几乎封装了所有底层资源管理和系统运维工作</li><li>服务器布署、扩缩容、运维、监控报警交由云服务器厂商来做</li><li>前端开发只关注业务，不需要关注服务器</li></ul><p><img src="http://img.zhufengpeixun.cn/serverless2.jpg" alt="serverless2"></p><h3 id="_1-2-云函数" tabindex="-1"><a class="header-anchor" href="#_1-2-云函数"><span>1.2 云函数</span></a></h3><ul><li><a href="https://console.cloud.tencent.com/scf/list?rid=1&amp;ns=default" target="_blank" rel="noopener noreferrer">函数服务</a></li></ul><h2 id="_2-serverless-framework" tabindex="-1"><a class="header-anchor" href="#_2-serverless-framework"><span>2. serverless framework</span></a></h2><ul><li>Serverless Framework 是业界非常受欢迎的无服务器应用框架，开发者无需关心底层资源即可部署完整可用的 Serverless 应用架构</li><li>Serverless Framework 具有资源编排、自动伸缩、事件驱动等能力，覆盖编码、调试、测试、部署等全生命周期，帮助开发者通过联动云资源，迅速构建 Serverless 应用</li><li><a href="https://cloud.tencent.com/product/sls" target="_blank" rel="noopener noreferrer">Serverless Framework</a></li><li><a href="https://cloud.tencent.com/document/product/1154" target="_blank" rel="noopener noreferrer">Serverless Framework文档</a></li><li><a href="https://cloud.tencent.com/document/product/1154/42990" target="_blank" rel="noopener noreferrer">安装Serverless Framework</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$ cnpm install -g serverless</span>
<span class="line">$ cnpm update -g serverless</span>
<span class="line">$ serverless -v</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-serverless-components" tabindex="-1"><a class="header-anchor" href="#_3-serverless-components"><span>3. Serverless Components</span></a></h2><ul><li><a href="https://cloud.tencent.com/document/product/1154/39270" target="_blank" rel="noopener noreferrer">Serverless Components</a>是支持多个云资源编排和组织的场景化解决方案，主要基于客户的具体场景，如 Express 框架支持、网站部署等</li><li>Serverless Components 可以有效简化云资源的配置和管理，将网关、COS 和 CAM 等产品联动起来，让客户更多关注场景和业务</li><li>Serverless Framework Components 最佳实践 <ul><li>@serverless/tencent-scf - 腾讯云云函数组件</li><li>@serverless/tencent-express - 快速部署基于 Express.js 的后端服务到腾讯云函数的组件</li><li>@serverless/tencent-website - 快速部署静态网站到腾讯云的组件</li></ul></li></ul><h3 id="_3-1-云函数-scf-组件" tabindex="-1"><a class="header-anchor" href="#_3-1-云函数-scf-组件"><span>3.1 云函数 SCF 组件</span></a></h3><ul><li><a href="https://cloud.tencent.com/document/product/1154/39271" target="_blank" rel="noopener noreferrer">腾讯云 SCF 云函数组件</a>通过使用 Tencent Serverless Framework，基于云上 Serverless 服务（云函数及触发器等），实现<code>0</code>配置，便捷开发，极速部署您的第一个云函数</li><li><a href="https://console.cloud.tencent.com/scf/list" target="_blank" rel="noopener noreferrer">查看scf</a></li><li><a href="https://github.com/serverless-components/tencent-scf/blob/v2/doc/serverless.yaml" target="_blank" rel="noopener noreferrer">全量配置</a></li></ul><h4 id="_3-1-1-serverless-yml" tabindex="-1"><a class="header-anchor" href="#_3-1-1-serverless-yml"><span>3.1.1 serverless.yml</span></a></h4><ul><li><p><a href="https://nodeca.github.io/js-yaml" target="_blank" rel="noopener noreferrer">js-yaml</a></p><p>tencent-scf\\serverless.yml</p></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line"></span>
<span class="line"> component: scf </span>
<span class="line"> name: scfdemo </span>
<span class="line"> org: test </span>
<span class="line"> app: scfApp </span>
<span class="line"> stage: dev </span>
<span class="line"></span>
<span class="line">inputs:</span>
<span class="line">  name: scfFunctionName</span>
<span class="line">  src: ./src</span>
<span class="line">   runtime: Nodejs10.15 </span>
<span class="line">  region: ap-beijing</span>
<span class="line">  handler: index.main_handler</span>
<span class="line">  events:</span>
<span class="line">    - apigw:</span>
<span class="line">        name: serverless_api</span>
<span class="line">        parameters:</span>
<span class="line">          protocols:</span>
<span class="line">            - http</span>
<span class="line">            - https</span>
<span class="line">          serviceName:</span>
<span class="line">          description: The service of Serverless Framework</span>
<span class="line">          environment: release</span>
<span class="line">          endpoints:</span>
<span class="line">            - path: /index</span>
<span class="line">              method: GET</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-src-index-js" tabindex="-1"><a class="header-anchor" href="#_3-1-2-src-index-js"><span>3.1.2 src\\index.js</span></a></h4><p>tencent-scf\\src\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">main_handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">[</span><span class="token string">&quot;non-exist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-3-tencent-scf-env" tabindex="-1"><a class="header-anchor" href="#_3-1-3-tencent-scf-env"><span>3.1.3 tencent-scf.env</span></a></h4><p>tencent-scf.env</p><ul><li>当前默认支持 CLI 扫描二维码登录，如您希望配置持久的环境变量/密钥信息，也可以本地创建 .env 文件：</li><li><a href="https://console.cloud.tencent.com/cam/capi" target="_blank" rel="noopener noreferrer">API密钥管理</a></li></ul><p><img src="http://img.zhufengpeixun.cn/wechatlogin.jpg" alt="wechatlogin"></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">TENCENT_APP_ID=</span>
<span class="line">TENCENT_SECRET_ID=</span>
<span class="line">TENCENT_SECRET_KEY=</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-4-布署" tabindex="-1"><a class="header-anchor" href="#_3-1-4-布署"><span>3.1.4 布署</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sls --debug</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-2-api-网关组件" tabindex="-1"><a class="header-anchor" href="#_3-2-api-网关组件"><span>3.2 API 网关组件</span></a></h3><ul><li>API网关是将所有API的调用统一接入API网关层，由网关层负责接入和输出</li><li>API网关是用户与服务器的连接器，负责API接口的托管，实现安全防护和统一监控。</li><li>API网关组件是 serverless-tencent 组件库中的基础组件之一，您可以通过该组件快速且方便地创建、配置和管理腾讯云的 API 网关产品。</li><li>通过 API 网关组件，您可以对一个 API 服务/接口进行完整的创建、配置、部署和删除等操作</li><li><a href="https://github.com/serverless-components/tencent-apigateway/blob/master/docs/configure.md" target="_blank" rel="noopener noreferrer">全量配置</a></li></ul><h4 id="_3-2-1-tencent-api-serverless-yml" tabindex="-1"><a class="header-anchor" href="#_3-2-1-tencent-api-serverless-yml"><span>3.2.1 tencent-api\\serverless.yml</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line"></span>
<span class="line">restApi:</span>
<span class="line">    component: &quot;@serverless/tencent-apigateway&quot;</span>
<span class="line">    inputs:</span>
<span class="line">      region: ap-beijing</span>
<span class="line">      protocol: http</span>
<span class="line">      serviceName: serverless</span>
<span class="line">      environment: release</span>
<span class="line">      endpoints:</span>
<span class="line">        - path: /users</span>
<span class="line">          method: GET</span>
<span class="line">          function:</span>
<span class="line">            functionName: scfFunctionName</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-布署" tabindex="-1"><a class="header-anchor" href="#_3-2-2-布署"><span>3.2.2 布署</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sls --debug</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>service<span class="token operator">-</span>mpkd1e88<span class="token operator">-</span><span class="token number">1258145019</span><span class="token punctuation">.</span>gz<span class="token punctuation">.</span>apigw<span class="token punctuation">.</span>tencentcs<span class="token punctuation">.</span>com<span class="token operator">/</span>users</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-3-布署静态网站" tabindex="-1"><a class="header-anchor" href="#_3-3-布署静态网站"><span>3.3 布署静态网站</span></a></h3><ul><li><a href="https://github.com/serverless-components/tencent-website/blob/v2/doc/serverless.yaml" target="_blank" rel="noopener noreferrer">完整配置</a></li></ul><h4 id="_3-3-1-serverless-yml" tabindex="-1"><a class="header-anchor" href="#_3-3-1-serverless-yml"><span>3.3.1 serverless.yml</span></a></h4><p>staticwebsite\\serverless.yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> component: website </span>
<span class="line"> name: websitedemo </span>
<span class="line"> org: test </span>
<span class="line"> app: websiteApp </span>
<span class="line"> stage: dev </span>
<span class="line"></span>
<span class="line">inputs:</span>
<span class="line">  code:</span>
<span class="line">    src: ./code</span>
<span class="line">    index: index.html</span>
<span class="line">    error: index.html  </span>
<span class="line">  region: ap-beijing</span>
<span class="line">  bucketName: my-bucket</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-2-index-html" tabindex="-1"><a class="header-anchor" href="#_3-3-2-index-html"><span>3.3.2 index.html</span></a></h4><p>staticwebsite\\code\\index.html</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;!DOCTYPE html&gt;</span>
<span class="line">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="line"></span>
<span class="line">&lt;head&gt;</span>
<span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
<span class="line">    &lt;title&gt;Document&lt;/title&gt;</span>
<span class="line">&lt;/head&gt;</span>
<span class="line"></span>
<span class="line">&lt;body&gt;</span>
<span class="line">    static website</span>
<span class="line">&lt;/body&gt;</span>
<span class="line"></span>
<span class="line">&lt;/html&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-布署express项目" tabindex="-1"><a class="header-anchor" href="#_3-4-布署express项目"><span>3.4 布署express项目</span></a></h3><ul><li><a href="https://github.com/serverless-components/tencent-express/blob/v2/docs/configure.md" target="_blank" rel="noopener noreferrer">全量配置</a></li></ul><h4 id="_3-4-1-创建项目" tabindex="-1"><a class="header-anchor" href="#_3-4-1-创建项目"><span>3.4.1 创建项目</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir tencent-express</span>
<span class="line">cd tencent-express</span>
<span class="line">npm init -y</span>
<span class="line">cnpm i express -S</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-2-serverless-yml" tabindex="-1"><a class="header-anchor" href="#_3-4-2-serverless-yml"><span>3.4.2 serverless.yml</span></a></h4><p>tencent-express\\serverless.yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> org: orgDemo </span>
<span class="line"> app: appDemo </span>
<span class="line"> stage: dev </span>
<span class="line"> component: express </span>
<span class="line"> name: expressDemo </span>
<span class="line"></span>
<span class="line">inputs:</span>
<span class="line">  src: ./</span>
<span class="line">  region: ap-beijing</span>
<span class="line">  runtime: Nodejs10.15</span>
<span class="line">  apigatewayConf:</span>
<span class="line">    protocols:</span>
<span class="line">      - http</span>
<span class="line">      - https</span>
<span class="line">    environment: release</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-3-sls-js" tabindex="-1"><a class="header-anchor" href="#_3-4-3-sls-js"><span>3.4.3 sls.js</span></a></h4><p>tencent-express\\sls.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/*</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;i am express&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-布署express-layer项目" tabindex="-1"><a class="header-anchor" href="#_3-5-布署express-layer项目"><span>3.5 布署express+layer项目</span></a></h3><ul><li><a href="https://cloud.tencent.com/document/product/583/40159" target="_blank" rel="noopener noreferrer">层管理</a></li><li><a href="https://github.com/serverless-components/tencent-egg/issues/5" target="_blank" rel="noopener noreferrer">打包压缩阶段</a></li></ul><h4 id="_3-5-1-serverless-yml" tabindex="-1"><a class="header-anchor" href="#_3-5-1-serverless-yml"><span>3.5.1 serverless.yml</span></a></h4><p>tencent-express-layer\\serverless.yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> org: orgDemo </span>
<span class="line"> app: appDemo </span>
<span class="line"> stage: dev </span>
<span class="line"> component: express </span>
<span class="line"> name: expressLayerDemo </span>
<span class="line"></span>
<span class="line">inputs:</span>
<span class="line">  src:</span>
<span class="line">     src: ./src </span>
<span class="line">    exclude:</span>
<span class="line">      - .env</span>
<span class="line">  region: ap-beijing</span>
<span class="line">  layers:</span>
<span class="line">    - name: nodeLayer</span>
<span class="line">      version: 1</span>
<span class="line">  runtime: Nodejs10.15</span>
<span class="line">  apigatewayConf:</span>
<span class="line">    protocols:</span>
<span class="line">      - http</span>
<span class="line">      - https</span>
<span class="line">    environment: release</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-2-src-sls-js" tabindex="-1"><a class="header-anchor" href="#_3-5-2-src-sls-js"><span>3.5.2 src\\sls.js</span></a></h4><p>tencent-express-layer\\src\\sls.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/*</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;index.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;Internal Serverless Error&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-部署vue-express全栈应用" tabindex="-1"><a class="header-anchor" href="#_3-6-部署vue-express全栈应用"><span>3.6 部署Vue+Express全栈应用</span></a></h3><ul><li>全栈组件（Vue.js+Express.js）用于通过多个 Serverless Components 部署 Serverless 全栈应用程序</li><li>可以帮助开发者更方便快捷的部署 Serverless 应用，例如利用后端 API 与前端 Vue.js 结合等场景</li><li>serverless Express.js 后端：由腾讯云 Serverless Cloud Function（云函数 SCF） 和腾讯云 API 网关提供相关能力，支持 express.js 框架，帮助开发者架构自己的项目和路由。</li><li>serverless Vue.js 前端：由腾讯云 Cloud Object Storage（对象存储 COS）提供相关存储能力，通过后端 API 传递到前端，并使用 Vue.js 做相关渲染</li></ul><p><img src="https://main.qcloudimg.com/raw/21ae7465b6927c14d9bc4ae6dc33fc17.png" alt="21ae7465b6927c14d9bc4ae6dc33fc17"></p><h4 id="_3-6-1-serverless-yml" tabindex="-1"><a class="header-anchor" href="#_3-6-1-serverless-yml"><span>3.6.1 serverless.yml</span></a></h4><p>vue-fullstack\\serverless.yml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">name</span><span class="token operator">:</span> tencent<span class="token operator">-</span>fullstack<span class="token operator">-</span>vue<span class="token operator">-</span>application</span>
<span class="line"></span>
<span class="line"><span class="token literal-property property">dashboard</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;@serverless/tencent-website&#39;</span></span>
<span class="line">  <span class="token literal-property property">inputs</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">code</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">src</span><span class="token operator">:</span> dist</span>
<span class="line">      <span class="token literal-property property">root</span><span class="token operator">:</span> dashboard</span>
<span class="line">      <span class="token literal-property property">hook</span><span class="token operator">:</span> npm run build</span>
<span class="line">    <span class="token literal-property property">env</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">apiUrl</span><span class="token operator">:</span> $<span class="token punctuation">{</span>api<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span>
<span class="line"><span class="token literal-property property">api</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;@serverless/tencent-express&#39;</span></span>
<span class="line">  <span class="token literal-property property">inputs</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>api</span>
<span class="line">    <span class="token literal-property property">functionName</span><span class="token operator">:</span> tencent<span class="token operator">-</span>fullstack<span class="token operator">-</span>vue<span class="token operator">-</span>api</span>
<span class="line">    <span class="token literal-property property">apigatewayConf</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">protocols</span><span class="token operator">:</span></span>
<span class="line">        <span class="token operator">-</span> https</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-2-api-package-json" tabindex="-1"><a class="header-anchor" href="#_3-6-2-api-package-json"><span>3.6.2 api\\package.json</span></a></h4><p>vue-fullstack\\api\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tencent-fullstack-vue-api&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;cors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.8.5&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.1&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-3-api-app-js" tabindex="-1"><a class="header-anchor" href="#_3-6-3-api-app-js"><span>3.6.3 api\\app.js</span></a></h4><p>vue-fullstack\\api\\app.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token string">&#39;use strict&#39;</span></span>
<span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;cors&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">珠峰架构</span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-4-生成前端项目" tabindex="-1"><a class="header-anchor" href="#_3-6-4-生成前端项目"><span>3.6.4 生成前端项目</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">vue create dashboard</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-6-5-src-app-vue" tabindex="-1"><a class="header-anchor" href="#_3-6-5-src-app-vue"><span>3.6.5 src\\App.vue</span></a></h4><p>vue-fullstack\\dashboard\\src\\App.vue</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;template&gt;</span>
<span class="line">  &lt;div id=&quot;app&quot;&gt;{{message}}&lt;/div&gt;</span>
<span class="line">&lt;/template&gt;</span>
<span class="line"></span>
<span class="line">&lt;script&gt;</span>
<span class="line">import &quot;../env&quot;;</span>
<span class="line">export default {</span>
<span class="line">  name: &quot;App&quot;,</span>
<span class="line">  data() {</span>
<span class="line">    return {</span>
<span class="line">      message: &quot;message&quot;</span>
<span class="line">    };</span>
<span class="line">  },</span>
<span class="line">  mounted() {</span>
<span class="line">    fetch(window.env.apiUrl)</span>
<span class="line">      .then(res =&gt; res.json())</span>
<span class="line">      .then(result =&gt; {</span>
<span class="line">        this.message = result.message;</span>
<span class="line">      });</span>
<span class="line">  }</span>
<span class="line">};</span>
<span class="line">&lt;/script&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-rbac" tabindex="-1"><a class="header-anchor" href="#_2-rbac"><span>2.RBAC</span></a></h2><ul><li>基于角色的权限访问控制（Role-Based Access Control）</li><li>RBAC（Role-Based Access Control，基于角色的访问控制），就是用户通过角色与权限进行关联</li><li>一个用户拥有若干角色,每一个角色拥有若干权限。这样，就构造成<code>用户-角色-权限</code>的授权模型</li><li>在这种模型中，用户与角色之间，角色与权限之间一般是多对多的关系</li><li>在RBAC中最重要的概念包括：用户(User)，角色(Role)，权限(Permission)</li></ul><h3 id="_2-1-示意图" tabindex="-1"><a class="header-anchor" href="#_2-1-示意图"><span>2.1 示意图</span></a></h3><p><img src="http://img.zhufengpeixun.cn/rbacimage.jpg" alt="rbacimage"></p><p><img src="http://img.zhufengpeixun.cn/rbac.png" alt="rbac"></p><h3 id="_2-2-表设计" tabindex="-1"><a class="header-anchor" href="#_2-2-表设计"><span>2.2 表设计</span></a></h3><h4 id="_2-2-1-用户表-user" tabindex="-1"><a class="header-anchor" href="#_2-2-1-用户表-user"><span>2.2.1 用户表(user)</span></a></h4><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th><th style="text-align:left;">默认</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">userName</td><td style="text-align:left;">用户名</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">password</td><td style="text-align:left;">密码</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">userName</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">password</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;isadmin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;isuser&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-角色表-role" tabindex="-1"><a class="header-anchor" href="#_2-2-2-角色表-role"><span>2.2.2 角色表(role)</span></a></h4><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th><th style="text-align:left;">默认</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">name</td><td style="text-align:left;">名称</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">desc</td><td style="text-align:left;">描述</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">name</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">desc</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span> <span class="token constant">E</span></span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;管理员&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;普通用户&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-3-权限表-permission" tabindex="-1"><a class="header-anchor" href="#_2-2-3-权限表-permission"><span>2.2.3 权限表(permission)</span></a></h4><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th><th style="text-align:left;">默认</th></tr></thead><tbody><tr><td style="text-align:left;">id</td><td style="text-align:left;">ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">name</td><td style="text-align:left;">名称</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">parent_id</td><td style="text-align:left;">父ID</td><td style="text-align:left;">int(11)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">icon</td><td style="text-align:left;">图标</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">key</td><td style="text-align:left;">路径</td><td style="text-align:left;">varchar(255)</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">type</td><td style="text-align:left;">类型</td><td style="text-align:left;">varchar(32)</td><td style="text-align:left;"></td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">name</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">parent_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">icon</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">key</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">type</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;授权平台&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;desktop&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;角色管理&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;team&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/role&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;用户管理&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&#39;权限管理&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;idcard&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/resource&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;menu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&#39;添加用户&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;team&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/user/add&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&#39;删除用户&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;team&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/user/delete&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-4-角色用户表-role-user" tabindex="-1"><a class="header-anchor" href="#_2-2-4-角色用户表-role-user"><span>2.2.4 角色用户表(role_user)</span></a></h4><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th></tr></thead><tbody><tr><td style="text-align:left;">role_id</td><td style="text-align:left;">角色ID</td><td style="text-align:left;">int(11)</td></tr><tr><td style="text-align:left;">user_id</td><td style="text-align:left;">用户ID</td><td style="text-align:left;">int(11)</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">DROP</span> <span class="token constant">TABLE</span> <span class="token constant">IF</span> <span class="token constant">EXISTS</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">user_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_user</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-5-角色权限-role-permission" tabindex="-1"><a class="header-anchor" href="#_2-2-5-角色权限-role-permission"><span>2.2.5 角色权限(role_permission)</span></a></h4><table><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">字段名</th><th style="text-align:left;">类型</th></tr></thead><tbody><tr><td style="text-align:left;">role_id</td><td style="text-align:left;">角色ID</td><td style="text-align:left;">int(11)</td></tr><tr><td style="text-align:left;">permission_id</td><td style="text-align:left;">资源ID</td><td style="text-align:left;">int(11)</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span>  <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission_id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">permission_id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">role_permission</span><span class="token template-punctuation string">\`</span></span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-6-数据库脚本" tabindex="-1"><a class="header-anchor" href="#_2-2-6-数据库脚本"><span>2.2.6 数据库脚本</span></a></h4><ul><li><a href="http://img.zhufengpeixun.cn/cms.sql" target="_blank" rel="noopener noreferrer">cms.sql</a></li></ul><h2 id="_3-egg-js" tabindex="-1"><a class="header-anchor" href="#_3-egg-js"><span>3.egg.js</span></a></h2><ul><li><a href="https://github.com/serverless-components/tencent-egg" target="_blank" rel="noopener noreferrer">tencent-egg</a></li></ul><h3 id="_3-1-初始化项目" tabindex="-1"><a class="header-anchor" href="#_3-1-初始化项目"><span>3.1. 初始化项目</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$ mkdir egg-cms &amp;&amp; cd egg-cms</span>
<span class="line">$ cnpm init egg --type=simple</span>
<span class="line">$ cnpm i</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-添加模块" tabindex="-1"><a class="header-anchor" href="#_3-2-添加模块"><span>3.2. 添加模块</span></a></h3><ul><li><a href="https://dev.mysql.com/doc/refman/5.6/en/" target="_blank" rel="noopener noreferrer">mysql</a></li><li><a href="https://github.com/microsoftarchive/redis/releases" target="_blank" rel="noopener noreferrer">redis</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$ cd egg-cms</span>
<span class="line">$ npm install egg-sequelize mysql2 egg-jwt egg-redis --save</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-config-plugin-js" tabindex="-1"><a class="header-anchor" href="#_3-3-config-plugin-js"><span>3.3. config\\plugin.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">sequelize</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">enable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;egg-sequelize&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">jwt</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">enable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;egg-jwt&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">redis</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">enable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;egg-redis&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-config-config-default-js" tabindex="-1"><a class="header-anchor" href="#_3-4-config-config-default-js"><span>3.4. config\\config.default.js</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">/* eslint valid-jsdoc: &quot;off&quot; */</span>
<span class="line"></span>
<span class="line">&#39;use strict&#39;;</span>
<span class="line"></span>
<span class="line">/**</span>
<span class="line"> * @param {Egg.EggAppInfo} appInfo app info</span>
<span class="line"> */</span>
<span class="line">module.exports = appInfo =&gt; {</span>
<span class="line">  /**</span>
<span class="line">   * built-in config</span>
<span class="line">   * @type {Egg.EggAppConfig}</span>
<span class="line">   **/</span>
<span class="line">  const config = exports = {};</span>
<span class="line"></span>
<span class="line">  // use for cookie sign key, should change to your own and keep security</span>
<span class="line">  config.keys = appInfo.name + &#39;_1588409777990_9883&#39;;</span>
<span class="line"></span>
<span class="line">  // add your middleware config here</span>
<span class="line">  config.middleware = [];</span>
<span class="line"></span>
<span class="line">  // add your user config here</span>
<span class="line">  const userConfig = {</span>
<span class="line">+    security: {</span>
<span class="line">+      csrf: false</span>
<span class="line">+    },</span>
<span class="line">+    sequelize: {</span>
<span class="line">+      dialect: &quot;mysql&quot;,</span>
<span class="line">+      host: &quot;localhost&quot;,</span>
<span class="line">+      port: &quot;3306&quot;,</span>
<span class="line">+      database: &quot;egg-cms&quot;,</span>
<span class="line">+      username: &quot;root&quot;,</span>
<span class="line">+      password: &quot;5f8b8a5d650637f8&quot;</span>
<span class="line">+    },</span>
<span class="line">+    redis: {</span>
<span class="line">+      client: {</span>
<span class="line">+        port: 6379,          // Redis port</span>
<span class="line">+        host: &#39;127.0.0.1&#39;,   // Redis host</span>
<span class="line">+        password: &#39;auth&#39;,</span>
<span class="line">+        db: 0,</span>
<span class="line">+      },</span>
<span class="line">+    }</span>
<span class="line">  };</span>
<span class="line"></span>
<span class="line">  return {</span>
<span class="line">    ...config,</span>
<span class="line">    ...userConfig,</span>
<span class="line">  };</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-model-user-js" tabindex="-1"><a class="header-anchor" href="#_3-5-model-user-js"><span>3.5. model\\user.js</span></a></h3><p>app\\model\\user.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token constant">DATE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>Sequelize<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> User <span class="token operator">=</span> app<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token literal-property property">primaryKey</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">autoIncrement</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">userName</span><span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">created_at</span><span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">updated_at</span><span class="token operator">:</span> <span class="token constant">DATE</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> User<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-app-controller-home-js" tabindex="-1"><a class="header-anchor" href="#_3-6-app-controller-home-js"><span>3.6. app\\controller\\home.js</span></a></h3><ul><li><a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">jwt.io</a></li></ul><p>app\\controller\\home.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> Controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;egg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controller<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&#39;hi, egg&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">currentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>state<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">name</span><span class="token operator">:</span> user<span class="token punctuation">.</span>userName<span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">&#39;http://img.zhufengpeixun.cn/tuizi.jpg&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">userid</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> userName<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> userName<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>users<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> user <span class="token operator">=</span> users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> token <span class="token operator">=</span> app<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">id</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">userName</span><span class="token operator">:</span> user<span class="token punctuation">.</span>userName</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span>secret<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">&quot;1h&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">await</span> app<span class="token punctuation">.</span>redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">token_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>user<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;account&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        token</span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HomeController<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-app-router-js" tabindex="-1"><a class="header-anchor" href="#_3-7-app-router-js"><span>3.7. app\\router.js</span></a></h3><p>app\\router.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">module.exports = app =&gt; {</span>
<span class="line">  const { router, controller, jwt } = app;</span>
<span class="line">  router.get(&#39;/&#39;, controller.home.index);</span>
<span class="line">+  router.post(&#39;/api/login/account&#39;, controller.home.login);</span>
<span class="line">+  router.get(&#39;/api/currentUser&#39;, jwt, controller.home.currentUser);</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-8-app-js" tabindex="-1"><a class="header-anchor" href="#_3-8-app-js"><span>3.8. app.js</span></a></h3><p>app.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">AppBootHook</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> app<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">async</span> <span class="token function">willReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">logging</span><span class="token operator">:</span> console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token string">&quot;INSERT INTO users (user_name, password) VALUES (&#39;admin&#39;, &#39;123456&#39;)&quot;</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> AppBootHook<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-前端项目" tabindex="-1"><a class="header-anchor" href="#_4-前端项目"><span>4. 前端项目</span></a></h2><h3 id="_4-1-启动项目" tabindex="-1"><a class="header-anchor" href="#_4-1-启动项目"><span>4.1. 启动项目</span></a></h3><ul><li><a href="https://pro.ant.design/docs/getting-started-cn" target="_blank" rel="noopener noreferrer">pro.ant.design</a></li><li><a href="https://github.com/umijs/create-umi" target="_blank" rel="noopener noreferrer">create-umi</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">umi -v</span>
<span class="line">cnpm create umi</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-config-config-ts" tabindex="-1"><a class="header-anchor" href="#_4-2-config-config-ts"><span>4.2 config\\config.ts</span></a></h3><p>config\\config.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default {</span>
<span class="line">  dev: {</span>
<span class="line">+    &#39;/server/api/&#39;: {</span>
<span class="line">+      target: &#39;http://127.0.0.1:7001&#39;,</span>
<span class="line">+      changeOrigin: true,</span>
<span class="line">+      pathRewrite: { &#39;^/server&#39;: &#39;&#39; },</span>
<span class="line">+    },</span>
<span class="line">    /* &#39;/api/&#39;: {</span>
<span class="line">      target: &#39;https://preview.pro.ant.design&#39;,</span>
<span class="line">      changeOrigin: true,</span>
<span class="line">      pathRewrite: { &#39;^&#39;: &#39;&#39; },</span>
<span class="line">    }, */</span>
<span class="line">  },</span>
<span class="line">  test: {</span>
<span class="line">    &#39;/api/&#39;: {</span>
<span class="line">      target: &#39;https://preview.pro.ant.design&#39;,</span>
<span class="line">      changeOrigin: true,</span>
<span class="line">      pathRewrite: { &#39;^&#39;: &#39;&#39; },</span>
<span class="line">    },</span>
<span class="line">  },</span>
<span class="line">  pre: {</span>
<span class="line">    &#39;/api/&#39;: {</span>
<span class="line">      target: &#39;your pre url&#39;,</span>
<span class="line">      changeOrigin: true,</span>
<span class="line">      pathRewrite: { &#39;^&#39;: &#39;&#39; },</span>
<span class="line">    },</span>
<span class="line">  },</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-services-login-ts" tabindex="-1"><a class="header-anchor" href="#_4-3-services-login-ts"><span>4.3 services\\login.ts</span></a></h3><p>src\\services\\login.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export async function fakeAccountLogin(params: LoginParamsType) {</span>
<span class="line">+  return request(&#39;/server/api/login/account&#39;, {</span>
<span class="line">    method: &#39;POST&#39;,</span>
<span class="line">    data: params,</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-services-user-ts" tabindex="-1"><a class="header-anchor" href="#_4-4-services-user-ts"><span>4.4 services\\user.ts</span></a></h3><p>src\\services\\user.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export async function queryCurrent(): Promise&lt;any&gt; {</span>
<span class="line">+  return request(&#39;/server/api/currentUser&#39;);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-models-login-ts" tabindex="-1"><a class="header-anchor" href="#_4-5-models-login-ts"><span>4.5 models\\login.ts</span></a></h3><p>src\\models\\login.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">*</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>fakeAccountLogin<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;changeLoginStatus&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">payload</span><span class="token operator">:</span> response<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// Login successfully</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>          localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">const</span> urlParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-utils-request-ts" tabindex="-1"><a class="header-anchor" href="#_4-6-utils-request-ts"><span>4.6 utils\\request.ts</span></a></h3><p>src\\utils\\request.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const request = extend({</span>
<span class="line">  errorHandler, // 默认错误处理</span>
<span class="line">  credentials: &#39;include&#39;, // 默认请求是否带上cookie</span>
<span class="line">});</span>
<span class="line">+request.interceptors.request.use((url: any, options: any) =&gt; {</span>
<span class="line">+  if (localStorage.getItem(&#39;token&#39;)) {</span>
<span class="line">+    options.headers.Authorization = &#39;Bearer &#39; + localStorage.getItem(&#39;token&#39;)</span>
<span class="line">+  }</span>
<span class="line">+  return { url, options };</span>
<span class="line">+});</span>
<span class="line">export default request;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,142)])])}const o=n(p,[["render",l]]),r=JSON.parse('{"path":"/strong/97.serverless.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/97.serverless.md"}');export{o as comp,r as data};
