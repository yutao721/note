import{_ as n,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(o,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-前端项目最佳实践" tabindex="-1"><a class="header-anchor" href="#_1-前端项目最佳实践"><span>1.前端项目最佳实践</span></a></h2><h3 id="_1-工具选择" tabindex="-1"><a class="header-anchor" href="#_1-工具选择"><span>1. 工具选择</span></a></h3><table><thead><tr><th style="text-align:left;">类别</th><th style="text-align:left;">选择</th></tr></thead><tbody><tr><td style="text-align:left;">框架</td><td style="text-align:left;"><a href="https://reactjs.org/" target="_blank" rel="noopener noreferrer">react</a></td></tr><tr><td style="text-align:left;">JS语言</td><td style="text-align:left;"><a href="http://www.typescriptlang.org" target="_blank" rel="noopener noreferrer">TypeScript</a></td></tr><tr><td style="text-align:left;">CSS语言</td><td style="text-align:left;"><a href="https://github.com/css-modules/css-modules" target="_blank" rel="noopener noreferrer">css-modules</a>+<a href="http://lesscss.org" target="_blank" rel="noopener noreferrer">less</a>+<a href="https://github.com/postcss/postcss" target="_blank" rel="noopener noreferrer">postcss</a></td></tr><tr><td style="text-align:left;">JS编译</td><td style="text-align:left;"><a href="https://www.babeljs.cn/" target="_blank" rel="noopener noreferrer">babel</a></td></tr><tr><td style="text-align:left;">模块打包</td><td style="text-align:left;"><a href="https://webpack.github.io/" target="_blank" rel="noopener noreferrer">webpack全家桶</a></td></tr><tr><td style="text-align:left;">单元测试</td><td style="text-align:left;"><a href="https://github.com/facebook/jest" target="_blank" rel="noopener noreferrer">jest</a>+<a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener noreferrer">enzyme</a>+<a href="https://github.com/puppeteer/puppeteer" target="_blank" rel="noopener noreferrer">puppteer</a>+<a href="https://github.com/jsdom/jsdom" target="_blank" rel="noopener noreferrer">jsdom</a></td></tr><tr><td style="text-align:left;">路由</td><td style="text-align:left;"><a href="https://github.com/ReactTraining/react-router" target="_blank" rel="noopener noreferrer">react-router</a></td></tr><tr><td style="text-align:left;">数据流</td><td style="text-align:left;"><a href="https://dvajs.com" target="_blank" rel="noopener noreferrer">dva</a>+<a href="https://www.redux.org.cn/" target="_blank" rel="noopener noreferrer">redux生态</a></td></tr><tr><td style="text-align:left;">代码风格</td><td style="text-align:left;"><a href="https://eslint.org/" target="_blank" rel="noopener noreferrer">eslint</a>+<a href="https://prettier.io/" target="_blank" rel="noopener noreferrer">prettier</a></td></tr><tr><td style="text-align:left;">JS压缩</td><td style="text-align:left;"><a href="https://github.com/terser/terser" target="_blank" rel="noopener noreferrer">TerserJS</a></td></tr><tr><td style="text-align:left;">CSS压缩</td><td style="text-align:left;"><a href="https://github.com/cssnano/cssnano" target="_blank" rel="noopener noreferrer">cssnano</a></td></tr><tr><td style="text-align:left;">请求库</td><td style="text-align:left;">[umi-request](https://github.com/umijs/umi-request</td></tr><tr><td style="text-align:left;">UI</td><td style="text-align:left;"><a href="https://ant.design/docs/react/introduce-cn" target="_blank" rel="noopener noreferrer">AntDesign</a>+<a href="https://pro.ant.design/index-cn" target="_blank" rel="noopener noreferrer">AntDesignPro</a></td></tr><tr><td style="text-align:left;">国际化</td><td style="text-align:left;"><a href="https://github.com/formatjs/react-intl" target="_blank" rel="noopener noreferrer">react-intl</a></td></tr><tr><td style="text-align:left;">hooks库</td><td style="text-align:left;"><a href="https://hooks.umijs.org/" target="_blank" rel="noopener noreferrer">umi-hooks</a></td></tr><tr><td style="text-align:left;">静态文档</td><td style="text-align:left;"><a href="https://www.docz.site/" target="_blank" rel="noopener noreferrer">docz</a></td></tr><tr><td style="text-align:left;">微前端</td><td style="text-align:left;"><a href="https://github.com/umijs/qiankun" target="_blank" rel="noopener noreferrer">qiankun</a></td></tr><tr><td style="text-align:left;">图表库</td><td style="text-align:left;"><a href="https://antv.vision/" target="_blank" rel="noopener noreferrer">antv</a></td></tr></tbody></table><h3 id="_2-技术栈选型" tabindex="-1"><a class="header-anchor" href="#_2-技术栈选型"><span>2.技术栈选型</span></a></h3><h4 id="_2-1-固定化" tabindex="-1"><a class="header-anchor" href="#_2-1-固定化"><span>2.1 固定化</span></a></h4><ul><li>React框架</li><li>TypeScript语言</li><li>Less+CSS Modules</li><li>Eslint+Prettier+固定配置</li><li>固定数据流方案dva</li><li>固定babel插件</li><li>Jest+Enzyme</li><li>框架版本不允许锁定，^前缀必须有</li><li>主要依赖不允许自定义依赖版本</li></ul><h4 id="_2-2-配置化" tabindex="-1"><a class="header-anchor" href="#_2-2-配置化"><span>2.2 配置化</span></a></h4><ul><li>不仅是框架功能，还有UI界面</li><li>路由、布局、菜单、导航、面包屑、权限、请求、埋点、错误处理</li><li>只管写Page页面就可以了</li></ul><h5 id="_2-2-1-编译态配置" tabindex="-1"><a class="header-anchor" href="#_2-2-1-编译态配置"><span>2.2.1 编译态配置</span></a></h5><ul><li>给node.js使用，比如webpack、babel相关配置，静态路由配置</li></ul><h5 id="_2-2-2-运行态配置" tabindex="-1"><a class="header-anchor" href="#_2-2-2-运行态配置"><span>2.2.2 运行态配置</span></a></h5><ul><li>给浏览器用、比如渲染逻辑、动态修改路由、获取用户信息</li></ul><h4 id="_2-3-约定化" tabindex="-1"><a class="header-anchor" href="#_2-3-约定化"><span>2.3 约定化</span></a></h4><ul><li>国际化</li><li>数据流</li><li>MOCK</li><li>目录结构</li><li>404</li><li>权限策略</li><li>Service</li><li>配置文件</li></ul><h3 id="_1-3-理念" tabindex="-1"><a class="header-anchor" href="#_1-3-理念"><span>1.3 理念</span></a></h3><ul><li>通过最佳实践减少不必要的选择的差异</li><li>通过插件和插件集的架构方式，满足不同场景的业务</li><li>通过资产市场和场景市场着力解决70%的开发者问题</li><li>通过对垂直场景采取强约束的方式，进一步提升研发效率</li><li>不给选择、配置化、约定化</li></ul><h2 id="_2-前端" tabindex="-1"><a class="header-anchor" href="#_2-前端"><span>2.前端</span></a></h2><h3 id="_2-1-ant-design-pro项目初始化" tabindex="-1"><a class="header-anchor" href="#_2-1-ant-design-pro项目初始化"><span>2.1. Ant Design Pro项目初始化</span></a></h3><ul><li><a href="https://pro.ant.design/docs/getting-started-cn" target="_blank" rel="noopener noreferrer">pro.ant.design</a></li><li><a href="https://github.com/ant-design/pro-blocks" target="_blank" rel="noopener noreferrer">Pro的区块</a></li><li><a href="https://github.com/ant-design/ant-design-pro-layout" target="_blank" rel="noopener noreferrer">ant-design-pro-layout</a></li><li><a href="https://ant-design.github.io/ant-design-pro-layout/?path=/story/basiclayout--readecn" target="_blank" rel="noopener noreferrer">ant-design-pro-layout</a></li><li><a href="https://github.com/ant-design/pro-blocks" target="_blank" rel="noopener noreferrer">pro-blocks</a></li><li><a href="https://pro.ant.design/docs/uset-typescript-cn" target="_blank" rel="noopener noreferrer">uset-typescript-cn</a></li><li>[umi-config](https://umijs.org/zh/config/</li><li><code>Ant Design Pro</code> 是一个企业级中后台前端/设计解决方案，我们秉承 Ant Design 的设计价值观，致力于在设计规范和基础组件的基础上，继续向上构建，提炼出典型模板/业务组件/配套设计资源，进一步提升企业级中后台产品设计研发过程中的『用户』和『设计者』的体验。</li></ul><h3 id="_2-2-启动项目" tabindex="-1"><a class="header-anchor" href="#_2-2-启动项目"><span>2.2 启动项目</span></a></h3><h4 id="_2-2-1-安装" tabindex="-1"><a class="header-anchor" href="#_2-2-1-安装"><span>2.2.1 安装</span></a></h4><ul><li>新建一个空的文件夹作为项目目录，并在目录下执行</li><li><a href="https://www.python.org/downloads/release/python-380/" target="_blank" rel="noopener noreferrer">python-380</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">npm config <span class="token keyword">set</span> python <span class="token string">&quot;C:/Python38/python.exe&quot;</span></span>
<span class="line">yarn create umi</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-目录结构" tabindex="-1"><a class="header-anchor" href="#_2-2-2-目录结构"><span>2.2.2 目录结构</span></a></h4><ul><li>我们已经为你生成了一个完整的开发框架，提供了涵盖中后台开发的各类功能和坑位，下面是整个项目的目录结构。</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> ├── config                   </span>
<span class="line"> ├── mock                     </span>
<span class="line">├── public</span>
<span class="line"> │   └── favicon.png          </span>
<span class="line">├── src</span>
<span class="line"> │   ├── assets               </span>
<span class="line"> │   ├── components           </span>
<span class="line"> │   ├── e2e                  </span>
<span class="line"> │   ├── layouts              </span>
<span class="line"> │   ├── models               </span>
<span class="line"> │   ├── pages                </span>
<span class="line"> │   ├── services             </span>
<span class="line"> │   ├── utils                </span>
<span class="line"> │   ├── locales              </span>
<span class="line"> │   ├── global.less          </span>
<span class="line"> │   └── global.ts            </span>
<span class="line"> ├── tests                    </span>
<span class="line">├── README.md</span>
<span class="line">└── package.json</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-3-本地开发" tabindex="-1"><a class="header-anchor" href="#_2-2-3-本地开发"><span>2.2.3 本地开发</span></a></h4><p>安装依赖</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">git init</span>
<span class="line">npm install</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>启动项目</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-3-用户注册" tabindex="-1"><a class="header-anchor" href="#_2-3-用户注册"><span>2.3 用户注册</span></a></h3><ul><li><a href="https://umijs.org/zh/guide/block.html" target="_blank" rel="noopener noreferrer">umijs-block</a></li><li><a href="https://pro.ant.design/docs/block-cn" target="_blank" rel="noopener noreferrer">pro区块</a></li><li><a href="https://preview.pro.ant.design/dashboard/analysis" target="_blank" rel="noopener noreferrer">pro-dashboard</a></li><li><a href="https://github.com/ant-design/pro-blocks" target="_blank" rel="noopener noreferrer">pro-blocks下载</a></li></ul><h4 id="_2-3-1-先配置区块下载地址" tabindex="-1"><a class="header-anchor" href="#_2-3-1-先配置区块下载地址"><span>2.3.1 先配置区块下载地址</span></a></h4><p>config.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default {</span>
<span class="line">  plugins,</span>
<span class="line">+ block: {</span>
<span class="line">+   defaultGitUrl: &#39;https://github.com/ant-design/pro-blocks&#39;,</span>
<span class="line">+ },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-2-区块列表" tabindex="-1"><a class="header-anchor" href="#_2-3-2-区块列表"><span>2.3.2 区块列表</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">umi block list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function">UserRegister</span> <span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>preview<span class="token punctuation">.</span>pro<span class="token punctuation">.</span>ant<span class="token punctuation">.</span>design<span class="token operator">/</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>preview<span class="token punctuation">.</span>pro<span class="token punctuation">.</span>ant<span class="token punctuation">.</span>design<span class="token operator">/</span>user<span class="token operator">/</span>register<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token function">UserRegisterResult</span>  <span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>preview<span class="token punctuation">.</span>pro<span class="token punctuation">.</span>ant<span class="token punctuation">.</span>design<span class="token operator">/</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>preview<span class="token punctuation">.</span>pro<span class="token punctuation">.</span>ant<span class="token punctuation">.</span>design<span class="token operator">/</span>user<span class="token operator">/</span>register<span class="token operator">/</span>result<span class="token punctuation">)</span></span>
<span class="line">请输入输出安装区块的路径 <span class="token operator">/</span>user<span class="token operator">/</span>register<span class="token operator">-</span>result</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-3-user-register-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-3-3-user-register-index-tsx"><span>2.3.3 user\\register\\index.tsx</span></a></h4><p>src\\pages\\user\\register\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">  <span class="token function-variable function">onGetCaptcha</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> form <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">const</span> mobile <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">getFieldValue</span><span class="token punctuation">(</span><span class="token string">&#39;mobile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>      type<span class="token operator">:</span> <span class="token string">&#39;login/getCaptcha&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>      payload<span class="token operator">:</span> mobile<span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">59</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      count <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span>   <span class="token operator">&lt;</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;currentAuthority&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>              rules<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                  required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                  message<span class="token operator">:</span> <span class="token function">formatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;userandregister.currentAuthority.required&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line"><span class="token operator">+</span>              <span class="token operator">&lt;</span>Select placeholder<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">formatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;userandregister.currentAuthority.placeholder&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token operator">&lt;</span>Option value<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">&gt;</span>普通用户<span class="token operator">&lt;</span><span class="token operator">/</span>Option<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token operator">&lt;</span>Option value<span class="token operator">=</span><span class="token string">&quot;admin&quot;</span><span class="token operator">&gt;</span>管理员<span class="token operator">&lt;</span><span class="token operator">/</span>Option<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>              <span class="token operator">&lt;</span><span class="token operator">/</span>Select<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-4-user-register-locales-zh-cn-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-4-user-register-locales-zh-cn-ts"><span>2.3.4 user\\register\\locales\\zh-CN.ts</span></a></h4><p>src\\pages\\user\\register\\locales\\zh-CN.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+  &#39;userandregister.currentAuthority.placeholder&#39;: &#39;角色&#39;,</span>
<span class="line">+  &#39;userandregister.currentAuthority.required&#39;: &#39;请输入邮箱地址！&#39;,</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-5-user-register-service-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-5-user-register-service-ts"><span>2.3.5 user\\register\\service.ts</span></a></h4><p>src\\pages\\user\\register\\service.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import request from &#39;@/utils/request&#39;;</span>
<span class="line">import { UserRegisterParams } from &#39;./index&#39;;</span>
<span class="line"></span>
<span class="line">export async function fakeRegister(params: UserRegisterParams) {</span>
<span class="line">+  return request(&#39;/server/api/register&#39;, {</span>
<span class="line">    method: &#39;POST&#39;,</span>
<span class="line">    data: params,</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-6-src-services-login-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-6-src-services-login-ts"><span>2.3.6 src\\services\\login.ts</span></a></h4><p>src\\services\\login.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export async function getFakeCaptcha(mobile: string) {</span>
<span class="line">+  return request(\`/server/api/login/captcha?mobile=\${mobile}\`);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-用户登录" tabindex="-1"><a class="header-anchor" href="#_2-4-用户登录"><span>2.4. 用户登录</span></a></h3><h4 id="_2-4-1-services-login-ts" tabindex="-1"><a class="header-anchor" href="#_2-4-1-services-login-ts"><span>2.4.1 services\\login.ts</span></a></h4><p>src\\services\\login.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export async function fakeAccountLogin(params: LoginParamsType) {</span>
<span class="line">+  return request(&#39;/server/api/login/account&#39;, {</span>
<span class="line">    method: &#39;POST&#39;,</span>
<span class="line">    data: params,</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-2-src-services-user-ts" tabindex="-1"><a class="header-anchor" href="#_2-4-2-src-services-user-ts"><span>2.4.2 src\\services\\user.ts</span></a></h4><p>src\\services\\user.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export async function queryCurrent(): Promise&lt;any&gt; {</span>
<span class="line">+  return request(&#39;/server/api/currentUser&#39;);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-权限菜单" tabindex="-1"><a class="header-anchor" href="#_2-5-权限菜单"><span>2.5. 权限菜单</span></a></h3><h4 id="_2-5-1-src-models-login-ts" tabindex="-1"><a class="header-anchor" href="#_2-5-1-src-models-login-ts"><span>2.5.1 src\\models\\login.ts</span></a></h4><p>src\\models\\login.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>          localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">const</span> urlParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-2-src-utils-request-ts" tabindex="-1"><a class="header-anchor" href="#_2-5-2-src-utils-request-ts"><span>2.5.2 src\\utils\\request.ts</span></a></h4><p>src\\utils\\request.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const request = extend({</span>
<span class="line">  errorHandler, // 默认错误处理</span>
<span class="line">  credentials: &#39;include&#39;, // 默认请求是否带上cookie</span>
<span class="line">});</span>
<span class="line">+const baseURL = &#39;http://localhost:4000&#39;;</span>
<span class="line">+request.interceptors.request.use((url: any, options: any) =&gt; {</span>
<span class="line">+  if (localStorage.getItem(&#39;token&#39;)) {</span>
<span class="line">+    options.headers.Authorization = &#39;Bearer &#39; + localStorage.getItem(&#39;token&#39;)</span>
<span class="line">+  }</span>
<span class="line">+  if (url.startsWith(&#39;/server&#39;)) {</span>
<span class="line">+    url = baseURL + url.slice(7);</span>
<span class="line">+  }</span>
<span class="line">+  return { url, options };</span>
<span class="line">+});</span>
<span class="line"></span>
<span class="line">export default request;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-docker" tabindex="-1"><a class="header-anchor" href="#_2-6-docker"><span>2.6 docker</span></a></h3><h4 id="_2-6-1-dockerfile" tabindex="-1"><a class="header-anchor" href="#_2-6-1-dockerfile"><span>2.6.1 Dockerfile</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">FROM</span> nginx</span>
<span class="line"><span class="token constant">LABEL</span> name<span class="token operator">=</span><span class="token string">&quot;antdesign-front&quot;</span></span>
<span class="line"><span class="token constant">LABEL</span> version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span></span>
<span class="line"><span class="token constant">COPY</span>  <span class="token punctuation">.</span><span class="token operator">/</span>dist<span class="token operator">/</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span></span>
<span class="line"><span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>antdesign<span class="token operator">-</span>front<span class="token punctuation">.</span>conf <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span></span>
<span class="line"><span class="token constant">EXPOSE</span> <span class="token number">80</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-2-dockerignore" tabindex="-1"><a class="header-anchor" href="#_2-6-2-dockerignore"><span>2.6.2 .dockerignore</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">.git</span>
<span class="line">node_modules</span>
<span class="line">package-lock.json</span>
<span class="line">Dockerfile</span>
<span class="line">.dockerignore</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-3-antdesign-front-conf" tabindex="-1"><a class="header-anchor" href="#_2-6-3-antdesign-front-conf"><span>2.6.3 antdesign-front.conf</span></a></h4><p>antdesign-front.conf</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">server {</span>
<span class="line">    listen       80;</span>
<span class="line">    server_name  47.104.204.74;</span>
<span class="line">    location / {</span>
<span class="line">        root   /usr/share/nginx/html;</span>
<span class="line">        index  index.html index.htm;</span>
<span class="line">        try_files $uri $uri/ /index.html;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-后端" tabindex="-1"><a class="header-anchor" href="#_3-后端"><span>3.后端</span></a></h2><h3 id="_3-1-api-js" tabindex="-1"><a class="header-anchor" href="#_3-1-api-js"><span>3.1 api.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;body-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;jwt-simple&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> Models <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> sendCode <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./sms&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express-session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> MongoStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;connect-mongo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> config <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">?</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config/config.prod&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config/config.dev&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">origin</span><span class="token operator">:</span> config<span class="token punctuation">.</span>origin<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">allowedHeaders</span><span class="token operator">:</span> <span class="token string">&quot;Content-Type,Authorization&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token string">&quot;GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">secret</span><span class="token operator">:</span> config<span class="token punctuation">.</span>secret<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">store</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">MongoStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">url</span><span class="token operator">:</span> config<span class="token punctuation">.</span>dbUrl<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">mongoOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">hello</span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/login/captcha&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> mobile <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>mobile<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> captcha <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>captcha <span class="token operator">=</span> captcha<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">sendCode</span><span class="token punctuation">(</span>mobile<span class="token punctuation">,</span> captcha<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[仅限测试环境验证码]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>captcha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/register&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>captcha <span class="token operator">!=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>captcha<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&#39;验证码不正确&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> avatarValue <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;crypto&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">&#39;md5&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>mail<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&#39;hex&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    user<span class="token punctuation">.</span>avatar <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://secure.gravatar.com/avatar/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>avatarValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?s=48</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    user <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/login/account&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&#39;account&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        query<span class="token punctuation">.</span>mail <span class="token operator">=</span> user<span class="token punctuation">.</span>userName<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&#39;mobile&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        query<span class="token punctuation">.</span>mobile <span class="token operator">=</span> user<span class="token punctuation">.</span>mobile<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>captcha <span class="token operator">!=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>captcha<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">type</span><span class="token operator">:</span> user<span class="token punctuation">.</span>type<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token string">&#39;guest&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> dbUser <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>dbUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        dbUser<span class="token punctuation">.</span>userid <span class="token operator">=</span> dbUser<span class="token punctuation">.</span>_id<span class="token punctuation">;</span></span>
<span class="line">        dbUser<span class="token punctuation">.</span>name <span class="token operator">=</span> dbUser<span class="token punctuation">.</span>mail<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>dbUser<span class="token punctuation">,</span> config<span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> user<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> dbUser<span class="token punctuation">.</span>currentAuthority <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> user<span class="token punctuation">.</span>type<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token string">&#39;guest&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/currentUser&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> authorization <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;authorization&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>authorization<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> user <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>authorization<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            user<span class="token punctuation">.</span>userid <span class="token operator">=</span> user<span class="token punctuation">.</span>_id<span class="token punctuation">;</span></span>
<span class="line">            user<span class="token punctuation">.</span>name <span class="token operator">=</span> user<span class="token punctuation">.</span>mail<span class="token punctuation">;</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;服务器在4000端口启动!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> min <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">9999</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-db-js" tabindex="-1"><a class="header-anchor" href="#_3-2-db-js"><span>3.2 db.js</span></a></h3><p>db.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> ObjectId <span class="token operator">=</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> configs <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">?</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config/config.prod&#39;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config/config.dev&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> conn <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>configs<span class="token punctuation">.</span>dbUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> UserModel <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//邮箱</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">mail</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//邮箱</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//密码</span></span>
<span class="line">    <span class="token literal-property property">mobile</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//手机号</span></span>
<span class="line">    <span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//头像</span></span>
<span class="line">    <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token comment">//当前用户的权限</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    UserModel</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-config-prod-js" tabindex="-1"><a class="header-anchor" href="#_3-3-config-prod-js"><span>3.3 config.prod.js</span></a></h3><p>config\\config.prod.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">&#39;zhufengcms&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">dbUrl</span><span class="token operator">:</span> <span class="token string">&quot;mongodb://antdesign-mongo:27017/zhufengcms&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://47.104.204.74&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://47.104.204.74:8000&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-config-config-dev-js" tabindex="-1"><a class="header-anchor" href="#_3-4-config-config-dev-js"><span>3.4 config\\config.dev.js</span></a></h3><p>config\\config.dev.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">&#39;zhufengcms&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">dbUrl</span><span class="token operator">:</span> <span class="token string">&quot;mongodb://localhost:27017/zhufengcms&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://localhost:8000&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-sms-js" tabindex="-1"><a class="header-anchor" href="#_3-5-sms-js"><span>3.5 sms.js</span></a></h3><p>sms.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;axios&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> smsConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./smsConfig&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//http://docs.ucpaas.com/doku.php?id=%E7%9F%AD%E4%BF%A1:sendsms</span></span>
<span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">mobile<span class="token punctuation">,</span> captcha</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&#39;https://open.ucpaas.com/ol/sms/sendsms&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        url<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">sid</span><span class="token operator">:</span> smsConfig<span class="token punctuation">.</span>sid<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">token</span><span class="token operator">:</span> smsConfig<span class="token punctuation">.</span>token<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">appid</span><span class="token operator">:</span> smsConfig<span class="token punctuation">.</span>appid<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">templateid</span><span class="token operator">:</span> smsConfig<span class="token punctuation">.</span>templateid<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">param</span><span class="token operator">:</span> captcha<span class="token punctuation">,</span></span>
<span class="line">            mobile</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json;charset=utf-8&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;Accept&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-smsconfig-js" tabindex="-1"><a class="header-anchor" href="#_3-6-smsconfig-js"><span>3.6 smsConfig.js</span></a></h3><p>smsConfig.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">sid</span><span class="token operator">:</span> <span class="token string">&#39;32548fb951ac0df279db0e6e9a515566&#39;</span><span class="token punctuation">,</span>      <span class="token comment">//开发者账号id</span></span>
<span class="line">    <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token string">&#39;aa0309c08920ca38201de69eb3c745b6&#39;</span><span class="token punctuation">,</span>    <span class="token comment">//开发者token</span></span>
<span class="line">    <span class="token literal-property property">appid</span><span class="token operator">:</span> <span class="token string">&#39;16129d504b7c484c9e8f09b4ec929983&#39;</span><span class="token punctuation">,</span>    <span class="token comment">//应用id</span></span>
<span class="line">    <span class="token literal-property property">templateid</span><span class="token operator">:</span> <span class="token string">&#39;387675&#39;</span>                          <span class="token comment">//短信模板id</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-package-json" tabindex="-1"><a class="header-anchor" href="#_3-7-package-json"><span>3.7 package.json</span></a></h3><p>package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node api.js&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-8-dockerfile" tabindex="-1"><a class="header-anchor" href="#_3-8-dockerfile"><span>3.8 Dockerfile</span></a></h3><p>Dockerfile</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">FROM</span> node</span>
<span class="line"><span class="token constant">ENV</span> <span class="token constant">NODE_ENV</span> production</span>
<span class="line"><span class="token constant">LABEL</span> name<span class="token operator">=</span><span class="token string">&quot;antdesign-server&quot;</span></span>
<span class="line"><span class="token constant">LABEL</span> version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span></span>
<span class="line"><span class="token constant">COPY</span> <span class="token punctuation">.</span> <span class="token operator">/</span>app</span>
<span class="line"><span class="token constant">WORKDIR</span> <span class="token operator">/</span>app</span>
<span class="line"><span class="token constant">RUN</span> npm install</span>
<span class="line"><span class="token constant">EXPOSE</span> <span class="token number">4000</span></span>
<span class="line"><span class="token constant">CMD</span> npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-9-dockerignore" tabindex="-1"><a class="header-anchor" href="#_3-9-dockerignore"><span>3.9 .dockerignore</span></a></h3><p>.dockerignore</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">.git</span>
<span class="line">node_modules</span>
<span class="line">package-lock.json</span>
<span class="line">Dockerfile</span>
<span class="line">.dockerignore</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-服务器布署" tabindex="-1"><a class="header-anchor" href="#_4-服务器布署"><span>4.服务器布署</span></a></h2><h3 id="_4-1-安装配置服务器" tabindex="-1"><a class="header-anchor" href="#_4-1-安装配置服务器"><span>4.1 安装配置服务器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">yum update  -y</span>
<span class="line"> </span>
<span class="line">yum upgrade </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-docker是什么" tabindex="-1"><a class="header-anchor" href="#_4-2-docker是什么"><span>4.2 docker是什么?</span></a></h3><ul><li><code>Docker</code> 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。</li><li><code>Docker</code> 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样</li></ul><p><img src="http://img.zhufengpeixun.cn/dockercontainer.png" alt="dockercontainer"></p><h3 id="_4-3-安装docker" tabindex="-1"><a class="header-anchor" href="#_4-3-安装docker"><span>4.3 安装docker</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils   device<span class="token operator">-</span>mapper<span class="token operator">-</span>persistent<span class="token operator">-</span>data   lvm2</span>
<span class="line">yum<span class="token operator">-</span>config<span class="token operator">-</span>manager \\</span>
<span class="line">    <span class="token operator">--</span>add<span class="token operator">-</span>repo \\</span>
<span class="line">    <span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo</span>
<span class="line">yum install <span class="token operator">-</span>y docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-阿里云加速" tabindex="-1"><a class="header-anchor" href="#_4-4-阿里云加速"><span>4.4 阿里云加速</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir -p /etc/docker</span>
<span class="line">tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;</span>
<span class="line">{</span>
<span class="line">  &quot;registry-mirrors&quot;: [&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;]</span>
<span class="line">}</span>
<span class="line">EOF</span>
<span class="line"> </span>
<span class="line">systemctl daemon-reload</span>
<span class="line">systemctl restart docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-安装git" tabindex="-1"><a class="header-anchor" href="#_4-5-安装git"><span>4.5 安装git</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum install git -y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-6-安装node和npm" tabindex="-1"><a class="header-anchor" href="#_4-6-安装node和npm"><span>4.6 安装node和npm</span></a></h3><ul><li><a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener noreferrer">nvm</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">curl <span class="token operator">-</span>o<span class="token operator">-</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>nvm<span class="token operator">-</span>sh<span class="token operator">/</span>nvm<span class="token operator">/</span>v0<span class="token punctuation">.</span><span class="token number">35.1</span><span class="token operator">/</span>install<span class="token punctuation">.</span>sh <span class="token operator">|</span> bash</span>
<span class="line"></span>
<span class="line">source <span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>bashrc</span>
<span class="line">nvm ls<span class="token operator">-</span>remote</span>
<span class="line">nvm install v12<span class="token punctuation">.</span><span class="token number">13.1</span></span>
<span class="line">npm i cnpm <span class="token operator">-</span>g</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-创建docker网络" tabindex="-1"><a class="header-anchor" href="#_4-7-创建docker网络"><span>4.7 创建docker网络</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker network create --driver bridge antdesign</span>
<span class="line">docker network connect  antdesign antdesign-mongo</span>
<span class="line">docker network inspect antdesign</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-8-启动mongodb" tabindex="-1"><a class="header-anchor" href="#_4-8-启动mongodb"><span>4.8 启动mongodb</span></a></h3><h4 id="_4-8-1-启动mongo的docker容器" tabindex="-1"><a class="header-anchor" href="#_4-8-1-启动mongo的docker容器"><span>4.8.1 启动mongo的docker容器</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker pull mongo<span class="token operator">:</span>latest</span>
<span class="line">docker images</span>
<span class="line">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name antdesign<span class="token operator">-</span>mongo <span class="token operator">-</span>p <span class="token number">27017</span><span class="token operator">:</span><span class="token number">27017</span> <span class="token operator">--</span>net antdesign mongo</span>
<span class="line">docker ps</span>
<span class="line">docker exec <span class="token operator">-</span>it antdesign<span class="token operator">-</span>mongo bash</span>
<span class="line">mongo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-8-2-本地安装mongodb" tabindex="-1"><a class="header-anchor" href="#_4-8-2-本地安装mongodb"><span>4.8.2 本地安装mongodb</span></a></h4><h5 id="_4-8-2-1-配置mongodb的yum源" tabindex="-1"><a class="header-anchor" href="#_4-8-2-1-配置mongodb的yum源"><span>4.8.2.1 配置MongoDB的yum源</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">vim /etc/yum.repos.d/mongodb-org-4.0.repo</span>
<span class="line"> </span>
<span class="line">[mongodb-org-4.0]</span>
<span class="line">name=MongoDB Repository</span>
<span class="line">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.0/x86_64/</span>
<span class="line">gpgcheck=0</span>
<span class="line">enabled=1</span>
<span class="line">gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc</span>
<span class="line"></span>
<span class="line"> </span>
<span class="line"> [root@localhost ~]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-8-2-2-安装mongodb" tabindex="-1"><a class="header-anchor" href="#_4-8-2-2-安装mongodb"><span>4.8.2.2 安装MongoDB</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum -y install mongodb-org</span>
<span class="line">whereis mongod</span>
<span class="line">vim /etc/mongod.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-8-2-3-启动mongodb" tabindex="-1"><a class="header-anchor" href="#_4-8-2-3-启动mongodb"><span>4.8.2.3 启动MongoDB</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> systemctl start mongod.service </span>
<span class="line"> systemctl stop mongod.service </span>
<span class="line"> systemctl status mongod.service </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-8-2-4-外网访问" tabindex="-1"><a class="header-anchor" href="#_4-8-2-4-外网访问"><span>4.8.2.4 外网访问</span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> systemctl stop firewalld.service </span>
<span class="line"> systemctl disable firewalld.service </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-9-启动后台服务器" tabindex="-1"><a class="header-anchor" href="#_4-9-启动后台服务器"><span>4.9 启动后台服务器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>gitee<span class="token punctuation">.</span>com<span class="token operator">/</span>zhufengpeixun<span class="token operator">/</span>antdesign<span class="token operator">-</span>server<span class="token punctuation">.</span>git</span>
<span class="line">cd antdesign<span class="token operator">-</span>server</span>
<span class="line">docker build <span class="token operator">-</span>t antdesign<span class="token operator">-</span>server <span class="token punctuation">.</span></span>
<span class="line">docker image ls</span>
<span class="line">docker run  <span class="token operator">-</span>d <span class="token operator">--</span>name antdesign<span class="token operator">-</span>server <span class="token operator">-</span>p <span class="token number">4000</span><span class="token operator">:</span><span class="token number">4000</span> <span class="token operator">--</span>net antdesign antdesign<span class="token operator">-</span>server</span>
<span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">4000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-10-启动前台服务" tabindex="-1"><a class="header-anchor" href="#_4-10-启动前台服务"><span>4.10 启动前台服务</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>gitee<span class="token punctuation">.</span>com<span class="token operator">/</span>zhufengpeixun<span class="token operator">/</span>antdesign<span class="token operator">-</span>front<span class="token punctuation">.</span>git</span>
<span class="line">cd antdesign<span class="token operator">-</span>front</span>
<span class="line">cnpm install</span>
<span class="line">cnpm run build</span>
<span class="line"></span>
<span class="line">docker build <span class="token operator">-</span>t antdesign<span class="token operator">-</span>front <span class="token punctuation">.</span></span>
<span class="line">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name antdesign<span class="token operator">-</span>front <span class="token operator">-</span>p <span class="token number">80</span><span class="token operator">:</span><span class="token number">80</span>  <span class="token operator">--</span>net antdesign antdesign<span class="token operator">-</span>front</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,133)])])}const c=n(t,[["render",l]]),r=JSON.parse('{"path":"/strong/85.antpro.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/85.antpro.md"}');export{c as comp,r as data};
