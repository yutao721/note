import{_ as s,c as a,a as e,o as t}from"./app-CD1YpnS1.js";const p={};function l(i,n){return t(),a("div",null,[...n[0]||(n[0]=[e(`<h2 id="_1-lerna" tabindex="-1"><a class="header-anchor" href="#_1-lerna"><span>1.lerna</span></a></h2><h3 id="_1-1-简介" tabindex="-1"><a class="header-anchor" href="#_1-1-简介"><span>1.1 简介</span></a></h3><ul><li><a href="www.lernajs.cn">Lerna 官网</a> 是一个管理工具，用于管理包含多个软件包（package）的 JavaScript 项目</li><li><a href="github.com/lerna/lerna">Lerna Git 仓库</a> 是一种工具，针对 使用 <code>git</code> 和 <code>npm</code> 管理多软件包代码仓库的工作流程进行优化</li></ul><h3 id="_1-2-lerna-入门" tabindex="-1"><a class="header-anchor" href="#_1-2-lerna-入门"><span>1.2.lerna 入门</span></a></h3><p>首先使用 npm 将 Lerna 安装到全局环境中</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install -g lerna</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>接下来，我们将创建一个新的 git 代码仓库</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir lerna4 &amp;&amp; cd lerna4</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>现在，我们将上述仓库转变为一个 Lerna 仓库：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">lerna init</span>
<span class="line">lerna notice cli v4<span class="token punctuation">.</span><span class="token number">0.0</span></span>
<span class="line">lerna info Initializing Git repository</span>
<span class="line">lerna info Creating <span class="token keyword">package</span><span class="token punctuation">.</span>json</span>
<span class="line">lerna info Creating lerna<span class="token punctuation">.</span>json</span>
<span class="line">lerna info Creating packages directory</span>
<span class="line">lerna success Initialized Lerna files</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">lerna4 / packages / 放置多个软件包(package);</span>
<span class="line">package.json;</span>
<span class="line">lerna.json;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>.gitignore</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">node_modules.idea.vscode;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2-lerna-源码" tabindex="-1"><a class="header-anchor" href="#_2-lerna-源码"><span>2.lerna 源码</span></a></h2><h3 id="_2-1-配置安装源" tabindex="-1"><a class="header-anchor" href="#_2-1-配置安装源"><span>2.1 配置安装源</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install -g yrm</span>
<span class="line">npm install -g nrm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-克隆源码" tabindex="-1"><a class="header-anchor" href="#_2-2-克隆源码"><span>2.2 克隆源码</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>gitee<span class="token punctuation">.</span>com<span class="token operator">/</span>zhufengpeixun<span class="token operator">/</span>lerna<span class="token punctuation">.</span>git <span class="token operator">--</span>depth<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-3-调试源码" tabindex="-1"><a class="header-anchor" href="#_2-3-调试源码"><span>2.3 调试源码</span></a></h3><p>.vscode\\launch.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch Program&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;skipFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;node_internals&gt;/**&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\${workspaceFolder}\\\\core\\\\lerna\\\\cli.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-核心包" tabindex="-1"><a class="header-anchor" href="#_2-4-核心包"><span>2.4 核心包</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">lerna 入口核心包</span>
<span class="line">@lerna/cli</span>
<span class="line">@lerna/create 创建包命令</span>
<span class="line">@lerna/init 初始化lerna项目</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-创建-npm-私服" tabindex="-1"><a class="header-anchor" href="#_3-创建-npm-私服"><span>3.创建 npm 私服</span></a></h2><ul><li><a href="https://www.npmjs.com/package/verdaccio" target="_blank" rel="noopener noreferrer">verdaccio</a>是一个简单 、零配置的本地私有化 npm 仓库</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm install verdaccio -g</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">verdaccio</span>
<span class="line"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">4873</span></span>
<span class="line">npm adduser <span class="token operator">--</span>registry http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">localhost:4873</span><span class="token regex-delimiter">/</span></span></span>
<span class="line">npm publish <span class="token operator">--</span>registry http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">localhost:4873</span><span class="token regex-delimiter">/</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-创建包" tabindex="-1"><a class="header-anchor" href="#_4-创建包"><span>4.创建包</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">lerna create lerna4 <span class="token operator">--</span>registry http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">4873</span></span>
<span class="line">lerna success create New <span class="token keyword">package</span> lerna4 created at <span class="token punctuation">.</span><span class="token operator">/</span>packages\\lerna4</span>
<span class="line">lerna create @lerna4<span class="token operator">/</span>cli <span class="token operator">--</span>registry http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">4873</span></span>
<span class="line">lerna success create New <span class="token keyword">package</span> @lerna4<span class="token operator">/</span>cli created at <span class="token punctuation">.</span><span class="token operator">/</span>packages\\cli</span>
<span class="line">lerna create @lerna4<span class="token operator">/</span>create <span class="token operator">--</span>registry http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">4873</span></span>
<span class="line">lerna success create New <span class="token keyword">package</span> @lerna4<span class="token operator">/</span>create created at <span class="token punctuation">.</span><span class="token operator">/</span>packages\\create</span>
<span class="line">lerna create @lerna4<span class="token operator">/</span>init <span class="token operator">--</span>registry http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">4873</span></span>
<span class="line">lerna success create New <span class="token keyword">package</span> @lerna4<span class="token operator">/</span>init created at <span class="token punctuation">.</span><span class="token operator">/</span>packages\\init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-单元测试" tabindex="-1"><a class="header-anchor" href="#_4-单元测试"><span>4.单元测试</span></a></h2><ul><li><a href="https://www.jestjs.cn/" target="_blank" rel="noopener noreferrer">Jest</a>是一个 JavaScript 测试框架</li><li><a href="https://www.jestjs.cn/docs/expect" target="_blank" rel="noopener noreferrer">expect</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install --save-dev jest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//在所有的包下执行test命令</span></span>
<span class="line">lerna run test</span>
<span class="line"><span class="token comment">//在lerna4下执行test命令</span></span>
<span class="line">lerna run test <span class="token operator">--</span>scope lerna4</span>
<span class="line"></span>
<span class="line"><span class="token comment">//在所有的包下执行shell脚本</span></span>
<span class="line">lerna exec <span class="token operator">--</span> jest</span>
<span class="line"><span class="token comment">//在lerna4下执行shell脚本</span></span>
<span class="line">lerna exec <span class="token operator">--</span>scope lerna4 <span class="token operator">--</span> jest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-1-package-json" tabindex="-1"><a class="header-anchor" href="#_5-1-package-json"><span>5.1 package.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;name&quot;: &quot;root&quot;,</span>
<span class="line">  &quot;private&quot;: true,</span>
<span class="line">  &quot;devDependencies&quot;: {</span>
<span class="line">    &quot;lerna&quot;: &quot;^4.0.0&quot;</span>
<span class="line">  },</span>
<span class="line">+ &quot;scripts&quot;: {</span>
<span class="line">+    &quot;test&quot;:&quot;jest&quot;</span>
<span class="line">+  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-jest-config-js" tabindex="-1"><a class="header-anchor" href="#_5-2-jest-config-js"><span>5.2 jest.config.js</span></a></h3><ul><li><a href="https://www.jestjs.cn/docs/configuration" target="_blank" rel="noopener noreferrer">configuration</a></li><li><a href="https://www.jestjs.cn/docs/expect" target="_blank" rel="noopener noreferrer">expect</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">testMatch</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/__tests__/**/*.test.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-lerna4-package-json" tabindex="-1"><a class="header-anchor" href="#_5-3-lerna4-package-json"><span>5.3 lerna4\\package.json</span></a></h3><p>packages\\lerna4\\package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">+  &quot;scripts&quot;: {</span>
<span class="line">+    &quot;test&quot;: &quot;jest&quot;</span>
<span class="line">+  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-lerna4-js" tabindex="-1"><a class="header-anchor" href="#_5-4-lerna4-js"><span>5.4 lerna4.js</span></a></h3><p>packages\\lerna4\\lib\\lerna4.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lerna4<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">lerna4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token string">&quot;lerna4&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-create-test-js" tabindex="-1"><a class="header-anchor" href="#_5-5-create-test-js"><span>5.5 create.test.js</span></a></h3><p>packages\\create__tests__\\create.test.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> create <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;@lerna4/create&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-eslint" tabindex="-1"><a class="header-anchor" href="#_6-eslint"><span>6.eslint</span></a></h2><ul><li><a href="https://www.npmjs.com/package/eslint" target="_blank" rel="noopener noreferrer">eslint</a>是一个插件化并且可配置的 JavaScript 语法规则和代码风格的检查工具</li><li>代码质量问题：使用方式有可能有问题</li><li>代码风格问题：风格不符合一定规则</li><li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint" target="_blank" rel="noopener noreferrer">vscode-eslint</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i eslint  --save-dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-1-eslintrc-js" tabindex="-1"><a class="header-anchor" href="#_6-1-eslintrc-js"><span>6.1 .eslintrc.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">2017</span><span class="token punctuation">,</span> <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint:recommended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;no-unused-vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;off&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">jest</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-eslintignore" tabindex="-1"><a class="header-anchor" href="#_6-2-eslintignore"><span>6.2 .eslintignore</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">__tests__;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-3-package-json" tabindex="-1"><a class="header-anchor" href="#_6-3-package-json"><span>6.3 package.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">  &quot;scripts&quot;: {</span>
<span class="line">    &quot;test&quot;: &quot;jest&quot;,</span>
<span class="line">+   &quot;lint&quot;:&quot;eslint --ext .js packages/**/*.js --no-error-on-unmatched-pattern --fix&quot;</span>
<span class="line">  }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-prettier" tabindex="-1"><a class="header-anchor" href="#_7-prettier"><span>7.Prettier</span></a></h2><ul><li>ESLint 主要解决的是代码质量问题</li><li>Prettier 主要解决的是代码风格问题</li><li>Prettier 会去掉你代码里的所有样式风格，然后用统一固定的格式重新输出</li><li><a href="https://prettier.io" target="_blank" rel="noopener noreferrer">prettier</a>声称自己是一个有主见的代码格式化工具</li><li><a href="https://prettier.io/docs/en/comparison.html" target="_blank" rel="noopener noreferrer">Prettier vs. Linters</a></li><li><a href="https://prettier.io/docs/en/integrating-with-linters.html" target="_blank" rel="noopener noreferrer">integrating-with-linters</a></li><li>Prettier 对应的是各种 Linters 的 Formatting rules 这一类规则</li><li>禁用 Linters 自己的 Formatting rules，让 Prettier 接管这些职责</li><li><a href="https://github.com/prettier/eslint-config-prettier" target="_blank" rel="noopener noreferrer">eslint-config-prettier</a>用来关闭和 Prettier 冲突非必要的规则</li><li>[recommended-configuration](https://github.com/prettier/eslint-plugin-prettier</li><li><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode" target="_blank" rel="noopener noreferrer">prettier-vscode</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i   prettier eslint-plugin-prettier  --save-dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_7-1-eslintrc-js" tabindex="-1"><a class="header-anchor" href="#_7-1-eslintrc-js"><span>7.1 .eslintrc.js</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">module.exports = {</span>
<span class="line">  extends: [&#39;eslint:recommended&#39;],</span>
<span class="line">  //让所有可能会与 prettier 规则存在冲突的 eslint rule失效，并使用 prettier 的规则进行代码检查</span>
<span class="line">  //相当于用 prettier 的规则，覆盖掉 eslint:recommended 的部分规则</span>
<span class="line">+ plugins: [&#39;prettier&#39;],</span>
<span class="line">  rules: {</span>
<span class="line">    &#39;no-unused-vars&#39;: [&#39;off&#39;],</span>
<span class="line">    //不符合prettier规则的代码要进行错误提示</span>
<span class="line">+   &#39;prettier/prettier&#39;: [&#39;error&#39;, { endOfLine: &#39;auto&#39; }],</span>
<span class="line">  },</span>
<span class="line">  env: { node: true, jest: false },</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-prettierrc-js" tabindex="-1"><a class="header-anchor" href="#_7-2-prettierrc-js"><span>7.2 .prettierrc.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-editorconfig" tabindex="-1"><a class="header-anchor" href="#_8-editorconfig"><span>8. editorconfig</span></a></h2><ul><li><a href="https://editorconfig.org/" target="_blank" rel="noopener noreferrer">editorconfig</a>帮助开发人员在不同的编辑器和 IDE 之间定义和维护一致的编码样式</li><li>不同的开发人员，不同的编辑器，有不同的编码风格，而 EditorConfig 就是用来协同团队开发人员之间的代码的风格及样式规范化的一个工具，而.editorconfig 正是它的默认配置文件</li><li><a href="https://marketplace.visualstudio.com/items?itemName=EditorConfig.EditorConfig" target="_blank" rel="noopener noreferrer">EditorConfig</a></li><li>vscode 这类编辑器，需要自行安装 editorconfig 插件</li></ul><h3 id="_8-1-editorconfig" tabindex="-1"><a class="header-anchor" href="#_8-1-editorconfig"><span>8.1 .editorconfig</span></a></h3><ul><li>Unix 系统里，每行结尾只有换行,即<code>\\n</code> LF(Line Feed)</li><li>Windows 系统里面，每行结尾是<code>换行 回车</code>，即<code>\\r\\n</code> CR/LF</li><li>Mac 系统里，每行结尾是<code>回车</code>，即<code>\\r</code> CR(Carriage Return)</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">root <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span></span>
<span class="line">indent_style <span class="token operator">=</span> space</span>
<span class="line">indent_size <span class="token operator">=</span> <span class="token number">2</span></span>
<span class="line">end_of_line <span class="token operator">=</span> lf</span>
<span class="line">charset <span class="token operator">=</span> utf<span class="token operator">-</span><span class="token number">8</span></span>
<span class="line">trim_trailing_whitespace <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">.</span>md<span class="token punctuation">]</span></span>
<span class="line">trim_trailing_whitespace <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-总结" tabindex="-1"><a class="header-anchor" href="#_8-2-总结"><span>8.2 总结</span></a></h3><ul><li>开发过程中，如果写出代码质量有问题的代码，eslint 能够及时提醒开发者，便于及时修复</li><li>如果写出代码格式有问题的代码，prettier 能够自动按照我们制定的规范、格式化代码</li><li>不同开发者如果使用不同的编辑器(webstorm/vscode)或系统(windows/mac),能够执行统一的代码风格标准</li></ul><h2 id="_9-git-hook" tabindex="-1"><a class="header-anchor" href="#_9-git-hook"><span>9. git hook</span></a></h2><h3 id="_9-1-pre-commit" tabindex="-1"><a class="header-anchor" href="#_9-1-pre-commit"><span>9.1 pre-commit</span></a></h3><ul><li>可以在 <code>git commit</code> 之前检查代码，保证所有提交到版本库中的代码都是符合规范的</li><li>可以在 <code>git push</code> 之前执行单元测试,保证所有的提交的代码经过的单元测试</li><li><a href="https://www.npmjs.com/package/husky" target="_blank" rel="noopener noreferrer">husky</a>可以让我们向项目中方便添加 <code>git hooks</code></li><li><a href="https://www.npmjs.com/package/lint-staged" target="_blank" rel="noopener noreferrer">lint-staged</a> 用于实现每次提交只检查本次提交所修改的文件</li></ul><h4 id="_9-1-1-安装-git-hooks" tabindex="-1"><a class="header-anchor" href="#_9-1-1-安装-git-hooks"><span>9.1.1 安装 Git hooks</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">cnpm i husky <span class="token operator">--</span>save<span class="token operator">-</span>dev</span>
<span class="line">npm set<span class="token operator">-</span>script prepare <span class="token string">&quot;husky install&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-1-2-安装-pre-commit" tabindex="-1"><a class="header-anchor" href="#_9-1-2-安装-pre-commit"><span>9.1.2 安装 pre-commit</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>pre<span class="token operator">-</span>commit <span class="token string">&quot;npx lint-staged&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_9-2-commit-msg" tabindex="-1"><a class="header-anchor" href="#_9-2-commit-msg"><span>9.2 commit-msg</span></a></h3><ul><li><a href="https://www.npmjs.com/package/commitizen" target="_blank" rel="noopener noreferrer">commitizen</a>插件可帮助实现一致的提交消息</li><li><a href="https://www.npmjs.com/package/cz-customizable" target="_blank" rel="noopener noreferrer">cz-customizable</a>可以实现自定义的提交</li><li><a href="https://www.npmjs.com/package/@commitlint/cli" target="_blank" rel="noopener noreferrer">@commitlint/cli</a>可以检查提交信息</li><li><a href="https://www.npmjs.com/package/@commitlint/config-conventional" target="_blank" rel="noopener noreferrer">@commitlint/config-conventional</a>检查您的常规提交</li></ul><h4 id="_9-2-1-安装配置" tabindex="-1"><a class="header-anchor" href="#_9-2-1-安装配置"><span>9.2.1 安装配置</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm install commitizen cz-customizable @commitlint/cli @commitlint/config-conventional --save-dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_9-2-2-安装-commit-msg" tabindex="-1"><a class="header-anchor" href="#_9-2-2-安装-commit-msg"><span>9.2.2 安装 commit-msg</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>commit<span class="token operator">-</span>msg <span class="token string">&quot;npx --no-install commitlint --edit $1&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_9-2-3-添加命令" tabindex="-1"><a class="header-anchor" href="#_9-2-3-添加命令"><span>9.2.3 添加命令</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>commit<span class="token operator">-</span>msg <span class="token string">&quot;npx --no-install commitlint --edit $1&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_9-2-4-cz-config-js" tabindex="-1"><a class="header-anchor" href="#_9-2-4-cz-config-js"><span>9.2.4 .cz-config.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;feat&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;feat:一个新特性&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;fix&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;fix:修复BUG&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">scopes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;sale&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-2-5-commitlint-config-js" tabindex="-1"><a class="header-anchor" href="#_9-2-5-commitlint-config-js"><span>9.2.5 commitlint.config.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@commitlint/config-conventional&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-2-6-package-json" tabindex="-1"><a class="header-anchor" href="#_9-2-6-package-json"><span>9.2.6 package.json</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">  &quot;scripts&quot;: {</span>
<span class="line">    &quot;test&quot;: &quot;jest&quot;,</span>
<span class="line">    &quot;lint&quot;: &quot;eslint --ext .js packages/**/*.js --no-error-on-unmatched-pattern --fix&quot;,</span>
<span class="line">    &quot;prepare&quot;: &quot;husky install&quot;,</span>
<span class="line">+   &quot;commit&quot;: &quot;cz&quot;</span>
<span class="line">  },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-发布上线" tabindex="-1"><a class="header-anchor" href="#_10-发布上线"><span>10.发布上线</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>pre<span class="token operator">-</span>push <span class="token string">&quot;npm run test&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">lerna version</span>
<span class="line">lerna publish</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-安装命令" tabindex="-1"><a class="header-anchor" href="#_11-安装命令"><span>11.安装命令</span></a></h2><h3 id="_11-1-cli-js" tabindex="-1"><a class="header-anchor" href="#_11-1-cli-js"><span>11.1 cli.js</span></a></h3><p>packages\\lerna4\\cli.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> </span>
<span class="line"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-lerna4-index-js" tabindex="-1"><a class="header-anchor" href="#_11-2-lerna4-index-js"><span>11.2 lerna4\\index.js</span></a></h3><p>packages\\lerna4\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> main<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-3-lerna4-package-json" tabindex="-1"><a class="header-anchor" href="#_11-3-lerna4-package-json"><span>11.3 lerna4\\package.json</span></a></h3><p>packages\\lerna4\\package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">+  &quot;main&quot;: &quot;index.js&quot;,</span>
<span class="line">+  &quot;bin&quot;:{</span>
<span class="line">+    &quot;lerna4&quot;:&quot;cli.js&quot;</span>
<span class="line">+  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-4-链接" tabindex="-1"><a class="header-anchor" href="#_11-4-链接"><span>11.4 链接</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cd packages\\lerna4</span>
<span class="line">npm link</span>
<span class="line">lerna4</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-yargs" tabindex="-1"><a class="header-anchor" href="#_12-yargs"><span>12. yargs</span></a></h2><ul><li><a href="https://www.npmjs.com/package/yargs" target="_blank" rel="noopener noreferrer">yargs</a>用来解析命令行参数和选项</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;yargs/yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> argv <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> cli <span class="token operator">=</span> <span class="token function">yargs</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//应用到每一个命令的全局参数</span></span>
<span class="line"><span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">loglevel</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;报告日志的级别&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;L&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//全局的key</span></span>
<span class="line"><span class="token keyword">const</span> globalKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">cli</span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token comment">//配置全局参数</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>globalKeys<span class="token punctuation">,</span> <span class="token string">&quot;Global Options:&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 把全局参数分到全局组里</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: $0 &lt;command&gt; [options]&quot;</span><span class="token punctuation">)</span> <span class="token comment">//提示使用说明</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">demandCommand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;至少需要一个命令，传递--help查看所有的命令和选项&quot;</span><span class="token punctuation">)</span> <span class="token comment">//指定最小命令数量</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">recommendCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//推荐命令</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">strict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//严格命令，不正确 会报错</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//自定义错误打印</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;lerna&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;help&quot;</span><span class="token punctuation">)</span> <span class="token comment">//别名</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">)</span> <span class="token comment">//别名</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>cli<span class="token punctuation">.</span><span class="token function">terminalWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//命令行宽度</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">epilogue</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token comment">//结语</span></span>
<span class="line">    <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">当1个命令失败了，所有的日志将会写入当前工作目录中的lerna-debug.log</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token string">&quot;create &lt;name&gt;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;创建一个新的lerna管理的包&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      yargs</span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">positional</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;包名(包含scope)&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">registry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token string">&quot;Command Options:&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;配置包的发布仓库&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行init命令&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line">node lerna4.js create project --registry  http://localhost:4873</span>
<span class="line">执行init命令 <span class="token punctuation">{</span></span>
<span class="line">  &#39;$0&#39;: &#39;lerna4.js&#39;,</span>
<span class="line">  _: [ &#39;create&#39; ],</span>
<span class="line">  name: &#39;project&#39;</span>
<span class="line">  registry: &#39;http://localhost:4873&#39;,</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_13-跑通-init-命令" tabindex="-1"><a class="header-anchor" href="#_13-跑通-init-命令"><span>13.跑通 init 命令</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">lerna link</span>
<span class="line">lerna bootstrap</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-1-cli-package-json" tabindex="-1"><a class="header-anchor" href="#_13-1-cli-package-json"><span>13.1 cli\\package.json</span></a></h3><p>packages\\cli\\package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&quot;dependencies&quot;: {</span>
<span class="line">    &quot;@lerna4/cli&quot;:&quot;^0.0.4&quot;,</span>
<span class="line">    &quot;@lerna4/init&quot;:&quot;^0.0.4&quot;</span>
<span class="line">},</span>
<span class="line">+  &quot;main&quot;: &quot;index.js&quot;,</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-2-cli-index-js" tabindex="-1"><a class="header-anchor" href="#_13-2-cli-index-js"><span>13.2 cli\\index.js</span></a></h3><p>packages\\cli\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;yargs/yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">lernaCLI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> cli <span class="token operator">=</span> <span class="token function">yargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">//应用到每一个命令的全局参数</span></span>
<span class="line">  <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">loglevel</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;报告日志的级别&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;L&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">//全局的key</span></span>
<span class="line">  <span class="token keyword">const</span> globalKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> cli</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token comment">//配置全局参数</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>globalKeys<span class="token punctuation">,</span> <span class="token string">&quot;Global Options:&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 把全局参数分到全局组里</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: $0 &lt;command&gt; [options]&quot;</span><span class="token punctuation">)</span> <span class="token comment">//提示使用说明</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">demandCommand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;至少需要一个命令，传递--help查看所有的命令和选项&quot;</span><span class="token punctuation">)</span> <span class="token comment">//指定最小命令数量</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">recommendCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//推荐命令</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">strict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//严格命令，不正确 会报错</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">//自定义错误打印</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;lerna&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;help&quot;</span><span class="token punctuation">)</span> <span class="token comment">//别名</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">)</span> <span class="token comment">//别名</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>cli<span class="token punctuation">.</span><span class="token function">terminalWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//命令行宽度</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">epilogue</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token comment">//结语</span></span>
<span class="line">      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">当1个命令失败了，所有的日志将会写入当前工作目录中的lerna-debug.log</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lernaCLI<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-3-init-command-js" tabindex="-1"><a class="header-anchor" href="#_13-3-init-command-js"><span>13.3 init\\command.js</span></a></h3><p>packages\\init\\command.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">exports<span class="token punctuation">.</span>command <span class="token operator">=</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span>describe <span class="token operator">=</span> <span class="token string">&quot;创建一个新的Lerna仓库&quot;</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">builder</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行init builder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行init命令&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-4-lerna4-package-json" tabindex="-1"><a class="header-anchor" href="#_13-4-lerna4-package-json"><span>13.4 lerna4\\package.json</span></a></h3><p>packages\\lerna4\\package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+  &quot;main&quot;: &quot;index.js&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_13-5-lerna4-index-js" tabindex="-1"><a class="header-anchor" href="#_13-5-lerna4-index-js"><span>13.5 lerna4\\index.js</span></a></h3><p>packages\\lerna4\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const cli = require(&#39;@lerna4/cli&#39;);</span>
<span class="line">const initCmd = require(&#39;@lerna4/init/command&#39;);</span>
<span class="line">function main(argv) {</span>
<span class="line">  return cli().command(initCmd).parse(argv);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">module.exports = main;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-实现-init-命令" tabindex="-1"><a class="header-anchor" href="#_14-实现-init-命令"><span>14.实现 init 命令</span></a></h2><h3 id="_14-1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_14-1-安装依赖"><span>14.1 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">lerna add fs-extra  packages/init</span>
<span class="line">lerna add  execa  packages/init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-2-init-command-js" tabindex="-1"><a class="header-anchor" href="#_14-2-init-command-js"><span>14.2 init\\command.js</span></a></h3><p>packages\\init\\command.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">exports<span class="token punctuation">.</span>command <span class="token operator">=</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span>describe <span class="token operator">=</span> <span class="token string">&quot;创建一个新的Lerna仓库&quot;</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">builder</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行init builder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行init命令&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-3-packages-init-index-js" tabindex="-1"><a class="header-anchor" href="#_14-3-packages-init-index-js"><span>14.3 packages\\init\\index.js</span></a></h3><p>packages\\init\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs-extra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> execa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;execa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">InitCommand</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>argv <span class="token operator">=</span> argv<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>rootPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">execa</span><span class="token punctuation">(</span><span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;init&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;pipe&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensurePackageJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensureLernaConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensurePackagesDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Initialized Lerna files&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">ensurePackageJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;创建 package.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeJson</span><span class="token punctuation">(</span></span>
<span class="line">      path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> <span class="token string">&quot;package.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">private</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">devDependencies</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">lerna</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">spaces</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">ensureLernaConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;创建 lerna.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeJson</span><span class="token punctuation">(</span></span>
<span class="line">      path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> <span class="token string">&quot;lerna.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">packages</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&quot;0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">spaces</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">ensurePackagesDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;创建 packages 目录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">mkdirp</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> <span class="token string">&quot;packages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">InitCommand</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> factory<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_15-实现-create-命令" tabindex="-1"><a class="header-anchor" href="#_15-实现-create-命令"><span>15.实现 create 命令</span></a></h2><ul><li><a href="https://www.npmjs.com/package/pify" target="_blank" rel="noopener noreferrer">pify</a></li><li><a href="https://www.npmjs.com/package/dedent" target="_blank" rel="noopener noreferrer">dedent</a></li><li><a href="https://www.npmjs.com/package/init-package-json" target="_blank" rel="noopener noreferrer">init-package-json</a></li></ul><h3 id="_15-1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_15-1-安装依赖"><span>15.1 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">lerna add pify  packages/crate</span>
<span class="line">lerna add  init-package-json  packages/crate</span>
<span class="line">lerna add  dedent  packages/crate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-2-lerna4-index-js" tabindex="-1"><a class="header-anchor" href="#_15-2-lerna4-index-js"><span>15.2 lerna4\\index.js</span></a></h3><p>packages\\lerna4\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const cli = require(&#39;@lerna4/cli&#39;);</span>
<span class="line">const initCmd = require(&#39;@lerna4/init/command&#39;);</span>
<span class="line">const createCmd = require(&#39;@lerna4/create/command&#39;);</span>
<span class="line">function main(argv) {</span>
<span class="line">  return cli()</span>
<span class="line">   .command(initCmd)</span>
<span class="line">+  .command(createCmd)</span>
<span class="line">   .parse(argv);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">module.exports = main;</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-3-lerna4-package-json" tabindex="-1"><a class="header-anchor" href="#_15-3-lerna4-package-json"><span>15.3 lerna4\\package.json</span></a></h3><p>packages\\lerna4\\package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;dependencies&quot;: {</span>
<span class="line">    &quot;@lerna4/cli&quot;:&quot;^0.0.4&quot;,</span>
<span class="line">    &quot;@lerna4/init&quot;:&quot;^0.0.4&quot;,</span>
<span class="line">+   &quot;@lerna4/create&quot;:&quot;^0.0.4&quot;</span>
<span class="line">  },</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-4-create-command-js" tabindex="-1"><a class="header-anchor" href="#_15-4-create-command-js"><span>15.4 create\\command.js</span></a></h3><p>packages\\create\\command.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">exports<span class="token punctuation">.</span>command <span class="token operator">=</span> <span class="token string">&quot;create &lt;name&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span>describe <span class="token operator">=</span> <span class="token string">&quot;创建一个新的lerna管理的包&quot;</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">builder</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行init builder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  yargs</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">positional</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;包名(包含scope)&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">registry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token string">&quot;Command Options:&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;配置包的发布仓库&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行create命令&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-5-create-index-js" tabindex="-1"><a class="header-anchor" href="#_15-5-create-index-js"><span>15.5 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs-extra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> dedent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dedent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> initPackageJson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;pify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;init-package-json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">CreateCommand</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>rootPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;options&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> registry <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>targetDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> <span class="token string">&quot;packages/cli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>libDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetDir<span class="token punctuation">,</span> <span class="token string">&quot;lib&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>testDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetDir<span class="token punctuation">,</span> <span class="token string">&quot;__tests__&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>libFileName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>testFileName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.test.js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">mkdirp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>libDir<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">mkdirp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>testDir<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">writeLibFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">writeTestFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">writeReadme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> initFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">HOME</span><span class="token punctuation">,</span> <span class="token string">&quot;.npm-init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">initPackageJson</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetDir<span class="token punctuation">,</span> initFile<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">writeLibFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> libContent <span class="token operator">=</span> dedent<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">        module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>camelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span>
<span class="line">        function </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>camelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">() {</span>
<span class="line">            // TODO</span>
<span class="line">        }</span>
<span class="line">    </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">catFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>libDir<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>libFileName<span class="token punctuation">,</span> libContent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">writeTestFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> testContent <span class="token operator">=</span> dedent<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">    const </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>camelName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = require(&#39;..&#39;);</span>
<span class="line">    describe(&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pkgName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;, () =&gt; {</span>
<span class="line">        it(&#39;needs tests&#39;);</span>
<span class="line">    });</span>
<span class="line">  </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">catFile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>testDir<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>testFileName<span class="token punctuation">,</span> testContent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">writeReadme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token keyword">const</span> readmeContent <span class="token operator">=</span> dedent<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">#</span>
<span class="line">    await catFile(this.targetDir, &quot;README.md&quot;, readmeContent);</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line">function catFile(baseDir, fileName, content) {</span>
<span class="line">  return fs.writeFile(path.join(baseDir, fileName), </span><span class="token template-punctuation string">\`</span></span>$<span class="token punctuation">{</span>content<span class="token punctuation">}</span>\\n\`<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">CreateCommand</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> factory<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_16-参考" tabindex="-1"><a class="header-anchor" href="#_16-参考"><span>16.参考</span></a></h2><h3 id="_16-1-lerna-命令" tabindex="-1"><a class="header-anchor" href="#_16-1-lerna-命令"><span>16.1 lerna 命令</span></a></h3><h4 id="项目初始化" tabindex="-1"><a class="header-anchor" href="#项目初始化"><span>项目初始化</span></a></h4><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">lerna init</td><td style="text-align:left;">初始化项目</td></tr></tbody></table><h4 id="_16-2-创建包" tabindex="-1"><a class="header-anchor" href="#_16-2-创建包"><span>16.2 创建包</span></a></h4><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">lerna create</td><td style="text-align:left;">创建 package</td></tr><tr><td style="text-align:left;">lerna add</td><td style="text-align:left;">安装依赖</td></tr><tr><td style="text-align:left;">lerna link</td><td style="text-align:left;">链接依赖</td></tr></tbody></table><h4 id="_16-3-开发和测试" tabindex="-1"><a class="header-anchor" href="#_16-3-开发和测试"><span>16.3 开发和测试</span></a></h4><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">lerna exec</td><td style="text-align:left;">执行 shell 脚本</td></tr><tr><td style="text-align:left;">lerna run</td><td style="text-align:left;">执行 npm 命令</td></tr><tr><td style="text-align:left;">lerna clean</td><td style="text-align:left;">清空依赖</td></tr><tr><td style="text-align:left;">lerna bootstrap</td><td style="text-align:left;">重新安装依赖</td></tr></tbody></table><h4 id="_16-4-发布上线" tabindex="-1"><a class="header-anchor" href="#_16-4-发布上线"><span>16.4 发布上线</span></a></h4><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">lerna version</td><td style="text-align:left;">修改版本号</td></tr><tr><td style="text-align:left;">lerna changed</td><td style="text-align:left;">查看上个版本以来的所有变更</td></tr><tr><td style="text-align:left;">lerna diff</td><td style="text-align:left;">查看 diff</td></tr><tr><td style="text-align:left;">lerna publish</td><td style="text-align:left;">发布项目</td></tr></tbody></table><h3 id="_17-格式化提交" tabindex="-1"><a class="header-anchor" href="#_17-格式化提交"><span>17.格式化提交</span></a></h3><h4 id="_17-1-conventional-commits" tabindex="-1"><a class="header-anchor" href="#_17-1-conventional-commits"><span>17.1 Conventional Commits</span></a></h4><ul><li>规范化的<code>git commit</code>可以提高<code>git log</code>可读性，生成格式良好的<code>changelog</code></li><li><a href="https://www.conventionalcommits.org/zh-hans/v1.0.0/" target="_blank" rel="noopener noreferrer">Conventional Commits</a> 是一种用于给提交信息增加人机可读含义的规范</li><li>它提供了一组简单规则来创建清晰的提交历史</li><li>通过在提交信息中描述功能、修复和破坏性变更，使这种惯例与 <a href="https://semver.org/" target="_blank" rel="noopener noreferrer">semver</a> 相互对应</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;类型&gt;[可选 范围]: &lt;描述&gt;</span>
<span class="line"></span>
<span class="line">[可选 正文]</span>
<span class="line"></span>
<span class="line">[可选 脚注]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_17-2-类型-type" tabindex="-1"><a class="header-anchor" href="#_17-2-类型-type"><span>17.2 类型（type）</span></a></h4><ul><li>feat: 类型 为 feat 的提交表示在代码库中新增了一个功能（这和语义化版本中的 MINOR 相对应）</li><li>fix: 类型 为 fix 的提交表示在代码库中修复了一个 bug（这和语义化版本中的 PATCH 相对应）</li><li>docs: 只是更改文档</li><li>style: 不影响代码含义的变化（空白、格式化、缺少分号等）</li><li>refactor: 代码重构，既不修复错误也不添加功能</li><li>perf: 改进性能的代码更改</li><li>test: 添加确实测试或更正现有的测试</li><li>build: 影响构建系统或外部依赖关系的更改（示例范围：gulp、broccoli、NPM）</li><li>ci: 更改持续集成文件和脚本（示例范围：Travis、Circle、BrowserStack、SauceLabs）</li><li>chore: 其他不修改 src 或 test 文件。</li><li>revert: commit 回退</li></ul><h4 id="_17-3-范围-scope" tabindex="-1"><a class="header-anchor" href="#_17-3-范围-scope"><span>17.3 范围（scope）</span></a></h4><ul><li>可以为提交类型添加一个围在圆括号内的作用域，以为其提供额外的上下文信息</li></ul>`,169)])])}const o=s(p,[["render",l]]),r=JSON.parse('{"path":"/strong/137.lerna.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/137.lerna.md"}');export{o as comp,r as data};
