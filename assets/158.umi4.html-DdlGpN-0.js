import{_ as n,c as a,a as p,o as e}from"./app-CD1YpnS1.js";const t={};function l(o,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="_1-课程大纲" tabindex="-1"><a class="header-anchor" href="#_1-课程大纲"><span>1.课程大纲</span></a></h2><ul><li>UMI4应用开发实战</li><li>UMI4+AntDesginProV6应用开发实战</li><li>从零实现UMI4插件系统和核心插件</li></ul><h2 id="_2-项目初始化" tabindex="-1"><a class="header-anchor" href="#_2-项目初始化"><span>2.项目初始化</span></a></h2><ul><li><a href="https://umijs.org/" target="_blank" rel="noopener noreferrer">umijs</a></li><li><a href="https://ant.design/components/icon-cn" target="_blank" rel="noopener noreferrer">icon</a></li><li><a href="https://github.com/ant-design/pro-components" target="_blank" rel="noopener noreferrer">pro-components</a></li><li>[layout](https://procomponents.ant.design/components/layout</li><li><a href="https://v3.umijs.org/zh-CN/plugins/preset-react" target="_blank" rel="noopener noreferrer">umijs plugins</a></li><li><a href="https://www.tailwindcss.cn/docs" target="_blank" rel="noopener noreferrer">tailwindcss</a></li><li><a href="https://ahooks.js.org/zh-CN/hooks/use-request/index" target="_blank" rel="noopener noreferrer">ahooks</a></li></ul><h3 id="_2-1-创建项目" tabindex="-1"><a class="header-anchor" href="#_2-1-创建项目"><span>2.1 创建项目</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">mkdir umi4project</span>
<span class="line">cd umi4project</span>
<span class="line">pnpm init <span class="token operator">-</span>y</span>
<span class="line">pnpm config <span class="token keyword">get</span> registry </span>
<span class="line">pnpm config <span class="token keyword">set</span> registry https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">registry.npmmirror.com</span><span class="token regex-delimiter">/</span></span></span>
<span class="line">pnpm i @ant<span class="token operator">-</span>design<span class="token operator">/</span>icons @ant<span class="token operator">-</span>design<span class="token operator">/</span>pro<span class="token operator">-</span>components @umijs<span class="token operator">/</span>max ahooks antd@<span class="token number">4</span>  jsonwebtoken</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-支持typescript" tabindex="-1"><a class="header-anchor" href="#_2-2-支持typescript"><span>2.2 支持typescript</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">max generate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-约定式路由" tabindex="-1"><a class="header-anchor" href="#_3-约定式路由"><span>3.约定式路由</span></a></h2><h3 id="_3-1-生成页面" tabindex="-1"><a class="header-anchor" href="#_3-1-生成页面"><span>3.1 生成页面</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mdir src</span>
<span class="line">max g</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-支持typescript" tabindex="-1"><a class="header-anchor" href="#_3-2-支持typescript"><span>3.2 支持typescript</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">max g</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-3-添加命令" tabindex="-1"><a class="header-anchor" href="#_3-3-添加命令"><span>3.3 添加命令</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;max dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;max build&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-gitignore" tabindex="-1"><a class="header-anchor" href="#_3-4-gitignore"><span>3.4 .gitignore</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">/node_modules</span>
<span class="line">/src/.umi</span>
<span class="line">/dist</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-tsconfig-json" tabindex="-1"><a class="header-anchor" href="#_3-5-tsconfig-json"><span>3.5 tsconfig.json</span></a></h3><p>tsconfig.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;extends&quot;: &quot;./src/.umi/tsconfig.json&quot;,</span>
<span class="line">+ &quot;compilerOptions&quot;: {</span>
<span class="line">+   &quot;noImplicitAny&quot;: false</span>
<span class="line">+ }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-启动" tabindex="-1"><a class="header-anchor" href="#_3-6-启动"><span>3.6 启动</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">pnpm dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_4-配置式路由" tabindex="-1"><a class="header-anchor" href="#_4-配置式路由"><span>4.配置式路由</span></a></h2><h3 id="_4-1-config-ts" tabindex="-1"><a class="header-anchor" href="#_4-1-config-ts"><span>4.1 config.ts</span></a></h3><p>config\\config.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { defineConfig } from &#39;@umijs/max&#39;;</span>
<span class="line">+import routes from &quot;./routes&quot;;</span>
<span class="line">export default defineConfig({</span>
<span class="line">  npmClient: &#39;pnpm&#39;,</span>
<span class="line">+ routes</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-routes-ts" tabindex="-1"><a class="header-anchor" href="#_4-2-routes-ts"><span>4.2 routes.ts</span></a></h3><p>config\\routes.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;HomeOutlined&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;首页&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/home&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./home/index&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;ProfileOutlined&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;个人中心&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/profile&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">&#39;./profile/index&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-home-index-tsx" tabindex="-1"><a class="header-anchor" href="#_4-3-home-index-tsx"><span>4.3 home\\index.tsx</span></a></h3><p>src\\pages\\home\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import styles from &#39;./index.less&#39;;</span>
<span class="line">+import { Link, history, useNavigate } from &#39;@umijs/max&#39;;</span>
<span class="line">+import { Button } from &#39;antd&#39;;</span>
<span class="line">export default function Page() {</span>
<span class="line">  let navigate = useNavigate();</span>
<span class="line">  return (</span>
<span class="line">    &lt;div&gt;</span>
<span class="line">+     &lt;h1 className={styles.title}&gt;首页&lt;/h1&gt;</span>
<span class="line">+     &lt;Link to=&quot;/profile&quot;&gt;个人中心&lt;/Link&gt;</span>
<span class="line">+     &lt;Button type=&#39;primary&#39; onClick={() =&gt; history.push(&#39;/profile&#39;)}&gt;个人中心&lt;/Button&gt;</span>
<span class="line">+     &lt;Button type=&#39;dashed&#39; onClick={() =&gt; navigate(&#39;/profile&#39;)}&gt;个人中心&lt;/Button&gt;</span>
<span class="line">    &lt;/div&gt;</span>
<span class="line">  );</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-tailwindcss" tabindex="-1"><a class="header-anchor" href="#_5-tailwindcss"><span>5.tailwindcss</span></a></h2><h3 id="_5-1-安装" tabindex="-1"><a class="header-anchor" href="#_5-1-安装"><span>5.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">max g</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-home-index-tsx" tabindex="-1"><a class="header-anchor" href="#_5-2-home-index-tsx"><span>5.2 home\\index.tsx</span></a></h3><p>src\\pages\\home\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { Link, history, useNavigate } from &#39;@umijs/max&#39;;</span>
<span class="line">import { Button } from &#39;antd&#39;;</span>
<span class="line">export default function Page() {</span>
<span class="line">  let navigate = useNavigate();</span>
<span class="line">  return (</span>
<span class="line">    &lt;div&gt;</span>
<span class="line">+     &lt;h1 className={\`text-lg font-bold text-red-600\`}&gt;首页&lt;/h1&gt;</span>
<span class="line">      &lt;Link to=&quot;/profile&quot;&gt;个人中心&lt;/Link&gt;</span>
<span class="line">      &lt;Button onClick={() =&gt; history.push(&#39;/profile&#39;)}&gt;个人中心&lt;/Button&gt;</span>
<span class="line">      &lt;Button onClick={() =&gt; navigate(&#39;/profile&#39;)}&gt;个人中心&lt;/Button&gt;</span>
<span class="line">    &lt;/div&gt;</span>
<span class="line">  );</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-profile-index-tsx" tabindex="-1"><a class="header-anchor" href="#_5-3-profile-index-tsx"><span>5.3 profile\\index.tsx</span></a></h3><p>src\\pages\\profile\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default function Page() {</span>
<span class="line">  return (</span>
<span class="line">    &lt;div&gt;</span>
<span class="line">+     &lt;h1 className={\`text-lg font-bold text-green-600\`}&gt;个人中心&lt;/h1&gt;</span>
<span class="line">    &lt;/div&gt;</span>
<span class="line">  );</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-支持布局" tabindex="-1"><a class="header-anchor" href="#_6-支持布局"><span>6.支持布局</span></a></h2><h3 id="_6-1-config-config-ts" tabindex="-1"><a class="header-anchor" href="#_6-1-config-config-ts"><span>6.1 config\\config.ts</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { defineConfig } from &quot;@umijs/max&quot;;</span>
<span class="line">import routes from &quot;./routes&quot;;</span>
<span class="line">export default defineConfig({</span>
<span class="line">  npmClient: &quot;pnpm&quot;,</span>
<span class="line">  routes,</span>
<span class="line">  tailwindcss: {},</span>
<span class="line">+ layout: {</span>
<span class="line">+   title: &quot;UMI&quot;,</span>
<span class="line">+   locale: false</span>
<span class="line">+ },</span>
<span class="line">+ antd: {},</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-支持子路由" tabindex="-1"><a class="header-anchor" href="#_7-支持子路由"><span>7.支持子路由</span></a></h2><h3 id="_7-1-routes-ts" tabindex="-1"><a class="header-anchor" href="#_7-1-routes-ts"><span>7.1 routes.ts</span></a></h3><p>config\\routes.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default [</span>
<span class="line">  { path: &#39;/&#39;, redirect: &#39;/home&#39; },</span>
<span class="line">  { icon: &#39;HomeOutlined&#39;, name: &#39;首页&#39;, path: &#39;/home&#39;, component: &#39;./home/index&#39; },</span>
<span class="line">  { icon: &#39;ProfileOutlined&#39;, name: &#39;个人中心&#39;, path: &#39;/profile&#39;, component: &#39;./profile/index&#39; },</span>
<span class="line">+ {</span>
<span class="line">+   icon: &#39;UserOutlined&#39;,</span>
<span class="line">+   name: &#39;用户管理&#39;,</span>
<span class="line">+   path: &#39;/user&#39;,</span>
<span class="line">+   component: &#39;./user/index&#39;,</span>
<span class="line">+   routes: [</span>
<span class="line">+     { name: &#39;添加用户&#39;, path: &#39;/user/add&#39;, component: &#39;./user/add/index&#39; },</span>
<span class="line">+     { name: &#39;用户列表&#39;, path: &#39;/user/list&#39;, component: &#39;./user/list/index&#39; },</span>
<span class="line">+     { name: &#39;用户详情&#39;, path: &#39;/user/detail/:id&#39;, component: &#39;./user/detail/index&#39;, hideInMenu: true },</span>
<span class="line">+   ],</span>
<span class="line">+ },</span>
<span class="line">]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-user-index-tsx" tabindex="-1"><a class="header-anchor" href="#_7-2-user-index-tsx"><span>7.2 user\\index.tsx</span></a></h3><p>src\\pages\\user\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> PageContainer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@ant-design/pro-components&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Outlet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>PageContainer<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Outlet <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>PageContainer<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-list-index-tsx" tabindex="-1"><a class="header-anchor" href="#_7-3-list-index-tsx"><span>7.3 list\\index.tsx</span></a></h3><p>src\\pages\\user\\list\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> List <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;root&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;member&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>List</span>
<span class="line">            header<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>用户列表<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">            footer<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>共计<span class="token punctuation">{</span>data<span class="token operator">?.</span>list<span class="token operator">?.</span>length<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">            bordered</span>
<span class="line">            dataSource<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token operator">?.</span>list<span class="token punctuation">}</span></span>
<span class="line">            renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">user</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">                <span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/user/detail/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>user<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span> state<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>user<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-add-index-tsx" tabindex="-1"><a class="header-anchor" href="#_7-4-add-index-tsx"><span>7.4 add\\index.tsx</span></a></h3><p>src\\pages\\user\\add\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">values</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Row <span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Col offset<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">}</span> span<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form</span>
<span class="line">                    labelCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                    wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                    onFinish<span class="token operator">=</span><span class="token punctuation">{</span>onFinish<span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                        label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line">                        name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span></span>
<span class="line">                        rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入用户名&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                        label<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span></span>
<span class="line">                        name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">                        rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入密码&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Input<span class="token punctuation">.</span>Password <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                        label<span class="token operator">=</span><span class="token string">&quot;手机号&quot;</span></span>
<span class="line">                        name<span class="token operator">=</span><span class="token string">&quot;phone&quot;</span></span>
<span class="line">                        rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入手机号&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> <span class="token operator">&gt;</span></span>
<span class="line">                            提交</span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Col<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Row<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-detail-index-tsx" tabindex="-1"><a class="header-anchor" href="#_7-5-detail-index-tsx"><span>7.5 detail\\index.tsx</span></a></h3><p>src\\pages\\user\\detail\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Descriptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useLocation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> location<span class="token punctuation">.</span>state <span class="token keyword">as</span> <span class="token constant">API</span><span class="token punctuation">.</span>User<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Descriptions title<span class="token operator">=</span><span class="token string">&quot;用户信息&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Descriptions<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>user<span class="token operator">?.</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Descriptions<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Descriptions<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;手机号&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>user<span class="token operator">?.</span>phone<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Descriptions<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Descriptions<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-请求用户列表" tabindex="-1"><a class="header-anchor" href="#_8-请求用户列表"><span>8.请求用户列表</span></a></h2><h3 id="_8-1-支持请求" tabindex="-1"><a class="header-anchor" href="#_8-1-支持请求"><span>8.1 支持请求</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { defineConfig } from &quot;@umijs/max&quot;;</span>
<span class="line">import routes from &quot;./routes&quot;;</span>
<span class="line">export default defineConfig({</span>
<span class="line">  npmClient: &quot;pnpm&quot;,</span>
<span class="line">  routes,</span>
<span class="line">  tailwindcss: {},</span>
<span class="line">  layout: {</span>
<span class="line">    title: &quot;UMI&quot;,</span>
<span class="line">    locale: false</span>
<span class="line">  },</span>
<span class="line">  antd: {},</span>
<span class="line">+ request: {},</span>
<span class="line">+ model: {},</span>
<span class="line">+ initialState: {},</span>
<span class="line">+ proxy: {</span>
<span class="line">+   &#39;/api/&#39;: {</span>
<span class="line">+     target: &#39;http://127.0.0.1:7001/&#39;,</span>
<span class="line">+     changeOrigin: true</span>
<span class="line">+   }</span>
<span class="line">+ }</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-list-index-tsx" tabindex="-1"><a class="header-anchor" href="#_8-2-list-index-tsx"><span>8.2 list\\index.tsx</span></a></h3><p>src\\pages\\user\\list\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { List } from &#39;antd&#39;;</span>
<span class="line">import { Link, useModel } from &#39;@umijs/max&#39;;</span>
<span class="line">export default function () {</span>
<span class="line">+   const { data, loading } = useModel(&#39;user.model&#39;);</span>
<span class="line">    return (</span>
<span class="line">        &lt;List</span>
<span class="line">            header={&lt;div&gt;用户列表&lt;/div&gt;}</span>
<span class="line">            footer={&lt;div&gt;共计{data?.list?.length}&lt;/div&gt;}</span>
<span class="line">            bordered</span>
<span class="line">            dataSource={data?.list}</span>
<span class="line">            renderItem={(user: any) =&gt; (</span>
<span class="line">                &lt;List.Item&gt;</span>
<span class="line">                    &lt;Link to={\`/user/detail/\${user.id}\`} state={user}&gt; {user.username}&lt;/Link&gt;</span>
<span class="line">                &lt;/List.Item&gt;</span>
<span class="line">            )}</span>
<span class="line">        /&gt;</span>
<span class="line">    );</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-user-model-ts" tabindex="-1"><a class="header-anchor" href="#_8-3-user-model-ts"><span>8.3 user\\model.ts</span></a></h3><p>src\\pages\\user\\model.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ahooks&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/services/user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> refresh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUser<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    data<span class="token punctuation">,</span></span>
<span class="line">    refresh<span class="token punctuation">,</span></span>
<span class="line">    loading</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-4-typings-d-ts" tabindex="-1"><a class="header-anchor" href="#_8-4-typings-d-ts"><span>8.4 typings.d.ts</span></a></h3><p>src\\services\\typings.d.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">declare namespace <span class="token constant">API</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ListResponse</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        data<span class="token operator">?</span><span class="token operator">:</span> ListData<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token literal-property property">errorCode</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        <span class="token literal-property property">errorMessage</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        <span class="token literal-property property">errorType</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line">        success<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ListData</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        list<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        total<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span></span>
<span class="line">        id<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line">        password<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        phone<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        username<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        role<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">SigninUser</span> <span class="token punctuation">{</span></span>
<span class="line">        username<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        password<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">SignupUser</span> <span class="token punctuation">{</span></span>
<span class="line">        password<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        phone<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        username<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">        role_id<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-5-user-ts" tabindex="-1"><a class="header-anchor" href="#_8-5-user-ts"><span>8.5 user.ts</span></a></h3><p>src\\services\\user.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> request <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> request<span class="token operator">&lt;</span><span class="token constant">API</span><span class="token punctuation">.</span>ListData<span class="token operator">&lt;</span><span class="token constant">API</span><span class="token punctuation">.</span>User<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;GET&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-6-app-ts" tabindex="-1"><a class="header-anchor" href="#_8-6-app-ts"><span>8.6 app.ts</span></a></h3><p>src\\app.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> notification<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">enum</span> ErrorShowType <span class="token punctuation">{</span></span>
<span class="line">    <span class="token constant">SILENT</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">WARN_MESSAGE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">ERROR_MESSAGE</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">NOTIFICATION</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">error</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;BizError&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> errorInfo <span class="token operator">=</span> error<span class="token punctuation">.</span>info<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> <span class="token punctuation">{</span> errorMessage<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> showType <span class="token punctuation">}</span> <span class="token operator">=</span> errorInfo<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">switch</span> <span class="token punctuation">(</span>errorInfo<span class="token punctuation">.</span>showType<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">SILENT</span><span class="token operator">:</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">WARN_MESSAGE</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">ERROR_MESSAGE</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION</span><span class="token operator">:</span></span>
<span class="line">                    notification<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">description</span><span class="token operator">:</span> errorMessage<span class="token punctuation">,</span></span>
<span class="line">                        <span class="token literal-property property">message</span><span class="token operator">:</span> errorCode<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">响应状态码:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;没有收到响应&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;请求发送失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorThrower</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> data<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> errorMessage <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token literal-property property">error</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        error<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;BizError&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        error<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">{</span> errorCode<span class="token punctuation">,</span> errorMessage<span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">throw</span> error<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&#39;Accept&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&#39;include&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">errorConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        errorThrower<span class="token punctuation">,</span></span>
<span class="line">        errorHandler</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">requestInterceptors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> options <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">responseInterceptors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">layout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;UMI4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">logo</span><span class="token operator">:</span> <span class="token string">&#39;https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-添加用户" tabindex="-1"><a class="header-anchor" href="#_9-添加用户"><span>9.添加用户</span></a></h2><h3 id="_9-1-add-index-tsx" tabindex="-1"><a class="header-anchor" href="#_9-1-add-index-tsx"><span>9.1 add\\index.tsx</span></a></h3><p>src\\pages\\user\\add\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { Form, Input, Button, Row, Col } from &#39;antd&#39;;</span>
<span class="line">+import { useRequest } from &#39;ahooks&#39;;</span>
<span class="line">+import { addUser } from &#39;@/services/user&#39;;</span>
<span class="line">+import { useNavigate, useModel } from &#39;@umijs/max&#39;;</span>
<span class="line">+import { useEffect } from &#39;react&#39;;</span>
<span class="line"></span>
<span class="line">export default function () {</span>
<span class="line">+   const navigate = useNavigate();</span>
<span class="line">+   const { refresh } = useModel(&#39;user.model&#39;);</span>
<span class="line">+   const { data, loading, run } = useRequest(addUser, {</span>
<span class="line">+       manual: true,</span>
<span class="line">+       onSuccess: refresh</span>
<span class="line">+   });</span>
<span class="line">    const onFinish = (values: any) =&gt; {</span>
<span class="line">+       run(values);</span>
<span class="line">    };</span>
<span class="line">+   useEffect(() =&gt; {</span>
<span class="line">+       if (data) {</span>
<span class="line">+           navigate(&#39;/user/list&#39;);</span>
<span class="line">+       }</span>
<span class="line">+   }, [data]);</span>
<span class="line">    return (</span>
<span class="line">        &lt;Row &gt;</span>
<span class="line">            &lt;Col offset={8} span={8}&gt;</span>
<span class="line">                &lt;Form</span>
<span class="line">                    labelCol={{ span: 4 }}</span>
<span class="line">                    wrapperCol={{ span: 20 }}</span>
<span class="line">                    onFinish={onFinish}</span>
<span class="line">                &gt;</span>
<span class="line">                    &lt;Form.Item</span>
<span class="line">                        label=&quot;用户名&quot;</span>
<span class="line">                        name=&quot;username&quot;</span>
<span class="line">                        rules={[{ required: true, message: &#39;请输入用户名&#39; }]}</span>
<span class="line">                    &gt;</span>
<span class="line">                        &lt;Input /&gt;</span>
<span class="line">                    &lt;/Form.Item&gt;</span>
<span class="line">                    &lt;Form.Item</span>
<span class="line">                        label=&quot;密码&quot;</span>
<span class="line">                        name=&quot;password&quot;</span>
<span class="line">                        rules={[{ required: true, message: &#39;请输入密码&#39; }]}</span>
<span class="line">                    &gt;</span>
<span class="line">                        &lt;Input.Password /&gt;</span>
<span class="line">                    &lt;/Form.Item&gt;</span>
<span class="line">                    &lt;Form.Item</span>
<span class="line">                        label=&quot;手机号&quot;</span>
<span class="line">                        name=&quot;phone&quot;</span>
<span class="line">                        rules={[{ required: true, message: &#39;请输入手机号&#39; }]}</span>
<span class="line">                    &gt;</span>
<span class="line">                        &lt;Input /&gt;</span>
<span class="line">                    &lt;/Form.Item&gt;</span>
<span class="line">                    &lt;Form.Item wrapperCol={{ offset: 8, span: 16 }}&gt;</span>
<span class="line">                        &lt;Button type=&quot;primary&quot; htmlType=&quot;submit&quot; &gt;</span>
<span class="line">                            提交</span>
<span class="line">                        &lt;/Button&gt;</span>
<span class="line">                    &lt;/Form.Item&gt;</span>
<span class="line">                &lt;/Form&gt;</span>
<span class="line">            &lt;/Col&gt;</span>
<span class="line">        &lt;/Row&gt;</span>
<span class="line">    );</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-src-services-user-ts" tabindex="-1"><a class="header-anchor" href="#_9-2-src-services-user-ts"><span>9.2 src\\services\\user.ts</span></a></h3><p>src\\services\\user.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { request } from &#39;@umijs/max&#39;;</span>
<span class="line"></span>
<span class="line">export async function getUser() {</span>
<span class="line">  return request&lt;API.ListData&lt;API.User&gt;&gt;(&#39;/api/user&#39;, {</span>
<span class="line">    method: &#39;GET&#39;</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line">+export async function addUser(</span>
<span class="line">+  body?: API.User</span>
<span class="line">+) {</span>
<span class="line">+  return request&lt;string&gt;(&#39;/api/user&#39;, {</span>
<span class="line">+    method: &#39;POST&#39;,</span>
<span class="line">+    headers: {</span>
<span class="line">+      &#39;Content-Type&#39;: &#39;application/json&#39;,</span>
<span class="line">+    },</span>
<span class="line">+    data: body</span>
<span class="line">+  });</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-用户注册" tabindex="-1"><a class="header-anchor" href="#_10-用户注册"><span>10.用户注册</span></a></h2><h3 id="_10-1-routes-ts" tabindex="-1"><a class="header-anchor" href="#_10-1-routes-ts"><span>10.1 routes.ts</span></a></h3><p>config\\routes.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default [</span>
<span class="line">  { path: &#39;/&#39;, redirect: &#39;/home&#39; },</span>
<span class="line">  { icon: &#39;HomeOutlined&#39;, name: &#39;首页&#39;, path: &#39;/home&#39;, component: &#39;./home/index&#39; },</span>
<span class="line">  { icon: &#39;ProfileOutlined&#39;, name: &#39;个人中心&#39;, path: &#39;/profile&#39;, component: &#39;./profile/index&#39; },</span>
<span class="line">  {</span>
<span class="line">    icon: &#39;UserOutlined&#39;,</span>
<span class="line">    name: &#39;用户管理&#39;,</span>
<span class="line">    path: &#39;/user&#39;,</span>
<span class="line">    component: &#39;./user/index&#39;,</span>
<span class="line">    routes: [</span>
<span class="line">      { name: &#39;添加用户&#39;, path: &#39;/user/add&#39;, component: &#39;./user/add/index&#39; },</span>
<span class="line">      { name: &#39;用户列表&#39;, path: &#39;/user/list&#39;, component: &#39;./user/list/index&#39; },</span>
<span class="line">      { name: &#39;用户详情&#39;, path: &#39;/user/detail/:id&#39;, component: &#39;./user/detail/index&#39;, hideInMenu: true },</span>
<span class="line">    ],</span>
<span class="line">  },</span>
<span class="line">+ {</span>
<span class="line">+   name: &#39;注册&#39;,</span>
<span class="line">+   path: &#39;/signup&#39;,</span>
<span class="line">+   component: &#39;./signup/index&#39;,</span>
<span class="line">+   hideInMenu: true,</span>
<span class="line">+   layout: false</span>
<span class="line">+ }</span>
<span class="line">]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-2-src-app-ts" tabindex="-1"><a class="header-anchor" href="#_10-2-src-app-ts"><span>10.2 src\\app.ts</span></a></h3><p>src\\app.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> notification<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">import</span> <span class="token punctuation">{</span> history <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">enum</span> ErrorShowType <span class="token punctuation">{</span></span>
<span class="line">    <span class="token constant">SILENT</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">WARN_MESSAGE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">ERROR_MESSAGE</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">NOTIFICATION</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">error</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;BizError&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> errorInfo <span class="token operator">=</span> error<span class="token punctuation">.</span>info<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> <span class="token punctuation">{</span> errorMessage<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> showType <span class="token punctuation">}</span> <span class="token operator">=</span> errorInfo<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">switch</span> <span class="token punctuation">(</span>errorInfo<span class="token punctuation">.</span>showType<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">SILENT</span><span class="token operator">:</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">WARN_MESSAGE</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">ERROR_MESSAGE</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION</span><span class="token operator">:</span></span>
<span class="line">                    notification<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">description</span><span class="token operator">:</span> errorMessage<span class="token punctuation">,</span></span>
<span class="line">                        <span class="token literal-property property">message</span><span class="token operator">:</span> errorCode<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">响应状态码:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;没有收到响应&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;请求发送失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorThrower</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> data<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> errorMessage <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token literal-property property">error</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        error<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;BizError&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        error<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">{</span> errorCode<span class="token punctuation">,</span> errorMessage<span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">throw</span> error<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&#39;Accept&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&#39;include&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">errorConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        errorThrower<span class="token punctuation">,</span></span>
<span class="line">        errorHandler</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">requestInterceptors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> options <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">responseInterceptors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">interface</span> <span class="token class-name">InitialState</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    currentUser<span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">.</span>User <span class="token operator">|</span> <span class="token keyword">null</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">let</span> <span class="token literal-property property">initialState</span><span class="token operator">:</span> InitialState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        currentUser<span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">return</span> initialState<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">layout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> initialState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;UMI4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">logo</span><span class="token operator">:</span> <span class="token string">&#39;https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token function">onPageChange</span><span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>           <span class="token keyword">const</span> <span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span> <span class="token operator">=</span> initialState<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentUser <span class="token operator">&amp;&amp;</span> location<span class="token punctuation">.</span>pathname <span class="token operator">!==</span> <span class="token string">&#39;/signin&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>               history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/signup&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>           <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-3-constants-index-ts" tabindex="-1"><a class="header-anchor" href="#_10-3-constants-index-ts"><span>10.3 constants\\index.ts</span></a></h3><p>src\\constants\\index.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">enum</span> RoleCodes <span class="token punctuation">{</span></span>
<span class="line">    root <span class="token operator">=</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    admin <span class="token operator">=</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    member <span class="token operator">=</span> <span class="token string">&#39;member&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">ROLES</span> <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">code</span><span class="token operator">:</span> RoleCodes<span class="token punctuation">.</span>root<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;超级管理员&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">code</span><span class="token operator">:</span> RoleCodes<span class="token punctuation">.</span>admin<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;管理员&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">code</span><span class="token operator">:</span> RoleCodes<span class="token punctuation">.</span>member<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;普通成员&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span></span>
<span class="line">    RoleCodes<span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">ROLES</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-signup-index-tsx" tabindex="-1"><a class="header-anchor" href="#_10-4-signup-index-tsx"><span>10.4 signup\\index.tsx</span></a></h3><p>src\\pages\\signup\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Card<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col<span class="token punctuation">,</span> Spin<span class="token punctuation">,</span> Select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ahooks&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> signup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/services/auth&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> history<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ROLES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/constants&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> loading<span class="token punctuation">,</span> run <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>signup<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/signin&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">values</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">run</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">onFinishFailed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">errorInfo</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Failed:&#39;</span><span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Row className<span class="token operator">=</span><span class="token string">&#39;h-screen bg-gray-200&#39;</span> align<span class="token operator">=</span><span class="token string">&#39;middle&#39;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Col offset<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">}</span> span<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Card title<span class="token operator">=</span><span class="token string">&quot;请登录&quot;</span> extra<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/signin&quot;</span><span class="token operator">&gt;</span>去登录<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Spin spinning<span class="token operator">=</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Form</span>
<span class="line">                            labelCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                            wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                            onFinish<span class="token operator">=</span><span class="token punctuation">{</span>onFinish<span class="token punctuation">}</span></span>
<span class="line">                            onFinishFailed<span class="token operator">=</span><span class="token punctuation">{</span>onFinishFailed<span class="token punctuation">}</span></span>
<span class="line">                        <span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                                label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line">                                name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span></span>
<span class="line">                                rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入用户名&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                                label<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span></span>
<span class="line">                                name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">                                rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入密码&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Input<span class="token punctuation">.</span>Password <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                                label<span class="token operator">=</span><span class="token string">&quot;手机号&quot;</span></span>
<span class="line">                                name<span class="token operator">=</span><span class="token string">&quot;phone&quot;</span></span>
<span class="line">                                rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入手机号&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                                label<span class="token operator">=</span><span class="token string">&quot;角色&quot;</span></span>
<span class="line">                                name<span class="token operator">=</span><span class="token string">&quot;role&quot;</span></span>
<span class="line">                                rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请选择角色&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Select</span>
<span class="line">                                <span class="token operator">&gt;</span></span>
<span class="line">                                    <span class="token punctuation">{</span></span>
<span class="line">                                        <span class="token constant">ROLES</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">role</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                                            <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">                                                <span class="token operator">&lt;</span>Select<span class="token punctuation">.</span>Option value<span class="token operator">=</span><span class="token punctuation">{</span>role<span class="token punctuation">.</span>code<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>role<span class="token punctuation">.</span>code<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                                                    <span class="token punctuation">{</span>role<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>
<span class="line">                                                <span class="token operator">&lt;</span><span class="token operator">/</span>Select<span class="token punctuation">.</span>Option<span class="token operator">&gt;</span></span>
<span class="line">                                            <span class="token punctuation">)</span></span>
<span class="line">                                        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">                                    <span class="token punctuation">}</span></span>
<span class="line">                                <span class="token operator">&lt;</span><span class="token operator">/</span>Select<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> <span class="token operator">&gt;</span></span>
<span class="line">                                    提交</span>
<span class="line">                                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Spin<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Col<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Row<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-5-auth-ts" tabindex="-1"><a class="header-anchor" href="#_10-5-auth-ts"><span>10.5 auth.ts</span></a></h3><p>src\\services\\auth.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> request <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">signup</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter">body<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">.</span>SignupUser</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> request<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">data</span><span class="token operator">:</span> body</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-用户登录" tabindex="-1"><a class="header-anchor" href="#_11-用户登录"><span>11.用户登录</span></a></h2><h3 id="_11-1-routes-ts" tabindex="-1"><a class="header-anchor" href="#_11-1-routes-ts"><span>11.1 routes.ts</span></a></h3><p>config\\routes.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default [</span>
<span class="line">  { path: &#39;/&#39;, redirect: &#39;/home&#39; },</span>
<span class="line">  { icon: &#39;HomeOutlined&#39;, name: &#39;首页&#39;, path: &#39;/home&#39;, component: &#39;./home/index&#39; },</span>
<span class="line">  { icon: &#39;ProfileOutlined&#39;, name: &#39;个人中心&#39;, path: &#39;/profile&#39;, component: &#39;./profile/index&#39; },</span>
<span class="line">  {</span>
<span class="line">    icon: &#39;UserOutlined&#39;,</span>
<span class="line">    name: &#39;用户管理&#39;,</span>
<span class="line">    path: &#39;/user&#39;,</span>
<span class="line">    component: &#39;./user/index&#39;,</span>
<span class="line">    routes: [</span>
<span class="line">      { name: &#39;添加用户&#39;, path: &#39;/user/add&#39;, component: &#39;./user/add/index&#39; },</span>
<span class="line">      { name: &#39;用户列表&#39;, path: &#39;/user/list&#39;, component: &#39;./user/list/index&#39; },</span>
<span class="line">      { name: &#39;用户详情&#39;, path: &#39;/user/detail/:id&#39;, component: &#39;./user/detail/index&#39;, hideInMenu: true },</span>
<span class="line">    ],</span>
<span class="line">  },</span>
<span class="line">  {</span>
<span class="line">    name: &#39;注册&#39;,</span>
<span class="line">    path: &#39;/signup&#39;,</span>
<span class="line">    component: &#39;./signup/index&#39;,</span>
<span class="line">    hideInMenu: true,</span>
<span class="line">    layout: false</span>
<span class="line">  },</span>
<span class="line">+ {</span>
<span class="line">+   name: &#39;登录&#39;,</span>
<span class="line">+   path: &#39;/signin&#39;,</span>
<span class="line">+   component: &#39;./signin/index&#39;,</span>
<span class="line">+   hideInMenu: true,</span>
<span class="line">+   layout: false</span>
<span class="line">+ }</span>
<span class="line">]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-app-ts" tabindex="-1"><a class="header-anchor" href="#_11-2-app-ts"><span>11.2 app.ts</span></a></h3><p>src\\app.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> notification<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> history <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">import</span> <span class="token punctuation">{</span> decode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">enum</span> ErrorShowType <span class="token punctuation">{</span></span>
<span class="line">    <span class="token constant">SILENT</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">WARN_MESSAGE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">ERROR_MESSAGE</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">NOTIFICATION</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">error</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;BizError&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> errorInfo <span class="token operator">=</span> error<span class="token punctuation">.</span>info<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> <span class="token punctuation">{</span> errorMessage<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> showType <span class="token punctuation">}</span> <span class="token operator">=</span> errorInfo<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">switch</span> <span class="token punctuation">(</span>errorInfo<span class="token punctuation">.</span>showType<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">SILENT</span><span class="token operator">:</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">WARN_MESSAGE</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">ERROR_MESSAGE</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">case</span> ErrorShowType<span class="token punctuation">.</span><span class="token constant">NOTIFICATION</span><span class="token operator">:</span></span>
<span class="line">                    notification<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">description</span><span class="token operator">:</span> errorMessage<span class="token punctuation">,</span></span>
<span class="line">                        <span class="token literal-property property">message</span><span class="token operator">:</span> errorCode<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">                    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">响应状态码:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;没有收到响应&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;请求发送失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorThrower</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> data<span class="token punctuation">,</span> errorCode<span class="token punctuation">,</span> errorMessage <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token literal-property property">error</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        error<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;BizError&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        error<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">{</span> errorCode<span class="token punctuation">,</span> errorMessage<span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">throw</span> error<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&#39;Accept&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&#39;include&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">errorConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        errorThrower<span class="token punctuation">,</span></span>
<span class="line">        errorHandler</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">requestInterceptors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            options<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization <span class="token operator">=</span> token</span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> options <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">responseInterceptors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">InitialState</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">currentUser</span><span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">.</span>User <span class="token operator">|</span> <span class="token keyword">null</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">initialState</span><span class="token operator">:</span> InitialState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">currentUser</span><span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       initialState<span class="token punctuation">.</span>currentUser <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> initialState<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">layout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> initialState <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;UMI4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">logo</span><span class="token operator">:</span> <span class="token string">&#39;https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function">onPageChange</span><span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> <span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span> <span class="token operator">=</span> initialState<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentUser <span class="token operator">&amp;&amp;</span> location<span class="token punctuation">.</span>pathname <span class="token operator">!==</span> <span class="token string">&#39;/signin&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>               history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/signin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>           <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-3-signin-index-tsx" tabindex="-1"><a class="header-anchor" href="#_11-3-signin-index-tsx"><span>11.3 signin\\index.tsx</span></a></h3><p>src\\pages\\signin\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Card<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col<span class="token punctuation">,</span> Spin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ahooks&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> signin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/services/auth&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useModel<span class="token punctuation">,</span> history<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> decode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> initialState<span class="token punctuation">,</span> setInitialState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useModel</span><span class="token punctuation">(</span><span class="token string">&#39;@@initialState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> loading<span class="token punctuation">,</span> run <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>signin<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> currentUser <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">setInitialState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialState<span class="token operator">?.</span>currentUser<span class="token punctuation">)</span></span>
<span class="line">            history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>initialState<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">values</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">run</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">onFinishFailed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">errorInfo</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Failed:&#39;</span><span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Row className<span class="token operator">=</span><span class="token string">&#39;h-screen bg-gray-200&#39;</span> align<span class="token operator">=</span><span class="token string">&#39;middle&#39;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Col offset<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">}</span> span<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Card title<span class="token operator">=</span><span class="token string">&quot;请登录&quot;</span> extra<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/signup&quot;</span><span class="token operator">&gt;</span>去注册<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Spin spinning<span class="token operator">=</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Form</span>
<span class="line">                            labelCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                            wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                            onFinish<span class="token operator">=</span><span class="token punctuation">{</span>onFinish<span class="token punctuation">}</span></span>
<span class="line">                            onFinishFailed<span class="token operator">=</span><span class="token punctuation">{</span>onFinishFailed<span class="token punctuation">}</span></span>
<span class="line">                        <span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                                label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line">                                name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span></span>
<span class="line">                                rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入用户名&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item</span>
<span class="line">                                label<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span></span>
<span class="line">                                name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">                                rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;请输入密码&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                            <span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Input<span class="token punctuation">.</span>Password <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item wrapperCol<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> <span class="token operator">&gt;</span></span>
<span class="line">                                    提交</span>
<span class="line">                                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Spin<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Col<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Row<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-4-auth-ts" tabindex="-1"><a class="header-anchor" href="#_11-4-auth-ts"><span>11.4 auth.ts</span></a></h3><p>src\\services\\auth.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { request } from &#39;@umijs/max&#39;;</span>
<span class="line"></span>
<span class="line">export async function signup(</span>
<span class="line">  body?: API.SignupUser</span>
<span class="line">) {</span>
<span class="line">  return request&lt;string&gt;(&#39;/api/user&#39;, {</span>
<span class="line">    method: &#39;POST&#39;,</span>
<span class="line">    headers: {</span>
<span class="line">      &#39;Content-Type&#39;: &#39;application/json&#39;,</span>
<span class="line">    },</span>
<span class="line">    data: body</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">+export async function signin(</span>
<span class="line">+  body?: API.SigninUser</span>
<span class="line">+) {</span>
<span class="line">+  return request(&#39;/api/signin&#39;, {</span>
<span class="line">+    method: &#39;POST&#39;,</span>
<span class="line">+    headers: {</span>
<span class="line">+      &#39;Content-Type&#39;: &#39;application/json&#39;,</span>
<span class="line">+    },</span>
<span class="line">+    data: body</span>
<span class="line">+  });</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-用户退出" tabindex="-1"><a class="header-anchor" href="#_12-用户退出"><span>12.用户退出</span></a></h2><h3 id="_12-1-profile-index-tsx" tabindex="-1"><a class="header-anchor" href="#_12-1-profile-index-tsx"><span>12.1 profile\\index.tsx</span></a></h3><p>src\\pages\\profile\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { PageContainer } from &#39;@ant-design/pro-components&#39;;</span>
<span class="line">+import HeaderMenu from &#39;@/components/HeaderMenu&#39;;</span>
<span class="line"></span>
<span class="line">export default function Page() {</span>
<span class="line">  return (</span>
<span class="line">+   &lt;PageContainer ghost&gt;</span>
<span class="line">+     &lt;HeaderMenu /&gt;</span>
<span class="line">+   &lt;/PageContainer&gt;</span>
<span class="line">  );</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-2-headermenu-index-tsx" tabindex="-1"><a class="header-anchor" href="#_12-2-headermenu-index-tsx"><span>12.2 HeaderMenu\\index.tsx</span></a></h3><p>src\\components\\HeaderMenu\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Dropdown<span class="token punctuation">,</span> Menu <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> LoginOutlined <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@ant-design/icons&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useModel<span class="token punctuation">,</span> history <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@umijs/max&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HeaderMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> initialState<span class="token punctuation">,</span> setInitialState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useModel</span><span class="token punctuation">(</span><span class="token string">&#39;@@initialState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">logoutClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">setInitialState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">currentUser</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/signin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">const</span> menu <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>Menu items<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;logout&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token punctuation">(</span></span>
<span class="line">          <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>退出<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token operator">&lt;</span>LoginOutlined <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">onClick</span><span class="token operator">:</span> logoutClick</span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>Dropdown<span class="token punctuation">.</span>Button overlay<span class="token operator">=</span><span class="token punctuation">{</span>menu<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">{</span>initialState<span class="token operator">?.</span>currentUser<span class="token operator">?.</span>username<span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Dropdown<span class="token punctuation">.</span>Button<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_13-路由权限" tabindex="-1"><a class="header-anchor" href="#_13-路由权限"><span>13.路由权限</span></a></h2><h3 id="_13-1-config-ts" tabindex="-1"><a class="header-anchor" href="#_13-1-config-ts"><span>13.1 config.ts</span></a></h3><p>config\\config.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { defineConfig } from &quot;@umijs/max&quot;;</span>
<span class="line">import routes from &quot;./routes&quot;;</span>
<span class="line">export default defineConfig({</span>
<span class="line">  npmClient: &quot;pnpm&quot;,</span>
<span class="line">  routes,</span>
<span class="line">  tailwindcss: {},</span>
<span class="line">  layout: {</span>
<span class="line">    title: &quot;UMI&quot;,</span>
<span class="line">    locale: false</span>
<span class="line">  },</span>
<span class="line">  antd: {},</span>
<span class="line">  request: {},</span>
<span class="line">  model: {},</span>
<span class="line">  initialState: {},</span>
<span class="line">  proxy: {</span>
<span class="line">    &#39;/api/&#39;: {</span>
<span class="line">      target: &#39;http://127.0.0.1:7001/&#39;,</span>
<span class="line">      changeOrigin: true</span>
<span class="line">    }</span>
<span class="line">  },</span>
<span class="line">+ access: {}</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-2-routes-ts" tabindex="-1"><a class="header-anchor" href="#_13-2-routes-ts"><span>13.2 routes.ts</span></a></h3><p>config\\routes.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default [</span>
<span class="line">  { path: &#39;/&#39;, redirect: &#39;/home&#39; },</span>
<span class="line">  { icon: &#39;HomeOutlined&#39;, name: &#39;首页&#39;, path: &#39;/home&#39;, component: &#39;./home/index&#39; },</span>
<span class="line">  { icon: &#39;ProfileOutlined&#39;, name: &#39;个人中心&#39;, path: &#39;/profile&#39;, component: &#39;./profile/index&#39; },</span>
<span class="line">  {</span>
<span class="line">    icon: &#39;UserOutlined&#39;,</span>
<span class="line">    name: &#39;用户管理&#39;,</span>
<span class="line">    path: &#39;/user&#39;,</span>
<span class="line">    component: &#39;./user/index&#39;,</span>
<span class="line">    routes: [</span>
<span class="line">+      { name: &#39;添加用户&#39;, path: &#39;/user/add&#39;, component: &#39;./user/add/index&#39;, access: &#39;adminCan&#39; },</span>
<span class="line">+      { name: &#39;用户列表&#39;, path: &#39;/user/list&#39;, component: &#39;./user/list/index&#39;, access: &#39;memberCan&#39; },</span>
<span class="line">+      { name: &#39;用户详情&#39;, path: &#39;/user/detail/:id&#39;, component: &#39;./user/detail/index&#39;, hideInMenu: true, access: &#39;memberCan&#39; },</span>
<span class="line">    ],</span>
<span class="line">  },</span>
<span class="line">  {</span>
<span class="line">    name: &#39;注册&#39;,</span>
<span class="line">    path: &#39;/signup&#39;,</span>
<span class="line">    component: &#39;./signup/index&#39;,</span>
<span class="line">    hideInMenu: true,</span>
<span class="line">    layout: false</span>
<span class="line">  },</span>
<span class="line">  {</span>
<span class="line">    name: &#39;登录&#39;,</span>
<span class="line">    path: &#39;/signin&#39;,</span>
<span class="line">    component: &#39;./signin/index&#39;,</span>
<span class="line">    hideInMenu: true,</span>
<span class="line">    layout: false</span>
<span class="line">  },</span>
<span class="line">]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-3-access-ts" tabindex="-1"><a class="header-anchor" href="#_13-3-access-ts"><span>13.3 access.ts</span></a></h3><p>src\\access.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RoleCodes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/constants&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> role <span class="token operator">=</span> initialState<span class="token operator">?.</span>currentUser<span class="token operator">?.</span>role<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">rootCan</span><span class="token operator">:</span> role <span class="token operator">===</span> RoleCodes<span class="token punctuation">.</span>root<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">adminCan</span><span class="token operator">:</span> <span class="token punctuation">[</span>RoleCodes<span class="token punctuation">.</span>root<span class="token punctuation">,</span> RoleCodes<span class="token punctuation">.</span>admin<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">memberCan</span><span class="token operator">:</span> <span class="token punctuation">[</span>RoleCodes<span class="token punctuation">.</span>root<span class="token punctuation">,</span> RoleCodes<span class="token punctuation">.</span>admin<span class="token punctuation">,</span> RoleCodes<span class="token punctuation">.</span>member<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-按钮权限" tabindex="-1"><a class="header-anchor" href="#_14-按钮权限"><span>14.按钮权限</span></a></h2><h3 id="_14-1-list-index-tsx" tabindex="-1"><a class="header-anchor" href="#_14-1-list-index-tsx"><span>14.1 list\\index.tsx</span></a></h3><p>src\\pages\\user\\list\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { List, Button } from &#39;antd&#39;;</span>
<span class="line">+import { Link, useModel, useAccess } from &#39;@umijs/max&#39;;</span>
<span class="line">+import { useRequest } from &#39;ahooks&#39;;</span>
<span class="line">+import { deleteUser } from &#39;@/services/user&#39;;</span>
<span class="line"></span>
<span class="line">export default function () {</span>
<span class="line">    const { data, loading, refresh } = useModel(&#39;user.model&#39;);</span>
<span class="line">+   const { run } = useRequest(deleteUser, {</span>
<span class="line">+       manual: true,</span>
<span class="line">+       onSuccess: refresh</span>
<span class="line">+   });</span>
<span class="line">+   const access = useAccess();</span>
<span class="line">    return (</span>
<span class="line">        &lt;List</span>
<span class="line">            className=&#39;w-1/3&#39;</span>
<span class="line">            header={&lt;div&gt;用户列表&lt;/div&gt;}</span>
<span class="line">            footer={&lt;div&gt;共计{data?.list?.length}&lt;/div&gt;}</span>
<span class="line">            bordered</span>
<span class="line">            dataSource={data?.list}</span>
<span class="line">            renderItem={(user: any) =&gt; (</span>
<span class="line">                &lt;List.Item&gt;</span>
<span class="line">                    &lt;Link to={\`/user/detail/\${user.id}\`} state={user}&gt; {user.username}&lt;/Link&gt;</span>
<span class="line">+                   &lt;Button</span>
<span class="line">+                       onClick={() =&gt; run(user.id)}</span>
<span class="line">+                       size=&#39;small&#39;</span>
<span class="line">+                       type=&quot;primary&quot;</span>
<span class="line">+                       disabled={!access.adminCan}</span>
<span class="line">+                       loading={loading}&gt;</span>
<span class="line">+                       删除</span>
<span class="line">+                   &lt;/Button&gt;</span>
<span class="line">                &lt;/List.Item&gt;</span>
<span class="line">            )}</span>
<span class="line">        /&gt;</span>
<span class="line">    );</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-2-user-ts" tabindex="-1"><a class="header-anchor" href="#_14-2-user-ts"><span>14.2 user.ts</span></a></h3><p>src\\services\\user.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { request } from &#39;@umijs/max&#39;;</span>
<span class="line"></span>
<span class="line">export async function getUser() {</span>
<span class="line">  return request&lt;API.ListData&lt;API.User&gt;&gt;(&#39;/api/user&#39;, {</span>
<span class="line">    method: &#39;GET&#39;</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line">export async function addUser(</span>
<span class="line">  body?: API.User</span>
<span class="line">) {</span>
<span class="line">  return request&lt;string&gt;(&#39;/api/user&#39;, {</span>
<span class="line">    method: &#39;POST&#39;,</span>
<span class="line">    headers: {</span>
<span class="line">      &#39;Content-Type&#39;: &#39;application/json&#39;,</span>
<span class="line">    },</span>
<span class="line">    data: body</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line">+export async function deleteUser(id) {</span>
<span class="line">+  return request&lt;string&gt;(\`/api/user/\${id}\`, {</span>
<span class="line">+    method: &#39;DELETE&#39;</span>
<span class="line">+  });</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,138)])])}const c=n(t,[["render",l]]),r=JSON.parse('{"path":"/strong/158.umi4.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/158.umi4.md"}');export{c as comp,r as data};
