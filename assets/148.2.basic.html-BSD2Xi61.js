import{_ as s,c as a,a as p,o as t}from"./app-CD1YpnS1.js";const e={};function l(c,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="_1-ecmascript-的类型" tabindex="-1"><a class="header-anchor" href="#_1-ecmascript-的类型"><span>1.ECMAScript 的类型</span></a></h2><ul><li>ECMAScript 的类型分为语言类型和规范类型</li><li>ECMAScript 语言类型是开发者直接使用 ECMAScript 可以操作的。其实就是我们常说的Undefined, Null, Boolean, String, Number, 和 Object</li><li>而规范类型相当于 <code>meta-values</code>，是用来用算法描述 ECMAScript 语言结构和 ECMAScript 语言类型的,包括<code>Reference</code>、 <code>Lexical Environment</code> 和 <code>Environment Record</code></li></ul><h2 id="_2-函数调用" tabindex="-1"><a class="header-anchor" href="#_2-函数调用"><span>2.函数调用</span></a></h2><ul><li>[函数调用](http://yanhaijing.com/es5/</li></ul><h3 id="_2-1-src-reference-js" tabindex="-1"><a class="header-anchor" href="#_2-1-src-reference-js"><span>2.1 src\\Reference.js</span></a></h3><p>src\\Reference.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> EnvironmentRecord <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./EnvironmentRecord&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Reference</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">base<span class="token punctuation">,</span> name<span class="token punctuation">,</span> strict</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>base <span class="token operator">=</span> base<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>strict <span class="token operator">=</span> strict<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">GetBase</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">V</span><span class="token punctuation">.</span>base<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">GetReferencedName</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">V</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">IsStrictReference</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">V</span><span class="token punctuation">.</span>strict<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">HasPrimitiveBase</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">V</span><span class="token punctuation">.</span>base<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[Object Boolean]</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">            <span class="token operator">||</span> <span class="token constant">V</span><span class="token punctuation">.</span>base<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[Object String]</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">            <span class="token operator">||</span> <span class="token constant">V</span><span class="token punctuation">.</span>base<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[Object Number]</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">IsPropertyReference</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token constant">V</span><span class="token punctuation">.</span>base <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">.</span>base <span class="token keyword">instanceof</span> <span class="token class-name">EnvironmentRecord</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> Reference<span class="token punctuation">.</span><span class="token function">HasPrimitiveBase</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">IsUnresolvableReference</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">typeof</span> <span class="token constant">V</span><span class="token punctuation">.</span>base <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//如果 Type(V) 不是引用 , 返回 V。</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Reference<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">V</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//令 base 为调用 GetBase(V) 的返回值</span></span>
<span class="line">        <span class="token keyword">let</span> base <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetBase</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//如果 IsUnresolvableReference(V), 抛出一个 ReferenceError 异常。</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">IsUnresolvableReference</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">ReferenceError </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">V</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not defined</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//如果 IsPropertyReference(V),</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">IsPropertyReference</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//如果 HasPrimitiveBase(V) 是 false,</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Reference<span class="token punctuation">.</span><span class="token function">HasPrimitiveBase</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">let</span> name <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetReferencedName</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> base<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">let</span> <span class="token constant">O</span> <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">ToObject</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">let</span> name <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetReferencedName</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">let</span> desc <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> desc <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">IsDataDescriptor</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> desc<span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsAccessorDescriptor</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">let</span> getter <span class="token operator">=</span> desc<span class="token punctuation">.</span>get<span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> getter <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">return</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//否则 , base 必须是一个 environment record</span></span>
<span class="line">            <span class="token comment">//传递 GetReferencedName(V) 和 IsStrictReference(V) 为参数调用 base 的 GetBindingValue( 见 10.2.1) 具体方法，返回结果。</span></span>
<span class="line">            <span class="token keyword">let</span> name <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetReferencedName</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> strict <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">IsStrictReference</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            base<span class="token punctuation">.</span><span class="token function">GetBindingValue</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> strict<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">base</span><span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">GetReferencedName</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">IsDataDescriptor</span><span class="token punctuation">(</span><span class="token parameter">desc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> desc<span class="token punctuation">.</span>value <span class="token operator">||</span> desc<span class="token punctuation">.</span>writable<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">IsAccessorDescriptor</span><span class="token punctuation">(</span><span class="token parameter">desc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> desc<span class="token punctuation">.</span>get <span class="token operator">||</span> desc<span class="token punctuation">.</span>set<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">ToObject</span><span class="token punctuation">(</span><span class="token parameter">PrimitiveValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>PrimitiveValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token string">&#39;Boolean&#39;</span><span class="token operator">:</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span>PrimitiveValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token string">&#39;Number&#39;</span><span class="token operator">:</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span>PrimitiveValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token string">&#39;String&#39;</span><span class="token operator">:</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>PrimitiveValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">Type</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">V</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">V</span> <span class="token keyword">instanceof</span> <span class="token class-name">Reference</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Reference<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-this-js" tabindex="-1"><a class="header-anchor" href="#_2-2-this-js"><span>2.2 this.js</span></a></h3><p>src\\3.this.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//console.log(obj.getName());</span></span>
<span class="line"><span class="token comment">//令 ref 为解释执行 MemberExpression 的结果</span></span>
<span class="line"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">/*</span>
<span class="line">console.log((obj.getName)());</span>
<span class="line">console.log((obj.getName = obj.getName)());</span>
<span class="line">console.log((true &amp;&amp; obj.getName)());</span>
<span class="line">console.log((obj.getName, obj.getName)());</span>
<span class="line">console.log((true &amp;&amp; obj.getName)()); */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> Reference <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./Reference&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Reference</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&#39;getName&#39;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//let ref = obj.getName;</span></span>
<span class="line"><span class="token comment">//令 func 为 GetValue(ref).</span></span>
<span class="line"><span class="token keyword">let</span> func <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//令 argList 为解释执行 Arguments 的结果 , 产生参数值们的内部列表 (see 11.2.4).</span></span>
<span class="line"><span class="token keyword">let</span> argList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//如果 Type(func) is not Object ，抛出一个 TypeError 异常 .</span></span>
<span class="line"><span class="token comment">/* if (!Type(func)) {</span>
<span class="line">    throw new Error(\`TypeError\`);</span>
<span class="line">} */</span></span>
<span class="line"><span class="token comment">//如果 IsCallable(func) is false ，抛出一个 TypeError 异常 .</span></span>
<span class="line"><span class="token comment">/* if (!IsCallable(func)) {</span>
<span class="line">    throw new Error(\`TypeError\`);</span>
<span class="line">} */</span></span>
<span class="line"><span class="token comment">//如果 Type(ref) 为 Reference，那么 如果 IsPropertyReference(ref) 为 true，</span></span>
<span class="line"><span class="token comment">//那么 令 thisValue 为 GetBase(ref).</span></span>
<span class="line"><span class="token comment">//否则, ref 的基值是一个环境记录项 令 thisValue 为调用 GetBase(ref) 的 ImplicitThisValue 具体方法的结果</span></span>
<span class="line"><span class="token keyword">let</span> thisValue<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">IsPropertyReference</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        thisValue <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetBase</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        thisValue <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetBase</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ImplicitThisValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//否则 , 假如 Type(ref) 不是 Reference. 令 thisValue 为 undefined.</span></span>
<span class="line">    thisValue <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//返回调用 func 的 [[Call]] 内置方法的结果 , 传入 thisValue 作为 this 值和列表 argList 作为参数列表</span></span>
<span class="line"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisValue<span class="token punctuation">,</span> <span class="token operator">...</span>argList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-call" tabindex="-1"><a class="header-anchor" href="#_3-call"><span>3.[[Call]]</span></a></h2><ul><li>当用一个 this 值，一个参数列表调用函数对象 F 的 [[Call]] 内部方法，采用以下步骤： <ul><li>用 F 的 [[FormalParameters]] 内部属性值，参数列表 args，10.4.3 描述的 this 值来建立 函数代码 的一个新执行环境，令 funcCtx 为其结果。</li><li>令 result 为 FunctionBody（也就是 F 的 [[Code]] 内部属性）解释执行的结果。如果 F 没有 [[Code]] 内部属性或其值是空的 FunctionBody，则 result 是 (normal, undefined, empty)。</li><li>退出 funcCtx 执行环境，恢复到之前的执行环境。</li><li>如果 result.type 是 throw 则抛出 result.value。</li><li>如果 result.type 是 return 则返回 result.value。</li><li>否则 result.type 必定是 normal。返回 undefined。</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//当用一个 this 值，一个参数列表调用函数对象 F 的 [[Call]] 内部方法，采用以下步骤：</span></span>
<span class="line"><span class="token keyword">const</span> ExecutionContext <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./ExecutionContext&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> LexicalEnvironment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./LexicalEnvironment&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> FunctionDeclaration <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./FunctionDeclaration&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> Reference <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./Reference&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> ECStack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./ECStack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//sum();</span></span>
<span class="line"><span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token string">&#39;sum&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> FormalParameterList <span class="token operator">=</span> <span class="token string">&quot;a,b&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> FunctionBody <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">   console.log(this, a, b);</span>
<span class="line"></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> globalLexicalEnvironment <span class="token operator">=</span> LexicalEnvironment<span class="token punctuation">.</span><span class="token function">NewObjectEnvironment</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> globalEC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExecutionContext</span><span class="token punctuation">(</span>globalLexicalEnvironment<span class="token punctuation">,</span> global<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>globalEC<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> env <span class="token operator">=</span> ECStack<span class="token punctuation">.</span>current<span class="token punctuation">.</span>lexicalEnvironment<span class="token punctuation">.</span>environmentRecord<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> Scope <span class="token operator">=</span> ECStack<span class="token punctuation">.</span>current<span class="token punctuation">.</span>lexicalEnvironment<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> fo <span class="token operator">=</span> FunctionDeclaration<span class="token punctuation">.</span><span class="token function">createInstance</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> FormalParameterList<span class="token punctuation">,</span> FunctionBody<span class="token punctuation">,</span> Scope<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Reference</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token string">&#39;sum&#39;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> thisValue<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>Reference<span class="token punctuation">.</span><span class="token function">IsPropertyReference</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        thisValue <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetBase</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        thisValue <span class="token operator">=</span> Reference<span class="token punctuation">.</span><span class="token function">GetBase</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ImplicitThisValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//否则 , 假如 Type(ref) 不是 Reference. 令 thisValue 为 undefined.</span></span>
<span class="line">    thisValue <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> FormalParameters <span class="token operator">=</span> FormalParameterList<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> localEnv <span class="token operator">=</span> LexicalEnvironment<span class="token punctuation">.</span><span class="token function">NewDeclarativeEnvironment</span><span class="token punctuation">(</span>fo<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[Scope]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> funcCtx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExecutionContext</span><span class="token punctuation">(</span>localEnv<span class="token punctuation">,</span> thisValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>funcCtx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">env <span class="token operator">=</span> ECStack<span class="token punctuation">.</span>current<span class="token punctuation">.</span>lexicalEnvironment<span class="token punctuation">.</span>environmentRecord<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> strict <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//令 argCount 为 args 中元素的数量</span></span>
<span class="line"><span class="token keyword">let</span> argCount <span class="token operator">=</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">FormalParameters<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">argName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> v <span class="token operator">=</span> n <span class="token operator">&gt;</span> argCount <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> args<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    argAlreadyDeclared <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">HasBinding</span><span class="token punctuation">(</span>argName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>argAlreadyDeclared<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        env<span class="token punctuation">.</span><span class="token function">CreateMutableBinding</span><span class="token punctuation">(</span>argName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    env<span class="token punctuation">.</span><span class="token function">SetMutableBinding</span><span class="token punctuation">(</span>argName<span class="token punctuation">,</span> v<span class="token punctuation">,</span> strict<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span></span>
<span class="line">    thisValue<span class="token punctuation">,</span></span>
<span class="line">    Reference<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span></span>
<span class="line">        LexicalEnvironment<span class="token punctuation">.</span><span class="token function">GetIdentifierReference</span><span class="token punctuation">(</span>ECStack<span class="token punctuation">.</span>current<span class="token punctuation">.</span>lexicalEnvironment<span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    Reference<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span></span>
<span class="line">        LexicalEnvironment<span class="token punctuation">.</span><span class="token function">GetIdentifierReference</span><span class="token punctuation">(</span>ECStack<span class="token punctuation">.</span>current<span class="token punctuation">.</span>lexicalEnvironment<span class="token punctuation">,</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-call" tabindex="-1"><a class="header-anchor" href="#_4-call"><span>4. call</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//Function.prototype.call (thisArg [ , arg1 [ , arg2, … ] ] )</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> thisArg <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;obj&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//当以 thisArg 和可选的 arg1, arg2 等等作为参数在一个 func 对象上调用 call 方法，采用如下步骤：</span></span>
<span class="line"><span class="token comment">//如果 IsCallable(func) 是 false, 则抛出一个 TypeError 异常。</span></span>
<span class="line"><span class="token keyword">let</span> func <span class="token operator">=</span> sum<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">/* if (!IsCallable(func)) {</span>
<span class="line">    throw new Error(\`TypeError\`);</span>
<span class="line">} */</span></span>
<span class="line"><span class="token comment">//令 argList 为一个空列表。</span></span>
<span class="line"><span class="token keyword">let</span> argList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//如果调用这个方法的参数多余一个，则从 arg1 开始以从左到右的顺序将每个参数插入为 argList 的最后一个元素。</span></span>
<span class="line">argList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">argList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//提供 thisArg 作为 this 值并以 argList 作为参数列表，调用 func 的 [[Call]] 内部方法，返回结果。</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span></span>
<span class="line">    thisArg</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-apply" tabindex="-1"><a class="header-anchor" href="#_5-apply"><span>5. apply</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//Function.prototype.apply (thisArg, argArray)</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Type <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> thisArg <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;obj&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//当以 thisArg 和 argArray 为参数在一个 func 对象上调用 apply 方法，采用如下步骤：</span></span>
<span class="line"><span class="token comment">//如果 IsCallable(func) 是 false, 则抛出一个 TypeError 异常 .</span></span>
<span class="line"><span class="token comment">/* if (!IsCallable(func)) {</span>
<span class="line">    throw new Error(\`TypeError\`);</span>
<span class="line">} */</span></span>
<span class="line"><span class="token comment">//如果 argArray 是 null 或 undefined,</span></span>
<span class="line"><span class="token comment">//则返回提供 thisArg 作为 this 值并以空参数列表调用 func 的 [[Call]] 内部方法的结果。</span></span>
<span class="line"><span class="token keyword">let</span> argArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>argArray<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//如果 Type(argArray) 不是 Object, 则抛出一个 TypeError 异常 .</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Type</span><span class="token punctuation">(</span>argArray<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">TypeError</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//令 len 为以 &quot;length&quot; 作为参数调用 argArray 的 [[Get]] 内部方法的结果。</span></span>
<span class="line"><span class="token keyword">let</span> len <span class="token operator">=</span> argArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//令 n 为 ToUint32(len).</span></span>
<span class="line"><span class="token keyword">let</span> n <span class="token operator">=</span> len<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//令 argList 为一个空列表 .</span></span>
<span class="line"><span class="token keyword">let</span> argList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> indexName <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> nextArg <span class="token operator">=</span> argArray<span class="token punctuation">[</span>indexName<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    argList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>nextArg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//提供 thisArg 作为 this 值并以 argList 作为参数列表，调用 func 的 [[Call]] 内部方法，返回结果。</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-bind" tabindex="-1"><a class="header-anchor" href="#_6-bind"><span>6. bind</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Function.prototype.bind (thisArg [, arg1 [, arg2, …]])</span></span>
<span class="line"><span class="token comment">// bind 方法需要一个或更多参数，thisArg 和（可选的）arg1, arg2, 等等，执行如下步骤返回一个新函数对象：</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> thisArg <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;obj&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> newFunc <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">newFunc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> IsCallable <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//令 Target 为 this 值 .</span></span>
<span class="line"><span class="token keyword">let</span> Target <span class="token operator">=</span> thisArg<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//如果 IsCallable(Target) 是 false, 抛出一个 TypeError 异常 .</span></span>
<span class="line">func<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[call]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsCallable</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">TypeError</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//令 A 为一个（可能为空的）新内部列表，它包含按顺序的 thisArg 后面的所有参数（arg1, arg2 等等）。</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//令 F 为一个新原生 ECMAScript 对象。</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token constant">F</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//依照 8.12 指定，设定 F 的除了 [[Get]] 之外的所有内部方法。</span></span>
<span class="line"><span class="token comment">//依照 15.3.5.4 指定，设定 F 的 [[Get]] 内部属性。</span></span>
<span class="line"><span class="token comment">//设定 F 的 [[TargetFunction]] 内部属性为 Target。</span></span>
<span class="line"><span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[TargetFunction]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> Target<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//设定 F 的 [[BoundThis]] 内部属性为 thisArg 的值。</span></span>
<span class="line"><span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[BoundThis]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> thisArg<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//设定 F 的 [[BoundArgs]] 内部属性为 A。</span></span>
<span class="line"><span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[BoundArgs]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//设定 F 的 [[Class]] 内部属性为 &quot;Function&quot;。</span></span>
<span class="line"><span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[Class]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;Function&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//设定 F 的 [[Prototype]] 内部属性为 15.3.3.1 指定的标准内置 Function 的 prototype 对象。</span></span>
<span class="line"><span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[Prototype]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//依照 15.3.4.5.1 描述，设定 F 的 [[Call]] 内置属性。</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//依照 15.3.4.5.2 描述，设定 F 的 [[Construct]] 内置属性。</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//依照 15.3.4.5.3 描述，设定 F 的 [[HasInstance]] 内置属性。</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//如果 Target 的 [[Class]] 内部属性是 &quot;Function&quot;, 则</span></span>
<span class="line"><span class="token comment">//令 L 为 Target 的 length 属性减 A 的长度。</span></span>
<span class="line"><span class="token comment">//设定 F 的 length 自身属性为 0 和 L 中更大的值。</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>Target<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[Class]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;Function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token constant">L</span> <span class="token operator">=</span> Target<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token constant">A</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line">    <span class="token constant">F</span><span class="token punctuation">.</span>length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//否则设定 F 的 length 自身属性为 0.</span></span>
<span class="line">    <span class="token constant">F</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//设定 F 的 length 自身属性的特性为 15.3.5.1 指定的值。</span></span>
<span class="line"><span class="token comment">//设定 F 的 [[Extensible]] 内部属性为 true。</span></span>
<span class="line"><span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[Extensible]] </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//令 thrower 为 [[ThrowTypeError]] 函数对象 (13.2.3)。</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token function-variable function">thrower</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//以 &quot;caller&quot;, 属性描述符 {[[Get]]: thrower, [[Set]]: thrower, [[Enumerable]]: false, [[Configurable]]: - false}, 和 false 作为参数调用 F 的 [[DefineOwnProperty]] 内部方法。</span></span>
<span class="line">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">,</span> <span class="token string">&#39;caller&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">get</span><span class="token operator">:</span> thrower<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">set</span><span class="token operator">:</span> thrower<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//以 &quot;arguments&quot;, 属性描述符 {[[Get]]: thrower, [[Set]]: thrower, [[Enumerable]]: false, [[Configurable]]: false}, 和 false 作为参数调用 F 的 [[DefineOwnProperty]] 内部方法。</span></span>
<span class="line">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">,</span> <span class="token string">&#39;arguments&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">get</span><span class="token operator">:</span> thrower<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">set</span><span class="token operator">:</span> thrower<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//bind 方法的 length 属性是 1。</span></span>
<span class="line"><span class="token comment">//Function.prototype.bind 创建的函数对象不包含 prototype 属性或 [[Code]], [[FormalParameters]], [[Scope]] 内部属性</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 当调用一个用 bind 函数创建的函数对象 F 的 [[Call]] 内部方法，传入一个 this 值和一个参数列表 ExtraArgs，采用如下步骤：</span></span>
<span class="line"><span class="token keyword">let</span> boundArgs <span class="token operator">=</span> <span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[BoundArgs]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> boundThis <span class="token operator">=</span> <span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[BoundThis]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token constant">F</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[[TargetFunction]]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//令 args 为一个新列表，它包含与列表 boundArgs 相同顺序相同值，后面跟着与 ExtraArgs 是相同顺序相同值。</span></span>
<span class="line"><span class="token keyword">let</span> ExtraArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>boundArgs<span class="token punctuation">,</span> <span class="token operator">...</span>ExtraArgs<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//提供 boundThis 作为 this 值，提供 args 为参数调用 target 的 [[Call]] 内部方法，返回结果。</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span></span>
<span class="line">    boundThis<span class="token punctuation">,</span></span>
<span class="line">    <span class="token operator">...</span>args</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-call-apply-bind" tabindex="-1"><a class="header-anchor" href="#_7-call-apply-bind"><span>7. call/apply/bind</span></a></h2><ul><li>call/apply/bind可以改变函数中this的指向</li><li>第一个参数是改变this指向(非严格模式下，传递null/undefined指向也是window)</li><li>call参数是依次传递，apply是以数组的方式传递</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">!</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">proto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">var</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> context<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;number&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;boolean&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;null&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">context<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> context<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        context<span class="token punctuation">.</span>_fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">_fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">delete</span> context<span class="token punctuation">.</span>_fn<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        context<span class="token punctuation">.</span>_fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">_fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">delete</span> context<span class="token punctuation">.</span>_fn<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>bindArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token operator">...</span>bindArgs<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    proto<span class="token punctuation">.</span>call <span class="token operator">=</span> call<span class="token punctuation">;</span></span>
<span class="line">    proto<span class="token punctuation">.</span>apply <span class="token operator">=</span> apply<span class="token punctuation">;</span></span>
<span class="line">    proto<span class="token punctuation">.</span>bind <span class="token operator">=</span> bind<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-7-引用规范类型" tabindex="-1"><a class="header-anchor" href="#_8-7-引用规范类型"><span>8.7 引用规范类型</span></a></h3><ul><li>引用类型用来说明 delete，typeof，赋值运算符这些运算符的行为</li><li>例如，在赋值运算中左边的操作数期望产生一个引用</li><li>一个 引用 (Reference) 是个已解决的命名绑定</li><li>一个引用由三部分组成， 基 (base) 值， 引用名称（referenced name） 和布尔值 严格引用 (strict reference) 标志</li><li>基值是 undefined, 一个 Object, 一个 Boolean, 一个 String, 一个 Number, 一个 environment record 中的任意一个</li><li>基值是 undefined 表示此引用可以不解决一个绑定</li><li>引用名称是一个字符串</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> aReference <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">base</span><span class="token operator">:</span> environmentRecords<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">strict</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;zhufeng&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">var</span> getNameReference <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">base</span><span class="token operator">:</span> obj<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;getName&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">strict</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> twoReference <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">base</span><span class="token operator">:</span> environmentRecords<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;two&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">strict</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>本规范中使用以下抽象操作访问引用的组件</li></ul><table><thead><tr><th style="text-align:left;">方法</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">GetBase(V)</td><td style="text-align:left;">返回引用值 V 的基值组件</td></tr><tr><td style="text-align:left;">GetReferencedName(V)</td><td style="text-align:left;">返回引用值 V 的引用名称组件</td></tr><tr><td style="text-align:left;">IsStrictReference(V)</td><td style="text-align:left;">返回引用值 V 的严格引用组件</td></tr><tr><td style="text-align:left;">HasPrimitiveBase(V)</td><td style="text-align:left;">如果基值是 Boolean, String, Number，那么返回 true</td></tr><tr><td style="text-align:left;">IsPropertyReference(V)</td><td style="text-align:left;">如果基值是个对象或 HasPrimitiveBase(V) 是 true，那么返回 true；否则返回 false</td></tr><tr><td style="text-align:left;">IsUnresolvableReference(V)</td><td style="text-align:left;">如果基值是 undefined 那么返回 true，否则返回 false</td></tr></tbody></table><h4 id="_8-7-1-getvalue-v" tabindex="-1"><a class="header-anchor" href="#_8-7-1-getvalue-v"><span>8.7.1 GetValue(v)</span></a></h4><ul><li>如果 Type(V) 不是引用 , 返回 V。</li><li>令 base 为调用 GetBase(V) 的返回值。</li><li>如果 IsUnresolvableReference(V), 抛出一个 ReferenceError 异常。</li><li>如果 IsPropertyReference(V), 那么 <ul><li>如果 HasPrimitiveBase(V) 是 false, 那么令 get 为 base 的 [[Get]] 内部方法 , 否则令 get 为下面定义的特殊的 [[Get]] 内部方法。</li><li>将 base 作为 this 值，传递 GetReferencedName(V) 为参数，调用 get 内部方法，返回结果。</li></ul></li><li>否则 , base 必须是一个 environment record。</li><li>传递 GetReferencedName(V) 和 IsStrictReference(V) 为参数调用 base 的 GetBindingValue( 见 10.2.1) 具体方法，返回结果。</li><li>GetValue 中的 V 是原始基值的 属性引用 时使用下面的 [[Get]] 内部方法。它用 base 作为他的 this 值，其中属性 P 是它的参数。采用以下步骤： -令 O 为 ToObject(base)。 -令 desc 为用属性名 P 调用 O 的 [[GetProperty]] 内部方法的返回值。 -如果 desc 是 undefined，返回 undefined。 -如果 IsDataDescriptor(desc) 是 true，返回 desc.[[Value]]。 -否则 IsAccessorDescriptor(desc) 必须是 true，令 getter 为 desc.[[Get]]。 -如果 getter 是 undefined，返回 undefined。 -提供 base 作为 this 值，无参数形式调用 getter 的 [[Call]] 内部方法，返回结果。</li></ul><h4 id="_8-7-2-putvalue-v-w" tabindex="-1"><a class="header-anchor" href="#_8-7-2-putvalue-v-w"><span>8.7.2 PutValue(v,w)</span></a></h4><ul><li><p>如果 Type(V) 不是引用，抛出一个 ReferenceError 异常。</p></li><li><p>令 base 为调用 GetBase(V) 的结果。</p></li><li><p>如果 IsUnresolvableReference(V)，那么</p><ul><li>如果 IsStrictReference(V) 是 true，那么抛出 ReferenceError 异常。</li><li>用 GetReferencedName(V)，W，false 作为参数调用全局对象的 [[Put]] 内部方法。</li></ul></li><li><p>否则如果 IsPropertyReference(V)，那么</p><ul><li>如果 HasPrimitiveBase(V) 是 false，那么令 put 为 base 的 [[Put]] 内部方法，否则令 put 为下面定义的特殊的 [[Put]] 内部方法。</li><li>用 base 作为 this 值，用 GetReferencedName(V)，W，IsStrictReference(V) 作为参数调用 put 内部方法。</li></ul></li><li><p>否则 base 必定是 environment record 作为 base 的引用。所以， 用 GetReferencedName(V), W, IsStrictReference(V) 作为参数调用 base 的 SetMutableBinding (10.2.1) 具体方法。 返回。</p></li><li><p>PutValue 中的 V 是原始基值的属性引用时使用下面的 [[Put]] 内部方法。用 base 作为 this 值，用属性 P，值 W，布尔标志 Throw 作为参数调用它。采用以下步骤：</p></li><li><p>令 O 为 ToObject(base)。</p></li><li><p>如果用 P 作为参数调用 O 的 [[CanPut]] 内部方法的结果是 false，那么</p><ul><li>如果 Throw 是 true，那么抛出一个 TypeError 异常。</li><li>否则返回。</li></ul></li><li><p>令 ownDesc 为用 P 作为参数调用 O 的 [[GetOwnProperty]] 内部方法的结果。</p></li><li><p>如果 IsDataDescriptor(ownDesc) 是 true，那么</p><ul><li>如果 Throw 是 true，那么抛出一个 TypeError 异常。</li><li>否则返回。</li></ul></li><li><p>令 desc 为用 P 作为参数调用 O 的 [[GetProperty]] 内部方法的结果。这可能是一个自身或继承的访问器属性描述或是一个继承的数据属性描述。</p></li><li><p>如果 IsAccessorDescriptor(desc) 是 true，那么</p><ul><li>令 setter 为 desc.Set，他不能是 undefined。</li><li>用 base 作为 this 值，用只由 W 组成的列表作为参数调用 setter 的 [[Call]] 内部方法。</li></ul></li><li><p>否则，这是要在临时对象 O 上创建自身属性的请求。</p><ul><li>如果 Throw 是 true，抛出一个 TypeError 异常。</li></ul></li><li><p>返回。</p></li></ul><h4 id="_8-10-1-isaccessordescriptor-desc" tabindex="-1"><a class="header-anchor" href="#_8-10-1-isaccessordescriptor-desc"><span>8.10.1 IsAccessorDescriptor (Desc)</span></a></h4><ul><li>当用属性描述 Desc 调用抽象操作 IsAccessorDescriptor，采用以下步骤： <ul><li>如果 Desc 是 undefined，那么返回 false</li><li>如果 Desc.[[Get]] 和 Desc.[[Set]] 都不存在，则返回 false</li><li>返回 true</li></ul></li></ul><h4 id="_8-10-2-isdatadescriptor-desc" tabindex="-1"><a class="header-anchor" href="#_8-10-2-isdatadescriptor-desc"><span>8.10.2 IsDataDescriptor (Desc)</span></a></h4><ul><li>当用属性描述 Desc 调用抽象操作 IsDataDescriptor，采用以下步骤： <ul><li>如果 Desc 是 undefined，那么返回 false。</li><li>如果 Desc.[[Value]] 和 Desc.[[Writable]] 都不存在，则返回 false。</li><li>返回 true</li></ul></li></ul><h4 id="_8-12-3-get-p" tabindex="-1"><a class="header-anchor" href="#_8-12-3-get-p"><span>8.12.3 [[Get]] (P)</span></a></h4><p>当用属性名 P 调用 O 的 [[Get]] 内部方法，采用以下步骤：</p><ul><li>令 desc 为用属性名 P 调用 O 的 [[GetProperty]] 内部方法的结果。</li><li>如果 desc 是 undefined，返回 undefined。</li><li>如果 IsDataDescriptor(desc) 是 true，返回 desc.[[Value]]。</li><li>否则，IsAccessorDescriptor(desc) 必定是真，所以，令 getter 为 desc.[[Get]]。</li><li>如果 getter 是 undefined，返回 undefined。</li><li>用 O 作为 this，无参数调用 getter 的 [[Call]] 内部方法，返回结果。</li></ul><h3 id="_9-9-toobject" tabindex="-1"><a class="header-anchor" href="#_9-9-toobject"><span>9.9 ToObject</span></a></h3><ul><li>ToObject 运算符根据下表将其参数转换为对象类型的值：</li></ul><table><thead><tr><th style="text-align:left;">输入类型</th><th style="text-align:left;">结果</th></tr></thead><tbody><tr><td style="text-align:left;">Undefined</td><td style="text-align:left;">抛出 TypeError 异常。</td></tr><tr><td style="text-align:left;">Null</td><td style="text-align:left;">抛出 TypeError 异常。</td></tr><tr><td style="text-align:left;">Boolean</td><td style="text-align:left;">创建一个新的Boolean对象，其 [[PrimitiveValue]]属性被设为该布尔值的值。</td></tr><tr><td style="text-align:left;">Number</td><td style="text-align:left;">创建一个新的Number对象，其[[PrimitiveValue]]属性被设为该数字值。</td></tr><tr><td style="text-align:left;">String</td><td style="text-align:left;">创建一个新的String对象，其 [[PrimitiveValue]] 属性被设为该字符串值。</td></tr><tr><td style="text-align:left;">Object</td><td style="text-align:left;">结果是输入的参数（不转换）。</td></tr></tbody></table><h4 id="_10-3-1-标识符解析" tabindex="-1"><a class="header-anchor" href="#_10-3-1-标识符解析"><span>10.3.1 标识符解析</span></a></h4><ul><li>标识符解析是指使用正在运行的执行环境中的词法环境，通过一个 标识符 获得其对应的绑定的过程。在 ECMA 脚本代码执行过程中，PrimaryExpression : Identifier 这一语法产生式将按以下算法进行解释执行： -令 env 为正在运行的执行环境的 词法环境 。 -如果正在解释执行的语法产生式处在 严格模式下的代码 中，则仅 strict 的值为 true，否则令 strict 的值为 false。 -以 env，Identifier 和 strict 为参数，调用 GetIdentifierReference 函数，并返回调用的结果。 <ul><li>解释执行一个标识符得到的结果必定是 引用 类型的对象，且其引用名属性的值与 Identifier 字符串相等。</li></ul></li></ul><h4 id="_11-1-6-分组表达式" tabindex="-1"><a class="header-anchor" href="#_11-1-6-分组表达式"><span>11.1.6 分组表达式</span></a></h4><ul><li>产生式 PrimaryExpression : ( Expression ) 按照下面的过程执行 :</li><li>返回执行Expression的结果，它可能是Reference类型。 <blockquote><p>这一算法并不会作用GetValue于执行Expression的结果。这样做的原则是确保delete和typeof这样的运算符可以作用于括号括起来的表达式。</p></blockquote></li></ul><h4 id="_11-13-1-简单赋值" tabindex="-1"><a class="header-anchor" href="#_11-13-1-简单赋值"><span>11.13.1 简单赋值</span></a></h4><ul><li>产生式 AssignmentExpression : LeftHandSideExpression = AssignmentExpression 按照下面的过程执行 :</li><li>令 lref 为解释执行 LeftH 和 SideExpression 的结果 .</li><li>令 rref 为解释执行 AssignmentExpression 的结果 .</li><li>令 rval 为 GetValue(rref).</li><li>抛出一个 SyntaxError 异常，当以下条件都成立 : <ul><li>Type(lref) 为 Reference</li><li>IsStrictReference(lref) 为 true</li><li>Type(GetBase(lref)) 为环境记录项</li><li>GetReferencedName(lref) 为 &quot;eval&quot; 或 &quot;arguments&quot;</li></ul></li><li>调用 PutValue(lref, rval).</li><li>返回 rval.</li></ul><h4 id="_11-2-3-函数调用" tabindex="-1"><a class="header-anchor" href="#_11-2-3-函数调用"><span>11.2.3 函数调用</span></a></h4><ul><li>产生式 CallExpression : MemberExpression Arguments 按照下面的过程执行 : <ul><li>令 ref 为解释执行 MemberExpression 的结果 .</li><li>令 func 为 GetValue(ref).</li><li>令 argList 为解释执行 Arguments 的结果 , 产生参数值们的内部列表 (see 11.2.4).</li><li>如果 Type(func) is not Object ，抛出一个 TypeError 异常 .</li><li>如果 IsCallable(func) is false ，抛出一个 TypeError 异常 .</li><li>如果 Type(ref) 为 Reference，那么 如果 IsPropertyReference(ref) 为 true，那么 令 thisValue 为 GetBase - (ref). 否则 , ref 的基值是一个环境记录项 令 thisValue 为调用 GetBase(ref) 的 ImplicitThisValue 具体方法的结 - 果</li><li>否则 , 假如 Type(ref) 不是 Reference. 令 thisValue 为 undefined.</li><li>返回调用 func 的 [[Call]] 内置方法的结果 , 传入 thisValue 作为 this 值和列表 argList 作为参数列表</li></ul></li><li>产生式 CallExpression : CallExpression Arguments以完全相同的方式执行，除了第1步执行的是其中的CallExpression。</li></ul><h4 id="_11-4-3-typeof-运算符" tabindex="-1"><a class="header-anchor" href="#_11-4-3-typeof-运算符"><span>11.4.3 typeof 运算符</span></a></h4><ul><li>返回根据表 20 由 Type(val) 决定的字符串。</li></ul><table><thead><tr><th style="text-align:left;">val类型</th><th style="text-align:left;">结果</th></tr></thead><tbody><tr><td style="text-align:left;">Undefined</td><td style="text-align:left;">&quot;undefined&quot;</td></tr><tr><td style="text-align:left;">Null</td><td style="text-align:left;">&quot;null&quot;</td></tr><tr><td style="text-align:left;">Boolean</td><td style="text-align:left;">&quot;boolean&quot;</td></tr><tr><td style="text-align:left;">Number</td><td style="text-align:left;">&quot;number&quot;</td></tr><tr><td style="text-align:left;">String</td><td style="text-align:left;">&quot;string&quot;</td></tr><tr><td style="text-align:left;">Object（原生，且没有实现 [[call]]）</td><td style="text-align:left;">&quot;object&quot;</td></tr><tr><td style="text-align:left;">Object（原生或者宿主且实现了 [[call]]</td><td style="text-align:left;">&quot;function&quot;</td></tr><tr><td style="text-align:left;">Object（宿主且没实现 [[call]]）</td><td style="text-align:left;">由实现定义，但不能是 &quot;undefined&quot;, &quot;boolean&quot;, &quot;number&quot;, or &quot;string&quot;</td></tr></tbody></table><h3 id="_11-11-二元逻辑运算符" tabindex="-1"><a class="header-anchor" href="#_11-11-二元逻辑运算符"><span>11.11 二元逻辑运算符</span></a></h3><ul><li>产生式 LogicalANDExpression : LogicalANDExpression &amp;&amp; BitwiseORExpression 按照下面的过程执行 : <ul><li>令 lref 为解释执行 LogicalANDExpression 的结果 .</li><li>令 lval 为 GetValue(lref).</li><li>如果 ToBoolean(lval) 为 false ，返回 lval.</li><li>令 rref 为解释执行 BitwiseORExpression 的结果 .</li><li>返回 GetValue(rref).</li></ul></li></ul><h3 id="_11-14-逗号运算符" tabindex="-1"><a class="header-anchor" href="#_11-14-逗号运算符"><span>11.14 逗号运算符</span></a></h3><ul><li>产生式 Expression : Expression , AssignmentExpression 按照下面的过程执行 : <ul><li>令 lref 为解释执行 Expression 的结果</li><li>Call GetValue(lref).</li><li>令 rref 为解释执行 AssignmentExpression 的结果 .</li><li>返回 GetValue(rref).</li></ul></li></ul><h4 id="_13-2-1-call" tabindex="-1"><a class="header-anchor" href="#_13-2-1-call"><span>13.2.1 [[call]]</span></a></h4><ul><li>当用一个 this 值，一个参数列表调用函数对象 F 的 [[Call]] 内部方法，采用以下步骤：</li><li>用 F 的 [[FormalParameters]] 内部属性值，参数列表 args，10.4.3 描述的 this 值来建立 函数代码 的一个新执行环- 境，令 funcCtx 为其结果。</li><li>令 result 为 FunctionBody（也就是 F 的 [[Code]] 内部属性）解释执行的结果。如果 F 没有 [[Code]] 内部属性或其- 值是空的 FunctionBody，则 result 是 (normal, undefined, empty)。</li><li>退出 funcCtx 执行环境，恢复到之前的执行环境。</li><li>如果 result.type 是 throw 则抛出 result.value。</li><li>如果 result.type 是 return 则返回 result.value。</li><li>否则 result.type 必定是 normal。返回 undefined。</li></ul><h5 id="_15-3-4-3-function-prototype-apply-thisarg-argarray" tabindex="-1"><a class="header-anchor" href="#_15-3-4-3-function-prototype-apply-thisarg-argarray"><span>15.3.4.3 Function.prototype.apply (thisArg, argArray)</span></a></h5><ul><li>当以 thisArg 和 argArray 为参数在一个 func 对象上调用 apply 方法，采用如下步骤：</li><li>如果 IsCallable(func) 是 false, 则抛出一个 TypeError 异常 .</li><li>如果 argArray 是 null 或 undefined, 则 <ul><li>返回提供 thisArg 作为 this 值并以空参数列表调用 func 的 [[Call]] 内部方法的结果。</li></ul></li><li>如果 Type(argArray) 不是 Object, 则抛出一个 TypeError 异常 .</li><li>令 len 为以 &quot;length&quot; 作为参数调用 argArray 的 [[Get]] 内部方法的结果。</li><li>令 n 为 ToUint32(len).</li><li>令 argList 为一个空列表 .</li><li>令 index 为 0.</li><li>只要 index &lt; n 就重复 <ul><li>令 indexName 为 ToString(index).</li><li>令 nextArg 为以 indexName 作为参数调用 argArray 的 [[Get]] 内部方法的结果。</li><li>将 nextArg 作为最后一个元素插入到 argList 里。</li><li>设定 index 为 index + 1.</li></ul></li><li>提供 thisArg 作为 this 值并以 argList 作为参数列表，调用 func 的 [[Call]] 内部方法，返回结果。</li><li>apply 方法的 length 属性是 2。</li></ul><blockquote><p>在外面传入的 thisArg 值会修改并成为 this 值。thisArg 是 undefined 或 null 时它会被替换成全局对象，所有其他值会被应用 ToObject 并将结果作为 this 值，这是第三版引入的更改。</p></blockquote><h5 id="_15-3-4-4-function-prototype-call-thisarg-arg1-arg2" tabindex="-1"><a class="header-anchor" href="#_15-3-4-4-function-prototype-call-thisarg-arg1-arg2"><span>15.3.4.4 Function.prototype.call (thisArg [ , arg1 [ , arg2, … ] ] )</span></a></h5><ul><li>当以 thisArg 和可选的 arg1, arg2 等等作为参数在一个 func 对象上调用 call 方法，采用如下步骤：</li><li>如果 IsCallable(func) 是 false, 则抛出一个 TypeError 异常。</li><li>令 argList 为一个空列表。</li><li>如果调用这个方法的参数多余一个，则从 arg1 开始以从左到右的顺序将每个参数插入为 argList 的最后一个元素。</li><li>提供 thisArg 作为 this 值并以 argList 作为参数列表，调用 func 的 [[Call]] 内部方法，返回结果。</li><li>call 方法的 length 属性是 1。 <blockquote><p>在外面传入的 thisArg 值会修改并成为 this 值。thisArg 是 undefined 或 null 时它会被替换成全局对象，所有其他值会被应用 ToObject 并将结果作为 this 值，这是第三版引入的更改。</p></blockquote></li></ul><h5 id="_15-3-4-5-function-prototype-bind-thisarg-arg1-arg2" tabindex="-1"><a class="header-anchor" href="#_15-3-4-5-function-prototype-bind-thisarg-arg1-arg2"><span>15.3.4.5 Function.prototype.bind (thisArg [, arg1 [, arg2, …]])</span></a></h5><ul><li>bind 方法需要一个或更多参数，thisArg 和（可选的）arg1, arg2, 等等，执行如下步骤返回一个新函数对象：</li><li>令 Target 为 this 值 .</li><li>如果 IsCallable(Target) 是 false, 抛出一个 TypeError 异常 .</li><li>令 A 为一个（可能为空的）新内部列表，它包含按顺序的 thisArg 后面的所有参数（arg1, arg2 等等）。</li><li>令 F 为一个新原生 ECMAScript 对象。</li><li>依照 8.12 指定，设定 F 的除了 [[Get]] 之外的所有内部方法。</li><li>依照 15.3.5.4 指定，设定 F 的 [[Get]] 内部属性。</li><li>设定 F 的 [[TargetFunction]] 内部属性为 Target。</li><li>设定 F 的 [[BoundThis]] 内部属性为 thisArg 的值。</li><li>设定 F 的 [[BoundArgs]] 内部属性为 A。</li><li>设定 F 的 [[Class]] 内部属性为 &quot;Function&quot;。</li><li>设定 F 的 [[Prototype]] 内部属性为 15.3.3.1 指定的标准内置 Function 的 prototype 对象。</li><li>依照 15.3.4.5.1 描述，设定 F 的 [[Call]] 内置属性。</li><li>依照 15.3.4.5.2 描述，设定 F 的 [[Construct]] 内置属性。</li><li>依照 15.3.4.5.3 描述，设定 F 的 [[HasInstance]] 内置属性。</li><li>如果 Target 的 [[Class]] 内部属性是 &quot;Function&quot;, 则 <ul><li>令 L 为 Target 的 length 属性减 A 的长度。</li><li>设定 F 的 length 自身属性为 0 和 L 中更大的值。</li></ul></li><li>否则设定 F 的 length 自身属性为 0.</li><li>设定 F 的 length 自身属性的特性为 15.3.5.1 指定的值。</li><li>设定 F 的 [[Extensible]] 内部属性为 true。</li><li>令 thrower 为 [[ThrowTypeError]] 函数对象 (13.2.3)。</li><li>以 &quot;caller&quot;, 属性描述符 {[[Get]]: thrower, [[Set]]: thrower, [[Enumerable]]: false, [[Configurable]]: - false}, 和 false 作为参数调用 F 的 [[DefineOwnProperty]] 内部方法。</li><li>以 &quot;arguments&quot;, 属性描述符 {[[Get]]: thrower, [[Set]]: thrower, [[Enumerable]]: false, [[Configurable]]: false}, 和 false 作为参数调用 F 的 [[DefineOwnProperty]] 内部方法。</li><li>返回 F.</li><li>bind 方法的 length 属性是 1。</li></ul><blockquote><p>Function.prototype.bind 创建的函数对象不包含 prototype 属性或 [[Code]], [[FormalParameters]], [[Scope]] 内部属性</p></blockquote><h6 id="_15-3-4-5-1-call" tabindex="-1"><a class="header-anchor" href="#_15-3-4-5-1-call"><span>15.3.4.5.1 [[Call]]</span></a></h6><ul><li>当调用一个用 bind 函数创建的函数对象 F 的 [[Call]] 内部方法，传入一个 this 值和一个参数列表 ExtraArgs，采用如下步骤：</li><li>令 boundArgs 为 F 的 [[BoundArgs]] 内部属性值。</li><li>令 boundThis 为 F 的 [[BoundThis]] 内部属性值。</li><li>令 target 为 F 的 [[TargetFunction]] 内部属性值。</li><li>令 args 为一个新列表，它包含与列表 boundArgs 相同顺序相同值，后面跟着与 ExtraArgs 是相同顺序相同值。</li><li>提供 boundThis 作为 this 值，提供 args 为参数调用 target 的 [[Call]] 内部方法，返回结果。</li></ul><h2 id="_3-面试题" tabindex="-1"><a class="header-anchor" href="#_3-面试题"><span>3.面试题</span></a></h2><h3 id="_3-1-第1题" tabindex="-1"><a class="header-anchor" href="#_3-1-第1题"><span>3.1 第1题</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;window&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> objGetName <span class="token operator">=</span> obj<span class="token punctuation">.</span>getName<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">objGetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span></span>
<span class="line">    obj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hello</span></span>
<span class="line">    <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>getName<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hello</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>getName<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-第2题" tabindex="-1"><a class="header-anchor" href="#_3-2-第2题"><span>3.2 第2题</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&#39;window&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;obj&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">getName1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">getName2</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">getName3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">getName4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;obj2&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//obj</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//obj2</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName2</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName3</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//obj2</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//obj</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName4</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//obj2</span></span>
<span class="line">obj<span class="token punctuation">.</span><span class="token function">getName4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//obj</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://vgqw56.yuque.com/books/share/23034e94-fcc2-431f-9214-1c96df47c0fa" target="_blank" rel="noopener noreferrer">qfct</a></p>`,74)])])}const i=s(e,[["render",l]]),u=JSON.parse('{"path":"/strong/148.2.basic.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/148.2.basic.md"}');export{i as comp,u as data};
