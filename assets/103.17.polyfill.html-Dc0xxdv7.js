import{_ as n,c as a,a as e,o as l}from"./app-CD1YpnS1.js";const p={};function i(t,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-babel-polyfill" tabindex="-1"><a class="header-anchor" href="#_1-babel-polyfill"><span>1. babel-polyfill</span></a></h2><ul><li><code>Babel</code>默认只转换新的<code>Javascript</code>语法，而不转换新的API，比如 <ul><li>Iterator, Generator, Set, Maps, Proxy, Reflect,Symbol,Promise 等全局对象</li><li>在全局对象上的方法,比如说ES6在Array对象上新增了<code>Array.find</code>方法，Babel就不会转码这个方法</li></ul></li><li>如果想让这个方法运行，必须使用 <code>babel-polyfill</code>来转换等</li><li>Babel 7.4之后不再推荐使用@babel/polyfill</li><li>babel v7 推荐使用@babel/preset-env代替以往的诸多polyfill方案</li><li><a href="https://babeljs.io/docs/en/babel-preset-env" target="_blank" rel="noopener noreferrer">babel-preset-env</a></li><li><a href="https://babeljs.io/docs/en/babel-polyfill" target="_blank" rel="noopener noreferrer">babel-polyfill</a></li><li><a href="https://babeljs.io/docs/en/babel-runtime" target="_blank" rel="noopener noreferrer">babel-runtime</a></li><li><a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime" target="_blank" rel="noopener noreferrer">babel-plugin-transform-runtime</a></li></ul><h3 id="_1-1-安装" tabindex="-1"><a class="header-anchor" href="#_1-1-安装"><span>1.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm i @babel/polyfill</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-2-targets" tabindex="-1"><a class="header-anchor" href="#_1-2-targets"><span>1.2 targets</span></a></h3><ul><li>配置参数<code>targets</code>表示我们需要支持哪些平台和哪些版本</li><li><a href="https://www.npmjs.com/package/browserslist" target="_blank" rel="noopener noreferrer">browserslist</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//&quot;browsers&quot;: [&quot;ie &gt;= 8&quot;, &quot;chrome &gt;= 62&quot;],// 推荐使用 .browserslist</span></span>
<span class="line">                <span class="token string-property property">&quot;browsers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&gt;1%&quot;</span><span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-usebuiltins-false" tabindex="-1"><a class="header-anchor" href="#_1-3-usebuiltins-false"><span>1.3 useBuiltIns: false</span></a></h3><ul><li><code>babel-polyfill</code> 它是通过向全局对象和内置对象的<code>prototype</code>上添加方法来实现的。比如运行环境中不支持<code>Array.prototype.find</code>方法，引入<code>polyfill</code>, 我们就可以使用<code>ES6</code>方法来编写了，但是缺点就是会造成全局空间污染</li><li><a href="https://www.npmjs.com/package/@babel/preset-env" target="_blank" rel="noopener noreferrer">@babel/preset-env</a>为每一个环境的预设</li><li><code>@babel/preset-env</code>默认只支持语法转化，需要开启<code>useBuiltIns</code>配置才能转化API和实例方法</li><li><code>useBuiltIns</code>可选值包括：&quot;usage&quot; | &quot;entry&quot; | false, 默认为 false，表示不对<code>polyfills</code> 处理，这个配置是引入 polyfills 的关键</li><li><code>useBuiltIns: false</code> 此时不对 <code>polyfill</code> 做操作。如果引入 <code>@babel/polyfill</code>，则无视配置的浏览器兼容，引入所有的 <code>polyfill</code></li></ul><h4 id="_1-3-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_1-3-1-src-index-js"><span>1.3.1 src/index.js</span></a></h4><p>src/index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token string">&#39;@babel/polyfill&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-2-webpack-config-js" tabindex="-1"><a class="header-anchor" href="#_1-3-2-webpack-config-js"><span>1.3.2 webpack.config.js</span></a></h4><p>webpack.config.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const path = require(&#39;path&#39;);</span>
<span class="line">module.exports = {</span>
<span class="line">    mode: &#39;development&#39;,</span>
<span class="line">    devtool: false,</span>
<span class="line">    entry: &#39;./src/index.js&#39;,</span>
<span class="line">    output: {</span>
<span class="line">        path: path.resolve(__dirname, &#39;dist&#39;),</span>
<span class="line">        filename: &#39;main.js&#39;</span>
<span class="line">    },</span>
<span class="line">    module: {</span>
<span class="line">        rules: [</span>
<span class="line">            {</span>
<span class="line">                test: /\\.js?$/,</span>
<span class="line">                exclude: /node_modules/,</span>
<span class="line">                use: {</span>
<span class="line">                    loader: &#39;babel-loader&#39;,</span>
<span class="line">                    options: {</span>
<span class="line">                        sourceType: &quot;unambiguous&quot;,</span>
<span class="line">+                       presets: [[&quot;@babel/preset-env&quot;, { useBuiltIns: false }]]</span>
<span class="line">                    }</span>
<span class="line">                }</span>
<span class="line">            }</span>
<span class="line">        ]</span>
<span class="line">    },</span>
<span class="line">    plugins: []</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-usebuiltins-entry" tabindex="-1"><a class="header-anchor" href="#_1-4-usebuiltins-entry"><span>1.4 useBuiltIns: &quot;entry&quot;</span></a></h3><ul><li>在项目入口引入一次（多次引入会报错）</li><li>&quot;useBuiltIns&quot;: &quot;entry&quot; 根据配置的浏览器兼容，引入浏览器不兼容的 polyfill。需要在入口文件手动添加 <code>import &#39;@babel/polyfill&#39;</code>，会自动根据 browserslist 替换成浏览器不兼容的所有 polyfill</li><li>这里需要指定 core-js 的版本,<code>corejs</code>默认是2,</li><li>如果配置 <code>corejs: 3</code>, 则<code>import &#39;@babel/polyfill&#39;</code> 需要改成 <code>import &#39;core-js/stable&#39;;import &#39;regenerator-runtime/runtime&#39;;</code></li><li><ul><li><code>corejs</code>默认是2</li></ul></li><li>50.8 KiB</li></ul><h4 id="_1-4-1-安装" tabindex="-1"><a class="header-anchor" href="#_1-4-1-安装"><span>1.4.1 安装</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> npm install <span class="token operator">--</span>save core<span class="token operator">-</span>js@<span class="token number">2</span>    npm install <span class="token operator">--</span>save core<span class="token operator">-</span>js@<span class="token number">3</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_1-4-2-src-index-js" tabindex="-1"><a class="header-anchor" href="#_1-4-2-src-index-js"><span>1.4.2 src\\index.js</span></a></h4><p>src\\index.js core-js@2</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token string">&#39;@babel/polyfill&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>core-js@3</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token string">&#39;core-js/stable&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&#39;regenerator-runtime/runtime&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-3-webpack-config-js" tabindex="-1"><a class="header-anchor" href="#_1-4-3-webpack-config-js"><span>1.4.3 webpack.config.js</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  test: /\\.js?$/,</span>
<span class="line">  exclude: /node_modules/,</span>
<span class="line">  use: {</span>
<span class="line">      loader: &#39;babel-loader&#39;,</span>
<span class="line">      options: {</span>
<span class="line">+         presets: [[&quot;@babel/preset-env&quot;, { useBuiltIns: &#39;entry&#39;, corejs: { version: 3 } }]]</span>
<span class="line">      }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">WARNING (@babel/preset-env): We noticed you&#39;re using the \`useBuiltIns\` option without declaring a core-js version. Currently, we assume version 2.x when no version is passed. Since this default version will likely change in future versions of Babel, we recommend explicitly setting the core-js version you are using via the \`corejs\` option.</span>
<span class="line">You should also be sure that the version you pass to the \`corejs\` option matches the version specified in your \`package.json\`&#39;s \`dependencies\` section. If it doesn&#39;t, you need to run one of the following commands:</span>
<span class="line"></span>
<span class="line">npm install --save core-js@2    npm install --save core-js@3</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-usebuiltins-usage" tabindex="-1"><a class="header-anchor" href="#_1-5-usebuiltins-usage"><span>1.5 &quot;useBuiltIns&quot;: &quot;usage&quot;</span></a></h3><ul><li>&quot;useBuiltIns&quot;: &quot;usage&quot; <code>usage</code> 会根据配置的浏览器兼容，以及你代码中用到的 API 来进行 polyfill，实现了按需添加</li><li>当设置为usage时，polyfill会自动按需添加，不再需要手工引入<code>@babel/polyfill</code></li></ul><h4 id="_1-5-1-src-index-js" tabindex="-1"><a class="header-anchor" href="#_1-5-1-src-index-js"><span>1.5.1 src/index.js</span></a></h4><p>src/index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>find<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&#39;find&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-5-2-webpack-config-js" tabindex="-1"><a class="header-anchor" href="#_1-5-2-webpack-config-js"><span>1.5.2 webpack.config.js</span></a></h4><p>webpack.config.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  test: /\\.js?$/,</span>
<span class="line">  exclude: /node_modules/,</span>
<span class="line">  use: {</span>
<span class="line">      loader: &#39;babel-loader&#39;,</span>
<span class="line">      options: {</span>
<span class="line">+         presets: [[&quot;@babel/preset-env&quot;, { useBuiltIns: &#39;usage&#39;, corejs: { version: 3 } }]]</span>
<span class="line">      }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-babel-runtime" tabindex="-1"><a class="header-anchor" href="#_2-babel-runtime"><span>2. babel-runtime</span></a></h2><ul><li>Babel为了解决全局空间污染的问题，提供了单独的包<a href="https://babeljs.io/docs/en/babel-runtime" target="_blank" rel="noopener noreferrer">babel-runtime</a>用以提供编译模块的工具函数</li><li>简单说 <code>babel-runtime</code> 更像是一种按需加载的实现，比如你哪里需要使用 <code>Promise</code>，只要在这个文件头部<code>import Promise from &#39;babel-runtime/core-js/promise&#39;</code>就行了</li></ul><h3 id="_2-1-安装" tabindex="-1"><a class="header-anchor" href="#_2-1-安装"><span>2.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm i babel-runtime --save-dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-2-src-index-js" tabindex="-1"><a class="header-anchor" href="#_2-2-src-index-js"><span>2.2 src/index.js</span></a></h3><p>src/index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> Promise <span class="token keyword">from</span> <span class="token string">&#39;babel-runtime/core-js/promise&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-babel-plugin-transform-runtime" tabindex="-1"><a class="header-anchor" href="#_3-babel-plugin-transform-runtime"><span>3. babel-plugin-transform-runtime</span></a></h2><ul><li><p><code>@babel/plugin-transform-runtime</code>插件是为了解决</p><ul><li>多个文件重复引用 相同helpers(帮助函数)=&gt;提取运行时</li><li>新API方法全局污染 -&gt; 局部引入</li></ul></li><li><p>启用插件<code>babel-plugin-transform-runtime</code>后，Babel就会使用<code>babel-runtime</code>下的工具函数</p></li><li><p><code>babel-plugin-transform-runtime</code>插件能够将这些工具函数的代码转换成<code>require</code>语句，指向为对<code>babel-runtime</code>的引用</p></li><li><p><code>babel-plugin-transform-runtime</code> 就是可以在我们使用新 API 时自动 import <code>babel-runtime</code> 里面的 <code>polyfill</code></p><ul><li>当我们使用 <code>async/await</code> 时，自动引入 <code>babel-runtime/regenerator</code></li><li>当我们使用 ES6 的静态事件或内置对象时，自动引入 <code>babel-runtime/core-js</code></li><li>移除内联<code>babel helpers</code>并替换使用<code>babel-runtime/helpers</code> 来替换</li></ul></li></ul><h3 id="_3-1-安装" tabindex="-1"><a class="header-anchor" href="#_3-1-安装"><span>3.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm i @babel/plugin-transform-runtime @babel/runtime-corejs3 --save-dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-2-webpack-config-js" tabindex="-1"><a class="header-anchor" href="#_3-2-webpack-config-js"><span>3.2 webpack.config.js</span></a></h3><p>webpack.config.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">    test: /\\.js?$/,</span>
<span class="line">    exclude: /node_modules/,</span>
<span class="line">    use: {</span>
<span class="line">        loader: &#39;babel-loader&#39;,</span>
<span class="line">        options: {</span>
<span class="line">            sourceType: &quot;unambiguous&quot;,</span>
<span class="line">            presets: [[&quot;@babel/preset-env&quot;, { useBuiltIns: &#39;usage&#39;, corejs: { version: 3 } }]],</span>
<span class="line">            plugins: [</span>
<span class="line">                [</span>
<span class="line">                    &quot;@babel/plugin-transform-runtime&quot;,</span>
<span class="line">                    {</span>
<span class="line">                        corejs: 3,</span>
<span class="line">                        helpers: true,</span>
<span class="line">                        regenerator: true</span>
<span class="line">                    }</span>
<span class="line">                ],</span>
<span class="line">            ]</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"> }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-corejs-3" tabindex="-1"><a class="header-anchor" href="#_3-3-corejs-3"><span>3.3 corejs: 3</span></a></h3><ul><li>当我们使用 ES6 的静态事件或内置对象时自动引入 babel-runtime/core-js<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//var _Promise = __webpack_require__(&quot;./node_modules/@babel/runtime-corejs3/core-js-stable/promise.js&quot;);</span></span>
<span class="line"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_3-4-helpers-true" tabindex="-1"><a class="header-anchor" href="#_3-4-helpers-true"><span>3.4 helpers: true</span></a></h3><ul><li>移除内联babel helpers并替换使用<code>babel-runtime/helpers</code> 来替换</li><li>避免内联的 helper 代码在多个文件重复出现</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-regenerator-true" tabindex="-1"><a class="header-anchor" href="#_3-5-regenerator-true"><span>3.5 regenerator: true</span></a></h3><ul><li>是否开启<code>generator</code>函数转换成使用<code>regenerator runtime</code>来避免污染全局域</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//var _regeneratorRuntime = __webpack_require__(/*! @babel/runtime-corejs3/regenerator */ &quot;./node_modules/@babel/runtime-corejs3/regenerator/index.js&quot;);</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-最佳实践" tabindex="-1"><a class="header-anchor" href="#_4-最佳实践"><span>4. 最佳实践</span></a></h2><ul><li>@babel/preset-env和plugin-transform-runtime二者都可以设置使用corejs来处理polyfill</li></ul><h3 id="_4-1-项目开发" tabindex="-1"><a class="header-anchor" href="#_4-1-项目开发"><span>4.1 项目开发</span></a></h3><ul><li>useBuiltIns使用usage</li><li>plugin-transform-runtime只使用其移除内联复用的辅助函数的特性，减小打包体积<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">              <span class="token string-property property">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">3</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">              <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_4-2-类库开发" tabindex="-1"><a class="header-anchor" href="#_4-2-类库开发"><span>4.2 类库开发</span></a></h3><ul><li>类库开发尽量不使用污染全局环境的<code>polyfill</code>，因此<code>@babel/preset-env</code>只发挥语法转换的功能</li><li>polyfill由<code>@babel/plugin-transform-runtime</code>来处理，推荐使用core-js@3</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;@babel/preset-env&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">3</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-polyfill-service" tabindex="-1"><a class="header-anchor" href="#_5-polyfill-service"><span>5. polyfill-service</span></a></h2><ul><li><a href="https://polyfill.io/v3/" target="_blank" rel="noopener noreferrer">polyfill.io</a>自动化的 JavaScript Polyfill 服务</li><li><a href="https://polyfill.io/v3/" target="_blank" rel="noopener noreferrer">polyfill.io</a>通过分析请求头信息中的 UserAgent 实现自动加载浏览器所需的 polyfills</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;script src=&quot;https://polyfill.io/v3/polyfill.min.js&quot;&gt;&lt;/script&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,67)])])}const o=n(p,[["render",i]]),r=JSON.parse('{"path":"/strong/103.17.polyfill.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/103.17.polyfill.md"}');export{o as comp,r as data};
