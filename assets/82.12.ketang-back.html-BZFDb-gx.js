import{_ as s,c as a,a as p,o as e}from"./app-CD1YpnS1.js";const t={};function l(o,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="_1-项目初始化" tabindex="-1"><a class="header-anchor" href="#_1-项目初始化"><span>1.项目初始化</span></a></h2><h3 id="_1-1-生成项目" tabindex="-1"><a class="header-anchor" href="#_1-1-生成项目"><span>1.1 生成项目</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir server</span>
<span class="line">cd server</span>
<span class="line">cnpm init -y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-安装依赖" tabindex="-1"><a class="header-anchor" href="#_1-2-安装依赖"><span>1.2 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i express mongoose body-parser bcryptjs jsonwebtoken morgan cors validator helmet dotenv multer -S</span>
<span class="line">cnpm i typescript  @types/node @types/express @types/mongoose @types/bcryptjs @types/jsonwebtoken  @types/morgan @types/cors @types/validator ts-node-dev nodemon  @types/helmet @types/multer -D</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">模块名</th><th style="text-align:left;">用途</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="https://www.npmjs.com/package/dotenv" target="_blank" rel="noopener noreferrer">dotenv</a></td><td style="text-align:left;">从<code>.env</code>加载到环境变量</td></tr></tbody></table><h3 id="_1-3-初始化tsconfig-json" tabindex="-1"><a class="header-anchor" href="#_1-3-初始化tsconfig-json"><span>1.3 初始化tsconfig.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npx tsconfig.json</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-4-package-json" tabindex="-1"><a class="header-anchor" href="#_1-4-package-json"><span>1.4 package.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+  &quot;scripts&quot;: {</span>
<span class="line">+    &quot;build&quot;: &quot;tsc&quot;,</span>
<span class="line">+    &quot;start&quot;: &quot;cross-env PORT=8000  ts-node-dev --respawn src/index.ts&quot;,</span>
<span class="line">+    &quot;dev&quot;: &quot;cross-env PORT=8000 nodemon --exec ts-node --files src/index.ts&quot;</span>
<span class="line">+  }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-gitignore" tabindex="-1"><a class="header-anchor" href="#_1-5-gitignore"><span>1.5 .gitignore</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">node_modules</span>
<span class="line">src/public/upload/</span>
<span class="line">.env</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6-env" tabindex="-1"><a class="header-anchor" href="#_1-6-env"><span>1.6 .env</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">JWT_SECRET_KEY</span><span class="token operator">=</span>zhufeng</span>
<span class="line"><span class="token constant">MONGODB_URL</span><span class="token operator">=</span>mongodb<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>zhufengketang</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-用户管理" tabindex="-1"><a class="header-anchor" href="#_2-用户管理"><span>2.用户管理</span></a></h2><h4 id="_2-1-src-index-ts" tabindex="-1"><a class="header-anchor" href="#_2-1-src-index-ts"><span>2.1 src/index.ts</span></a></h4><p>src/index.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> express<span class="token punctuation">,</span> <span class="token punctuation">{</span> Express<span class="token punctuation">,</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> mongoose <span class="token keyword">from</span> <span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> HttpException <span class="token keyword">from</span> <span class="token string">&#39;./exceptions/HttpException&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> cors <span class="token keyword">from</span> <span class="token string">&#39;cors&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> morgan <span class="token keyword">from</span> <span class="token string">&#39;morgan&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> helmet <span class="token keyword">from</span> <span class="token string">&#39;helmet&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> errorMiddleware <span class="token keyword">from</span> <span class="token string">&#39;./middlewares/errorMiddleware&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token keyword">as</span> userController <span class="token keyword">from</span> <span class="token string">&#39;./controller/user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;dotenv/config&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> multer <span class="token keyword">from</span> <span class="token string">&#39;multer&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">destination</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;public&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;uploads&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">filename</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">file</span><span class="token operator">:</span> Express<span class="token punctuation">.</span>Multer<span class="token punctuation">.</span>File<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> storage <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">app</span><span class="token operator">:</span> Express <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;public&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;hello world&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/user/validate&#39;</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>validate<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/user/register&#39;</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>register<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/user/login&#39;</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/user/uploadAvatar&#39;</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&#39;avatar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>uploadAvatar<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">_res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token literal-property property">error</span><span class="token operator">:</span> HttpException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">&#39;尚未为此路径分配路由&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>errorMiddleware<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">PORT</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">&amp;&amp;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">8000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    mongoose<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;useNewUrlParser&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    mongoose<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;useUnifiedTopology&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://localhost/zhufengketang&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-src-exceptions-httpexception-ts" tabindex="-1"><a class="header-anchor" href="#_2-2-src-exceptions-httpexception-ts"><span>2.2 src/exceptions/HttpException.ts</span></a></h4><p>src/exceptions/HttpException.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">HttpException</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> <span class="token literal-property property">status</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token literal-property property">message</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token keyword">public</span> errors<span class="token operator">?</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> HttpException<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-src-middlewares-errormiddleware-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-src-middlewares-errormiddleware-ts"><span>2.3 src/middlewares/errorMiddleware.ts</span></a></h4><p>src/middlewares/errorMiddleware.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> HttpException <span class="token keyword">from</span> <span class="token string">&#39;../exceptions/HttpException&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">INTERNAL_SERVER_ERROR</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;http-status-codes&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">err</span><span class="token operator">:</span> HttpException<span class="token punctuation">,</span> <span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">_next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">result</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> err<span class="token punctuation">.</span>message</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>errors <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        result<span class="token punctuation">.</span>errors <span class="token operator">=</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> errorMiddleware<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-src-utils-validator-ts" tabindex="-1"><a class="header-anchor" href="#_2-4-src-utils-validator-ts"><span>2.4 src/utils/validator.ts</span></a></h4><p>src/utils/validator.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> validator <span class="token keyword">from</span> <span class="token string">&#39;validator&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models/user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RegisterInput</span> <span class="token keyword">extends</span> <span class="token class-name">Partial</span><span class="token operator">&lt;</span>UserDocument<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    confirmPassword<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RegisterInputValidateResult</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">errors</span><span class="token operator">:</span> RegisterInput<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">valid</span><span class="token operator">:</span> boolean</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> validateRegisterInput <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">confirmPassword</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">email</span><span class="token operator">:</span> string</span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">RegisterInputValidateResult</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">errors</span><span class="token operator">:</span> RegisterInput <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        errors<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">&#39;用户名不能为空&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        errors<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">&#39;密码不能为空&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>confirmPassword <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>confirmPassword<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        errors<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">&#39;确认密码不能为空&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validator<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> confirmPassword<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        errors<span class="token punctuation">.</span>confirmPassword <span class="token operator">=</span> <span class="token string">&#39;确认密码和密码不相等&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>email <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        errors<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&#39;邮箱不能为空&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>validator<span class="token punctuation">.</span><span class="token function">isEmail</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        errors<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&#39;邮箱格式必须合法&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> errors<span class="token punctuation">,</span> <span class="token literal-property property">valid</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-src-typings-jwt-ts" tabindex="-1"><a class="header-anchor" href="#_2-5-src-typings-jwt-ts"><span>2.5 src/typings/jwt.ts</span></a></h4><p>src/typings/jwt.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UserPayload</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">id</span><span class="token operator">:</span> UserDocument<span class="token punctuation">[</span><span class="token string">&#39;_id&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-src-models-index-ts" tabindex="-1"><a class="header-anchor" href="#_2-6-src-models-index-ts"><span>2.6 src\\models\\index.ts</span></a></h4><p>src\\models\\index.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-7-src-models-user-ts" tabindex="-1"><a class="header-anchor" href="#_2-7-src-models-user-ts"><span>2.7 src/models/user.ts</span></a></h4><p>src/models/user.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> mongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> Model<span class="token punctuation">,</span> Document<span class="token punctuation">,</span> HookNextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> validator <span class="token keyword">from</span> <span class="token string">&#39;validator&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> jwt <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserPayload <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../typings/jwt&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> bcrypt <span class="token keyword">from</span> <span class="token string">&#39;bcryptjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UserDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">email</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">avatar</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function-variable function">generateToken</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">_doc</span><span class="token operator">:</span> UserDocument</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">UserSchema</span><span class="token operator">:</span> Schema<span class="token operator">&lt;</span>UserDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&#39;用户名不能为空&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">minlength</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&#39;最小长度不能少于6位&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">maxlength</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">&#39;最大长度不能大于12位&#39;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">avatar</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">validate</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">validator</span><span class="token operator">:</span> validator<span class="token punctuation">.</span>isEmail</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">trim</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">,</span>    <span class="token literal-property property">toJSON</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function-variable function">transform</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_doc</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">result</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            result<span class="token punctuation">.</span>id <span class="token operator">=</span> result<span class="token punctuation">.</span>_id<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">delete</span> result<span class="token punctuation">.</span>_id<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">delete</span> result<span class="token punctuation">.</span>__v<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">delete</span> result<span class="token punctuation">.</span>password<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">delete</span> result<span class="token punctuation">.</span>createdAt<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">delete</span> result<span class="token punctuation">.</span>updatedAt<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">UserSchema<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function-variable function">generateToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> UserPayload <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET_KEY</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">&#39;1h&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">UserSchema<span class="token punctuation">.</span>pre<span class="token operator">&lt;</span>UserDocument<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">next</span><span class="token operator">:</span> HookNextFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isModified</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token keyword">await</span> bcrypt<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">UserSchema<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;login&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>UserDocument <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">user</span><span class="token operator">:</span> UserDocument <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> matched <span class="token operator">=</span> <span class="token keyword">await</span> bcrypt<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>matched<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> user<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> user<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">IUserModel</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> UserDocument <span class="token operator">|</span> <span class="token keyword">null</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">User</span><span class="token operator">:</span> IUserModel<span class="token operator">&lt;</span>UserDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>model<span class="token operator">&lt;</span>UserDocument<span class="token punctuation">,</span> IUserModel<span class="token operator">&lt;</span>UserDocument<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> UserSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-8-src-controller-user-ts" tabindex="-1"><a class="header-anchor" href="#_2-8-src-controller-user-ts"><span>2.8 src\\controller\\user.ts</span></a></h4><p>src\\controller\\user.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> validateRegisterInput <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/validator&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> HttpException <span class="token keyword">from</span> <span class="token string">&#39;../exceptions/HttpException&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">UNPROCESSABLE_ENTITY</span><span class="token punctuation">,</span> <span class="token constant">UNAUTHORIZED</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;http-status-codes&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserDocument<span class="token punctuation">,</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models/user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserPayload <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../typings/jwt&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> jwt <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//客户端会把token放在请求头里发给服务器</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">validate</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> authorization <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>authorization<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> access_token <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//Bearer access_token</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>access_token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> <span class="token literal-property property">userPayload</span><span class="token operator">:</span> UserPayload <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>access_token<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET_KEY</span> <span class="token operator">||</span> <span class="token string">&#39;zhufeng&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> UserPayload<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> <span class="token literal-property property">user</span><span class="token operator">:</span> UserDocument <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userPayload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token literal-property property">data</span><span class="token operator">:</span> user<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token string">&#39;用户未找到&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token string">&#39;access_token不正确&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token string">&#39;access_token未提供&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token string">&#39;authorization未提供&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> confirmPassword<span class="token punctuation">,</span> email<span class="token punctuation">,</span> addresses <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token punctuation">{</span> valid<span class="token punctuation">,</span> errors <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">validateRegisterInput</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> confirmPassword<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNPROCESSABLE_ENTITY</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">参数验证失败!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> errors<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token literal-property property">user</span><span class="token operator">:</span> UserDocument <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            username<span class="token punctuation">,</span></span>
<span class="line">            email<span class="token punctuation">,</span></span>
<span class="line">            password<span class="token punctuation">,</span></span>
<span class="line">            addresses</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token literal-property property">oldUser</span><span class="token operator">:</span> UserDocument <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> user<span class="token punctuation">.</span>username <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNPROCESSABLE_ENTITY</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">用户名重复!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> token <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> token <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    token</span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">登录失败</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">uploadAvatar</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> userId <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> avatar <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> userId <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> avatar <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> avatar <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-9-typings-express-d-ts" tabindex="-1"><a class="header-anchor" href="#_2-9-typings-express-d-ts"><span>2.9 typings\\express.d.ts</span></a></h4><p>src\\typings\\express.d.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line">declare global <span class="token punctuation">{</span></span>
<span class="line">    namespace Express <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Request</span> <span class="token punctuation">{</span></span>
<span class="line">            currentUser<span class="token operator">?</span><span class="token operator">:</span> UserDocument <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token literal-property property">file</span><span class="token operator">:</span> Multer<span class="token punctuation">.</span>File</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-轮播图" tabindex="-1"><a class="header-anchor" href="#_3-轮播图"><span>3.轮播图</span></a></h2><h3 id="_3-1-src-index-ts" tabindex="-1"><a class="header-anchor" href="#_3-1-src-index-ts"><span>3.1 src\\index.ts</span></a></h3><p>src\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import express, { Express, Request, Response, NextFunction } from &#39;express&#39;;</span>
<span class="line">import mongoose from &#39;mongoose&#39;;</span>
<span class="line">import HttpException from &#39;./exceptions/HttpException&#39;;</span>
<span class="line">import cors from &#39;cors&#39;;</span>
<span class="line">import morgan from &#39;morgan&#39;;</span>
<span class="line">import helmet from &#39;helmet&#39;;</span>
<span class="line">import errorMiddleware from &#39;./middlewares/errorMiddleware&#39;;</span>
<span class="line">import *  as userController from &#39;./controller/user&#39;;</span>
<span class="line">+import *  as sliderController from &#39;./controller/slider&#39;;</span>
<span class="line">import &quot;dotenv/config&quot;;</span>
<span class="line">import multer from &#39;multer&#39;;</span>
<span class="line">import path from &#39;path&#39;;</span>
<span class="line">+import { Slider } from &#39;./models&#39;;</span>
<span class="line">const storage = multer.diskStorage({</span>
<span class="line">    destination: path.join(__dirname, &#39;public&#39;, &#39;uploads&#39;),</span>
<span class="line">    filename(_req: Request, file: Express.Multer.File, cb) {</span>
<span class="line">        cb(null, Date.now() + path.extname(file.originalname));</span>
<span class="line">    }</span>
<span class="line">});</span>
<span class="line">const upload = multer({ storage });</span>
<span class="line">const app: Express = express();</span>
<span class="line">app.use(morgan(&quot;dev&quot;));</span>
<span class="line">app.use(cors());</span>
<span class="line">app.use(helmet());</span>
<span class="line">app.use(express.static(path.resolve(__dirname, &#39;public&#39;)));</span>
<span class="line">app.use(express.json());</span>
<span class="line">app.use(express.urlencoded({ extended: false }));</span>
<span class="line">app.get(&#39;/&#39;, (_req: Request, res: Response) =&gt; {</span>
<span class="line">    res.json({ success: true, message: &#39;hello world&#39; });</span>
<span class="line">});</span>
<span class="line">app.get(&#39;/user/validate&#39;, userController.validate);</span>
<span class="line">app.post(&#39;/user/register&#39;, userController.register);</span>
<span class="line">app.post(&#39;/user/login&#39;, userController.login);</span>
<span class="line">app.post(&#39;/user/uploadAvatar&#39;, upload.single(&#39;avatar&#39;), userController.uploadAvatar);</span>
<span class="line">+app.get(&#39;/slider/list&#39;, sliderController.list);</span>
<span class="line">app.use((_req: Request, _res: Response, next: NextFunction) =&gt; {</span>
<span class="line">    const error: HttpException = new HttpException(404, &#39;Route not found&#39;);</span>
<span class="line">    next(error);</span>
<span class="line">});</span>
<span class="line">app.use(errorMiddleware);</span>
<span class="line">const PORT: number = (process.env.PORT &amp;&amp; parseInt(process.env.PORT)) || 8000;</span>
<span class="line">(async function () {</span>
<span class="line">    mongoose.set(&#39;useNewUrlParser&#39;, true);</span>
<span class="line">    mongoose.set(&#39;useUnifiedTopology&#39;, true);</span>
<span class="line">    await mongoose.connect(process.env.MONGODB_URL!);</span>
<span class="line">+    await createSliders();</span>
<span class="line">    app.listen(PORT, () =&gt; {</span>
<span class="line">        console.log(\`Running on http://localhost:\${PORT}\`);</span>
<span class="line">    });</span>
<span class="line">})();</span>
<span class="line"></span>
<span class="line">+async function createSliders() {</span>
<span class="line">+    const sliders = await Slider.find();</span>
<span class="line">+    if (sliders.length == 0) {</span>
<span class="line">+        const sliders = [</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/reactnative.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/wechat.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/architect.jpg&#39; }</span>
<span class="line">+        ];</span>
<span class="line">+        Slider.create(sliders);</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-controller-slider-ts" tabindex="-1"><a class="header-anchor" href="#_3-2-controller-slider-ts"><span>3.2 controller\\slider.ts</span></a></h3><p>src\\controller\\slider.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ISliderDocument<span class="token punctuation">,</span> Slider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">list</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">sliders</span><span class="token operator">:</span> ISliderDocument<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Slider<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> sliders <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-models-slider-ts" tabindex="-1"><a class="header-anchor" href="#_3-3-models-slider-ts"><span>3.3 models\\slider.ts</span></a></h3><p>src\\models\\slider.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> mongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> Document <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ISliderDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">_doc</span><span class="token operator">:</span> ISliderDocument</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">SliderSchema</span><span class="token operator">:</span> Schema<span class="token operator">&lt;</span>ISliderDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Slider <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>model<span class="token operator">&lt;</span>ISliderDocument<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;Slider&#39;</span><span class="token punctuation">,</span> SliderSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-src-models-index-ts" tabindex="-1"><a class="header-anchor" href="#_3-4-src-models-index-ts"><span>3.4 src\\models\\index.ts</span></a></h3><p>src\\models\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./user&#39;;</span>
<span class="line">+export * from &#39;./slider&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-课程管理" tabindex="-1"><a class="header-anchor" href="#_4-课程管理"><span>4.课程管理</span></a></h2><h3 id="_4-1-src-index-ts" tabindex="-1"><a class="header-anchor" href="#_4-1-src-index-ts"><span>4.1 src\\index.ts</span></a></h3><p>src\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import express, { Express, Request, Response, NextFunction } from &#39;express&#39;;</span>
<span class="line">import mongoose from &#39;mongoose&#39;;</span>
<span class="line">import HttpException from &#39;./exceptions/HttpException&#39;;</span>
<span class="line">import cors from &#39;cors&#39;;</span>
<span class="line">import morgan from &#39;morgan&#39;;</span>
<span class="line">import helmet from &#39;helmet&#39;;</span>
<span class="line">import errorMiddleware from &#39;./middlewares/errorMiddleware&#39;;</span>
<span class="line">import *  as userController from &#39;./controller/user&#39;;</span>
<span class="line">import *  as sliderController from &#39;./controller/slider&#39;;</span>
<span class="line">+import *  as lessonController from &#39;./controller/lesson&#39;;</span>
<span class="line">import &quot;dotenv/config&quot;;</span>
<span class="line">import multer from &#39;multer&#39;;</span>
<span class="line">import path from &#39;path&#39;;</span>
<span class="line">+import { Slider, Lesson } from &#39;./models&#39;;</span>
<span class="line">const storage = multer.diskStorage({</span>
<span class="line">    destination: path.join(__dirname, &#39;public&#39;, &#39;uploads&#39;),</span>
<span class="line">    filename(_req: Request, file: Express.Multer.File, cb) {</span>
<span class="line">        cb(null, Date.now() + path.extname(file.originalname));</span>
<span class="line">    }</span>
<span class="line">});</span>
<span class="line">const upload = multer({ storage });</span>
<span class="line">const app: Express = express();</span>
<span class="line">app.use(morgan(&quot;dev&quot;));</span>
<span class="line">app.use(cors());</span>
<span class="line">app.use(helmet());</span>
<span class="line">app.use(express.static(path.resolve(__dirname, &#39;public&#39;)));</span>
<span class="line">app.use(express.json());</span>
<span class="line">app.use(express.urlencoded({ extended: false }));</span>
<span class="line">app.get(&#39;/&#39;, (_req: Request, res: Response) =&gt; {</span>
<span class="line">    res.json({ success: true, message: &#39;hello world&#39; });</span>
<span class="line">});</span>
<span class="line">app.get(&#39;/user/validate&#39;, userController.validate);</span>
<span class="line">app.post(&#39;/user/register&#39;, userController.register);</span>
<span class="line">app.post(&#39;/user/login&#39;, userController.login);</span>
<span class="line">app.post(&#39;/user/uploadAvatar&#39;, upload.single(&#39;avatar&#39;), userController.uploadAvatar);</span>
<span class="line">app.get(&#39;/slider/list&#39;, sliderController.list);</span>
<span class="line">+app.get(&#39;/lesson/list&#39;, lessonController.list);</span>
<span class="line">+app.get(&#39;/lesson/:id&#39;, lessonController.get);</span>
<span class="line">app.use((_req: Request, _res: Response, next: NextFunction) =&gt; {</span>
<span class="line">    const error: HttpException = new HttpException(404, &#39;Route not found&#39;);</span>
<span class="line">    next(error);</span>
<span class="line">});</span>
<span class="line">app.use(errorMiddleware);</span>
<span class="line">const PORT: number = (process.env.PORT &amp;&amp; parseInt(process.env.PORT)) || 8000;</span>
<span class="line">(async function () {</span>
<span class="line">    mongoose.set(&#39;useNewUrlParser&#39;, true);</span>
<span class="line">    mongoose.set(&#39;useUnifiedTopology&#39;, true);</span>
<span class="line">    await mongoose.connect(process.env.MONGODB_URL!);</span>
<span class="line">    await createSliders();</span>
<span class="line">+    await createLessons();</span>
<span class="line">    app.listen(PORT, () =&gt; {</span>
<span class="line">        console.log(\`Running on http://localhost:\${PORT}\`);</span>
<span class="line">    });</span>
<span class="line">})();</span>
<span class="line"></span>
<span class="line">async function createSliders() {</span>
<span class="line">    const sliders = await Slider.find();</span>
<span class="line">    if (sliders.length == 0) {</span>
<span class="line">        const sliders = [</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/reactnative.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/wechat.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/architect.jpg&#39; }</span>
<span class="line">        ];</span>
<span class="line">        Slider.create(sliders);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">+async function createLessons() {</span>
<span class="line">+    const lessons = await Lesson.find();</span>
<span class="line">+    if (lessons.length == 0) {</span>
<span class="line">        const lessons = [</span>
<span class="line">            {</span>
<span class="line">                order: 1,</span>
<span class="line">                title: &#39;1.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥100.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 2,</span>
<span class="line">                title: &#39;2.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥200.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 3,</span>
<span class="line">                title: &#39;3.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥300.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 4,</span>
<span class="line">                title: &#39;4.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥400.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 5,</span>
<span class="line">                title: &#39;5.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥500.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 6,</span>
<span class="line">                title: &#39;6.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥100.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 7,</span>
<span class="line">                title: &#39;7.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥200.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 8,</span>
<span class="line">                title: &#39;8.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥300.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 9,</span>
<span class="line">                title: &#39;9.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥400.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 10,</span>
<span class="line">                title: &#39;10.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥500.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 11,</span>
<span class="line">                title: &#39;11.React全栈架构&#39;,</span>
<span class="line">                &quot;video&quot;: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥600.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 12,</span>
<span class="line">                title: &#39;12.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥700.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 13,</span>
<span class="line">                title: &#39;13.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥800.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 14,</span>
<span class="line">                title: &#39;14.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥900.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 15,</span>
<span class="line">                title: &#39;15.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥1000.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 16,</span>
<span class="line">                title: &#39;16.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥600.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 17,</span>
<span class="line">                title: &#39;17.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥700.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 18,</span>
<span class="line">                title: &#39;18.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥800.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 19,</span>
<span class="line">                title: &#39;19.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥900.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 20,</span>
<span class="line">                title: &#39;20.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥1000.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            }</span>
<span class="line">        ];</span>
<span class="line">+       Lesson.create(lessons);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-src-models-index-ts" tabindex="-1"><a class="header-anchor" href="#_4-2-src-models-index-ts"><span>4.2 src\\models\\index.ts</span></a></h3><p>src\\models\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./user&#39;;</span>
<span class="line">export * from &#39;./slider&#39;;</span>
<span class="line">+export * from &#39;./lesson&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-controller-lesson-ts" tabindex="-1"><a class="header-anchor" href="#_4-3-controller-lesson-ts"><span>4.3 controller\\lesson.ts</span></a></h3><p>src\\controller\\lesson.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ILessonDocument<span class="token punctuation">,</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">list</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> offset<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> category <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span></span>
<span class="line">    offset <span class="token operator">=</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//偏移量 </span></span>
<span class="line">    limit <span class="token operator">=</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">5</span> <span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//每页条数</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">query</span><span class="token operator">:</span> Partial<span class="token operator">&lt;</span>ILessonDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> ILessonDocument<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>category <span class="token operator">&amp;&amp;</span> category <span class="token operator">!=</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        query<span class="token punctuation">.</span>category <span class="token operator">=</span> category<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token keyword">await</span> Lesson<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">await</span> Lesson<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">order</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> list<span class="token punctuation">,</span> <span class="token literal-property property">hasMore</span><span class="token operator">:</span> total <span class="token operator">&gt;</span> offset <span class="token operator">+</span> limit <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> lesson <span class="token operator">=</span> <span class="token keyword">await</span> Lesson<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> lesson <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-models-lesson-ts" tabindex="-1"><a class="header-anchor" href="#_4-4-models-lesson-ts"><span>4.4 models\\lesson.ts</span></a></h3><p>src\\models\\lesson.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> mongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> Document <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ILessonDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">order</span><span class="token operator">:</span> number<span class="token punctuation">,</span><span class="token comment">//顺序</span></span>
<span class="line">    <span class="token literal-property property">title</span><span class="token operator">:</span> string<span class="token punctuation">,</span><span class="token comment">//标题</span></span>
<span class="line">    <span class="token literal-property property">video</span><span class="token operator">:</span> string<span class="token punctuation">,</span><span class="token comment">//视频</span></span>
<span class="line">    <span class="token literal-property property">poster</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token comment">//海报</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> string<span class="token punctuation">,</span><span class="token comment">//url地址</span></span>
<span class="line">    <span class="token literal-property property">price</span><span class="token operator">:</span> string<span class="token punctuation">,</span><span class="token comment">//价格</span></span>
<span class="line">    <span class="token literal-property property">category</span><span class="token operator">:</span> string<span class="token punctuation">,</span><span class="token comment">//分类</span></span>
<span class="line">    <span class="token literal-property property">_doc</span><span class="token operator">:</span> ILessonDocument</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">LessonSchema</span><span class="token operator">:</span> Schema<span class="token operator">&lt;</span>ILessonDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">order</span><span class="token operator">:</span> Number<span class="token punctuation">,</span><span class="token comment">//顺序</span></span>
<span class="line">    <span class="token literal-property property">title</span><span class="token operator">:</span> String<span class="token punctuation">,</span><span class="token comment">//标题</span></span>
<span class="line">    <span class="token literal-property property">video</span><span class="token operator">:</span> String<span class="token punctuation">,</span><span class="token comment">//视频</span></span>
<span class="line">    <span class="token literal-property property">poster</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">//海报</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> String<span class="token punctuation">,</span><span class="token comment">//url地址</span></span>
<span class="line">    <span class="token literal-property property">price</span><span class="token operator">:</span> String<span class="token punctuation">,</span><span class="token comment">//价格</span></span>
<span class="line">    <span class="token literal-property property">category</span><span class="token operator">:</span> String<span class="token punctuation">,</span><span class="token comment">//分类</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Lesson <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>model<span class="token operator">&lt;</span>ILessonDocument<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;Lesson&#39;</span><span class="token punctuation">,</span> LessonSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,68)])])}const i=s(t,[["render",l]]),r=JSON.parse('{"path":"/strong/82.12.ketang-back.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/82.12.ketang-back.md"}');export{i as comp,r as data};
