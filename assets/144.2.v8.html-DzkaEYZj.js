import{_ as s,c as a,a as t,o as e}from"./app-CD1YpnS1.js";const p={};function l(c,n){return e(),a("div",null,[...n[0]||(n[0]=[t(`<p><img src="https://static.zhufengpeixun.com/zhu_feng_jia_gou_1639320506265.png" alt=""></p><h2 id="_1-v8的内存垃圾回收" tabindex="-1"><a class="header-anchor" href="#_1-v8的内存垃圾回收"><span>1.V8的内存垃圾回收</span></a></h2><ul><li>内存</li><li>V8</li><li>垃圾回收</li></ul><h2 id="_2-计算机模型" tabindex="-1"><a class="header-anchor" href="#_2-计算机模型"><span>2.计算机模型</span></a></h2><p><img src="https://static.zhufengpeixun.com/ji_suan_ji_mo_xing_4_1639112201198.jpg" alt=""></p><h3 id="_2-1-寄存器" tabindex="-1"><a class="header-anchor" href="#_2-1-寄存器"><span>2.1 寄存器</span></a></h3><ul><li>是中央处理器的组成部分</li><li>寄存器是有限存储容量的高速存储部件</li><li>可以用来暂存指令、数据和地址</li><li>寄存器内的数据可用于执行算术和逻辑运算</li><li>寄存器内的地址可用于指向内存的某个位置</li></ul><h3 id="_2-2-内存" tabindex="-1"><a class="header-anchor" href="#_2-2-内存"><span>2.2 内存</span></a></h3><ul><li>随机存取存储器(Random Access Memory)也叫内存，英文缩写RAM</li><li>RAM是与CPU直接交换数据的内部存储器</li><li>RAM工作时可以从任何一个指定地址写入或读出信息</li><li>RAM用来在计算机中用来暂时存储程序、数据和中间结果</li></ul><p><img src="https://static.zhufengpeixun.com/nei_cun_di_zhi_2_1639308561583.jpg" alt=""></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4294967295</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-1-内存空间分类" tabindex="-1"><a class="header-anchor" href="#_2-2-1-内存空间分类"><span>2.2.1 内存空间分类</span></a></h4><ul><li><a href="https://www.processon.com/diagraming/61b2e22863768956b5f64f68" target="_blank" rel="noopener noreferrer">内存空间</a>会分为二类 <ul><li>数据空间</li><li>指令空间</li></ul></li></ul><p><img src="https://static.zhufengpeixun.com/nei_cun_di_zhi_ji_suan_2_1639229838350.jpg" alt=""></p><h3 id="_2-3-指令" tabindex="-1"><a class="header-anchor" href="#_2-3-指令"><span>2.3 指令</span></a></h3><ul><li>可以通过指令指挥命令计算机进行工作</li></ul><h4 id="_2-3-1-机器语言指令" tabindex="-1"><a class="header-anchor" href="#_2-3-1-机器语言指令"><span>2.3.1 机器语言指令</span></a></h4><ul><li>计算机只认识0和1，所以我们可以通过二进制指令和计算机进行沟通</li><li>这些指令被称为指令集，也就是机器语言</li><li>MIPS是一种采取精简指令集(RISC)的处理器架构</li><li>最常见的MIPS-32位指令集每个指令是一个32位的二进制数</li></ul><p><img src="https://static.zhufengpeixun.com/command2_1639230482961.jpg" alt=""></p><h4 id="_2-3-2-汇编指令" tabindex="-1"><a class="header-anchor" href="#_2-3-2-汇编指令"><span>2.3.2 汇编指令</span></a></h4><ul><li>二进制指令难以编写和阅读，所以出现了汇编指令集</li><li><ul><li><a href="http://courses.missouristate.edu/KenVollmar/MARS/" target="_blank" rel="noopener noreferrer">MIPS Assembler and Runtime Simulator</a>是一个轻量级的交互式开发环境IDE,用于使用MIPS(Microprocessor without interlocked piped stages architecture)汇编语言进行编程</li></ul></li></ul><table><thead><tr><th style="text-align:left;">部分</th><th style="text-align:left;">值</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">opcode操作码</td><td style="text-align:left;">0</td><td style="text-align:left;">add做加法运算</td></tr><tr><td style="text-align:left;">rs</td><td style="text-align:left;">$s1</td><td style="text-align:left;">第一个来源寄存器</td></tr><tr><td style="text-align:left;">rt</td><td style="text-align:left;">$s2</td><td style="text-align:left;">第二个来源寄存器</td></tr><tr><td style="text-align:left;">rd</td><td style="text-align:left;">$s3</td><td style="text-align:left;">目标寄存器</td></tr><tr><td style="text-align:left;">shamt</td><td style="text-align:left;">0</td><td style="text-align:left;">位移量</td></tr><tr><td style="text-align:left;">funct</td><td style="text-align:left;">32</td><td style="text-align:left;">函数,这个字段选择Opcode操作某个特定变体</td></tr></tbody></table><table><thead><tr><th style="text-align:left;">助记符</th><th style="text-align:left;">opcode</th><th style="text-align:left;">rs</th><th style="text-align:left;">rt</th><th style="text-align:left;">rd</th><th style="text-align:left;">shamt</th><th style="text-align:left;">funct</th><th style="text-align:left;">示例</th><th style="text-align:left;">示例含义</th><th style="text-align:left;">操作</th></tr></thead><tbody><tr><td style="text-align:left;">add</td><td style="text-align:left;">000000</td><td style="text-align:left;">rs</td><td style="text-align:left;">rt</td><td style="text-align:left;">rd</td><td style="text-align:left;">00000</td><td style="text-align:left;">100000</td><td style="text-align:left;">add $1,$2,$3</td><td style="text-align:left;">$1=$2+$3</td><td style="text-align:left;">带符号数相加</td></tr><tr><td style="text-align:left;">addu</td><td style="text-align:left;">000000</td><td style="text-align:left;">rs</td><td style="text-align:left;">rt</td><td style="text-align:left;">rd</td><td style="text-align:left;">00000</td><td style="text-align:left;">100001</td><td style="text-align:left;">add $1,$2,$3</td><td style="text-align:left;">$1=$2+$3</td><td style="text-align:left;">无符号数相加</td></tr><tr><td style="text-align:left;">sll</td><td style="text-align:left;">000000</td><td style="text-align:left;">00000</td><td style="text-align:left;">rt</td><td style="text-align:left;">rd</td><td style="text-align:left;">sa</td><td style="text-align:left;">000000</td><td style="text-align:left;">sll rd,rt,sa</td><td style="text-align:left;">rd = rt &lt;&lt; sa</td><td style="text-align:left;">逻辑左移,寄存器rt的值向左移sa位，结果保存到rd寄存器中</td></tr></tbody></table><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">add $s3,$s1,$s2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">addi $s1<span class="token punctuation">,</span>$zero<span class="token punctuation">,</span><span class="token number">1</span></span>
<span class="line">sll s2<span class="token punctuation">,</span>s1<span class="token punctuation">,</span><span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x02329820</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-4-程序指针" tabindex="-1"><a class="header-anchor" href="#_2-4-程序指针"><span>2.4 程序指针</span></a></h3><ul><li>PC寄存器存储着下一条要执行的指令的内存地址</li><li>机器循环=PC位置获取指令-&gt;分析指令-&gt;执行指令-&gt;PC指针移动</li><li><a href="https://www.processon.com/diagraming/61b2e2f8e401fd0ae56242ab" target="_blank" rel="noopener noreferrer">执行过程</a></li></ul><p><img src="https://static.zhufengpeixun.com/nei_cun_di_zhi_ji_suan_123_1639114678616.jpg" alt=""></p><table><thead><tr><th style="text-align:left;">汇编指令</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">addi $s1,$zero,1</td><td style="text-align:left;">把$zero中的值加上数字1保存到寄存器$1中</td></tr><tr><td style="text-align:left;">addi $s2,$zero,2</td><td style="text-align:left;">把$zero中的值加上数字2保存到寄存器$1中</td></tr><tr><td style="text-align:left;">add $s3,$s1,$s2</td><td style="text-align:left;">把寄存器$s1和寄存器$2的和存储到$s3中</td></tr></tbody></table><h2 id="_3-v8" tabindex="-1"><a class="header-anchor" href="#_3-v8"><span>3.V8</span></a></h2><ul><li><a href="https://gitee.com/zhufengpeixun/v8/" target="_blank" rel="noopener noreferrer">V8引擎</a>是一个JavaScript引擎实现</li></ul><h3 id="_3-1-语言的分类" tabindex="-1"><a class="header-anchor" href="#_3-1-语言的分类"><span>3.1 语言的分类</span></a></h3><h4 id="_3-1-1-解释执行" tabindex="-1"><a class="header-anchor" href="#_3-1-1-解释执行"><span>3.1.1 解释执行</span></a></h4><ul><li>先将源代码通过解析器转成中间代码，再用解释器执行中间代码，输出结果</li><li>启动快，执行慢</li></ul><p><img src="https://static.zhufengpeixun.com/jie_shi_zhi_xing_1639126594667.jpg" alt=""></p><h4 id="_3-1-2-编译执行" tabindex="-1"><a class="header-anchor" href="#_3-1-2-编译执行"><span>3.1.2 编译执行</span></a></h4><ul><li>先将源代码通过解析器转成中间代码，再用编译器把中间代码转成机器码，最后执行机器码，输出结果</li><li>启动慢，执行快</li></ul><p><img src="https://static.zhufengpeixun.com/bian_yi_zhi_xing_1639126672891.jpg" alt=""></p><h3 id="_3-2-v8执行过程" tabindex="-1"><a class="header-anchor" href="#_3-2-v8执行过程"><span>3.2 V8执行过程</span></a></h3><ul><li>V8采用的是解释和编译两种方式，这种混合使用的方式称为JIT技术</li><li>第一步先由解析器生成抽象语法树和相关的作用域</li><li>第二步根据AST和作用域生成字节码，字节码是介于AST和机器码的中间代码</li><li>然后由解释器直接执行字节码，也可以让编译器把字节码编译成机器码后再执行</li><li><a href="https://github.com/GoogleChromeLabs/jsvu" target="_blank" rel="noopener noreferrer">jsvu</a>可以快速安装V8引擎</li><li>V8源码编译出来的可执行程序名为d8<a href="https://v8.dev/docs/d8" target="_blank" rel="noopener noreferrer">d8</a>,d8是V8自己的开发工具shell</li></ul><p><img src="https://static.zhufengpeixun.com/V8_zhi_xing_guo_cheng_1639127073239.jpg" alt=""></p><h4 id="_3-2-1-抽象语法树" tabindex="-1"><a class="header-anchor" href="#_3-2-1-抽象语法树"><span>3.2.1 抽象语法树</span></a></h4><ul><li><a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">astexplorer</a>可以查看抽象语法树</li></ul><p><img src="https://static.zhufengpeixun.com/ast_1639234241241.jpg" alt=""></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">d8 <span class="token operator">--</span>print<span class="token operator">-</span>ast <span class="token number">4</span><span class="token punctuation">.</span>js</span>
<span class="line"><span class="token punctuation">[</span>generating bytecode <span class="token keyword">for</span> <span class="token keyword">function</span><span class="token operator">:</span> <span class="token punctuation">]</span></span>
<span class="line"><span class="token operator">--</span><span class="token operator">-</span> <span class="token constant">AST</span> <span class="token operator">--</span><span class="token operator">-</span></span>
<span class="line"><span class="token constant">FUNC</span> at <span class="token number">0</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">KIND</span> <span class="token number">0</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">SUSPEND</span> <span class="token constant">COUNT</span> <span class="token number">0</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">NAME</span> <span class="token string">&quot;&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">INFERRED</span> <span class="token constant">NAME</span> <span class="token string">&quot;&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">DECLS</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VARIABLE</span> <span class="token punctuation">(</span>00000278B965EB88<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;a&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VARIABLE</span> <span class="token punctuation">(</span>00000278B965EC78<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;b&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VARIABLE</span> <span class="token punctuation">(</span>00000278B965EDB0<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;c&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">BLOCK</span> <span class="token constant">NOCOMPLETIONS</span> at <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">EXPRESSION</span> <span class="token constant">STATEMENT</span> at <span class="token number">8</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">INIT</span> at <span class="token number">8</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VAR</span> <span class="token constant">PROXY</span> <span class="token function">unallocated</span> <span class="token punctuation">(</span>00000278B965EB88<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;a&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">LITERAL</span> <span class="token number">1</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">BLOCK</span> <span class="token constant">NOCOMPLETIONS</span> at <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">EXPRESSION</span> <span class="token constant">STATEMENT</span> at <span class="token number">20</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">INIT</span> at <span class="token number">20</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VAR</span> <span class="token constant">PROXY</span> <span class="token function">unallocated</span> <span class="token punctuation">(</span>00000278B965EC78<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;b&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">LITERAL</span> <span class="token number">2</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token constant">BLOCK</span> <span class="token constant">NOCOMPLETIONS</span> at <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">EXPRESSION</span> <span class="token constant">STATEMENT</span> at <span class="token number">32</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">INIT</span> at <span class="token number">32</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VAR</span> <span class="token constant">PROXY</span> <span class="token function">unallocated</span> <span class="token punctuation">(</span>00000278B965EDB0<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;c&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">ADD</span> at <span class="token number">34</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VAR</span> <span class="token constant">PROXY</span> <span class="token function">unallocated</span> <span class="token punctuation">(</span>00000278B965EB88<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;a&quot;</span></span>
<span class="line"><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token constant">VAR</span> <span class="token constant">PROXY</span> <span class="token function">unallocated</span> <span class="token punctuation">(</span>00000278B965EC78<span class="token punctuation">)</span> <span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token constant">VAR</span><span class="token punctuation">)</span> <span class="token string">&quot;b&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://static.zhufengpeixun.com/printast_1639128193051.jpg" alt=""></p><h4 id="_3-2-2-作用域" tabindex="-1"><a class="header-anchor" href="#_3-2-2-作用域"><span>3.2.2 作用域</span></a></h4><ul><li>作用域是一个抽象的概念，它描述了一个变量的生命周期，比如哪些变量是在哪里声明的，哪些变量是在哪里使用的</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">d8 <span class="token operator">--</span>print<span class="token operator">-</span>scopes <span class="token number">1</span><span class="token punctuation">.</span>js</span>
<span class="line">Global scope<span class="token operator">:</span></span>
<span class="line">global <span class="token punctuation">{</span> <span class="token comment">// (000001D42188BEC0) (0, 38)</span></span>
<span class="line">  <span class="token comment">// will be compiled</span></span>
<span class="line">  <span class="token comment">// 1 stack slots</span></span>
<span class="line">  <span class="token comment">// temporary vars:</span></span>
<span class="line">  <span class="token constant">TEMPORARY</span> <span class="token punctuation">.</span>result<span class="token punctuation">;</span>  <span class="token comment">// (000001D42188C730) local[0]</span></span>
<span class="line">  <span class="token comment">// local vars:</span></span>
<span class="line">  <span class="token constant">VAR</span> c<span class="token punctuation">;</span>  <span class="token comment">// (000001D42188C670)</span></span>
<span class="line">  <span class="token constant">VAR</span> b<span class="token punctuation">;</span>  <span class="token comment">// (000001D42188C538)</span></span>
<span class="line">  <span class="token constant">VAR</span> a<span class="token punctuation">;</span>  <span class="token comment">// (000001D42188C448)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-3-字节码" tabindex="-1"><a class="header-anchor" href="#_3-2-3-字节码"><span>3.2.3 字节码</span></a></h4><ul><li>字节码是机器码的抽象表示</li><li>源代码直接编译成机器码编译时间太长，体积太大，不适合移动端</li><li>编译成字节码编译时间短，体积小</li><li><a href="https://gitee.com/zhufengpeixun/v8/blob/master/src/interpreter/bytecodes.h" target="_blank" rel="noopener noreferrer">bytecodes.h</a></li><li>FeedBack Vector slot(反馈向量槽)是一个数组，是用来给优化编译器提供信息的</li><li><a href="https://www.processon.com/diagraming/61b37c957d9c086a6766b72f" target="_blank" rel="noopener noreferrer">字节码执行过程</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">d8 <span class="token operator">--</span>print<span class="token operator">-</span>bytecode  <span class="token number">4</span><span class="token punctuation">.</span>js</span>
<span class="line">LdaConstant <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> 从常量池中加载索引<span class="token number">0</span>的常量到累加寄存器中</span>
<span class="line">Star r1 把累加器的值保存到目标寄存器中</span>
<span class="line">LdaZero 把<span class="token number">0</span>保存到累加寄存器中</span>
<span class="line">Star r2 把累加器的值<span class="token number">0</span>保存到目标寄存器中</span>
<span class="line">Mov <span class="token operator">&lt;</span>closure<span class="token operator">&gt;</span><span class="token punctuation">,</span> r3 保存r3寄存器的值</span>
<span class="line">CallRuntime <span class="token punctuation">[</span>DeclareGlobals<span class="token punctuation">]</span><span class="token punctuation">,</span> r1<span class="token operator">-</span>r3</span>
<span class="line"></span>
<span class="line">StackCheck    检查栈是否溢出</span>
<span class="line"></span>
<span class="line">LdaSmi <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>   加载<span class="token number">10</span>到累加寄存器中</span>
<span class="line">StaGlobal <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> 把累加寄存器的值保存到常量池索引<span class="token number">1</span>处</span>
<span class="line"></span>
<span class="line">LdaSmi <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span>   加载<span class="token number">20</span>到累加寄存器中</span>
<span class="line">StaGlobal <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> 把累加寄存器的值保存到常量池索引<span class="token number">2</span>处</span>
<span class="line"></span>
<span class="line">LdaGlobal <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> 从常量池加载索引<span class="token number">1</span>到累加寄存器</span>
<span class="line">Star r1       把累加器的值<span class="token number">10</span>保存到目标计数器中</span>
<span class="line">LdaGlobal <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> 从常量池加载索引<span class="token number">2</span>的值<span class="token number">20</span>到累加寄存器</span>
<span class="line">Add r1  把r1寄存器的值加到累加寄存器中，累加寄存器值为<span class="token number">30</span></span>
<span class="line">StaGlobal <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> 把累加寄存器的值保存到常量池索引<span class="token number">3</span>处</span>
<span class="line">LdaUndefined  把Undefined保存到累加寄存器中</span>
<span class="line">Return        返回累加寄存器中的值</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-4-编译器优化" tabindex="-1"><a class="header-anchor" href="#_3-2-4-编译器优化"><span>3.2.4 编译器优化</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">d8 --trace-opt sum.js</span>
<span class="line">[marking 0x02ccc2ba2279 &lt;JSFunction (sfi = 000002CCC2BA2091)&gt; for optimized recompilation, reason: small function, ICs with typeinfo: 4/4 (100%), generic ICs: 0/4 (0%)]</span>
<span class="line">[marking 0x02ccc2ba2339 &lt;JSFunction sum (sfi = 000002CCC2BA2141)&gt; for optimized recompilation, reason: small function, ICs with typeinfo: 1/1 (100%), generic ICs: 0/1 (0%)]</span>
<span class="line">[compiling method 0x02ccc2ba2339 &lt;JSFunction sum (sfi = 000002CCC2BA2141)&gt; using TurboFan]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,58)])])}const o=s(p,[["render",l]]),u=JSON.parse('{"path":"/strong/144.2.v8.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/144.2.v8.md"}');export{o as comp,u as data};
