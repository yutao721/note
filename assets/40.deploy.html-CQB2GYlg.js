import{_ as a,c as n,a as e,o as l}from"./app-CD1YpnS1.js";const t={};function i(p,s){return l(),n("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-服务器部署步骤" tabindex="-1"><a class="header-anchor" href="#_1-服务器部署步骤"><span>1. 服务器部署步骤</span></a></h2><ol><li>购买自己的域名</li><li>域名备案</li><li>购买服务器</li><li>配置服务器应用环境</li><li>安装配置服务器</li><li>项目远程部署和发布与更新</li></ol><h3 id="_1-2-购买域名" tabindex="-1"><a class="header-anchor" href="#_1-2-购买域名"><span>1.2 购买域名</span></a></h3><ul><li><a href="https://dnspod.cloud.tencent.com" target="_blank" rel="noopener noreferrer">腾讯云</a></li><li><a href="https://wanwang.aliyun.com" target="_blank" rel="noopener noreferrer">阿里云</a></li><li><a href="https://cloud.baidu.com/product/bcd.html" target="_blank" rel="noopener noreferrer">百度云</a></li><li><a href="https://www.22.cn" target="_blank" rel="noopener noreferrer">爱名网</a></li><li><a href="https://sg.godaddy.com" target="_blank" rel="noopener noreferrer">godaddy</a></li></ul><h3 id="_1-3-云主机" tabindex="-1"><a class="header-anchor" href="#_1-3-云主机"><span>1.3 云主机</span></a></h3><ul><li><a href="https://www.aliyun.com" target="_blank" rel="noopener noreferrer">阿里云 ECS</a></li><li><a href="https://aws.amazon.com/cn" target="_blank" rel="noopener noreferrer">亚马逊 AWS</a></li><li><a href="https://cloud.baidu.com" target="_blank" rel="noopener noreferrer">百度云</a></li></ul><h3 id="_1-4-购买阿里云" tabindex="-1"><a class="header-anchor" href="#_1-4-购买阿里云"><span>1.4 购买阿里云</span></a></h3><ul><li>[选择配置](https://ecs-buy.aliyun.com/wizard/</li><li>镜像 Ubuntu 16.04 64位</li></ul><h3 id="_1-5-备案" tabindex="-1"><a class="header-anchor" href="#_1-5-备案"><span>1.5 备案</span></a></h3><ul><li><a href="https://beian.aliyun.com" target="_blank" rel="noopener noreferrer">阿里云备案</a></li><li>[备案服务号管理](https://bsn.console.aliyun.com/</li></ul><h2 id="_2-服务器" tabindex="-1"><a class="header-anchor" href="#_2-服务器"><span>2. 服务器</span></a></h2><ul><li><a href="http://img.zhufengpeixun.cn/Xshell4.zip" target="_blank" rel="noopener noreferrer">Xshell4</a></li><li>使用<code>git bash</code>而非<code>git cmd</code></li></ul><h3 id="_2-1-连接服务器" tabindex="-1"><a class="header-anchor" href="#_2-1-连接服务器"><span>2.1 连接服务器</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">ssh root@<span class="token number">47.104</span><span class="token number">.75</span><span class="token number">.43</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-2-创建用户" tabindex="-1"><a class="header-anchor" href="#_2-2-创建用户"><span>2.2 创建用户</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">adduser zhufeng</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-3-赋予权限" tabindex="-1"><a class="header-anchor" href="#_2-3-赋予权限"><span>2.3 赋予权限</span></a></h3><p><code>gpasswd</code>命令是Linux下工作组文件<code>/etc/group</code>和<code>/etc/gshadow</code>管理工具。</p><ul><li><code>-a</code>: 添加用户到组</li><li><code>-d</code>: 从组删除用户</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">gpasswd -a zhufeng sudo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-4-添加sudo权限" tabindex="-1"><a class="header-anchor" href="#_2-4-添加sudo权限"><span>2.4 添加sudo权限</span></a></h3><ul><li>Linux用户配置sudo权限<code>visudo</code>,如果你用<code>visudo</code>来编辑这个文件，那么它会帮你自动做很多事情，比如说语法检查，加锁防止别人同时修改这个文件等等</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo visudo</span>
<span class="line">vi /etc/sudoers</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>visudo其实是打开/etc/sudoers</p></blockquote><p>增加以下内容</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">zhufeng ALL=(ALL:ALL) ALL</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>1 &quot;From ALL hosts&quot;, zhufeng 从任何机器登录，都可以应用接下来的规则</li><li>2 &quot;Run As ALL User&quot;, zhufeng&quot;可以以任何用户的身份运行一些命令</li><li>3 &quot;Run As All Groups&quot;, zhufeng&quot;可以以任何用户组的身份运行一些命令</li><li>4 前面的规定适用于任何命令</li></ul><blockquote><p><code>zhufeng</code>这个用户可以从任何机器登录，以任何用户和用户组的身份运行任何命令。 保存并退出</p></blockquote><h3 id="_2-5-ssh无密码登录" tabindex="-1"><a class="header-anchor" href="#_2-5-ssh无密码登录"><span>2.5 SSH无密码登录</span></a></h3><p>ssh 公钥认证是ssh认证的方式之一。通过公钥认证可实现ssh免密码登陆，git的ssh方式也是通过公钥进行认证的。</p><h4 id="_2-5-1-本地生成公钥和私钥" tabindex="-1"><a class="header-anchor" href="#_2-5-1-本地生成公钥和私钥"><span>2.5.1 本地生成公钥和私钥</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">ssh-keygen --help</span>
<span class="line">cd ~/.ssh</span>
<span class="line">ssh-keygen -t rsa -b 4096</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>-t 指定加密方式</li><li>-b 字节数</li></ul><h4 id="_2-5-2-开启ssh代理" tabindex="-1"><a class="header-anchor" href="#_2-5-2-开启ssh代理"><span>2.5.2 开启ssh代理</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">eval <span class="token string">&quot;$(ssh-agent -s)&quot;</span></span>
<span class="line">ssh<span class="token operator">-</span>add <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>id_rsa</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-3-服务器配置" tabindex="-1"><a class="header-anchor" href="#_2-5-3-服务器配置"><span>2.5.3 服务器配置</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">ssh<span class="token operator">-</span>keygen <span class="token operator">-</span>t rsa <span class="token operator">-</span>b <span class="token number">4096</span></span>
<span class="line">eval <span class="token string">&quot;$(ssh-agent -s)&quot;</span></span>
<span class="line">ssh<span class="token operator">-</span>add <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>id_rsa</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-4-把本地的公钥上传到服务器授权文件中" tabindex="-1"><a class="header-anchor" href="#_2-5-4-把本地的公钥上传到服务器授权文件中"><span>2.5.4 把本地的公钥上传到服务器授权文件中</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">vi <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>authorized_keys</span>
<span class="line">chmod <span class="token number">600</span> <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>authorized_keys</span>
<span class="line">service ssh restart</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-安装软件" tabindex="-1"><a class="header-anchor" href="#_2-6-安装软件"><span>2.6 安装软件</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">apt<span class="token operator">-</span><span class="token keyword">get</span> update</span>
<span class="line">apt<span class="token operator">-</span><span class="token keyword">get</span> install wget curl git <span class="token operator">-</span>y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-7-安装node" tabindex="-1"><a class="header-anchor" href="#_2-7-安装node"><span>2.7 安装node</span></a></h3><ul><li><p><a href="https://github.com/creationix/nvm/blob/master/README.md" target="_blank" rel="noopener noreferrer">nvm</a></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">wget <span class="token operator">-</span>qO<span class="token operator">-</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>creationix<span class="token operator">/</span>nvm<span class="token operator">/</span>v0<span class="token punctuation">.</span><span class="token number">33.11</span><span class="token operator">/</span>install<span class="token punctuation">.</span>sh <span class="token operator">|</span> bash</span>
<span class="line"><span class="token punctuation">.</span> <span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>bashrc</span>
<span class="line">nvm install stable</span>
<span class="line">node <span class="token operator">-</span>v</span>
<span class="line">npm i cnpm <span class="token operator">-</span>g</span>
<span class="line">npm i nrm <span class="token operator">-</span>g</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_2-8-编写node程序" tabindex="-1"><a class="header-anchor" href="#_2-8-编写node程序"><span>2.8 编写node程序</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;Hello World\\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-9-启动程序" tabindex="-1"><a class="header-anchor" href="#_2-9-启动程序"><span>2.9 启动程序</span></a></h3><p>强大的进程管理器，进程异常退出时pm2会尝试重启</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm install pm2 -g</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>用pm2启动node |命令|用途| |:----|:----| |pm2 start blog.js --name &quot;blog&quot;|启动应用| |pm2 list|查看所有应用| |pm2 restart crawl|重启应用| |pm2 stop crawl|停止应用| |pm2 delete crawl|删除应用|</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">pm2 start blog<span class="token punctuation">.</span>js <span class="token operator">--</span>name <span class="token string">&quot;blog&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-10-nginx" tabindex="-1"><a class="header-anchor" href="#_2-10-nginx"><span>2.10 nginx</span></a></h3><ul><li><code>Nginx</code>是一个高性能的<code>HTTP</code>和反向代理服务器</li></ul><h4 id="_2-10-1-安装" tabindex="-1"><a class="header-anchor" href="#_2-10-1-安装"><span>2.10.1 安装</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">apt<span class="token operator">-</span><span class="token keyword">get</span> install nginx <span class="token operator">-</span>y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-10-2-nginx命令" tabindex="-1"><a class="header-anchor" href="#_2-10-2-nginx命令"><span>2.10.2 nginx命令</span></a></h4><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">命令</th></tr></thead><tbody><tr><td style="text-align:left;">启动nginx</td><td style="text-align:left;">nginx -c /etc/nginx/nginx.conf</td></tr><tr><td style="text-align:left;">关闭 nginx</td><td style="text-align:left;">nginx -s stop</td></tr><tr><td style="text-align:left;">重读配置文件</td><td style="text-align:left;">nginx -s reload / kill -HUP nginx</td></tr><tr><td style="text-align:left;">常用命令</td><td style="text-align:left;">service nginx {start</td></tr></tbody></table><h4 id="_2-10-3-nginx配置" tabindex="-1"><a class="header-anchor" href="#_2-10-3-nginx配置"><span>2.10.3 nginx配置</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cd /etc/nginx/sites-enabled</span>
<span class="line">vi blog.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">upstream blog<span class="token punctuation">{</span></span>
<span class="line">    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">3000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">server <span class="token punctuation">{</span></span>
<span class="line">    listen <span class="token number">80</span><span class="token punctuation">;</span></span>
<span class="line">    server_name <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span></span>
<span class="line">    location <span class="token operator">/</span> <span class="token punctuation">{</span></span>
<span class="line">        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>blog<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-10-4-重启nginx" tabindex="-1"><a class="header-anchor" href="#_2-10-4-重启nginx"><span>2.10.4 重启nginx</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> nginx -s reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-docker-是什么" tabindex="-1"><a class="header-anchor" href="#_3-docker-是什么"><span>3. Docker 是什么</span></a></h2><ul><li>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口</li></ul><h3 id="_3-1-docker安装" tabindex="-1"><a class="header-anchor" href="#_3-1-docker安装"><span>3.1 docker安装</span></a></h3><ul><li>docker分为企业版(EE)和社区版(CE)</li><li><a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener noreferrer">docker-ce</a></li><li><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">hub.docker</a></li></ul><h3 id="_3-2-安装" tabindex="-1"><a class="header-anchor" href="#_3-2-安装"><span>3.2 安装</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils   device<span class="token operator">-</span>mapper<span class="token operator">-</span>persistent<span class="token operator">-</span>data   lvm2</span>
<span class="line">yum<span class="token operator">-</span>config<span class="token operator">-</span>manager     <span class="token operator">--</span>add<span class="token operator">-</span>repo     https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo</span>
<span class="line">yum install docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-启动" tabindex="-1"><a class="header-anchor" href="#_3-3-启动"><span>3.3 启动</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl start docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-4-查看docker版本" tabindex="-1"><a class="header-anchor" href="#_3-4-查看docker版本"><span>3.4 查看docker版本</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$ docker version</span>
<span class="line">$ docker info</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-卸载" tabindex="-1"><a class="header-anchor" href="#_3-5-卸载"><span>3.5 卸载</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker info</span>
<span class="line">yum remove docker</span>
<span class="line">rm <span class="token operator">-</span>rf <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-docker架构" tabindex="-1"><a class="header-anchor" href="#_3-6-docker架构"><span>3.6 Docker架构</span></a></h3><p><img src="http://img.zhufengpeixun.cn/docker-arch.jpg" alt="docker"></p><h3 id="_3-7-阿里云加速" tabindex="-1"><a class="header-anchor" href="#_3-7-阿里云加速"><span>3.7 阿里云加速</span></a></h3><ul><li><a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener noreferrer">镜像仓库</a></li><li><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener noreferrer">镜像加速器</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir -p /etc/docker</span>
<span class="line">tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;</span>
<span class="line">{</span>
<span class="line">  &quot;registry-mirrors&quot;: [&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;]</span>
<span class="line">}</span>
<span class="line">EOF</span>
<span class="line"></span>
<span class="line"> </span>
<span class="line">systemctl daemon-reload</span>
<span class="line">systemctl restart docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动服务</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker run ubuntu <span class="token operator">/</span>bin<span class="token operator">/</span>echo <span class="token string">&quot;Hello world&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>docker: Docker 的二进制执行文件</li><li>run:与前面的 docker 组合来运行一个容器</li><li>ubuntu指定要运行的镜像，Docker首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像</li><li><code>/bin/echo &quot;Hello world&quot;</code>: 在启动的容器里执行的命令</li></ul><h3 id="_3-8-启动node服务" tabindex="-1"><a class="header-anchor" href="#_3-8-启动node服务"><span>3.8 启动node服务</span></a></h3><h4 id="_3-8-1-dockerfile" tabindex="-1"><a class="header-anchor" href="#_3-8-1-dockerfile"><span>3.8.1 Dockerfile</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">FROM</span> node</span>
<span class="line"><span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>app <span class="token operator">/</span>app</span>
<span class="line"><span class="token constant">WORKDIR</span> <span class="token operator">/</span>app</span>
<span class="line"><span class="token constant">RUN</span> npm install</span>
<span class="line"><span class="token constant">EXPOSE</span> <span class="token number">3000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>FROM 表示该镜像继承的镜像 :表示标签</li><li>COPY 是将当前目录下的app目录下面的文件都拷贝到image里的/app目录中</li><li>WORKDIR 指定工作路径，类似于执行 cd 命令</li><li>RUN npm install 在/app目录下安装依赖，安装后的依赖也会打包到image目录中</li><li>EXPOSE 暴露3000端口，允许外部连接这个端口</li></ul><h4 id="_3-8-2-创建image" tabindex="-1"><a class="header-anchor" href="#_3-8-2-创建image"><span>3.8.2 创建image</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker build -t zhufengblog .</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>-t用来指定image镜像的名称，后面还可以加冒号指定标签，如果不指定默认就是latest</li><li>. 表示Dockerfile文件的所有路径,.就表示当前路径</li></ul><h4 id="_3-8-3-使用新的镜像运行容器" tabindex="-1"><a class="header-anchor" href="#_3-8-3-使用新的镜像运行容器"><span>3.8.3 使用新的镜像运行容器</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">docker container run <span class="token operator">-</span>p <span class="token number">3333</span><span class="token operator">:</span><span class="token number">3000</span> <span class="token operator">-</span>it zhufengblog <span class="token operator">/</span>bin<span class="token operator">/</span>bash</span>
<span class="line">npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>-p 参数是将容器的<code>3000</code>端口映射为本机的<code>3333</code>端口</li><li>-it 参数是将容器的shell容器映射为当前的shell,在本机容器中执行的命令都会发送到容器当中执行</li><li>zhufengblog image的名称</li><li>/bin/bash 容器启动后执行的第一个命令,这里是启动了bash容器以便执行脚本</li></ul><h4 id="_3-8-4-cmd" tabindex="-1"><a class="header-anchor" href="#_3-8-4-cmd"><span>3.8.4 CMD</span></a></h4><p>Dockerfile</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ CMD npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重新制作镜像</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker build -t zhufengblog .</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>RUN命令在 image 文件的构建阶段执行，执行结果都会打包进入 image 文件</li><li>CMD命令则是在容器启动后执行</li><li>一个 Dockerfile 可以包含多个RUN命令，但是只能有一个CMD命令</li><li>指定了CMD命令以后，<code>docker container run</code>命令就不能附加命令了(比如前面的/bin/bash),否则它会覆盖CMD命令</li></ul>`,97)])])}const c=a(t,[["render",i]]),o=JSON.parse('{"path":"/strong/40.deploy.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/40.deploy.md"}');export{c as comp,o as data};
