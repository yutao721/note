import{_ as n,c as a,a as p,o as e}from"./app-CD1YpnS1.js";const t={};function o(l,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="_1-初始化项目" tabindex="-1"><a class="header-anchor" href="#_1-初始化项目"><span>1. 初始化项目</span></a></h2><ul><li><a href="https://umijs.org/zh/guide/create-umi-app.html" target="_blank" rel="noopener noreferrer">create-umi-app</a></li><li><a href="https://ant.design/docs/react/introduce-cn" target="_blank" rel="noopener noreferrer">ant.design</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$ mkdir myapp &amp;&amp; cd myapp</span>
<span class="line">$ yarn create umi</span>
<span class="line">$ cnpm i styled-components jsonwebtoken -S</span>
<span class="line">$ npm start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-配置别名" tabindex="-1"><a class="header-anchor" href="#_2-配置别名"><span>2. 配置别名</span></a></h2><p>.webpackrc.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span><span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;alias&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-注册登录" tabindex="-1"><a class="header-anchor" href="#_3-注册登录"><span>3. 注册登录</span></a></h2><p><img src="http://img.zhufengpeixun.cn/loginregister.png" alt="注册"></p><h3 id="_3-1-login-index-js" tabindex="-1"><a class="header-anchor" href="#_3-1-login-index-js"><span>3.1 login/index.js</span></a></h3><h4 id="_3-1-1-login" tabindex="-1"><a class="header-anchor" href="#_3-1-1-login"><span>3.1.1 Login</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Layout<span class="token punctuation">,</span>Form<span class="token punctuation">,</span>Input<span class="token punctuation">,</span>Radio<span class="token punctuation">,</span>Cascader<span class="token punctuation">,</span>Select<span class="token punctuation">,</span>AutoComplete<span class="token punctuation">,</span>Checkbox<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>message<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">&#39;styled-components&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva&#39;</span><span class="token punctuation">;</span><span class="token comment">//react-redux 是用来连接仓库和组件</span></span>
<span class="line"><span class="token keyword">import</span> addresses <span class="token keyword">from</span> <span class="token string">&#39;../../utils/addresses&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> getFieldItems <span class="token keyword">from</span> <span class="token string">&#39;../../utils/getFieldItems&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Header<span class="token punctuation">,</span> Footer<span class="token punctuation">,</span> Sider<span class="token punctuation">,</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> FormItem <span class="token operator">=</span> Form<span class="token punctuation">.</span>Item<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>Option<span class="token punctuation">}</span> <span class="token operator">=</span> Select<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">handleSubmit</span><span class="token operator">=</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>userForm<span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;输入不合法!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isLogin<span class="token operator">?</span><span class="token string">&#39;login/login&#39;</span><span class="token operator">:</span><span class="token string">&#39;login/signup&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span>values<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">changeLoginStatus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;login/save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">isLogin</span><span class="token operator">:</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isLogin<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">           <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Content<span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span>LoginForm</span>
<span class="line">                 isLogin<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isLogin<span class="token punctuation">}</span></span>
<span class="line">                 changeLoginStatus<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeLoginStatus<span class="token punctuation">}</span></span>
<span class="line">                 handleSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span></span>
<span class="line">                 wrappedComponentRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">inst</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userForm<span class="token operator">=</span>inst<span class="token punctuation">}</span></span>
<span class="line">                 handleSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span></span>
<span class="line">              <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">           <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">       <span class="token punctuation">)</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-loginform" tabindex="-1"><a class="header-anchor" href="#_3-1-2-loginform"><span>3.1.2 LoginForm</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    state <span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">gender</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">autoCompleteResult</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token literal-property property">repasswordDirty</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">handleWebsiteChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//1 [1.com,1.cn,1.org]</span></span>
<span class="line">      <span class="token keyword">let</span> autoCompleteResult<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        autoCompleteResult <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;.com&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.cn&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.org&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">domain</span><span class="token operator">=&gt;</span>value<span class="token operator">+</span>domain<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>autoCompleteResult<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">compareWithRepassword</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span>value<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>repasswordDirty<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;repassword&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">force</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">compareWithPassword</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span>value<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//自定义校验器 规则 最新的值 回调</span></span>
<span class="line">       <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">;</span></span>
<span class="line">       <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> form<span class="token punctuation">.</span><span class="token function">getFieldValue</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">&#39;密码和确认密码不一致&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">       <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">           <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">       <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">repasswordChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">repasswordDirty</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>repasswordDirty<span class="token operator">||</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//一旦把组件用Form.create包裹</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token literal-property property">form</span><span class="token operator">:</span><span class="token punctuation">{</span>getFieldDecorator<span class="token punctuation">}</span><span class="token punctuation">,</span>isLogin<span class="token punctuation">,</span>handleSubmit<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> formTailItemLayout <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">wrapperCol</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">offset</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token literal-property property">span</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">let</span> countrySelector <span class="token operator">=</span> <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;prefix&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">initialValue</span><span class="token operator">:</span><span class="token string">&#39;086&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Select style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Option value<span class="token operator">=</span><span class="token string">&quot;086&quot;</span><span class="token operator">&gt;</span><span class="token number">086</span><span class="token operator">&lt;</span><span class="token operator">/</span>Option<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Option value<span class="token operator">=</span><span class="token string">&quot;087&quot;</span><span class="token operator">&gt;</span><span class="token number">087</span><span class="token operator">&lt;</span><span class="token operator">/</span>Option<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Option value<span class="token operator">=</span><span class="token string">&quot;088&quot;</span><span class="token operator">&gt;</span><span class="token number">088</span><span class="token operator">&lt;</span><span class="token operator">/</span>Option<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Select<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> websiteOptions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>autoCompleteResult<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>AutoComplete<span class="token punctuation">.</span>Option key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>AutoComplete<span class="token punctuation">.</span>Option<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> websiteField <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>AutoComplete onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleWebsiteChange<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">{</span>websiteOptions<span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>AutoComplete<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">let</span> genderField <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Radio<span class="token punctuation">.</span>Group <span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Radio value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>男<span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Radio value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>女<span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Radio<span class="token punctuation">.</span>Group<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">let</span> filedItems <span class="token operator">=</span> <span class="token function">getFieldItems</span><span class="token punctuation">(</span>getFieldDecorator<span class="token punctuation">,</span><span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">&lt;</span>Input<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">&lt;</span>Input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>repasswordChange<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token literal-property property">validator</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>compareWithRepassword<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token literal-property property">min</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&#39;密码长度最短1位&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token literal-property property">max</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&#39;密码长度最长8位&#39;</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span>isLogin<span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;确认密码&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;repassword&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">&lt;</span>Input<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token literal-property property">validator</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>compareWithPassword<span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span>isLogin<span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;邮箱&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">&lt;</span>Input<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&#39;必须输入一个合法的邮箱!&#39;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span>isLogin<span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;性别&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span>genderField<span class="token punctuation">,</span><span class="token literal-property property">extra</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">initialValue</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span>isLogin<span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;住址&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">&lt;</span>Cascader options<span class="token operator">=</span><span class="token punctuation">{</span>addresses<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span>isLogin<span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;手机号&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">pattern</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^1\\d{10}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&#39;请输入合法手机号&#39;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">&lt;</span>Input addonBefore<span class="token operator">=</span><span class="token punctuation">{</span>countrySelector<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span>isLogin<span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">&quot;网址&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;website&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span>websiteField<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span>isLogin<span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;agreement&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">layout</span><span class="token operator">:</span>formTailItemLayout<span class="token punctuation">,</span><span class="token literal-property property">input</span><span class="token operator">:</span><span class="token operator">&lt;</span>Checkbox<span class="token operator">&gt;</span>我已经同意本协议<span class="token operator">&lt;</span><span class="token operator">/</span>Checkbox<span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token literal-property property">extra</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">valuePropName</span><span class="token operator">:</span><span class="token string">&#39;checked&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>FormWrapper<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">&#39;500px&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span> onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>欢迎<span class="token punctuation">{</span>isLogin<span class="token operator">?</span><span class="token string">&quot;登录&quot;</span><span class="token operator">:</span><span class="token string">&quot;注册&quot;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span></span>
<span class="line">                     <span class="token punctuation">{</span>filedItems<span class="token punctuation">}</span></span>
<span class="line">                     <span class="token operator">&lt;</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                       <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>isLogin<span class="token operator">?</span><span class="token string">&quot;登录&quot;</span><span class="token operator">:</span><span class="token string">&quot;注册&quot;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                         已有账号<span class="token operator">?</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span>&quot;</span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>FormWrapper<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">LoginForm  <span class="token operator">=</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>LoginForm<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> FormWrapper <span class="token operator">=</span> styled<span class="token punctuation">.</span>div<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">  display:flex;</span>
<span class="line">  justify-content:center;</span>
<span class="line">  align-items:center;</span>
<span class="line">  height:calc(100vh - 70px );</span>
<span class="line">  h3{</span>
<span class="line">      text-align:center;</span>
<span class="line">  }</span>
<span class="line">  form{</span>
<span class="line">       border:1px solid </span>
<span class="line">      border-radius:5px;</span>
<span class="line">      padding:20px;</span>
<span class="line">  }</span>
<span class="line"></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line"><span class="token comment">//一般来说在dva里，一个页面路由组件会对应一个子状态 login</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>login</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">(</span>Login<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-3-getfielditems-js" tabindex="-1"><a class="header-anchor" href="#_3-1-3-getfielditems-js"><span>3.1.3 getFieldItems.js</span></a></h4><p>src\\utils\\getFieldItems.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Form<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> FormItem <span class="token operator">=</span> Form<span class="token punctuation">.</span>Item<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> formItemLayout <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token literal-property property">labelCol</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">span</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token literal-property property">wrapperCol</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">span</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getFieldItems</span><span class="token punctuation">(</span><span class="token parameter">getFieldDecorator<span class="token punctuation">,</span>fields</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//{label,name,rules,input}</span></span>
<span class="line">   <span class="token keyword">return</span> fields<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">field</span><span class="token operator">=&gt;</span>field<span class="token punctuation">.</span>visible<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">field<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token keyword">let</span> layout <span class="token operator">=</span> field<span class="token punctuation">.</span>layout<span class="token operator">?</span>field<span class="token punctuation">.</span>layout<span class="token operator">:</span>formItemLayout<span class="token punctuation">;</span></span>
<span class="line">       field<span class="token punctuation">.</span>extra <span class="token operator">=</span> field<span class="token punctuation">.</span>extra<span class="token operator">||</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">       field<span class="token punctuation">.</span>rules <span class="token operator">=</span> field<span class="token punctuation">.</span>rules<span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">       <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">           <span class="token operator">&lt;</span>FormItem key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span> label<span class="token operator">=</span><span class="token punctuation">{</span>field<span class="token punctuation">.</span>label<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>layout<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">                            <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">required</span><span class="token operator">:</span>field<span class="token punctuation">.</span>required<span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>field<span class="token punctuation">.</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">必须输入</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">...</span>field<span class="token punctuation">.</span>rules<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token operator">...</span>field<span class="token punctuation">.</span>extra</span>
<span class="line">                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>input<span class="token punctuation">)</span></span>
<span class="line">                      <span class="token punctuation">}</span></span>
<span class="line">           <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">       <span class="token punctuation">)</span></span>
<span class="line">   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> getFieldItems<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-4-addresses-js" tabindex="-1"><a class="header-anchor" href="#_3-1-4-addresses-js"><span>3.1.4 addresses.js</span></a></h4><p>src\\utils\\addresses.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span>  <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">&#39;guangdong&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;广东&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">&#39;guangzhou&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;广州&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">&#39;dongguan&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;东莞&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">&#39;shandong&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;山东&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">&#39;jinan&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;济南&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">&#39;shouguang&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;寿光&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">]</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-4-utils-request-js" tabindex="-1"><a class="header-anchor" href="#_3-1-4-utils-request-js"><span>3.1.4 utils/request.js</span></a></h4><p>src/utils/request.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> fetch <span class="token keyword">from</span> <span class="token string">&#39;dva/fetch&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">&#39;http://127.0.0.1:7001&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  options<span class="token punctuation">.</span>headers <span class="token operator">=</span> options<span class="token punctuation">.</span>headers <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    options<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization <span class="token operator">=</span> token<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  options<span class="token punctuation">.</span>method <span class="token operator">=</span> options<span class="token punctuation">.</span>method <span class="token operator">||</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  options<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  options<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  options<span class="token punctuation">.</span>credentials <span class="token operator">=</span> <span class="token string">&#39;include&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">BASE_URL</span> <span class="token operator">+</span> url<span class="token punctuation">,</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-models-login-js" tabindex="-1"><a class="header-anchor" href="#_3-3-models-login-js"><span>3.3 models/login.js</span></a></h3><p>src/pages/login/models/login.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> service <span class="token keyword">from</span> <span class="token string">&#39;../services/login&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>decode<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>routerRedux<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">namespace</span><span class="token operator">:</span><span class="token string">&#39;login&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">isLogin</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否正在注册</span></span>
<span class="line">      <span class="token literal-property property">errorInfo</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span><span class="token comment">//放着报错信息</span></span>
<span class="line">      <span class="token literal-property property">userInfo</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token comment">//如果用户登录之后，会把用户信息放在这里</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">effects</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token operator">*</span><span class="token function">signup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>signup<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">         <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">isLogin</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">          message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;注册失败!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token operator">*</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span>  result <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>login<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span>userInfo<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span>routerRedux<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/admin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">          message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;登录失败!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token operator">*</span><span class="token function">loadUser</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> token<span class="token operator">=</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span>userInfo<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span>routerRedux<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">reducers</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span><span class="token operator">...</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-login-services-login-js" tabindex="-1"><a class="header-anchor" href="#_3-4-login-services-login-js"><span>3.4 login/services/login.js</span></a></h3><p>src/pages/login/services/login.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">&#39;../../../utils/request&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//定义一个注册的方法,调用api接口</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">signup</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&#39;/api/signup&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">body</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//定义一个登陆的方法</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/signin</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">body</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-验证码" tabindex="-1"><a class="header-anchor" href="#_4-验证码"><span>4.验证码</span></a></h2><h3 id="_4-1-login-index-js" tabindex="-1"><a class="header-anchor" href="#_4-1-login-index-js"><span>4.1 login/index.js</span></a></h3><p>src/pages/login/index.js LoginForm</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ import getFieldItems,{formItemLayout} from &#39;../../utils/getFieldItems&#39;;</span>
<span class="line"></span>
<span class="line">+ const captchaUrl=\`http://127.0.0.1:7001/api/captcha?ts=\`;</span>
<span class="line"></span>
<span class="line">+ refreshCaptcha = (event)=&gt;{</span>
<span class="line">+     event.target.src = captchaUrl+Date.now();</span>
<span class="line">+ }</span>
<span class="line"></span>
<span class="line">+ &lt;FormItem label=&quot;验证码&quot; {...formItemLayout} extra=&quot;证明你不是机器人&quot;&gt;</span>
<span class="line">+      &lt;Row gutter={8}&gt;</span>
<span class="line">+           &lt;Col span={12}&gt;</span>
<span class="line">+               {</span>
<span class="line">+                   getFieldDecorator(&#39;captcha&#39;,{</span>
<span class="line">+                       rules: [{required:true,message:&#39;必须输入验证码&#39;}]</span>
<span class="line">+                   })(&lt;Input /&gt;)</span>
<span class="line">+               }</span>
<span class="line">+           &lt;/Col&gt;</span>
<span class="line">+           &lt;Col span={12}&gt;</span>
<span class="line">+                  &lt;img src={captchaUrl} onClick={this.refreshCaptcha}/&gt;</span>
<span class="line">+           &lt;/Col&gt;</span>
<span class="line">+     &lt;/Row&gt;</span>
<span class="line">+ &lt;/FormItem&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-后台管理界面布局模版" tabindex="-1"><a class="header-anchor" href="#_5-后台管理界面布局模版"><span>5.后台管理界面布局模版</span></a></h2><h3 id="_5-1-admin-layout-js" tabindex="-1"><a class="header-anchor" href="#_5-1-admin-layout-js"><span>5.1 /admin/_layout.js</span></a></h3><p>src/pages/admin/_layout.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">,</span>Fragment<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Layout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Header<span class="token punctuation">,</span> Footer<span class="token punctuation">,</span> Sider<span class="token punctuation">,</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Admin</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Header<span class="token operator">&gt;</span>Header<span class="token operator">&lt;</span><span class="token operator">/</span>Header<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Sider<span class="token operator">&gt;</span>Sider<span class="token operator">&lt;</span><span class="token operator">/</span>Sider<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Content<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Footer<span class="token operator">&gt;</span></span>
<span class="line">                   珠峰培训 ©<span class="token number">2018</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Footer<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">       <span class="token punctuation">)</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-顶部导航条" tabindex="-1"><a class="header-anchor" href="#_6-顶部导航条"><span>6. 顶部导航条</span></a></h2><p><img src="http://img.zhufengpeixun.cn/adminheader.png" alt="adminheader"></p><h3 id="_6-1-components-adminheader-index-js" tabindex="-1"><a class="header-anchor" href="#_6-1-components-adminheader-index-js"><span>6.1 components\\AdminHeader\\index.js</span></a></h3><p>src\\components\\AdminHeader\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Layout<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&#39;./index.less&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>Header<span class="token punctuation">}</span><span class="token operator">=</span>Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">AdminHeader</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;login/loadUser&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span>userInfo<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Header className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>header<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>img className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>logo<span class="token punctuation">}</span> src<span class="token operator">=</span><span class="token string">&quot;http://img.zhufengpeixun.cn/zfpxlogo.png&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>welcome<span class="token punctuation">}</span><span class="token operator">&gt;</span>欢迎登录 <span class="token punctuation">{</span>userInfo<span class="token operator">&amp;&amp;</span>userInfo<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Header<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>login</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">(</span>AdminHeader<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-components-adminheader-index-less" tabindex="-1"><a class="header-anchor" href="#_6-2-components-adminheader-index-less"><span>6.2 components\\AdminHeader\\index.less</span></a></h3><p>src\\components\\AdminHeader\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">.</span>logo<span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">width</span><span class="token operator">:</span>120px<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">height</span><span class="token operator">:</span>32px<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">margin</span><span class="token operator">:</span>16px<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">float</span><span class="token operator">:</span>left<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">.</span>welcome<span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">float</span><span class="token operator">:</span>right<span class="token punctuation">;</span></span>
<span class="line">     <span class="token literal-property property">color</span><span class="token operator">:</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-admin-layout-js" tabindex="-1"><a class="header-anchor" href="#_6-3-admin-layout-js"><span>6.3 admin/_layout.js</span></a></h3><p>src/pages/admin/_layout.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Layout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> AdminHeader <span class="token keyword">from</span> <span class="token string">&#39;../../components/AdminHeader&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>Footer<span class="token punctuation">,</span>Sider<span class="token punctuation">,</span>Content<span class="token punctuation">}</span><span class="token operator">=</span>Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Admin</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>AdminHeader<span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Sider<span class="token operator">&gt;</span>Sider<span class="token operator">&lt;</span><span class="token operator">/</span>Sider<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Content<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Footer<span class="token operator">&gt;</span></span>
<span class="line">                   珠峰架构 ©<span class="token number">2018</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Footer<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">       <span class="token punctuation">)</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-左侧菜单和用户页面" tabindex="-1"><a class="header-anchor" href="#_7-左侧菜单和用户页面"><span>7.左侧菜单和用户页面</span></a></h2><p><img src="http://img.zhufengpeixun.cn/resources.png" alt="resources"></p><p><img src="http://img.zhufengpeixun.cn/leftmenus.png" alt="leftmenus"></p><h3 id="_7-1-components-menulist-js" tabindex="-1"><a class="header-anchor" href="#_7-1-components-menulist-js"><span>7.1 components/MenuList.js</span></a></h3><p>src/components/MenuList.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">,</span>Fragment<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Menu<span class="token punctuation">,</span>Icon<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">&#39;umi/link&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> SubMenu<span class="token operator">=</span>Menu<span class="token punctuation">.</span>SubMenu<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MenuList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">renderMenus</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">resources<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> resources<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">resource</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">                    <span class="token operator">&lt;</span>SubMenu key<span class="token operator">=</span><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>key<span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>icon<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderMenus</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>SubMenu<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">)</span>    </span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>key<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>icon<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>resource<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span>userInfo<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>userInfo<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Menu</span>
<span class="line">                theme<span class="token operator">=</span><span class="token string">&quot;dark&quot;</span></span>
<span class="line">                defaultSelectedKeys<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;/admin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                defaultOpenKeys<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token string">&#39;/admin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                mode<span class="token operator">=</span><span class="token string">&quot;inline&quot;</span></span>
<span class="line">            <span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderMenus</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>resources<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>login</span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">(</span>MenuList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>app\\controller\\user.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">   <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">SELECT resource.* FROM role_user,role_resource,resource where role_user.role_id = role_resource.role_id AND role_resource.resource_id = resource.id AND role_user.user_id = ? ORDER BY resource.id ASC</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> resources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">      list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          item<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">          map<span class="token punctuation">[</span>item<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>parent_id <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            resources<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            map<span class="token punctuation">[</span>item<span class="token punctuation">.</span>parent_id<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      user<span class="token punctuation">.</span>resources<span class="token operator">=</span>resources<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-admin-layout-js" tabindex="-1"><a class="header-anchor" href="#_7-2-admin-layout-js"><span>7.2 admin/_layout.js</span></a></h3><p>src/pages/admin/_layout.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Layout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> AdminHeader <span class="token keyword">from</span> <span class="token string">&#39;../../components/AdminHeader&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> MenuList <span class="token keyword">from</span> <span class="token string">&#39;../../components/MenuList&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>Footer<span class="token punctuation">,</span>Sider<span class="token punctuation">,</span>Content<span class="token punctuation">}</span><span class="token operator">=</span>Layout<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Admin</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>AdminHeader<span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Sider<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>MenuList<span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Sider<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Content<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Content<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Footer<span class="token operator">&gt;</span></span>
<span class="line">                   珠峰培训 ©<span class="token number">2018</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Footer<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span></span>
<span class="line">       <span class="token punctuation">)</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-用户管理" tabindex="-1"><a class="header-anchor" href="#_8-用户管理"><span>8. 用户管理</span></a></h2><h3 id="_8-1-用户列表" tabindex="-1"><a class="header-anchor" href="#_8-1-用户列表"><span>8.1 用户列表</span></a></h3><h4 id="_8-1-1-index-js" tabindex="-1"><a class="header-anchor" href="#_8-1-1-index-js"><span>8.1.1 index.js</span></a></h4><p>src\\pages\\admin\\user\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">,</span>Fragment<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Card<span class="token punctuation">,</span>Table<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>Modal<span class="token punctuation">,</span>Form<span class="token punctuation">,</span>Input<span class="token punctuation">,</span>message<span class="token punctuation">,</span>Popconfirm<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./constants&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> routerRedux <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> FormItem<span class="token operator">=</span>Form<span class="token punctuation">.</span>Item<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> </span>
<span class="line">@<span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span><span class="token literal-property property">loading</span><span class="token operator">:</span>state<span class="token punctuation">.</span>loading<span class="token punctuation">.</span>models<span class="token punctuation">.</span>user<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span> </span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">user</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> columns<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;用户名&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;username&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;email&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;性别&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&#39;gender&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;gender&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span></span>
<span class="line">                    val<span class="token operator">===</span><span class="token number">1</span><span class="token operator">?</span><span class="token string">&#39;男&#39;</span><span class="token operator">:</span><span class="token string">&#39;女&#39;</span></span>
<span class="line">                <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span>list<span class="token punctuation">,</span>loading<span class="token punctuation">,</span>pageNum<span class="token punctuation">,</span>total<span class="token punctuation">,</span>dispatch<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> pagination<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">current</span><span class="token operator">:</span> pageNum<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token constant">PAGE_SIZE</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">showQuickJumper</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">showTotal</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>range</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">共</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">条</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            total<span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">pageNum</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">dispatch</span><span class="token punctuation">(</span>routerRedux<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/admin/user?pageNum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pageNum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">         <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">             <span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Table</span>
<span class="line">                        columns<span class="token operator">=</span><span class="token punctuation">{</span>columns<span class="token punctuation">}</span></span>
<span class="line">                        dataSource<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span></span>
<span class="line">                        loading<span class="token operator">=</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span></span>
<span class="line">                        rowKey<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> record<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>
<span class="line">                        pagination<span class="token operator">=</span><span class="token punctuation">{</span>pagination<span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">         <span class="token punctuation">)</span></span>
<span class="line">     <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-1-2-constants-js" tabindex="-1"><a class="header-anchor" href="#_8-1-2-constants-js"><span>8.1.2 constants.js</span></a></h4><p>src\\pages\\admin\\user\\constants.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PAGE_SIZE</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_8-1-3-models-user-js" tabindex="-1"><a class="header-anchor" href="#_8-1-3-models-user-js"><span>8.1.3 models\\user.js</span></a></h4><p>src\\pages\\admin\\user\\models\\user.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> userService <span class="token keyword">from</span> <span class="token string">&#39;../services/user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">total</span><span class="token operator">:</span><span class="token number">0</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span><span class="token operator">...</span>payload<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>pageNum<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span>fetch<span class="token punctuation">,</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">debugger</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">               <span class="token keyword">let</span> <span class="token punctuation">{</span> list<span class="token punctuation">,</span>total<span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">               <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span>list<span class="token punctuation">,</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">,</span>total<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">subscriptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dispatch<span class="token punctuation">,</span>history<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>pathname<span class="token punctuation">,</span>query<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token operator">===</span><span class="token string">&#39;/admin/user&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span>query<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-1-4-services-user-js" tabindex="-1"><a class="header-anchor" href="#_8-1-4-services-user-js"><span>8.1.4 services\\user.js</span></a></h4><p>src\\pages\\admin\\user\\services\\user.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">&#39;@/utils/request&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../constants&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">pageNum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/user?pageNum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pageNum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;pageSize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">PAGE_SIZE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-新增和编辑用户" tabindex="-1"><a class="header-anchor" href="#_8-2-新增和编辑用户"><span>8.2 新增和编辑用户</span></a></h3><h4 id="_8-1-1-index-js-1" tabindex="-1"><a class="header-anchor" href="#_8-1-1-index-js-1"><span>8.1.1 index.js</span></a></h4><p>src\\pages\\admin\\user\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">,</span>Fragment<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Card<span class="token punctuation">,</span>Table<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>Modal<span class="token punctuation">,</span>Form<span class="token punctuation">,</span>Input<span class="token punctuation">,</span>message<span class="token punctuation">,</span>Popconfirm<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./constants&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> routerRedux <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> FormItem<span class="token operator">=</span>Form<span class="token punctuation">.</span>Item<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> </span>
<span class="line">@<span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span><span class="token literal-property property">loading</span><span class="token operator">:</span>state<span class="token punctuation">.</span>loading<span class="token punctuation">.</span>models<span class="token punctuation">.</span>user<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span> </span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">user</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>     <span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            type<span class="token operator">:</span> <span class="token string">&#39;user/save&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>            payload</span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>     <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>     <span class="token function-variable function">onAdd</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">isCreate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">record</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>     <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>     <span class="token function-variable function">onEditCancel</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">editVisible</span> <span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token function-variable function">onEdit</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">isCreate</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>record<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token function-variable function">onEditOk</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>editForm<span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;表单校验失败!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                    type<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isCreate<span class="token operator">?</span><span class="token string">&#39;user/create&#39;</span><span class="token operator">:</span><span class="token string">&#39;user/update&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                    payload<span class="token operator">:</span>values</span>
<span class="line"><span class="token operator">+</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span></span>
<span class="line">     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> columns<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;用户名&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;username&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;email&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;性别&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&#39;gender&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;gender&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span></span>
<span class="line">                    val<span class="token operator">===</span><span class="token number">1</span><span class="token operator">?</span><span class="token string">&#39;男&#39;</span><span class="token operator">:</span><span class="token string">&#39;女&#39;</span></span>
<span class="line">                <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                title<span class="token operator">:</span> <span class="token string">&#39;操作&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                key<span class="token operator">:</span> <span class="token string">&#39;operation&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span>Fragment<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                        <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;warning&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onEdit</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>编辑<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span>list<span class="token punctuation">,</span>loading<span class="token punctuation">,</span>pageNum<span class="token punctuation">,</span>total<span class="token punctuation">,</span>dispatch<span class="token punctuation">,</span>isCreate<span class="token punctuation">,</span>editVisible<span class="token punctuation">,</span>record<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> pagination<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">current</span><span class="token operator">:</span> pageNum<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token constant">PAGE_SIZE</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">showQuickJumper</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">showTotal</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>range</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">共</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">条</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            total<span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">pageNum</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">dispatch</span><span class="token punctuation">(</span>routerRedux<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/admin/user?pageNum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pageNum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">         <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">             <span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;warning&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onAdd<span class="token punctuation">}</span><span class="token operator">&gt;</span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Table</span>
<span class="line">                        columns<span class="token operator">=</span><span class="token punctuation">{</span>columns<span class="token punctuation">}</span></span>
<span class="line">                        dataSource<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span></span>
<span class="line">                        loading<span class="token operator">=</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span></span>
<span class="line">                        rowKey<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> record<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>
<span class="line">                        pagination<span class="token operator">=</span><span class="token punctuation">{</span>pagination<span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                 <span class="token operator">&lt;</span>EditModal</span>
<span class="line"><span class="token operator">+</span>                    wrappedComponentRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">instance</span> <span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>editForm<span class="token operator">=</span>instance<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    isCreate<span class="token operator">=</span><span class="token punctuation">{</span>isCreate<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    visible<span class="token operator">=</span><span class="token punctuation">{</span>editVisible<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    onOk<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onEditOk<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    onCancel<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onEditCancel<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">         <span class="token punctuation">)</span></span>
<span class="line">     <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>@Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">class</span> <span class="token class-name">EditModal</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>     <span class="token keyword">let</span> <span class="token punctuation">{</span>visible<span class="token punctuation">,</span>onOk<span class="token punctuation">,</span>isCreate<span class="token punctuation">,</span>onCancel<span class="token punctuation">,</span>record<span class="token punctuation">,</span><span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>getFieldDecorator<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span>username<span class="token punctuation">,</span>email<span class="token punctuation">,</span>id<span class="token punctuation">}</span><span class="token operator">=</span>record<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token operator">&lt;</span>Modal</span>
<span class="line"><span class="token operator">+</span>                title<span class="token operator">=</span><span class="token punctuation">{</span>isCreate<span class="token operator">?</span><span class="token string">&#39;创建用户&#39;</span><span class="token operator">:</span><span class="token string">&#39;修改用户&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                visible<span class="token operator">=</span><span class="token punctuation">{</span>visible<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                onOk<span class="token operator">=</span><span class="token punctuation">{</span>onOk<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                onCancel<span class="token operator">=</span><span class="token punctuation">{</span>onCancel<span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                destroyOnClose</span>
<span class="line"><span class="token operator">+</span>            <span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token operator">&lt;</span>Form<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                       <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                            <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                                initialValue<span class="token operator">:</span> id</span>
<span class="line"><span class="token operator">+</span>                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input type<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>                        <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span>FormItem</span>
<span class="line"><span class="token operator">+</span>                        label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                        <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                            <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                                rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                                    required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                                    message<span class="token operator">:</span><span class="token string">&#39;用户名必须输入&#39;</span></span>
<span class="line"><span class="token operator">+</span>                               <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                                initialValue<span class="token operator">:</span> username</span>
<span class="line"><span class="token operator">+</span>                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>                        <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span>FormItem label<span class="token operator">=</span><span class="token string">&quot;邮箱&quot;</span> <span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                        <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                            <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                                initialValue<span class="token operator">:</span> email<span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>                                rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&#39;用户名必须输入&#39;</span></span>
<span class="line"><span class="token operator">+</span>                            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>                        <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>                    <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token operator">&lt;</span><span class="token operator">/</span>Modal<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-1-2-models-user-js" tabindex="-1"><a class="header-anchor" href="#_8-1-2-models-user-js"><span>8.1.2 models/user.js</span></a></h4><p>src/pages/admin/user/models/user.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> userService <span class="token keyword">from</span> <span class="token string">&#39;../services/user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">total</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        editVisible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        isCreate<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        record<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span><span class="token operator">...</span>payload<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>pageNum<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span>fetch<span class="token punctuation">,</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">debugger</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">               <span class="token keyword">let</span> <span class="token punctuation">{</span> list<span class="token punctuation">,</span>total<span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">               <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span>list<span class="token punctuation">,</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">,</span>total<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token operator">*</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span>create<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token operator">*</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">,</span>select<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span>update<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">let</span> pageNum<span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>pageNum<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">subscriptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dispatch<span class="token punctuation">,</span>history<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>pathname<span class="token punctuation">,</span>query<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token operator">===</span><span class="token string">&#39;/admin/user&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span>query<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-1-3-services-user-js" tabindex="-1"><a class="header-anchor" href="#_8-1-3-services-user-js"><span>8.1.3 services/user.js</span></a></h4><p>src/pages/admin/user/services/user.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import request from &#39;@/utils/request&#39;;</span>
<span class="line">import {PAGE_SIZE} from &#39;../constants&#39;;</span>
<span class="line">export function fetch(pageNum) {</span>
<span class="line">    return request(\`/api/user?pageNum=\${pageNum}&amp;pageSize=\${PAGE_SIZE}\`);</span>
<span class="line">}</span>
<span class="line">+export function create(values) {</span>
<span class="line">+    return request(\`/api/user\`,{</span>
<span class="line">+        method: &#39;POST&#39;,</span>
<span class="line">+        headers:{&quot;Content-Type&quot;:&quot;application/json&quot;},</span>
<span class="line">+        body:JSON.stringify(values)</span>
<span class="line">+    });</span>
<span class="line">+}</span>
<span class="line">+export function update(values) {</span>
<span class="line">+   return request(\`/api/user/\${values.id}\`,{</span>
<span class="line">+        method: &#39;PUT&#39;,</span>
<span class="line">+        headers:{&quot;Content-Type&quot;:&quot;application/json&quot;},</span>
<span class="line">+        body:JSON.stringify(values)</span>
<span class="line">+    });</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-删除用户" tabindex="-1"><a class="header-anchor" href="#_8-3-删除用户"><span>8.3 删除用户</span></a></h3><h4 id="_8-3-1-index-js" tabindex="-1"><a class="header-anchor" href="#_8-3-1-index-js"><span>8.3.1 index.js</span></a></h4><p>src\\pages\\admin\\user\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+    onDel=(id) =&gt; {</span>
<span class="line">+        this.props.dispatch({</span>
<span class="line">+            type: &#39;user/del&#39;,</span>
<span class="line">+            payload:id</span>
<span class="line">+        });</span>
<span class="line">+   }</span>
<span class="line"></span>
<span class="line">   render: (val,record) =&gt; (</span>
<span class="line">       &lt;Fragment&gt;</span>
<span class="line">           &lt;Button type=&quot;warning&quot; onClick={()=&gt;this.onEdit(record)   &lt;/Button&gt;</span>
<span class="line">+           &lt;Popconfirm</span>
<span class="line">+               okText=&quot;确认&quot;</span>
<span class="line">+               cancelText=&quot;取消&quot;</span>
<span class="line">+               title=&quot;确认删除此用户吗?&quot;</span>
<span class="line">+               onConfirm={() =&gt; this.onDel(record.id)}&gt;</span>
<span class="line">+                 &lt;Button type=&quot;danger&quot;&gt;删除&lt;/Button&gt;</span>
<span class="line">+           &lt;/Popconfirm&gt;</span>
<span class="line">       &lt;/Fragment&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-3-2-models-user-js" tabindex="-1"><a class="header-anchor" href="#_8-3-2-models-user-js"><span>8.3.2 models\\user.js</span></a></h4><p>src\\pages\\admin\\user\\models\\user.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+        *del({payload},{call,put}) {</span>
<span class="line">+            yield call(userService.del,payload);</span>
<span class="line">+            yield put({type: &#39;fetch&#39;,payload: {pageNum:1}});</span>
<span class="line">+        }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-3-3-services-user-js" tabindex="-1"><a class="header-anchor" href="#_8-3-3-services-user-js"><span>8.3.3 services\\user.js</span></a></h4><p>src\\pages\\admin\\user\\services\\user.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ export function del(id) {</span>
<span class="line">+     return request(\`/api/user/\${id}\`,{</span>
<span class="line">+        method: &#39;DELETE&#39;</span>
<span class="line">+ });</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-4-全部删除" tabindex="-1"><a class="header-anchor" href="#_8-4-全部删除"><span>8.4 全部删除</span></a></h3><h4 id="_8-4-1-src-pages-admin-user-index-js" tabindex="-1"><a class="header-anchor" href="#_8-4-1-src-pages-admin-user-index-js"><span>8.4.1 src\\pages\\admin\\user\\index.js</span></a></h4><p>src\\pages\\admin\\user\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">            type: &#39;user/del&#39;,</span>
<span class="line">            payload:id</span>
<span class="line">        });</span>
<span class="line">   }</span>
<span class="line">+   onAllDel=() =&gt; {</span>
<span class="line">+    this.props.dispatch({</span>
<span class="line">+        type: &#39;user/delAll&#39;,</span>
<span class="line">+        payload:this.props.selectedRowKeys</span>
<span class="line">+    });</span>
<span class="line">+   }</span>
<span class="line">     render(){</span>
<span class="line">          const columns=[</span>
<span class="line"></span>
<span class="line">                dispatch(routerRedux.push(\`/admin/user?pageNum=\${pageNum}\`));</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line">+        const rowSelection={</span>
<span class="line">+            type: &#39;checkbox&#39;,</span>
<span class="line">+            selectedRowKeys: this.props.selectedRowKeys,</span>
<span class="line">+            onChange: (selectedRowKeys) =&gt; {</span>
<span class="line">+                this.save({selectedRowKeys});</span>
<span class="line">+            }</span>
<span class="line">     }</span>
<span class="line">         return (</span>
<span class="line">             &lt;Card&gt;</span>
<span class="line">                &lt;Button type=&quot;warning&quot; onClick={this.onAdd}&gt;添加&lt;/Button&gt;</span>
<span class="line">+                &lt;Button type=&quot;danger&quot; onClick={this.onAllDel}&gt;全部删除&lt;/Button&gt;</span>
<span class="line">                &lt;Table</span>
<span class="line">                        columns={columns}</span>
<span class="line">                        dataSource={list}</span>
<span class="line">                        loading={loading}</span>
<span class="line">                        rowKey={record =&gt; record.id}</span>
<span class="line">                        pagination={pagination}</span>
<span class="line">+                       rowSelection={rowSelection}</span>
<span class="line">                /&gt;</span>
<span class="line">                 &lt;EditModal</span>
<span class="line">                    wrappedComponentRef={instance =&gt;this.editForm=instance}         </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-4-2-user-js" tabindex="-1"><a class="header-anchor" href="#_8-4-2-user-js"><span>8.4.2 user.js</span></a></h4><p>pages\\admin\\user\\models\\user.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">        record: {},</span>
<span class="line">+        selectedRowKeys:[]</span>
<span class="line">+        *delAll({payload},{call,put}) {</span>
<span class="line">+           yield call(userService.delAll,payload);</span>
<span class="line">+           yield put({type: &#39;fetch&#39;,payload: {pageNum:1}});</span>
<span class="line">+        }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-4-3-services-user-js" tabindex="-1"><a class="header-anchor" href="#_8-4-3-services-user-js"><span>8.4.3 services\\user.js</span></a></h4><p>src\\pages\\admin\\user\\services\\user.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ export function delAll(ids) {</span>
<span class="line">+    return request(\`/api/user/\${ids[0]}\`,{</span>
<span class="line">+        method: &#39;DELETE&#39;,</span>
<span class="line">+        headers: {&quot;Content-Type&quot;: &quot;application/json&quot;},</span>
<span class="line">+        body: JSON.stringify(ids)</span>
<span class="line">+    });</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-5-搜索" tabindex="-1"><a class="header-anchor" href="#_8-5-搜索"><span>8.5 搜索</span></a></h3><h4 id="_8-5-1-src-pages-admin-user-index-js" tabindex="-1"><a class="header-anchor" href="#_8-5-1-src-pages-admin-user-index-js"><span>8.5.1 src\\pages\\admin\\user\\index.js</span></a></h4><p>src\\pages\\admin\\user\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">        type: &#39;user/delAll&#39;,</span>
<span class="line">        payload:this.props.selectedRowKeys</span>
<span class="line">    });</span>
<span class="line">   }</span>
<span class="line">+   onSearch=() =&gt; {</span>
<span class="line">+        let values=this.searchForm.props.form.getFieldsValue();</span>
<span class="line">+        let where=Object.keys(values).reduce((memo,key) =&gt; {</span>
<span class="line">+            if (values[key]){</span>
<span class="line">+                memo[key]=values[key];</span>
<span class="line">+            }</span>
<span class="line">+            return memo;</span>
<span class="line">+        },{});</span>
<span class="line">+        this.props.dispatch({</span>
<span class="line">+            type: &#39;user/search&#39;,</span>
<span class="line">+            payload:where</span>
<span class="line">+        });</span>
<span class="line">+   }</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">+ let {list,loading,pageNum,total,dispatch,isCreate,editVisible,record,where}=this.props;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">+    &lt;&gt;</span>
<span class="line">+            &lt;Card&gt;</span>
<span class="line">+                &lt;SearchForm</span>
<span class="line">+                    where={where}</span>
<span class="line">+                    onSearch={this.onSearch}</span>
<span class="line">+                    wrappedComponentRef={inst=&gt;this.searchForm=inst}/&gt;</span>
<span class="line">            &lt;/Card&gt;</span>
<span class="line">             &lt;Card&gt;</span>
<span class="line">+    &lt;/&gt;      </span>
<span class="line"></span>
<span class="line"></span>
<span class="line">+@Form.create()</span>
<span class="line">+class SearchForm extends Component{</span>
<span class="line">+    render() {</span>
<span class="line">+        let {form: {getFieldDecorator},onSearch,where={}}=this.props;</span>
<span class="line">+        return (</span>
<span class="line">+            &lt;Form layout=&quot;inline&quot;&gt;</span>
<span class="line">+                    &lt;FormItem</span>
<span class="line">+                        label=&quot;用户名&quot;</span>
<span class="line">+                    &gt;</span>
<span class="line">+                        {</span>
<span class="line">+                            getFieldDecorator(&#39;username&#39;,{initialValue:where.username})(&lt;Input /&gt;)</span>
<span class="line">+                        }</span>
<span class="line">+                    &lt;/FormItem&gt;</span>
<span class="line">+                    &lt;FormItem</span>
<span class="line">+                        label=&quot;邮箱&quot;</span>
<span class="line">+                    &gt;</span>
<span class="line">+                        {</span>
<span class="line">+                            getFieldDecorator(&#39;email&#39;,{initialValue:where.email})(&lt;Input/&gt;)</span>
<span class="line">+                        }</span>
<span class="line">+                &lt;/FormItem&gt;</span>
<span class="line">+                &lt;FormItem&gt;</span>
<span class="line">+                    &lt;Button onClick={onSearch} shape=&quot;circle&quot; icon=&quot;search&quot;&gt;&lt;/Button&gt;</span>
<span class="line">+                &lt;/FormItem&gt;</span>
<span class="line">+                &lt;/Form&gt;</span>
<span class="line">+        )</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-5-2-user-js" tabindex="-1"><a class="header-anchor" href="#_8-5-2-user-js"><span>8.5.2 user.js</span></a></h4><p>pages\\admin\\user\\models\\user.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">        selectedRowKeys:[],</span>
<span class="line">+        where:{}</span>
<span class="line"></span>
<span class="line">+ *fetch({payload: {pageNum=1,where}},{call,put,select}) {</span>
<span class="line">+             if (!where) {</span>
<span class="line">+                 where =yield select(state =&gt; state.user.where);</span>
<span class="line">+            }</span>
<span class="line">+            if (!pageNum) {</span>
<span class="line">+                pageNum =yield select(state =&gt; state.user.pageNum);</span>
<span class="line">+            }</span>
<span class="line">+            const result=yield call(userService.fetch,pageNum,where);</span>
<span class="line">+            if(result.code === 0){</span>
<span class="line">+               let { list,total} = result.data;</span>
<span class="line">+               yield put({type:&#39;save&#39;,payload:{list,pageNum:parseInt(pageNum),total}});</span>
<span class="line">+            }</span>
<span class="line">+        },</span>
<span class="line">+        *search({payload:where},{call,put}) {</span>
<span class="line">+            yield put({type: &#39;fetch&#39;,payload: {pageNum:1,where}});</span>
<span class="line">+        },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-5-3-services-user-js" tabindex="-1"><a class="header-anchor" href="#_8-5-3-services-user-js"><span>8.5.3 services\\user.js</span></a></h4><p>src\\pages\\admin\\user\\services\\user.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import querystring from &#39;querystring&#39;;</span>
<span class="line">+export function fetch(pageNum,where) {</span>
<span class="line">+    let whereString=querystring.stringify(where);</span>
<span class="line">+    return request(\`/api/user?pageNum=\${pageNum}&amp;pageSize=\${PAGE_SIZE}&amp;\${whereString}\`);</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-6-点行选择行" tabindex="-1"><a class="header-anchor" href="#_8-6-点行选择行"><span>8.6 点行选择行</span></a></h3><h4 id="_8-6-1-src-pages-admin-user-index-js" tabindex="-1"><a class="header-anchor" href="#_8-6-1-src-pages-admin-user-index-js"><span>8.6.1 src\\pages\\admin\\user\\index.js</span></a></h4><p>src\\pages\\admin\\user\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> &lt;Table</span>
<span class="line">                    columns={columns}</span>
<span class="line">                    dataSource={list}</span>
<span class="line">                    loading={loading}</span>
<span class="line">                    rowKey={record =&gt; record.id}</span>
<span class="line">                    pagination={pagination}</span>
<span class="line">                    rowSelection={rowSelection}</span>
<span class="line">+                    onRow = {</span>
<span class="line">+                      (record) =&gt; {</span>
<span class="line">+                        return {</span>
<span class="line">+                          onClick: () =&gt; {</span>
<span class="line">+                            let selectedRowKeys = this.props.selectedRowKeys;</span>
<span class="line">+                            let index = selectedRowKeys.indexOf(record.id);</span>
<span class="line">+                            if (index == -1) {</span>
<span class="line">+                              selectedRowKeys = [...selectedRowKeys, record.id];</span>
<span class="line">+                            } else {</span>
<span class="line">+                              selectedRowKeys = selectedRowKeys.filter(key =&gt; key !=record.id);</span>
<span class="line">+                            }</span>
<span class="line">+                            this.save({</span>
<span class="line">+                              selectedRowKeys</span>
<span class="line">+                            });</span>
<span class="line">+                          }</span>
<span class="line">+                        }</span>
<span class="line">+                      }</span>
<span class="line">+                    }</span>
<span class="line">                /&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-角色管理" tabindex="-1"><a class="header-anchor" href="#_9-角色管理"><span>9 角色管理</span></a></h2><h3 id="_9-1-role-index-js" tabindex="-1"><a class="header-anchor" href="#_9-1-role-index-js"><span>9.1 role\\index.js</span></a></h3><p>src\\pages\\admin\\role\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">,</span>Fragment<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Card<span class="token punctuation">,</span>Table<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>Modal<span class="token punctuation">,</span>Form<span class="token punctuation">,</span>Input<span class="token punctuation">,</span>message<span class="token punctuation">,</span>Popconfirm<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./constants&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> routerRedux <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;dva/router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> FormItem<span class="token operator">=</span>Form<span class="token punctuation">.</span>Item<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">ENTITY</span><span class="token operator">=</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> </span>
<span class="line">@<span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">[</span><span class="token constant">ENTITY</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token literal-property property">loading</span><span class="token operator">:</span>state<span class="token punctuation">.</span>loading<span class="token punctuation">.</span>models<span class="token punctuation">[</span><span class="token constant">ENTITY</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span> </span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">     <span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/save</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">            payload</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">     <span class="token punctuation">}</span></span>
<span class="line">     <span class="token function-variable function">onAdd</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">isCreate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">record</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">     <span class="token punctuation">}</span></span>
<span class="line">     <span class="token function-variable function">onEditCancel</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">editVisible</span> <span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">onEditOk</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>editForm<span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;表单校验失败!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isCreate<span class="token operator">?</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/create</span><span class="token template-punctuation string">\`</span></span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/update</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">payload</span><span class="token operator">:</span>values</span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">onEdit</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">isCreate</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>record<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">onDel</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/del</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">payload</span><span class="token operator">:</span>id</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">   <span class="token function-variable function">onAllDel</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/delAll</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>selectedRowKeys</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">   <span class="token function-variable function">onSearch</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> values<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchForm<span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">getFieldsValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> where<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                memo<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span>values<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span> memo<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/search</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">payload</span><span class="token operator">:</span>where</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> columns<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;名称&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;name&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;操作&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;operation&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Fragment<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;warning&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onEdit</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>编辑<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>Popconfirm</span>
<span class="line">                            okText<span class="token operator">=</span><span class="token string">&quot;确认&quot;</span></span>
<span class="line">                            cancelText<span class="token operator">=</span><span class="token string">&quot;取消&quot;</span></span>
<span class="line">                            title<span class="token operator">=</span><span class="token string">&quot;确认删除此用户吗?&quot;</span></span>
<span class="line">                            onConfirm<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onDel</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                             <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;danger&quot;</span><span class="token operator">&gt;</span>删除<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>Popconfirm<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span>list<span class="token punctuation">,</span>loading<span class="token punctuation">,</span>pageNum<span class="token punctuation">,</span>total<span class="token punctuation">,</span>dispatch<span class="token punctuation">,</span>isCreate<span class="token punctuation">,</span>editVisible<span class="token punctuation">,</span>record<span class="token punctuation">,</span>where<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> pagination<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">current</span><span class="token operator">:</span> pageNum<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token constant">PAGE_SIZE</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">showQuickJumper</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">showTotal</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>range</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">共</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">条</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            total<span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">pageNum</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">dispatch</span><span class="token punctuation">(</span>routerRedux<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/admin/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?pageNum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pageNum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">const</span> rowSelection<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;checkbox&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">selectedRowKeys</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>selectedRowKeys<span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">selectedRowKeys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span>selectedRowKeys<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">     <span class="token punctuation">}</span></span>
<span class="line">         <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>SearchForm</span>
<span class="line">                    where<span class="token operator">=</span><span class="token punctuation">{</span>where<span class="token punctuation">}</span></span>
<span class="line">                    onSearch<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onSearch<span class="token punctuation">}</span></span>
<span class="line">                    wrappedComponentRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">inst</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchForm<span class="token operator">=</span>inst<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">             <span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;warning&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onAdd<span class="token punctuation">}</span><span class="token operator">&gt;</span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;danger&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onAllDel<span class="token punctuation">}</span><span class="token operator">&gt;</span>全部删除<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Table</span>
<span class="line">                        columns<span class="token operator">=</span><span class="token punctuation">{</span>columns<span class="token punctuation">}</span></span>
<span class="line">                        dataSource<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span></span>
<span class="line">                        loading<span class="token operator">=</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span></span>
<span class="line">                        rowKey<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> record<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>
<span class="line">                        pagination<span class="token operator">=</span><span class="token punctuation">{</span>pagination<span class="token punctuation">}</span></span>
<span class="line">                         rowSelection<span class="token operator">=</span><span class="token punctuation">{</span>rowSelection<span class="token punctuation">}</span></span>
<span class="line">                        onRow <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                          <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token keyword">let</span> selectedRowKeys <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>selectedRowKeys<span class="token punctuation">;</span></span>
<span class="line">                            <span class="token keyword">let</span> index <span class="token operator">=</span> selectedRowKeys<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                              selectedRowKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>selectedRowKeys<span class="token punctuation">,</span> record<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                              selectedRowKeys <span class="token operator">=</span> selectedRowKeys<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> key <span class="token operator">!=</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token punctuation">}</span></span>
<span class="line">                            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                              selectedRowKeys</span>
<span class="line">                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                          <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                      <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                 <span class="token operator">&lt;</span>EditModal</span>
<span class="line">                    wrappedComponentRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">instance</span> <span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>editForm<span class="token operator">=</span>instance<span class="token punctuation">}</span></span>
<span class="line">                    isCreate<span class="token operator">=</span><span class="token punctuation">{</span>isCreate<span class="token punctuation">}</span></span>
<span class="line">                    visible<span class="token operator">=</span><span class="token punctuation">{</span>editVisible<span class="token punctuation">}</span></span>
<span class="line">                    onOk<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onEditOk<span class="token punctuation">}</span></span>
<span class="line">                    onCancel<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onEditCancel<span class="token punctuation">}</span></span>
<span class="line">                    record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">         <span class="token punctuation">)</span></span>
<span class="line">     <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">@Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SearchForm</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>getFieldDecorator<span class="token punctuation">}</span><span class="token punctuation">,</span>onSearch<span class="token punctuation">,</span>where<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Form layout<span class="token operator">=</span><span class="token string">&quot;inline&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>FormItem</span>
<span class="line">                        label<span class="token operator">=</span><span class="token string">&quot;角色名称&quot;</span></span>
<span class="line">                    <span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">initialValue</span><span class="token operator">:</span>where<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onSearch<span class="token punctuation">}</span> shape<span class="token operator">=</span><span class="token string">&quot;circle&quot;</span> icon<span class="token operator">=</span><span class="token string">&quot;search&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">@Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">EditModal</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span>visible<span class="token punctuation">,</span>onOk<span class="token punctuation">,</span>isCreate<span class="token punctuation">,</span>onCancel<span class="token punctuation">,</span>record<span class="token punctuation">,</span><span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>getFieldDecorator<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span>name<span class="token punctuation">}</span><span class="token operator">=</span>record<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Modal</span>
<span class="line">                title<span class="token operator">=</span><span class="token punctuation">{</span>isCreate<span class="token operator">?</span><span class="token string">&#39;创建角色&#39;</span><span class="token operator">:</span><span class="token string">&#39;修改角色&#39;</span><span class="token punctuation">}</span></span>
<span class="line">                visible<span class="token operator">=</span><span class="token punctuation">{</span>visible<span class="token punctuation">}</span></span>
<span class="line">                onOk<span class="token operator">=</span><span class="token punctuation">{</span>onOk<span class="token punctuation">}</span></span>
<span class="line">                onCancel<span class="token operator">=</span><span class="token punctuation">{</span>onCancel<span class="token punctuation">}</span></span>
<span class="line">                destroyOnClose</span>
<span class="line">            <span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Form<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                       <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">                                <span class="token literal-property property">initialValue</span><span class="token operator">:</span> id</span>
<span class="line">                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input type<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>FormItem</span>
<span class="line">                        label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line">                    <span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">                                <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">                                    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                                    <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&#39;名称必须输入&#39;</span></span>
<span class="line">                                <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                                <span class="token literal-property property">initialValue</span><span class="token operator">:</span> name</span>
<span class="line">                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Modal<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-role-constants-js" tabindex="-1"><a class="header-anchor" href="#_9-2-role-constants-js"><span>9.2 role\\constants.js</span></a></h3><p>src\\pages\\admin\\role\\constants.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PAGE_SIZE</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_9-3-models-role-js" tabindex="-1"><a class="header-anchor" href="#_9-3-models-role-js"><span>9.3 models\\role.js</span></a></h3><p>src\\pages\\admin\\role\\models\\role.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> service <span class="token keyword">from</span> <span class="token string">&#39;../services/role&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">ENTITY</span><span class="token operator">=</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token constant">ENTITY</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">total</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">editVisible</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">isCreate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">record</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">selectedRowKeys</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">where</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span><span class="token operator">...</span>payload<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>pageNum<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>where<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">,</span>select<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>where<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                where <span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">[</span><span class="token constant">ENTITY</span><span class="token punctuation">]</span><span class="token punctuation">.</span>where<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pageNum<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                pageNum <span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">[</span><span class="token constant">ENTITY</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>fetch<span class="token punctuation">,</span>pageNum<span class="token punctuation">,</span>where<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">               <span class="token keyword">let</span> <span class="token punctuation">{</span> list<span class="token punctuation">,</span>total<span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">               <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span>list<span class="token punctuation">,</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">,</span>total<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token literal-property property">payload</span><span class="token operator">:</span>where<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>where<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>create<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">,</span>select<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>update<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> pageNum<span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">[</span><span class="token constant">ENTITY</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>pageNum<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">editVisible</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>del<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token operator">*</span><span class="token function">delAll</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">             <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>delAll<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">pageNum</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">subscriptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dispatch<span class="token punctuation">,</span>history<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>pathname<span class="token punctuation">,</span>query<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token operator">===</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/admin/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span>query<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-4-services-role-js" tabindex="-1"><a class="header-anchor" href="#_9-4-services-role-js"><span>9.4 services\\role.js</span></a></h3><p>src\\pages\\admin\\role\\services\\role.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">&#39;@/utils/request&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../constants&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> querystring <span class="token keyword">from</span> <span class="token string">&#39;querystring&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">ENTITY</span><span class="token operator">=</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">pageNum<span class="token punctuation">,</span>where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> whereString<span class="token operator">=</span>querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>where<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?pageNum=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pageNum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;pageSize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">PAGE_SIZE</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>whereString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">body</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>values<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;PUT&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">body</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;DELETE&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">delAll</span><span class="token punctuation">(</span><span class="token parameter">ids</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ids<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;DELETE&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-设置权限" tabindex="-1"><a class="header-anchor" href="#_10-设置权限"><span>10. 设置权限</span></a></h2><h3 id="_10-1-service-role-js" tabindex="-1"><a class="header-anchor" href="#_10-1-service-role-js"><span>10.1 service\\role.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//list  resourceIds=代表这个角色所拥有的资源ID数组</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> rows <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;role_resource&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">role_id</span><span class="token operator">:</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[{role_id:1,resource_id:2},{role_id:1,resource_id:3}]</span></span>
<span class="line">    list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>resourceIds <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>resource_id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[2,3]</span></span>
<span class="line">    rows <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;role_user&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">         <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">role_id</span><span class="token operator">:</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[{role_id:1,resource_id:2},{role_id:1,resource_id:3}]</span></span>
<span class="line">   list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>userIds <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[2,3]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-2-role-index-js" tabindex="-1"><a class="header-anchor" href="#_10-2-role-index-js"><span>10.2 role/index.js</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ import {Tree,Card,Table,Button,Modal,Form,Input,message,Popconfirm} from &#39;antd&#39;;</span>
<span class="line">+const TreeNode=Tree.TreeNode;</span>
<span class="line"></span>
<span class="line">+   setRolePermission=() =&gt; {</span>
<span class="line">+        if (this.props.selectedRows.length===1) {</span>
<span class="line">+            let record=this.props.selectedRows[0];</span>
<span class="line">+            this.save({setPermissionVisible:true,record,checkedKeys:record.resourceIds});</span>
<span class="line">+        } else {</span>
<span class="line">+            message.error(&#39;为角色设置权限时要选择并且只能选择一个角色!&#39;);</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">+    onCheckPermission=(checkedKeys) =&gt; {</span>
<span class="line">+            this.save({checkedKeys});</span>
<span class="line">+        }</span>
<span class="line">+    setRolePermissionOk=() =&gt; {</span>
<span class="line">+            this.props.dispatch({</span>
<span class="line">+                type: \`\${ENTITY}/setRolePermission\`</span>
<span class="line">+            });</span>
<span class="line">+    }</span>
<span class="line"></span>
<span class="line">+ let {list,loading,pageNum,total,dispatch,isCreate,editVisible,record,where,setPermissionVisible,resources,checkedKeys}=this.props;</span>
<span class="line"></span>
<span class="line">+const rowSelection={</span>
<span class="line">+            type: &#39;checkbox&#39;,</span>
<span class="line">+            selectedRowKeys: this.props.selectedRowKeys,</span>
<span class="line">+            selectedRows: this.props.selectedRows,</span>
<span class="line">+            onChange: (selectedRowKeys,selectedRows) =&gt; {</span>
<span class="line">+                this.save({selectedRowKeys,selectedRows});</span>
<span class="line">+           }</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">+ &lt;Button icon=&quot;solution&quot; onClick={this.setRolePermission}&gt;设置权限&lt;/Button&gt;</span>
<span class="line">&lt;Table</span>
<span class="line">+    rowSelection={rowSelection}</span>
<span class="line"></span>
<span class="line">+                &lt;PermissonModal</span>
<span class="line">+                    visible={setPermissionVisible}</span>
<span class="line">+                    record={record}</span>
<span class="line">+                    resources={resources}</span>
<span class="line">+                    checkedKeys={checkedKeys}</span>
<span class="line">+                    onCheck={this.onCheckPermission}</span>
<span class="line">+                    onOk={this.setRolePermissionOk}</span>
<span class="line">+                    onCancel={()=&gt;this.save({setPermissionVisible:false})}</span>
<span class="line">+                /&gt;</span>
<span class="line"></span>
<span class="line">+class PermissonModal extends Component{</span>
<span class="line">+    renderResources=(children) =&gt; {</span>
<span class="line">+        return children.map(child =&gt; {</span>
<span class="line">+            if (child.children.length &gt; 0) {</span>
<span class="line">+                return (</span>
<span class="line">+                    &lt;TreeNode title={child.name} key={child.id}&gt;</span>
<span class="line">+                        {this.renderResources(child.children)}</span>
<span class="line">+                    &lt;/TreeNode&gt;</span>
<span class="line">+                )</span>
<span class="line">+            } else {</span>
<span class="line">+                return &lt;TreeNode title={child.name} key={child.id}/&gt;</span>
<span class="line">+            }</span>
<span class="line">+        });</span>
<span class="line">+    }</span>
<span class="line">+    render() {</span>
<span class="line">+        let {onCheck,visible,onOk,onCancel,checkedKeys,resources=[]}=this.props;</span>
<span class="line">+        return (</span>
<span class="line">+            &lt;Modal</span>
<span class="line">+                visible={visible}</span>
<span class="line">+                title=&quot;为角色设置权限&quot;</span>
<span class="line">+                onOk={onOk}</span>
<span class="line">+                onCancel={onCancel}</span>
<span class="line">+                destroyOnClose</span>
<span class="line">+            &gt;</span>
<span class="line">+                &lt;Tree</span>
<span class="line">+                    checkable</span>
<span class="line">+                    defaultExpandAll</span>
<span class="line">+                    onCheck={onCheck}</span>
<span class="line">+                    checkedKeys={checkedKeys}</span>
<span class="line">+                &gt;</span>
<span class="line">+                    &lt;TreeNode title=&quot;所有权限&quot; key={0} disabled&gt;</span>
<span class="line">+                        {this.renderResources(resources)}</span>
<span class="line">+                    &lt;/TreeNode&gt;</span>
<span class="line">+                &lt;/Tree&gt;</span>
<span class="line">+            &lt;/Modal&gt;</span>
<span class="line">+        )</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-3-models-role-js" tabindex="-1"><a class="header-anchor" href="#_10-3-models-role-js"><span>10.3 models\\role.js</span></a></h3><p>src\\pages\\admin\\role\\models\\role.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">+</span>        selectedRows<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        checkedKeys<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        resources<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        setPermissionVisible<span class="token operator">:</span><span class="token boolean">false</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span>        <span class="token operator">*</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">const</span> resources<span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>getResources<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span>resources<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token operator">*</span><span class="token function">setRolePermission</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">,</span>select<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">let</span> <span class="token punctuation">{</span>record<span class="token punctuation">,</span>checkedKeys<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">[</span><span class="token constant">ENTITY</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>setRolePermission<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">roleId</span><span class="token operator">:</span>record<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token literal-property property">resourceIds</span><span class="token operator">:</span>checkedKeys<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">setPermissionVisible</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token literal-property property">selectedRowKeys</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token literal-property property">selectedRows</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token operator">===</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/admin/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">ENTITY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;fetch&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span>query<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>                   <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;getResource&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-role-js" tabindex="-1"><a class="header-anchor" href="#_10-4-role-js"><span>10.4 role.js</span></a></h3><p>src\\pages\\admin\\role\\services\\role.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ export function getResources() {</span>
<span class="line">+    return request(\`/api/role/getResource\`);</span>
<span class="line">+}</span>
<span class="line">+export function setRolePermission(values) {</span>
<span class="line">+    return request(\`/api/role/setResource\`,{</span>
<span class="line">+        method: &#39;POST&#39;,</span>
<span class="line">+        headers:{&quot;Content-Type&quot;:&quot;application/json&quot;},</span>
<span class="line">+        body:JSON.stringify(values)</span>
<span class="line">+    });</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-给角色加用户" tabindex="-1"><a class="header-anchor" href="#_11-给角色加用户"><span>11.给角色加用户</span></a></h2><h3 id="_11-1-roles-index-js" tabindex="-1"><a class="header-anchor" href="#_11-1-roles-index-js"><span>11.1 roles/index.js</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ import { Transfer} from &#39;antd&#39;;</span>
<span class="line">+ setUser = () =&gt; {</span>
<span class="line">+        let selectedRows = this.props.selectedRows;</span>
<span class="line">+        if (selectedRows.length == 1) {</span>
<span class="line">+            let record = selectedRows[0];</span>
<span class="line">+            this.save({ setUserVisible: true, record, targetKeys: record.userIds });</span>
<span class="line">+       } else {</span>
<span class="line">+            message.warn(&#39;请选中并且只能选中一个角色!&#39;);</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">+    setUserOk = () =&gt; {</span>
<span class="line">+            this.props.dispatch({</span>
<span class="line">+               type: \`\${ENTITY}/setUser\`</span>
<span class="line">+            });</span>
<span class="line">+        }</span>
<span class="line">+    onSetUserChange = (targetKeys) =&gt; {</span>
<span class="line">+            this.save({ targetKeys });</span>
<span class="line">+    }</span>
<span class="line"></span>
<span class="line">+        let {list,loading,pageNum,total,dispatch,isCreate,editVisible,record,</span>
<span class="line">        where,setPermissionVisible,resources,checkedKeys, setUserVisible, targetKeys, users}=this.props;</span>
<span class="line">+                 &lt;Button style={{ marginLeft: 8 }} type=&quot;primary&quot; icon=&quot;plus-circle&quot; onClick={this.setUser}&gt;分配用户&lt;/Button&gt;</span>
<span class="line"></span>
<span class="line">+                             let selectedRowKeys=this.props.selectedRowKeys;</span>
<span class="line">+                                        let selectedRows = this.props.selectedRows;</span>
<span class="line">+                                        let index = selectedRowKeys.indexOf(record.id);</span>
<span class="line">+                                        if (index===-1) {</span>
<span class="line">+                                            selectedRowKeys=[...selectedRowKeys,record.id];</span>
<span class="line">+                                            selectedRows=[...selectedRows,record];</span>
<span class="line">+                                        } else {</span>
<span class="line">+                                            selectedRowKeys=selectedRowKeys.filter(key =&gt; key!=record.id);</span>
<span class="line">+                                            selectedRows=selectedRows.filter(row =&gt; row.id!=record.id);</span>
<span class="line">+                                        }</span>
<span class="line">+                                        this.save({selectedRowKeys,selectedRows});</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">+                &lt;SetUserModal</span>
<span class="line">+                        visible={setUserVisible}</span>
<span class="line">+                        record={record}</span>
<span class="line">+                        onOk={this.setUserOk}</span>
<span class="line">+                        targetKeys={targetKeys}</span>
<span class="line">+                        onChange={this.onSetUserChange}</span>
<span class="line">+                        users={users}</span>
<span class="line">+                        onCancel={() =&gt; this.save({ setUserVisible: false })}</span>
<span class="line">+/&gt;</span>
<span class="line"></span>
<span class="line">+ class SetUserModal extends Component {</span>
<span class="line">+    render() {</span>
<span class="line">+        let { visible, onOk, onCancel, record, targetKeys, onChange, users } = this.props;</span>
<span class="line">+        return (</span>
<span class="line">+            &lt;Modal</span>
<span class="line">+                title={\`为 \${record.name} 分配用户\`}</span>
<span class="line">+                visible={visible}</span>
<span class="line">+                onOk={onOk}</span>
<span class="line">+                okText={&quot;确定&quot;}</span>
<span class="line">+                cancelText={&quot;取消&quot;}</span>
<span class="line">+                onCancel={onCancel}</span>
<span class="line">+                destroyOnClose</span>
<span class="line">+            &gt;</span>
<span class="line">+                &lt;Transfer</span>
<span class="line">+                    dataSource={users}</span>
<span class="line">+                    targetKeys={targetKeys}</span>
<span class="line">+                    titles={[&quot;待选用户&quot;, &quot;已选用户&quot;]}</span>
<span class="line">+                    onChange={onChange}</span>
<span class="line">+                    render={row =&gt; row.username}</span>
<span class="line">+                    rowKey={row =&gt; row.id}</span>
<span class="line">+                /&gt;</span>
<span class="line">+            &lt;/Modal&gt;</span>
<span class="line">+        )</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-models-roles-js" tabindex="-1"><a class="header-anchor" href="#_11-2-models-roles-js"><span>11.2 models/roles.js</span></a></h3><p>src/pages/admin/roles/models/roles.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+        setPermissionVisible:false,</span>
<span class="line">+        setUserVisible: false,//窗口是否显示</span>
<span class="line">+        targetKeys: [],//选中的用户</span>
<span class="line">+        users: [] //所有的用户</span>
<span class="line"></span>
<span class="line">+        *getUser({ }, { call, put }) {</span>
<span class="line">+            let users = yield call(service.getUser);</span>
<span class="line">+            yield put({ type: &#39;save&#39;, payload: { users } });</span>
<span class="line">+        },</span>
<span class="line">+         *setUser({ }, { call, put, select }) {</span>
<span class="line">+            let record = yield select(state =&gt; state.role.record);</span>
<span class="line">+            let targetKeys = yield select(state =&gt; state.role.targetKeys);</span>
<span class="line">+            yield call(service.setUser, {</span>
<span class="line">+                roleId: record.id,</span>
<span class="line">+                userIds: targetKeys</span>
<span class="line">+            });</span>
<span class="line">+            yield put({ type: &#39;save&#39;, payload: { setUserVisible: false, selectedRowKeys: [], selectedRows: [] } });</span>
<span class="line">+            yield put({ type: &#39;fetch&#39;, payload: {} });</span>
<span class="line">+        }</span>
<span class="line"></span>
<span class="line">            dispatch({type:&#39;getResource&#39;});</span>
<span class="line">+           dispatch({ type: &#39;getUser&#39; });</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-3-services-roles-js" tabindex="-1"><a class="header-anchor" href="#_11-3-services-roles-js"><span>11.3 services/roles.js</span></a></h3><p>src/pages/admin/roles/services/roles.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+export function getUser() {</span>
<span class="line">+    return request(\`/api/role/getUser\`);</span>
<span class="line">+}</span>
<span class="line">+export function setUser(values) {</span>
<span class="line">+    return request(\`/api/role/setUser\`, {</span>
<span class="line">+        method: &#39;POST&#39;,</span>
<span class="line">+        headers: {</span>
<span class="line">+            &quot;Content-Type&quot;: &quot;application/json&quot;</span>
<span class="line">+        },</span>
<span class="line">+        body: JSON.stringify(values)</span>
<span class="line">+    });</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,149)])])}const i=n(t,[["render",o]]),r=JSON.parse('{"path":"/strong/30.cms-14-front.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/30.cms-14-front.md"}');export{i as comp,r as data};
