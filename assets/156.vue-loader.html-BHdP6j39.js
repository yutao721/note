import{_ as n,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(c,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-vue-loader-是什么" tabindex="-1"><a class="header-anchor" href="#_1-vue-loader-是什么"><span>1.Vue Loader 是什么？</span></a></h2><ul><li><a href="https://vue-loader.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue Loader</a> 是一个 webpack 的 loader，它允许你以一种名为单文件组件 (SFCs)的格式撰写 Vue 组件</li></ul><h2 id="_2-起步" tabindex="-1"><a class="header-anchor" href="#_2-起步"><span>2.起步</span></a></h2><h3 id="_2-1-安装" tabindex="-1"><a class="header-anchor" href="#_2-1-安装"><span>2.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install vue --save</span>
<span class="line">npm install  webpack webpack-cli style-loader css-loader html-webpack-plugin vue-loader  vue-template-compiler  webpack-dev-server --save-dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-webpack-config-js" tabindex="-1"><a class="header-anchor" href="#_2-2-webpack-config-js"><span>2.2 webpack.config.js</span></a></h3><p>webpack.config.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> VueLoaderPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;vue-loader&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;html-webpack-plugin&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/main.js&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;vue-loader&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.html&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">__VUE_OPTIONS_API__</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">__VUE_PROD_DEVTOOLS__</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-main-js" tabindex="-1"><a class="header-anchor" href="#_2-3-main-js"><span>2.3 main.js</span></a></h3><p>src\\main.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span></span>
<span class="line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App.vue&#39;</span></span>
<span class="line"> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-app-vue" tabindex="-1"><a class="header-anchor" href="#_2-4-app-vue"><span>2.4 App.vue</span></a></h3><p>src\\App.vue</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;script&gt;</span>
<span class="line">console.log(&#39;App&#39;);</span>
<span class="line">&lt;/script&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-index-html" tabindex="-1"><a class="header-anchor" href="#_2-5-index-html"><span>2.5 index.html</span></a></h3><p>src\\index.html</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;!DOCTYPE html&gt;</span>
<span class="line">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="line">&lt;head&gt;</span>
<span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span>
<span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
<span class="line">    &lt;title&gt;vue-loader&lt;/title&gt;</span>
<span class="line">&lt;/head&gt;</span>
<span class="line">&lt;body&gt;</span>
<span class="line">    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span>
<span class="line">&lt;/body&gt;</span>
<span class="line">&lt;/html&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-loader实现" tabindex="-1"><a class="header-anchor" href="#_3-loader实现"><span>3.loader实现</span></a></h2><h3 id="_3-1-文件结构" tabindex="-1"><a class="header-anchor" href="#_3-1-文件结构"><span>3.1 文件结构</span></a></h3><ul><li>vue-loader内部主要有三个部分 <ul><li><code>vue-loader\\index.js</code> 实现了一个普通Loader,负责把SFC的不同区块转化为<code>import</code>语句</li><li><code>vue-loader\\pitcher.js</code>实现pitch Loader,用于拼出完整的行内路径</li><li><code>vue-loader\\plugin.js</code> 负责动态修改webpack配置，注入新的loader到rules规则中</li></ul></li></ul><h3 id="_3-2-基础知识" tabindex="-1"><a class="header-anchor" href="#_3-2-基础知识"><span>3.2 基础知识</span></a></h3><h4 id="_3-2-1-loadercontext" tabindex="-1"><a class="header-anchor" href="#_3-2-1-loadercontext"><span>3.2.1 LoaderContext</span></a></h4><ul><li>[Loader Context](https://webpack.docschina.org/api/loaders/</li><li>[this.callback](https://webpack.docschina.org/api/loaders/</li></ul><h4 id="_3-2-2-pitching-loader" tabindex="-1"><a class="header-anchor" href="#_3-2-2-pitching-loader"><span>3.2.2 pitching-loader</span></a></h4><ul><li>[pitching-loader](https://webpack.docschina.org/api/loaders</li><li>loader 可以通过 request 添加或者禁用内联前缀，这将影响到 pitch 和执行的顺序,请看[Rule.enforce](https://webpack.docschina.org/configuration/module/</li></ul><p><img src="http://img.zhufengpeixun.cn/loader-runner2.jpg" alt="loader-runner"></p><h4 id="_3-2-3-rule-enforce" tabindex="-1"><a class="header-anchor" href="#_3-2-3-rule-enforce"><span>3.2.3 Rule.enforce</span></a></h4><ul><li>[Rule.enforce](https://webpack.docschina.org/configuration/module</li></ul><h4 id="_3-2-4-resource" tabindex="-1"><a class="header-anchor" href="#_3-2-4-resource"><span>3.2.4 resource</span></a></h4><ul><li>[Rule.resource](https://webpack.docschina.org/configuration/module/</li><li>[Rule.resourceQuery](https://webpack.docschina.org/configuration/module/</li></ul><h4 id="_3-2-5-contextify" tabindex="-1"><a class="header-anchor" href="#_3-2-5-contextify"><span>3.2.5 contextify</span></a></h4><ul><li>[contextify](https://webpack.docschina.org/api/loaders/</li></ul><h4 id="_3-2-6-vue-compiler-sfc" tabindex="-1"><a class="header-anchor" href="#_3-2-6-vue-compiler-sfc"><span>3.2.6 @vue/compiler-sfc</span></a></h4><ul><li><a href="https://www.npmjs.com/package/@vue/compiler-sfc" target="_blank" rel="noopener noreferrer">compiler-sfc</a>用于编译Vue单文件组件的低级实用程序</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// main script</span></span>
<span class="line"><span class="token keyword">import</span> script <span class="token keyword">from</span> <span class="token string">&#39;/project/foo.vue?vue&amp;type=script&#39;</span></span>
<span class="line"><span class="token comment">// template compiled to render function</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/project/foo.vue?vue&amp;type=template&amp;id=xxxxxx&#39;</span></span>
<span class="line"><span class="token comment">// css</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&#39;/project/foo.vue?vue&amp;type=style&amp;index=0&amp;id=xxxxxx&#39;</span></span>
<span class="line"><span class="token comment">// attach render function to script</span></span>
<span class="line">script<span class="token punctuation">.</span>render <span class="token operator">=</span> render</span>
<span class="line"><span class="token comment">// attach additional metadata</span></span>
<span class="line">script<span class="token punctuation">.</span>__file <span class="token operator">=</span> <span class="token string">&#39;example.vue&#39;</span></span>
<span class="line">script<span class="token punctuation">.</span>__scopeId <span class="token operator">=</span> <span class="token string">&#39;hash&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> script</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-工作流程" tabindex="-1"><a class="header-anchor" href="#_3-3-工作流程"><span>3.3 工作流程</span></a></h3><p><img src="https://static.zhufengpeixun.com/vueloader_1661567856026.jpg" alt=""></p><h4 id="_3-3-1-原始内容" tabindex="-1"><a class="header-anchor" href="#_3-3-1-原始内容"><span>3.3.1 原始内容</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App.vue&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-2-第1次转换" tabindex="-1"><a class="header-anchor" href="#_3-3-2-第1次转换"><span>3.3.2 第1次转换</span></a></h4><ul><li>1.进入vue-loader的normal处理转换代码为<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> script <span class="token keyword">from</span> <span class="token string">&quot;./App.vue?vue&amp;type=script&amp;id=4d69bc76&amp;lang=js&quot;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>render<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./App.vue?vue&amp;type=template&amp;id=4d69bc76&amp;scoped=true&amp;lang=js&quot;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./App.vue?vue&amp;type=style&amp;index=0&amp;id=4d69bc76&amp;scoped=true&amp;lang=css&quot;</span></span>
<span class="line">script<span class="token punctuation">.</span>__scopeId <span class="token operator">=</span> <span class="token string">&quot;data-v-4d69bc76&quot;</span></span>
<span class="line">script<span class="token punctuation">.</span>render<span class="token operator">=</span>render</span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> script</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_3-3-3-第2次转换" tabindex="-1"><a class="header-anchor" href="#_3-3-3-第2次转换"><span>3.3.3 第2次转换</span></a></h4><ul><li>2.进入pitcher，不同区块返回不同内容</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//script区块</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;-!../vue-loader/index.js!./App.vue?vue&amp;type=script&amp;id=4d69bc76&amp;lang=js&quot;</span><span class="token punctuation">;</span> <span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;-!../vue-loader/index.js!./App.vue?vue&amp;type=script&amp;id=4d69bc76&amp;lang=js&quot;</span></span>
<span class="line"><span class="token comment">//template区块</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;-!../vue-loader/templateLoader.js!../vue-loader/index.js!./App.vue?vue&amp;type=template&amp;id=4d69bc76&amp;scoped=true&amp;lang=js&quot;</span></span>
<span class="line"><span class="token comment">//style区块</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;-!../node_modules/style-loader/dist/cjs.js!../node_modules/css-loader/dist/cjs.js!../vue-loader/stylePostLoader.js!../vue-loader/index.js!./App.vue?vue&amp;type=style&amp;index=0&amp;id=4d69bc76&amp;scoped=true&amp;lang=css&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-4-第3次转换" tabindex="-1"><a class="header-anchor" href="#_3-3-4-第3次转换"><span>3.3.4 第3次转换</span></a></h4><ul><li>第二次执行<code>vue-loader</code>,从SFC中提取对应的区块内容，交给后面的loader</li><li><code>script</code>内容直接编译返回</li><li><code>template</code>内容交给<code>templateLoader</code></li><li><code>style</code>内容交给<code>stylePostLoader</code></li></ul><p>vue-loader\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>incomingQuery<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> select<span class="token punctuation">.</span><span class="token function">selectBlock</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> id<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> incomingQuery<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-编译script" tabindex="-1"><a class="header-anchor" href="#_4-编译script"><span>4.编译script</span></a></h2><ul><li>第一次的时候只走<code>vue-loader</code>,返回临时文件<code>import script from &quot;./App.vue?vue&amp;type=script&amp;id=4d69bc76&amp;lang=js&quot;</code></li><li>第一次加载临时文件的时候会走<code>pitcher</code>,<code>pitcher</code>会拼出行内loader和加载模块的完整路径</li></ul><h3 id="_4-1-webpack-config-js" tabindex="-1"><a class="header-anchor" href="#_4-1-webpack-config-js"><span>4.1 webpack.config.js</span></a></h3><p>webpack.config.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+const { VueLoaderPlugin } = require(&#39;./vue-loader&#39;)</span>
<span class="line">const HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;)</span>
<span class="line">const webpack = require(&#39;webpack&#39;)</span>
<span class="line">+const path = require(&#39;path&#39;)</span>
<span class="line">module.exports = {</span>
<span class="line">    mode: &#39;development&#39;,</span>
<span class="line">    devtool: false,</span>
<span class="line">    entry: &#39;./src/main.js&#39;,</span>
<span class="line">    module: {</span>
<span class="line">        rules: [</span>
<span class="line">            {</span>
<span class="line">                test: /\\.vue$/,</span>
<span class="line">+               loader: path.resolve(__dirname, &#39;vue-loader&#39;)</span>
<span class="line">            }</span>
<span class="line">        ]</span>
<span class="line">    },</span>
<span class="line">    plugins: [</span>
<span class="line">        new VueLoaderPlugin(),</span>
<span class="line">        new HtmlWebpackPlugin({</span>
<span class="line">            template: &#39;./src/index.html&#39;</span>
<span class="line">        }),</span>
<span class="line">        new webpack.DefinePlugin({</span>
<span class="line">            __VUE_OPTIONS_API__: true,</span>
<span class="line">            __VUE_PROD_DEVTOOLS__: true</span>
<span class="line">        })</span>
<span class="line">    ]</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-vue-loader-index-js" tabindex="-1"><a class="header-anchor" href="#_4-2-vue-loader-index-js"><span>4.2 vue-loader\\index.js</span></a></h3><p>vue-loader\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue/compiler-sfc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> hash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;hash-sum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> VueLoaderPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> select <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./select&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> loaderContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> resourcePath<span class="token punctuation">,</span> resourceQuery <span class="token operator">=</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> loaderContext<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> rawQuery <span class="token operator">=</span> resourceQuery<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> incomingQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>rawQuery<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> descriptor <span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>resourcePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>incomingQuery<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> select<span class="token punctuation">.</span><span class="token function">selectBlock</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> id<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> incomingQuery<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> script <span class="token punctuation">}</span> <span class="token operator">=</span> descriptor<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>script<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">?vue&amp;type=script&amp;id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;lang=js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> scriptRequest <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>loaderContext<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">contextify</span><span class="token punctuation">(</span>loaderContext<span class="token punctuation">.</span>context<span class="token punctuation">,</span> resourcePath <span class="token operator">+</span> query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        code<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">import script from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>scriptRequest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    code<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">export default script</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> code<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">loader<span class="token punctuation">.</span>VueLoaderPlugin <span class="token operator">=</span> VueLoaderPlugin<span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-plugin-js" tabindex="-1"><a class="header-anchor" href="#_4-3-plugin-js"><span>4.3 plugin.js</span></a></h3><p>vue-loader\\plugin.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">VueLoaderPlugin</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> rules <span class="token operator">=</span> compiler<span class="token punctuation">.</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> pitcher <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;./pitcher&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token comment">//类似于test,用于判断资源的路径是否适用于此规则</span></span>
<span class="line">            <span class="token function-variable function">resourceQuery</span><span class="token operator">:</span> <span class="token parameter">query</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">let</span> parsed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> parsed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//把pitcher添加到rules数组的第一位</span></span>
<span class="line">        compiler<span class="token punctuation">.</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token punctuation">[</span>pitcher<span class="token punctuation">,</span> <span class="token operator">...</span>rules<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> VueLoaderPlugin<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-pitcher-js" tabindex="-1"><a class="header-anchor" href="#_4-4-pitcher-js"><span>4.4 pitcher.js</span></a></h3><p>vue-loader\\pitcher.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">pitcher</span> <span class="token operator">=</span> <span class="token parameter">code</span> <span class="token operator">=&gt;</span> code<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">isNotPitcher</span> <span class="token operator">=</span> <span class="token parameter">loader</span> <span class="token operator">=&gt;</span> loader<span class="token punctuation">.</span>path <span class="token operator">!==</span> __filename<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> loaders <span class="token operator">=</span> context<span class="token punctuation">.</span>loaders<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isNotPitcher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>resourceQuery<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genProxyModule</span><span class="token punctuation">(</span>loaders<span class="token punctuation">,</span> context<span class="token punctuation">,</span> query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&#39;template&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">genProxyModule</span><span class="token punctuation">(</span><span class="token parameter">loaders<span class="token punctuation">,</span> context<span class="token punctuation">,</span> exportDefault <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">genRequest</span><span class="token punctuation">(</span>loaders<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>exportDefault <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">export { default } from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; </span><span class="token template-punctuation string">\`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">export * from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>request<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">genRequest</span><span class="token punctuation">(</span><span class="token parameter">loaders<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> loaderStrings <span class="token operator">=</span> loaders<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">loader</span> <span class="token operator">=&gt;</span> loader<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> resource <span class="token operator">=</span> context<span class="token punctuation">.</span>resourcePath <span class="token operator">+</span> context<span class="token punctuation">.</span>resourceQuery<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">contextify</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>context<span class="token punctuation">,</span> <span class="token string">&#39;-!&#39;</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token operator">...</span>loaderStrings<span class="token punctuation">,</span> resource<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">pitcher<span class="token punctuation">.</span>pitch <span class="token operator">=</span> pitch<span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> pitcher<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-select-js" tabindex="-1"><a class="header-anchor" href="#_4-5-select-js"><span>4.5 select.js</span></a></h3><p>vue-loader\\select.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> compiler_sfc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue/compiler-sfc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">selectBlock</span><span class="token punctuation">(</span><span class="token parameter">descriptor<span class="token punctuation">,</span> scopeId<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">script</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> script <span class="token operator">=</span> compiler_sfc<span class="token punctuation">.</span><span class="token function">compileScript</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> scopeId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        loaderContext<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> script<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">exports<span class="token punctuation">.</span>selectBlock <span class="token operator">=</span> selectBlock<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-编译template" tabindex="-1"><a class="header-anchor" href="#_5-编译template"><span>5.编译template</span></a></h2><h3 id="_5-1-src-app-vue" tabindex="-1"><a class="header-anchor" href="#_5-1-src-app-vue"><span>5.1 src\\App.vue</span></a></h3><p>src\\App.vue</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;template&gt;</span>
<span class="line">    &lt;h1&gt;hello&lt;/h1&gt;</span>
<span class="line">&lt;/template&gt;</span>
<span class="line">&lt;script&gt;</span>
<span class="line">console.log(&#39;App&#39;);</span>
<span class="line">&lt;/script&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-vue-loader-index-js" tabindex="-1"><a class="header-anchor" href="#_5-2-vue-loader-index-js"><span>5.2 vue-loader\\index.js</span></a></h3><p>vue-loader\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const compiler = require(&quot;vue/compiler-sfc&quot;);</span>
<span class="line">const hash = require(&quot;hash-sum&quot;);</span>
<span class="line">const VueLoaderPlugin = require(&quot;./plugin&quot;);</span>
<span class="line">const select = require(&quot;./select&quot;);</span>
<span class="line">function loader(source) {</span>
<span class="line">    const loaderContext = this;</span>
<span class="line">    const { resourcePath, resourceQuery = &#39;&#39; } = loaderContext;</span>
<span class="line">    const rawQuery = resourceQuery.slice(1);</span>
<span class="line">    const incomingQuery = new URLSearchParams(rawQuery);</span>
<span class="line">    const { descriptor } = compiler.parse(source);</span>
<span class="line">    const id = hash(resourcePath);</span>
<span class="line">    if (incomingQuery.get(&#39;type&#39;)) {</span>
<span class="line">        return select.selectBlock(descriptor, id, loaderContext, incomingQuery);</span>
<span class="line">    }</span>
<span class="line">    const code = [];</span>
<span class="line">    const { script } = descriptor;</span>
<span class="line">    if (script) {</span>
<span class="line">        const query = \`?vue&amp;type=script&amp;id=\${id}&amp;lang=js\`;</span>
<span class="line">        const scriptRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">        console.log(scriptRequest);</span>
<span class="line">        code.push(\`import script from \${scriptRequest}\`);</span>
<span class="line">    }</span>
<span class="line">+   if (descriptor.template) {</span>
<span class="line">+       const query = \`?vue&amp;type=template&amp;id=\${id}&amp;lang=js\`;</span>
<span class="line">+       const templateRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">+       code.push(\`import {render} from \${templateRequest}\`);</span>
<span class="line">+   }</span>
<span class="line">+   code.push(\`script.render=render\`);</span>
<span class="line">    code.push(\`export default script\`);</span>
<span class="line">    return code.join(&#39;\\n&#39;);</span>
<span class="line">}</span>
<span class="line">loader.VueLoaderPlugin = VueLoaderPlugin;</span>
<span class="line">module.exports = loader;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-plugin-js" tabindex="-1"><a class="header-anchor" href="#_5-3-plugin-js"><span>5.3 plugin.js</span></a></h3><p>vue-loader\\plugin.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">class VueLoaderPlugin {</span>
<span class="line">    apply(compiler) {</span>
<span class="line">        const rules = compiler.options.module.rules;</span>
<span class="line">        const pitcher = {</span>
<span class="line">            loader: require.resolve(&#39;./pitcher&#39;),</span>
<span class="line">            resourceQuery: query =&gt; {</span>
<span class="line">                if (!query) {</span>
<span class="line">                    return false;</span>
<span class="line">                }</span>
<span class="line">                let parsed = new URLSearchParams(query.slice(1));</span>
<span class="line">                return parsed.get(&#39;vue&#39;) !== null;</span>
<span class="line">            }</span>
<span class="line">        };</span>
<span class="line">+       const templateCompilerRule = {</span>
<span class="line">+           loader: require.resolve(&#39;./templateLoader&#39;),</span>
<span class="line">+           resourceQuery: query =&gt; {</span>
<span class="line">+               if (!query) {</span>
<span class="line">+                   return false;</span>
<span class="line">+               }</span>
<span class="line">+               const parsed = new URLSearchParams(query.slice(1));</span>
<span class="line">+               return parsed.get(&#39;vue&#39;) != null &amp;&amp; parsed.get(&#39;type&#39;) === &#39;template&#39;;</span>
<span class="line">+           }</span>
<span class="line">+       };</span>
<span class="line">+       compiler.options.module.rules = [pitcher, templateCompilerRule, ...rules];</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">module.exports = VueLoaderPlugin;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-select-js" tabindex="-1"><a class="header-anchor" href="#_5-4-select-js"><span>5.4 select.js</span></a></h3><p>vue-loader\\select.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> compiler_sfc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue/compiler-sfc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">selectBlock</span><span class="token punctuation">(</span><span class="token parameter">descriptor<span class="token punctuation">,</span> scopeId<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">script</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> script <span class="token operator">=</span> compiler_sfc<span class="token punctuation">.</span><span class="token function">compileScript</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> scopeId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        loaderContext<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> script<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">template</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">const</span> template <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>template<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       loaderContext<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> template<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">exports<span class="token punctuation">.</span>selectBlock <span class="token operator">=</span> selectBlock<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-templateloader-js" tabindex="-1"><a class="header-anchor" href="#_5-5-templateloader-js"><span>5.5 templateLoader.js</span></a></h3><p>vue-loader\\templateLoader.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> compiler_sfc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue/compiler-sfc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">TemplateLoader</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> loaderContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>loaderContext<span class="token punctuation">.</span>resourceQuery<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> scopeId <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> compiler_sfc<span class="token punctuation">.</span><span class="token function">compileTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        source<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">id</span><span class="token operator">:</span> scopeId</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    loaderContext<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> TemplateLoader<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-编译style" tabindex="-1"><a class="header-anchor" href="#_6-编译style"><span>6.编译style</span></a></h2><h3 id="_6-1-webpack-config-js" tabindex="-1"><a class="header-anchor" href="#_6-1-webpack-config-js"><span>6.1 webpack.config.js</span></a></h3><p>webpack.config.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const { VueLoaderPlugin } = require(&#39;./vue-loader&#39;)</span>
<span class="line">const HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;)</span>
<span class="line">const webpack = require(&#39;webpack&#39;)</span>
<span class="line">const path = require(&#39;path&#39;)</span>
<span class="line">module.exports = {</span>
<span class="line">    mode: &#39;development&#39;,</span>
<span class="line">    devtool: false,</span>
<span class="line">    entry: &#39;./src/main.js&#39;,</span>
<span class="line">    module: {</span>
<span class="line">        rules: [</span>
<span class="line">            {</span>
<span class="line">                test: /\\.vue$/,</span>
<span class="line">                loader: path.resolve(__dirname, &#39;vue-loader&#39;)</span>
<span class="line">            },</span>
<span class="line">+           {</span>
<span class="line">+               test: /\\.css$/,</span>
<span class="line">+               use: [</span>
<span class="line">+                   &#39;style-loader&#39;,</span>
<span class="line">+                   &#39;css-loader&#39;</span>
<span class="line">+               ]</span>
<span class="line">+           }</span>
<span class="line">        ]</span>
<span class="line">    },</span>
<span class="line">    plugins: [</span>
<span class="line">        new VueLoaderPlugin(),</span>
<span class="line">        new HtmlWebpackPlugin({</span>
<span class="line">            template: &#39;./src/index.html&#39;</span>
<span class="line">        }),</span>
<span class="line">        new webpack.DefinePlugin({</span>
<span class="line">            __VUE_OPTIONS_API__: true,</span>
<span class="line">            __VUE_PROD_DEVTOOLS__: true</span>
<span class="line">        })</span>
<span class="line">    ]</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-app-vue" tabindex="-1"><a class="header-anchor" href="#_6-2-app-vue"><span>6.2 App.vue</span></a></h3><p>src\\App.vue</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;template&gt;</span>
<span class="line">+   &lt;h1 class=&quot;title&quot;&gt;hello&lt;/h1&gt;</span>
<span class="line">&lt;/template&gt;</span>
<span class="line">&lt;script&gt;</span>
<span class="line">console.log(&#39;App&#39;);</span>
<span class="line">&lt;/script&gt;</span>
<span class="line">+&lt;style&gt;</span>
<span class="line">+.title {</span>
<span class="line">+    color: red;</span>
<span class="line">+}</span>
<span class="line">+&lt;/style&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-vue-loader-index-js" tabindex="-1"><a class="header-anchor" href="#_6-3-vue-loader-index-js"><span>6.3 vue-loader\\index.js</span></a></h3><p>vue-loader\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const compiler = require(&quot;vue/compiler-sfc&quot;);</span>
<span class="line">const hash = require(&quot;hash-sum&quot;);</span>
<span class="line">const VueLoaderPlugin = require(&quot;./plugin&quot;);</span>
<span class="line">const select = require(&quot;./select&quot;);</span>
<span class="line">function loader(source) {</span>
<span class="line">    const loaderContext = this;</span>
<span class="line">    const { resourcePath, resourceQuery = &#39;&#39; } = loaderContext;</span>
<span class="line">    const rawQuery = resourceQuery.slice(1);</span>
<span class="line">    const incomingQuery = new URLSearchParams(rawQuery);</span>
<span class="line">    const { descriptor } = compiler.parse(source);</span>
<span class="line">    const id = hash(resourcePath);</span>
<span class="line">    if (incomingQuery.get(&#39;type&#39;)) {</span>
<span class="line">        return select.selectBlock(descriptor, id, loaderContext, incomingQuery);</span>
<span class="line">    }</span>
<span class="line">    const code = [];</span>
<span class="line">    const { script } = descriptor;</span>
<span class="line">    if (script) {</span>
<span class="line">        const query = \`?vue&amp;type=script&amp;id=\${id}&amp;lang=js\`;</span>
<span class="line">        const scriptRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">        console.log(scriptRequest);</span>
<span class="line">        code.push(\`import script from \${scriptRequest}\`);</span>
<span class="line">    }</span>
<span class="line">    if (descriptor.template) {</span>
<span class="line">        const query = \`?vue&amp;type=template&amp;id=\${id}&amp;lang=js\`;</span>
<span class="line">        const templateRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">        code.push(\`import {render} from \${templateRequest}\`);</span>
<span class="line">    }</span>
<span class="line">+   if (descriptor.styles.length) {</span>
<span class="line">+       descriptor.styles.forEach((style, i) =&gt; {</span>
<span class="line">+           const query = \`?vue&amp;type=style&amp;index=\${i}&amp;id=\${id}&amp;lang=css\`;</span>
<span class="line">+           const styleRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">+           code.push(\`import \${styleRequest}\`);</span>
<span class="line">+       })</span>
<span class="line">+   }</span>
<span class="line">    code.push(\`script.render=render\`);</span>
<span class="line">    code.push(\`export default script\`);</span>
<span class="line">    return code.join(&#39;\\n&#39;);</span>
<span class="line">}</span>
<span class="line">loader.VueLoaderPlugin = VueLoaderPlugin;</span>
<span class="line">module.exports = loader;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-4-plugin-js" tabindex="-1"><a class="header-anchor" href="#_6-4-plugin-js"><span>6.4 plugin.js</span></a></h3><p>vue-loader\\plugin.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">+</span><span class="token keyword">const</span> <span class="token function-variable function">langBlockRuleResource</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">query<span class="token punctuation">,</span> resource</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>resource<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;lang&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">VueLoaderPlugin</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> rules <span class="token operator">=</span> compiler<span class="token punctuation">.</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> pitcher <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;./pitcher&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">resourceQuery</span><span class="token operator">:</span> <span class="token parameter">query</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">let</span> parsed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> parsed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">const</span> vueRule <span class="token operator">=</span> rules<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;foo.vue&#39;</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">const</span> clonedRules <span class="token operator">=</span> rules<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=&gt;</span> rule <span class="token operator">!==</span> vueRule<span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>           <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=&gt;</span> <span class="token function">cloneRule</span><span class="token punctuation">(</span>rule<span class="token punctuation">,</span> langBlockRuleResource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> templateCompilerRule <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;./templateLoader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">resourceQuery</span><span class="token operator">:</span> <span class="token parameter">query</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">const</span> parsed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> parsed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> parsed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;template&#39;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       compiler<span class="token punctuation">.</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token punctuation">[</span>pitcher<span class="token punctuation">,</span> templateCompilerRule<span class="token punctuation">,</span> <span class="token operator">...</span>clonedRules<span class="token punctuation">,</span> <span class="token operator">...</span>rules<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> <span class="token function">cloneRule</span><span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> ruleResource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">let</span> currentResource<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">const</span> res <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rule<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token function-variable function">resource</span><span class="token operator">:</span> <span class="token parameter">resources</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            currentResource <span class="token operator">=</span> resources<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token function-variable function">resourceQuery</span><span class="token operator">:</span> <span class="token parameter">query</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">const</span> parsed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>parsed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token comment">//取出路径中的lang参数，生成一个虚拟路径，传入规则中判断是否满足  </span></span>
<span class="line"><span class="token operator">+</span>            <span class="token comment">//通过这种方式，vue-loader可以为不同的区块匹配rule规则 </span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">const</span> fakeResourcePath <span class="token operator">=</span> <span class="token function">ruleResource</span><span class="token punctuation">(</span>parsed<span class="token punctuation">,</span> currentResource<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fakeResourcePath<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>        <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">delete</span> res<span class="token punctuation">.</span>test<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">return</span> res<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> VueLoaderPlugin<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-5-select-js" tabindex="-1"><a class="header-anchor" href="#_6-5-select-js"><span>6.5 select.js</span></a></h3><p>vue-loader\\select.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> compiler_sfc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue/compiler-sfc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">selectBlock</span><span class="token punctuation">(</span><span class="token parameter">descriptor<span class="token punctuation">,</span> scopeId<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">script</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> script <span class="token operator">=</span> compiler_sfc<span class="token punctuation">.</span><span class="token function">compileScript</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> scopeId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        loaderContext<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> script<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">template</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> template <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>template<span class="token punctuation">;</span></span>
<span class="line">        loaderContext<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> template<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">style</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">&amp;&amp;</span> query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">const</span> style <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>styles<span class="token punctuation">[</span><span class="token function">Number</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       loaderContext<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> style<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>       <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">exports<span class="token punctuation">.</span>selectBlock <span class="token operator">=</span> selectBlock<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-scoped-css" tabindex="-1"><a class="header-anchor" href="#_7-scoped-css"><span>7.Scoped CSS</span></a></h2><ul><li>当<code>style</code>标签有<a href="https://vue-loader.vuejs.org/zh/guide/scoped-css.html" target="_blank" rel="noopener noreferrer">scoped</a>属性时，它的 CSS 只作用于当前组件中的元素</li></ul><h3 id="_7-1-app-vue" tabindex="-1"><a class="header-anchor" href="#_7-1-app-vue"><span>7.1 App.vue</span></a></h3><p>src\\App.vue</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;template&gt;</span>
<span class="line">    &lt;h1 class=&quot;title&quot;&gt;hello&lt;/h1&gt;</span>
<span class="line">&lt;/template&gt;</span>
<span class="line">&lt;script&gt;</span>
<span class="line">console.log(&#39;App&#39;);</span>
<span class="line">&lt;/script&gt;</span>
<span class="line">+&lt;style scoped&gt;</span>
<span class="line">+.title {</span>
<span class="line">+    color: red;</span>
<span class="line">+}</span>
<span class="line">+&lt;/style&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-vue-loader-index-js" tabindex="-1"><a class="header-anchor" href="#_7-2-vue-loader-index-js"><span>7.2 vue-loader\\index.js</span></a></h3><p>vue-loader\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const compiler = require(&quot;vue/compiler-sfc&quot;);</span>
<span class="line">const hash = require(&quot;hash-sum&quot;);</span>
<span class="line">const VueLoaderPlugin = require(&quot;./plugin&quot;);</span>
<span class="line">const select = require(&quot;./select&quot;);</span>
<span class="line">function loader(source) {</span>
<span class="line">    const loaderContext = this;</span>
<span class="line">    const { resourcePath, resourceQuery = &#39;&#39; } = loaderContext;</span>
<span class="line">    const rawQuery = resourceQuery.slice(1);</span>
<span class="line">    const incomingQuery = new URLSearchParams(rawQuery);</span>
<span class="line">    const { descriptor } = compiler.parse(source);</span>
<span class="line">    const id = hash(resourcePath);</span>
<span class="line">    if (incomingQuery.get(&#39;type&#39;)) {</span>
<span class="line">        return select.selectBlock(descriptor, id, loaderContext, incomingQuery);</span>
<span class="line">    }</span>
<span class="line">+    const hasScoped = descriptor.styles.some(s =&gt; s.scoped);</span>
<span class="line">    const code = [];</span>
<span class="line">    const { script } = descriptor;</span>
<span class="line">    if (script) {</span>
<span class="line">        const query = \`?vue&amp;type=script&amp;id=\${id}&amp;lang=js\`;</span>
<span class="line">        const scriptRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">        code.push(\`import script from \${scriptRequest}\`);</span>
<span class="line">    }</span>
<span class="line">    if (descriptor.template) {</span>
<span class="line">+       const scopedQuery = hasScoped ? \`&amp;scoped=true\` : \`\`;</span>
<span class="line">+       const query = \`?vue&amp;type=template&amp;id=\${id}\${scopedQuery}&amp;lang=js\`;</span>
<span class="line">        const templateRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">        code.push(\`import {render} from \${templateRequest}\`);</span>
<span class="line">    }</span>
<span class="line">    if (descriptor.styles.length) {</span>
<span class="line">        descriptor.styles.forEach((style, i) =&gt; {</span>
<span class="line">+           const scopedQuery = style.scoped ? \`&amp;scoped=true\` : \`\`;</span>
<span class="line">+           const query = \`?vue&amp;type=style&amp;index=\${i}&amp;id=\${id}\${scopedQuery}&amp;lang=css\`;</span>
<span class="line">            const styleRequest = JSON.stringify(loaderContext.utils.contextify(loaderContext.context, resourcePath + query));</span>
<span class="line">            code.push(\`import \${styleRequest}\`);</span>
<span class="line">        })</span>
<span class="line">    }</span>
<span class="line">+   if (hasScoped) {</span>
<span class="line">+       code.push(\`script.__scopeId = &quot;data-v-\${id}&quot;\`);</span>
<span class="line">+   }</span>
<span class="line">    code.push(\`script.render=render\`);</span>
<span class="line">    code.push(\`export default script\`);</span>
<span class="line">    return code.join(&#39;\\n&#39;);</span>
<span class="line">}</span>
<span class="line">loader.VueLoaderPlugin = VueLoaderPlugin;</span>
<span class="line">module.exports = loader;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-pitcher-js" tabindex="-1"><a class="header-anchor" href="#_7-3-pitcher-js"><span>7.3 pitcher.js</span></a></h3><p>vue-loader\\pitcher.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+const isCSSLoader = loader =&gt; /css-loader/.test(loader.path);</span>
<span class="line">+const stylePostLoaderPath = require.resolve(&#39;./stylePostLoader&#39;);</span>
<span class="line">const pitcher = code =&gt; code;</span>
<span class="line">const isNotPitcher = loader =&gt; loader.path !== __filename;</span>
<span class="line">const pitch = function () {</span>
<span class="line">    const context = this;</span>
<span class="line">    const loaders = context.loaders.filter(isNotPitcher);</span>
<span class="line">    const query = new URLSearchParams(context.resourceQuery.slice(1));</span>
<span class="line">+   if (query.get(&#39;type&#39;) === \`style\`) {</span>
<span class="line">+       const cssLoaderIndex = loaders.findIndex(isCSSLoader);</span>
<span class="line">+       if (cssLoaderIndex &gt; -1) {</span>
<span class="line">+           const afterLoaders = loaders.slice(0, cssLoaderIndex + 1);</span>
<span class="line">+           const beforeLoaders = loaders.slice(cssLoaderIndex + 1);</span>
<span class="line">+           return genProxyModule([...afterLoaders, stylePostLoaderPath, ...beforeLoaders], context);</span>
<span class="line">+       }</span>
<span class="line">+   }</span>
<span class="line">    return genProxyModule(loaders, context, query.get(&#39;type&#39;) !== &#39;template&#39;);</span>
<span class="line">}</span>
<span class="line">function genProxyModule(loaders, context, exportDefault = true) {</span>
<span class="line">    const request = genRequest(loaders, context);</span>
<span class="line">    return (exportDefault ? \`export { default } from \${request}; \` : \`\`) + \`export * from \${request}\`;</span>
<span class="line">}</span>
<span class="line">function genRequest(loaders, context) {</span>
<span class="line">+   const loaderStrings = loaders.map(loader =&gt; loader.request || loader);</span>
<span class="line">    const resource = context.resourcePath + context.resourceQuery;</span>
<span class="line">    return JSON.stringify(context.utils.contextify(context.context, &#39;-!&#39; + [...loaderStrings, resource].join(&#39;!&#39;)));</span>
<span class="line">}</span>
<span class="line">pitcher.pitch = pitch;</span>
<span class="line">module.exports = pitcher;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-stylepostloader-js" tabindex="-1"><a class="header-anchor" href="#_7-4-stylepostloader-js"><span>7.4 stylePostLoader.js</span></a></h3><p>vue-loader\\stylePostLoader.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> compiler_sfc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue/compiler-sfc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">StylePostLoader</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceQuery<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> compiler_sfc<span class="token punctuation">.</span><span class="token function">compileStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        source<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">data-v-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">scoped</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;scoped&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> StylePostLoader<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,111)])])}const o=n(t,[["render",l]]),u=JSON.parse('{"path":"/strong/156.vue-loader.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/156.vue-loader.md"}');export{o as comp,u as data};
