import{_ as a,c as n,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(r,s){return p(),n("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-cicd" tabindex="-1"><a class="header-anchor" href="#_1-cicd"><span>1.CICD</span></a></h2><ul><li>CI 的意思是 持续构建 。负责拉取代码库中的代码后，执行用户预置定义好的操作脚本，通过一系列编译操作构建出一个 制品 ，并将制品推送至到制品库里面。常用工具有 Gitlab CI，Github CI，Jenkins 等。这个环节不参与部署，只负责构建代码，然后保存构建物。构建物被称为 制品，保存制品的地方被称为 <code>制品库</code></li><li>CD 则有2层含义： 持续部署（Continuous Deployment） 和 持续交付（Continuous Delivery） 。 持续交付 的概念是：将制品库的制品拿出后，部署在测试环境 / 交付给客户提前测试。 持续部署 则是将制品部署在生产环境。</li></ul><h2 id="_2-服务器" tabindex="-1"><a class="header-anchor" href="#_2-服务器"><span>2. 服务器</span></a></h2><table><thead><tr><th style="text-align:left;">配置</th><th style="text-align:left;">技术栈</th><th style="text-align:left;">类型</th><th style="text-align:left;">标签</th></tr></thead><tbody><tr><td style="text-align:left;">2核4G</td><td style="text-align:left;">Jenkins + Nexus + Docker</td><td style="text-align:left;">Cloud</td><td style="text-align:left;">构建机</td></tr><tr><td style="text-align:left;">2核4G</td><td style="text-align:left;">Docker + Kubernetes</td><td style="text-align:left;">Cloud</td><td style="text-align:left;">kubernetes Master</td></tr><tr><td style="text-align:left;">1核1G</td><td style="text-align:left;">Docker + Kubernetes</td><td style="text-align:left;">Cloud</td><td style="text-align:left;">kubernetes Node</td></tr></tbody></table><h2 id="_3-构建机ci" tabindex="-1"><a class="header-anchor" href="#_3-构建机ci"><span>3. 构建机CI</span></a></h2><p><img src="https://img.zhufengpeixun.com/0cafb0ad2ba216ef1c566ea98ce8cb30" alt="0cafb0ad2ba216ef1c566ea98ce8cb30"></p><h3 id="_3-1-安装docker" tabindex="-1"><a class="header-anchor" href="#_3-1-安装docker"><span>3.1 安装docker</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils device<span class="token operator">-</span>mapper<span class="token operator">-</span>persistent<span class="token operator">-</span>data lvm2</span>
<span class="line">sudo yum<span class="token operator">-</span>config<span class="token operator">-</span>manager <span class="token operator">--</span>add<span class="token operator">-</span>repo http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo</span>
<span class="line">yum install docker<span class="token operator">-</span>ce <span class="token operator">-</span>y</span>
<span class="line">systemctl start docker</span>
<span class="line">systemctl enable docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置阿里云镜像源</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo mkdir -p /etc/docker</span>
<span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;</span>
<span class="line">{</span>
<span class="line">  &quot;registry-mirrors&quot;: [&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;]</span>
<span class="line">}</span>
<span class="line">EOF</span>
<span class="line"> </span>
<span class="line">sudo systemctl daemon-reload</span>
<span class="line">sudo systemctl restart docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-安装-git" tabindex="-1"><a class="header-anchor" href="#_3-2-安装-git"><span>3.2 安装 git</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum install git -y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-3-安装-jenkins" tabindex="-1"><a class="header-anchor" href="#_3-3-安装-jenkins"><span>3.3 安装 Jenkins</span></a></h3><ul><li>Jenkins 是一个基于 Java 语言开发的持续构建工具平台，主要用于持续、自动的构建/测试你的软件和项目。它可以执行你预先设定好的设置和构建脚本，也可以和 Git 代码库做集成，实现自动触发和定时触发构建</li></ul><h4 id="_3-3-1-安装java" tabindex="-1"><a class="header-anchor" href="#_3-3-1-安装java"><span>3.3.1 安装java</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum install -y java</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-2-安装jenkins" tabindex="-1"><a class="header-anchor" href="#_3-3-2-安装jenkins"><span>3.3.2 安装jenkins</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">sudo wget <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>repo https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>img<span class="token punctuation">.</span>zhufengpeixun<span class="token punctuation">.</span>com<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>repo</span>
<span class="line">sudo rpm <span class="token operator">--</span><span class="token keyword">import</span> <span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>img<span class="token punctuation">.</span>zhufengpeixun<span class="token punctuation">.</span>com<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>io<span class="token punctuation">.</span>key</span>
<span class="line">yum install jenkins <span class="token operator">-</span>y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-3-启动-jenkins" tabindex="-1"><a class="header-anchor" href="#_3-2-3-启动-jenkins"><span>3.2.3 启动 Jenkins</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> systemctl start jenkins.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-4-开放端口" tabindex="-1"><a class="header-anchor" href="#_3-3-4-开放端口"><span>3.3.4 开放端口</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>zone<span class="token operator">=</span><span class="token keyword">public</span> <span class="token operator">--</span>add<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">8080</span><span class="token operator">/</span>tcp <span class="token operator">--</span>permanent</span>
<span class="line">firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>zone<span class="token operator">=</span><span class="token keyword">public</span> <span class="token operator">--</span>add<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">50000</span><span class="token operator">/</span>tcp <span class="token operator">--</span>permanent</span>
<span class="line">systemctl reload firewalld</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-5-打开浏览器访问" tabindex="-1"><a class="header-anchor" href="#_3-3-5-打开浏览器访问"><span>3.3.5 打开浏览器访问</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">8.136.218.128:8080</span><span class="token regex-delimiter">/</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-6-查看密码" tabindex="-1"><a class="header-anchor" href="#_3-3-6-查看密码"><span>3.3.6 查看密码</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">cat <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>jenkins<span class="token operator">/</span>secrets<span class="token operator">/</span>initialAdminPassword</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-7-修改插件镜像" tabindex="-1"><a class="header-anchor" href="#_3-3-7-修改插件镜像"><span>3.3.7 修改插件镜像</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">sed <span class="token operator">-</span>i <span class="token string">&#39;s/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g&#39;</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>jenkins<span class="token operator">/</span>updates<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>json <span class="token operator">&amp;&amp;</span> sed <span class="token operator">-</span>i <span class="token string">&#39;s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g&#39;</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>jenkins<span class="token operator">/</span>updates<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>json</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-8-添加到docker用户组里" tabindex="-1"><a class="header-anchor" href="#_3-3-8-添加到docker用户组里"><span>3.3.8 添加到docker用户组里</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> sudo gpasswd -a jenkins docker  </span>
<span class="line"> newgrp docker                 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-9-新建任务" tabindex="-1"><a class="header-anchor" href="#_3-3-9-新建任务"><span>3.3.9 新建任务</span></a></h4><ul><li><a href="http://8.136.218.128:8080/view/all/newJob" target="_blank" rel="noopener noreferrer">http://8.136.218.128:8080/view/all/newJob</a></li><li>新建任务=&gt;构建一个自由风格的软件项目=&gt;配置&gt;增加构建步骤</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker -v</span>
<span class="line">docker pull node:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-安装nodejs" tabindex="-1"><a class="header-anchor" href="#_3-3-安装nodejs"><span>3.3 安装Nodejs</span></a></h3><ul><li>系统管理 =&gt; 插件管理 =&gt; 可选插件 =》 安装NodeJS插件</li><li>全局工具配置 =&gt; NodeJS =&gt; 新增NodeJS</li><li>任务的配置=&gt;构建环境=&gt;选中 <code>Provide Node &amp; npm bin/ folder to PATH</code></li></ul><p>默认会拉取这个地址的安装包，但有可能会失败,失败之后可以重复，这个只需要执行一次就可以了</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">Unpacking https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nodejs<span class="token punctuation">.</span>org<span class="token operator">/</span>dist<span class="token operator">/</span>v15<span class="token punctuation">.</span><span class="token number">11.0</span><span class="token operator">/</span>node<span class="token operator">-</span>v15<span class="token punctuation">.</span><span class="token number">11.0</span><span class="token operator">-</span>linux<span class="token operator">-</span>x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz to <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>jenkins<span class="token operator">/</span>tools<span class="token operator">/</span>jenkins<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>nodejs<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>NodeJSInstallation<span class="token operator">/</span>nodejs15<span class="token punctuation">.</span><span class="token number">11.0</span> on Jenkins</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-4-集成-git-仓库" tabindex="-1"><a class="header-anchor" href="#_3-4-集成-git-仓库"><span>3.4 集成 Git 仓库</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/reactproject" target="_blank" rel="noopener noreferrer">项目仓库</a></li></ul><h4 id="_3-4-1-生成公钥私钥" tabindex="-1"><a class="header-anchor" href="#_3-4-1-生成公钥私钥"><span>3.4.1 生成公钥私钥</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">ssh<span class="token operator">-</span>keygen <span class="token operator">-</span>t rsa <span class="token operator">-</span><span class="token constant">C</span> <span class="token string">&quot;zhufengnodejs@126.com&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-4-2-gitee-配置公钥" tabindex="-1"><a class="header-anchor" href="#_3-4-2-gitee-配置公钥"><span>3.4.2 Gitee 配置公钥</span></a></h4><ul><li>设置=&gt;安全设置 =&gt; SSH公钥</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cat ~/.ssh/id_rsa.pub </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-4-3-在jenkins-配置私钥" tabindex="-1"><a class="header-anchor" href="#_3-4-3-在jenkins-配置私钥"><span>3.4.3 在Jenkins 配置私钥</span></a></h4><ul><li>在 Jenkins 中，私钥/密码 等认证信息都是以 凭证 的方式管理的</li><li>一定要确保先安装git <code>yum install git -y</code></li><li>配置 =&gt; 源码管理 =&gt; Git =&gt; Repositories</li><li>Credentials =&gt; 添加 =&gt; SSH Username with private key <ul><li>Username <a href="mailto:zhufengnodejs@126.com" target="_blank" rel="noopener noreferrer">zhufengnodejs@126.com</a></li></ul></li></ul><h3 id="_3-5-构建镜像" tabindex="-1"><a class="header-anchor" href="#_3-5-构建镜像"><span>3.5 构建镜像</span></a></h3><h4 id="_3-5-1-编写-dockerfile" tabindex="-1"><a class="header-anchor" href="#_3-5-1-编写-dockerfile"><span>3.5.1 编写 Dockerfile</span></a></h4><p>Dockerfile</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">FROM</span> <span class="token literal-property property">nginx</span><span class="token operator">:</span><span class="token number">1.15</span></span>
<span class="line"><span class="token constant">COPY</span> build <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>html</span>
<span class="line"><span class="token constant">COPY</span> conf <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span></span>
<span class="line"><span class="token constant">WORKDIR</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>html</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>conf\\site</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">server <span class="token punctuation">{</span></span>
<span class="line">    listen       <span class="token number">80</span><span class="token punctuation">;</span></span>
<span class="line">    server_name  _<span class="token punctuation">;</span></span>
<span class="line">    root         <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-2-jenkins配置脚本" tabindex="-1"><a class="header-anchor" href="#_3-5-2-jenkins配置脚本"><span>3.5.2 Jenkins配置脚本</span></a></h4><ul><li>构建 =&gt; 执行Shell</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> </span>
<span class="line"></span>
<span class="line">npm install <span class="token operator">--</span>registry<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org</span>
<span class="line">npm run build</span>
<span class="line">docker build <span class="token operator">-</span>t react<span class="token operator">-</span>project <span class="token punctuation">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-3-执行任务" tabindex="-1"><a class="header-anchor" href="#_3-5-3-执行任务"><span>3.5.3 执行任务</span></a></h4><h3 id="_3-6-上传私有镜像库" tabindex="-1"><a class="header-anchor" href="#_3-6-上传私有镜像库"><span>3.6 上传私有镜像库</span></a></h3><ul><li>镜像库就是集中存放镜像的一个文件服务</li><li>镜像库在 CI/CD 中，又称 制品库</li><li>构建后的产物称为制品，制品则要放到制品库做中转和版本管理</li><li>常用平台有Nexus、Jfrog和Harbor或其他对象存储平台</li></ul><h4 id="_3-6-1-部署-nexus-服务" tabindex="-1"><a class="header-anchor" href="#_3-6-1-部署-nexus-服务"><span>3.6.1 部署 Nexus 服务</span></a></h4><ul><li>nexus-3.29.0-02 是nexus主程序文件夹</li><li>sonatype-work 则是数据文件</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">cd <span class="token operator">/</span>usr<span class="token operator">/</span>local</span>
<span class="line">wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dependency<span class="token operator">-</span>fe<span class="token punctuation">.</span>oss<span class="token operator">-</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>nexus<span class="token operator">-</span><span class="token number">3.29</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span>unix<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</span>
<span class="line">tar <span class="token operator">-</span>zxvf <span class="token punctuation">.</span><span class="token operator">/</span>nexus<span class="token operator">-</span><span class="token number">3.29</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span>unix<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</span>
<span class="line">cd nexus<span class="token operator">-</span><span class="token number">3.29</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">/</span>bin</span>
<span class="line"><span class="token punctuation">.</span><span class="token operator">/</span>nexus start</span>
<span class="line"></span>
<span class="line">firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>zone<span class="token operator">=</span><span class="token keyword">public</span> <span class="token operator">--</span>add<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">8081</span><span class="token operator">/</span>tcp <span class="token operator">--</span>permanent</span>
<span class="line">firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>zone<span class="token operator">=</span><span class="token keyword">public</span> <span class="token operator">--</span>add<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">8082</span><span class="token operator">/</span>tcp <span class="token operator">--</span>permanent</span>
<span class="line"></span>
<span class="line"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">8.136.218.128:8081</span><span class="token regex-delimiter">/</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>nexus 还支持停止，重启等命令。可以在 bin 目录下执行 ./nexus help 查看更多命令</p></blockquote><h4 id="_3-6-2-配置-nexus" tabindex="-1"><a class="header-anchor" href="#_3-6-2-配置-nexus"><span>3.6.2 配置 Nexus</span></a></h4><ul><li>可以使用admin用户登录Nexus</li><li>注意请立即更改密码</li><li>Enable anonymous access</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cat /root/sonatype-work/nexus3/admin.password </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-6-3-创建docker私服" tabindex="-1"><a class="header-anchor" href="#_3-6-3-创建docker私服"><span>3.6.3 创建Docker私服</span></a></h4><ul><li><p>登录 =&gt; 齿轮图标 =&gt; Repositories =&gt; Create repository =&gt; docker(hosted) =&gt; HTTP(8082)</p></li><li><p>proxy: 此类型制品库原则上只下载，不允许用户推送</p></li><li><p>hosted：此类型制品库和 proxy 相反，原则上 只允许用户推送，不允许缓存。这里只存放自己的私有镜像或制品</p></li><li><p>group：此类型制品库可以将以上两种类型的制品库组合起来</p></li></ul><h4 id="_3-6-4-添加访问权限" tabindex="-1"><a class="header-anchor" href="#_3-6-4-添加访问权限"><span>3.6.4 添加访问权限</span></a></h4><ul><li>齿轮图标 =&gt; Realms =&gt; Docker Bearer Token Realm =&gt; 添加到右边的 Active =&gt;保存</li><li>copy <a href="http://118.190.142.109:8081/repository/dockcer-repository/" target="_blank" rel="noopener noreferrer">http://118.190.142.109:8081/repository/dockcer-repository/</a></li></ul><h4 id="_3-6-5-登录制品库" tabindex="-1"><a class="header-anchor" href="#_3-6-5-登录制品库"><span>3.6.5 登录制品库</span></a></h4><p>vi /etc/docker/daemon.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;insecure-registries&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&quot;8.136.218.128:8082&quot;</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">systemctl restart docker</span>
<span class="line">docker login <span class="token number">8.136</span><span class="token number">.218</span><span class="token number">.128</span><span class="token operator">:</span><span class="token number">8082</span> <span class="token comment">//注意此处要和insecure-registries里的地址一致</span></span>
<span class="line"><span class="token literal-property property">Username</span><span class="token operator">:</span> admin</span>
<span class="line"><span class="token literal-property property">Password</span><span class="token operator">:</span> <span class="token number">123456</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-6-6-推送镜像到制品库" tabindex="-1"><a class="header-anchor" href="#_3-6-6-推送镜像到制品库"><span>3.6.6 推送镜像到制品库</span></a></h4><ul><li>设置界面 =&gt; 构建环境 =&gt; 勾选 Use secret text(s) or file(s) =&gt; 新增选择 =&gt; Username and password (separated) <ul><li>DOCKER_LOGIN_USERNAME</li><li>DOCKER_LOGIN_PASSWORD</li></ul></li><li>接着在下面指定凭据=&gt;添加jenkins=&gt;选择类型<code>Username with password</code>,输入用户名和密码然后点添加确定</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> </span>
<span class="line"></span>
<span class="line">npm install <span class="token operator">--</span>registry<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org</span>
<span class="line">npm run build</span>
<span class="line">docker build <span class="token operator">-</span>t <span class="token number">8.136</span><span class="token number">.218</span><span class="token number">.128</span><span class="token operator">:</span><span class="token number">8082</span><span class="token operator">/</span>react<span class="token operator">-</span>project <span class="token punctuation">.</span></span>
<span class="line">docker login <span class="token operator">-</span>u $<span class="token constant">DOCKER_LOGIN_USERNAME</span> <span class="token operator">-</span>p $<span class="token constant">DOCKER_LOGIN_PASSWORD</span> <span class="token number">8.136</span><span class="token number">.218</span><span class="token number">.128</span><span class="token operator">:</span><span class="token number">8082</span></span>
<span class="line">docker push <span class="token number">8.136</span><span class="token number">.218</span><span class="token number">.128</span><span class="token operator">:</span><span class="token number">8082</span><span class="token operator">/</span>react<span class="token operator">-</span>project</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>然后就可以查看镜像了,注意端口是8081</li><li>[http://8.136.218.128:8081/#browse/browse:docker-repository](http://8.136.218.128:8081/</li></ul>`,77)])])}const i=a(t,[["render",l]]),c=JSON.parse('{"path":"/strong/125.12.ci.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/125.12.ci.md"}');export{i as comp,c as data};
