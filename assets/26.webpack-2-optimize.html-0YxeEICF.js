import{_ as n,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const l={};function t(i,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-purgecss-webpack-plugin" tabindex="-1"><a class="header-anchor" href="#_1-purgecss-webpack-plugin"><span>1. purgecss-webpack-plugin</span></a></h2><ul><li><a href="https://www.purgecss.com/" target="_blank" rel="noopener noreferrer">purgecss</a></li><li>可以去除未使用的 css，一般与 glob、glob-all 配合使用</li><li>必须和<code>mini-css-extract-plugin</code>配合使用</li><li><code>paths</code>路径是绝对路径</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm i -D purgecss-webpack-plugin mini-css-extract-plugin glob</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>webpack.config.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ const glob = require(&#39;glob&#39;);</span>
<span class="line">+ const PurgecssPlugin = require(&#39;purgecss-webpack-plugin&#39;);</span>
<span class="line"></span>
<span class="line">module.exports = {</span>
<span class="line">  mode: &#39;development&#39;,</span>
<span class="line">  plugins: [</span>
<span class="line">+    new PurgecssPlugin({</span>
<span class="line">+      paths: glob.sync(\`\${path.join(__dirname, &#39;src&#39;)}/**/*\`</span>
<span class="line">+    }),</span>
<span class="line">  ],</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">plugins: [</span>
<span class="line">+        new MiniCssExtractPlugin({</span>
<span class="line">+            filename: &#39;[name].css&#39;,</span>
<span class="line">+            chunkFilename:&#39;[id].css&#39;</span>
<span class="line">+        }),</span>
<span class="line"></span>
<span class="line">{</span>
<span class="line">                test: /\\.css/,</span>
<span class="line">                include: path.resolve(__dirname,&#39;src&#39;),</span>
<span class="line">                exclude: /node_modules/,</span>
<span class="line">                use: [{</span>
<span class="line">+                    loader: MiniCssExtractPlugin.loader</span>
<span class="line">                },&#39;css-loader&#39;]</span>
<span class="line">            }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-dll" tabindex="-1"><a class="header-anchor" href="#_2-dll"><span>2.DLL</span></a></h2><ul><li><code>.dll</code>为后缀的文件称为动态链接库，在一个动态链接库中可以包含给其他模块调用的函数和数据</li><li>把基础模块独立出来打包到单独的动态连接库里</li><li>当需要导入的模块在动态连接库里的时候，模块不能再次被打包，而是去动态连接库里获取</li><li><a href="https://webpack.js.org/plugins/dll-plugin/" target="_blank" rel="noopener noreferrer">dll-plugin</a></li></ul><h3 id="_2-1-定义dll" tabindex="-1"><a class="header-anchor" href="#_2-1-定义dll"><span>2.1 定义Dll</span></a></h3><ul><li>DllPlugin插件： 用于打包出一个个动态连接库</li><li>DllReferencePlugin: 在配置文件中引入DllPlugin插件打包好的动态连接库</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> DllPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack/lib/DllPlugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">react</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 把 React 相关模块的放到一个单独的动态链接库</span></span>
<span class="line">    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 输出的文件都放到 dist 目录下</span></span>
<span class="line">        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].dll.js&#39;</span><span class="token punctuation">,</span><span class="token comment">//输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称</span></span>
<span class="line">        <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&#39;_dll_[name]&#39;</span><span class="token punctuation">,</span><span class="token comment">//存放动态链接库的全局变量名称,例如对应 react 来说就是 _dll_react</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token keyword">new</span> <span class="token class-name">DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 动态链接库的全局变量名称，需要和 output.library 中保持一致</span></span>
<span class="line">            <span class="token comment">// 该字段的值也就是输出的 manifest.json 文件 中 name 字段的值</span></span>
<span class="line">            <span class="token comment">// 例如 react.manifest.json 中就有 &quot;name&quot;: &quot;_dll_react&quot;</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;_dll_[name]&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token comment">// 描述动态链接库的 manifest.json 文件输出时的文件名称</span></span>
<span class="line">            <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;[name].manifest.json&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">webpack --config webpack.dll.config.js --mode development</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-2-使用动态链接库文件" tabindex="-1"><a class="header-anchor" href="#_2-2-使用动态链接库文件"><span>2.2 使用动态链接库文件</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> DllReferencePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack/lib/DllReferencePlugin&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">manifest</span><span class="token operator">:</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/react.manifest.json&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">webpack --config webpack.config.js --mode development</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-3-html中使用" tabindex="-1"><a class="header-anchor" href="#_2-3-html中使用"><span>2.3 html中使用</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;react.dll.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;bundle.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-多进程处理" tabindex="-1"><a class="header-anchor" href="#_3-多进程处理"><span>3. 多进程处理</span></a></h2><h3 id="_3-1-thread-loader" tabindex="-1"><a class="header-anchor" href="#_3-1-thread-loader"><span>3.1 thread-loader</span></a></h3><ul><li>把这个 loader 放置在其他 loader 之前， 放置在这个 loader 之后的 loader 就会在一个单独的 worker 池(worker pool)中运行</li><li><a href="https://webpack.js.org/loaders/thread-loader/" target="_blank" rel="noopener noreferrer">thread-loader</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(js)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">           <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;thread-loader&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">workers</span><span class="token operator">:</span><span class="token number">3</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span> </span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;babel-loader&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-cdn" tabindex="-1"><a class="header-anchor" href="#_4-cdn"><span>4. CDN</span></a></h2><ul><li><a href="https://www.qiniu.com/" target="_blank" rel="noopener noreferrer">qiniu</a></li><li>CDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近的服务器获取资源，从而加速资源的获取速度。</li></ul><p><img src="http://img.zhufengpeixun.cn/cdn2.jpg" alt="cdn"></p><ul><li>HTML文件不缓存，放在自己的服务器上，关闭自己服务器的缓存，静态资源的URL变成指向CDN服务器的地址</li><li>静态的JavaScript、CSS、图片等文件开启CDN和缓存，并且文件名带上HASH值</li><li>为了并行加载不阻塞，把不同的静态资源分配到不同的CDN服务器上</li></ul><h3 id="_4-1-使用缓存" tabindex="-1"><a class="header-anchor" href="#_4-1-使用缓存"><span>4.1 使用缓存</span></a></h3><ul><li>由于 CDN 服务一般都会给资源开启很长时间的缓存，例如用户从 CDN 上获取到了 index.html 这个文件后， 即使之后的发布操作把 index.html 文件给重新覆盖了，但是用户在很长一段时间内还是运行的之前的版本，这会新的导致发布不能立即生效 解决办法</li><li>针对 HTML 文件：不开启缓存，把 HTML 放到自己的服务器上，而不是 CDN 服务上，同时关闭自己服务器上的缓存。自己的服务器只提供 HTML 文件和数据接口。</li><li>针对静态的 JavaScript、CSS、图片等文件：开启 CDN 和缓存，上传到 CDN 服务上去，同时给每个文件名带上由文件内容算出的 Hash 值</li><li>带上 Hash 值的原因是文件名会随着文件内容而变化，只要文件发生变化其对应的 URL 就会变化，它就会被重新下载，无论缓存时间有多长。</li><li>启用CDN之后 相对路径，都变成了绝对的指向 CDN 服务的 URL 地址</li></ul><h3 id="_4-2-域名限制" tabindex="-1"><a class="header-anchor" href="#_4-2-域名限制"><span>4.2 域名限制</span></a></h3><ul><li>同一时刻针对同一个域名的资源并行请求是有限制</li><li>可以把这些静态资源分散到不同的 CDN 服务上去</li><li>多个域名后会增加域名解析时间</li><li>可以通过在 HTML HEAD 标签中 加入<code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://img.zhufengpeixun.cn&quot;&gt;</code>去预解析域名，以降低域名解析带来的延迟</li></ul><h3 id="_4-3-接入cdn" tabindex="-1"><a class="header-anchor" href="#_4-3-接入cdn"><span>4.3 接入CDN</span></a></h3><p>要给网站接入 CDN，需要把网页的静态资源上传到 CDN 服务上去，在服务这些静态资源的时候需要通过 CDN 服务提供的 URL 地址去访问</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">    output: {</span>
<span class="line">        path: path.resolve(__dirname, &#39;dist&#39;),</span>
<span class="line">+        filename: &#39;[name]_[hash:8].js&#39;,</span>
<span class="line">+        publicPath: &#39;http://img.zhufengpeixun.cn&#39;</span>
<span class="line">    },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-tree-shaking" tabindex="-1"><a class="header-anchor" href="#_5-tree-shaking"><span>5.Tree Shaking</span></a></h2><ul><li>一个模块可以有多个方法，只要其中某个方法使用到了，则整个文件都会被打到bundle里面去，tree shaking就是只把用到的方法打入bundle,没用到的方法会uglify阶段擦除掉</li><li>原理是利用es6模块的特点,只能作为模块顶层语句出现,import的模块名只能是字符串常量</li></ul><h3 id="_5-1-开启" tabindex="-1"><a class="header-anchor" href="#_5-1-开启"><span>5.1 开启</span></a></h3><ul><li>webpack默认支持，在.babelrc里设置<code>module:false</code>即可在<code>production mode</code>下默认开启</li><li>还要注意把devtool设置为null</li></ul><p>.babelrc</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">    &quot;presets&quot;:[</span>
<span class="line">+        [&quot;@babel/preset-env&quot;,{&quot;modules&quot;:false}],//转译 ES6 ES7</span>
<span class="line">        &quot;@babel/preset-react&quot;//转译JSX语法</span>
<span class="line">    ],</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-没有导入和使用" tabindex="-1"><a class="header-anchor" href="#_5-2-没有导入和使用"><span>5.2 没有导入和使用</span></a></h3><p>functions.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token string">&#39;func1&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">     <span class="token keyword">return</span> <span class="token string">&#39;func2&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span></span>
<span class="line">  func1<span class="token punctuation">,</span></span>
<span class="line">  func2</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>func2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./functions&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-代码不会被执行-不可到达" tabindex="-1"><a class="header-anchor" href="#_5-3-代码不会被执行-不可到达"><span>5.3 代码不会被执行，不可到达</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line"> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;false&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-代码执行的结果不会被用到" tabindex="-1"><a class="header-anchor" href="#_5-4-代码执行的结果不会被用到"><span>5.4 代码执行的结果不会被用到</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>func2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./functions&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-代码中只写不读的变量" tabindex="-1"><a class="header-anchor" href="#_5-4-代码中只写不读的变量"><span>5.4 代码中只写不读的变量</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">var</span> aabbcc<span class="token operator">=</span><span class="token string">&#39;aabbcc&#39;</span><span class="token punctuation">;</span></span>
<span class="line">aabbcc<span class="token operator">=</span><span class="token string">&#39;eeffgg&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-代码分割" tabindex="-1"><a class="header-anchor" href="#_6-代码分割"><span>6.代码分割</span></a></h2><h3 id="_6-1-代码分割的意义" tabindex="-1"><a class="header-anchor" href="#_6-1-代码分割的意义"><span>6.1 代码分割的意义</span></a></h3><ul><li>对于大的Web应用来讲，将所有的代码都放在一个文件中显然是不够有效的，特别是当你的某些代码块是在某些特殊的时候才会被用到。</li><li>webpack有一个功能就是将你的代码库分割成chunks语块，当代码运行到需要它们的时候再进行加载。 适用的场景</li><li>抽离相同代码到一个共享块</li><li>脚本懒加载，使得初始下载的代码更小</li></ul><h3 id="_6-2-entry-points" tabindex="-1"><a class="header-anchor" href="#_6-2-entry-points"><span>6.2 Entry Points</span></a></h3><ul><li>Entry Points：入口文件设置的时候可以配置</li><li>这种方法的问题 <ul><li>如果入口 chunks 之间包含重复的模块(lodash)，那些重复模块都会被引入到各个 bundle 中</li><li>不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">login</span><span class="token operator">:</span> <span class="token string">&quot;./src/login.js&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-动态导入和懒加载" tabindex="-1"><a class="header-anchor" href="#_6-2-动态导入和懒加载"><span>6.2 动态导入和懒加载</span></a></h3><ul><li>用户当前需要用什么功能就只加载这个功能对应的代码，也就是所谓的按需加载 在给单页应用做按需加载优化时，一般采用以下原则： <ul><li>对网站功能进行划分，每一类一个chunk</li><li>对于首次打开页面需要的功能直接加载，尽快展示给用户,某些依赖大量代码的功能点可以按需加载</li><li>被分割出去的代码需要一个按需加载的时机</li></ul></li></ul><p>hello.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>&#39;</span>
<span class="line">    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>index.html</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;button id=&quot;clickBtn&quot;&gt;点我&lt;/button&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-3-提取公共代码" tabindex="-1"><a class="header-anchor" href="#_6-3-提取公共代码"><span>6.3 提取公共代码</span></a></h3><h3 id="_6-1-为什么需要提取公共代码" tabindex="-1"><a class="header-anchor" href="#_6-1-为什么需要提取公共代码"><span>6.1 为什么需要提取公共代码</span></a></h3><p>大网站有多个页面，每个页面由于采用相同技术栈和样式代码，会包含很多公共代码，如果都包含进来会有问题</p><ul><li>相同的资源被重复的加载，浪费用户的流量和服务器的成本；</li><li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。</li><li>如果能把公共代码抽离成单独文件进行加载能进行优化，可以减少网络传输流量，降低服务器成本</li></ul><h3 id="_6-2-如何提取" tabindex="-1"><a class="header-anchor" href="#_6-2-如何提取"><span>6.2 如何提取</span></a></h3><ul><li>基础类库，方便长期缓存</li><li>页面之间的公用代码</li><li>各个页面单独生成文件</li><li><a href="https://www.webpackjs.com/plugins/split-chunks-plugin/" target="_blank" rel="noopener noreferrer">文档</a></li><li><a href="https://github.com/webpack/webpack/tree/master/examples/common-chunk-and-vendor-chunk" target="_blank" rel="noopener noreferrer">common-chunk-and-vendor-chunk</a></li><li>webpack将会基于以下条件自动分割代码块: <ul><li>新的代码块被共享或者来自node_modules文件夹</li><li>新的代码块大于30kb(在min+giz之前)</li><li>按需加载代码块的请求数量应该&lt;=5</li><li>页面初始化时加载代码块的请求数量应该&lt;=3</li></ul></li></ul><p>默认配置</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span><span class="token comment">//默认作用于异步chunk，值为all/initial/async</span></span>
<span class="line">            <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>  <span class="token comment">//默认值是30kb,代码块的最小尺寸</span></span>
<span class="line">            <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">//被多少模块共享,在分割之前模块的被引用次数</span></span>
<span class="line">            <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token comment">//按需加载最大并行请求数量</span></span>
<span class="line">            <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">//一个入口的最大并行请求数量</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//打包后的名称，默认是chunk的名字通过分隔符（默认是～）分隔开，如vendor~</span></span>
<span class="line">            <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">&#39;~&#39;</span><span class="token punctuation">,</span><span class="token comment">//默认webpack将会使用入口名和代码块的名称生成命名,比如 &#39;vendors~main.js&#39;</span></span>
<span class="line">            <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//设置缓存组用来抽取满足不同规则的chunk,下面以生成common为例</span></span>
<span class="line">                <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//条件</span></span>
<span class="line">                    <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span> <span class="token comment">///优先级，一个chunk很可能满足多个缓存组，会被抽取到优先级高的缓存组中,为了能够让自定义缓存组有更高的优先级(默认0),默认缓存组的priority属性为负值.</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">commons</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//最小提取字节数</span></span>
<span class="line">                    <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//最少被几个chunk引用</span></span>
<span class="line">                    <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//    如果该chunk中引用了已经被抽取的chunk，直接引用该chunk，不会重复打包代码</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-提取公共代码-1" tabindex="-1"><a class="header-anchor" href="#_6-3-提取公共代码-1"><span>6.3 提取公共代码</span></a></h3><p>pageA.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">&#39;./utils1&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> utils2 <span class="token keyword">from</span> <span class="token string">&#39;./utils2&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span>utils2<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pageB.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">&#39;./utils1&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> utils2 <span class="token keyword">from</span> <span class="token string">&#39;./utils2&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span>utils2<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pageC.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> utils3 <span class="token keyword">from</span> <span class="token string">&#39;./utils3&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">&#39;./utils1&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span>utils3<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>utils1.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>utils2.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>utils3.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>webpack.config.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">pageA</span><span class="token operator">:</span> <span class="token string">&#39;./src/pageA&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">pageB</span><span class="token operator">:</span> <span class="token string">&#39;./src/pageB&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">pageC</span><span class="token operator">:</span> <span class="token string">&#39;./src/pageC&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="line">       <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;pageA.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">excludeChunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;pageB&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;pageC&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;pageB.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">excludeChunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;pageA&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;pageC&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;pageC.html&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">excludeChunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;pageA&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;pageB&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://img.zhufengpeixun.cn/splitchunks.png" alt="splitchunks"></p><h2 id="_7-开启-scope-hoisting" tabindex="-1"><a class="header-anchor" href="#_7-开启-scope-hoisting"><span>7.开启 Scope Hoisting</span></a></h2><ul><li>Scope Hoisting 可以让 Webpack 打包出来的代码文件更小、运行的更快， 它又译作 &quot;作用域提升&quot;，是在 Webpack3 中新推出的功能。</li><li>初webpack转换后的模块会包裹上一层函数,import会转换成require</li><li>代码体积更小，因为函数申明语句会产生大量代码</li><li>代码在运行时因为创建的函数作用域更少了，内存开销也随之变小</li><li>大量作用域包裹代码会导致体积增大</li><li>运行时创建的函数作用域变多，内存开销增大</li><li>scope hoisting的原理是将所有的模块按照引用顺序放在一个函数作用域里，然后适当地重命名一些变量以防止命名冲突</li><li>这个功能在mode为production下默认开启,开发环境要用 <code>webpack.optimize.ModuleConcatenationPlugin</code>插件</li><li>也要使用ES6 Module,CJS不支持</li></ul><h3 id="_7-1-开发环境插件配置" tabindex="-1"><a class="header-anchor" href="#_7-1-开发环境插件配置"><span>7.1 开发环境插件配置</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 针对 Npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件</span></span>
<span class="line">    <span class="token literal-property property">mainFields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;jsnext:main&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;browser&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;main&#39;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token comment">// 开启 Scope Hoisting</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>ModuleConcatenationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-代码" tabindex="-1"><a class="header-anchor" href="#_7-2-代码"><span>7.2 代码</span></a></h3><p>hello.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">&#39;Hello&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> str <span class="token keyword">from</span> <span class="token string">&#39;./hello.js&#39;</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出的结果main.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token string-property property">&quot;./src/index.js&quot;</span><span class="token operator">:</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>函数由两个变成了一个，hello.js 中定义的内容被直接注入到了 main.js 中</p></blockquote><h2 id="_8-用-hmr-提高开发效率" tabindex="-1"><a class="header-anchor" href="#_8-用-hmr-提高开发效率"><span>8. 用 HMR 提高开发效率</span></a></h2><ul><li>HMR 全称是 Hot Module Replacement，即模块热替换</li><li>Hot Reloading，当代码变更时通知浏览器刷新页面，以避免频繁手动刷新浏览器页面</li><li>HMR 可以理解为增强版的 Hot Reloading，但不用整个页面刷新，而是局部替换掉部分模块代码并且使其生效</li><li>原理是当一个源码发生变化时，只重新编译发生变化的模块，再用新输出的模块替换掉浏览器中对应的老模块</li><li>模块热替换技术的优势有： <ul><li>实时预览反应更快，等待时间更短。</li><li>不刷新浏览器能保留当前网页的运行状态，例如在使用 Redux 来管理数据的应用中搭配模块热替换能做到代码更新时Redux 中的数据还保持不变</li></ul></li></ul><h3 id="_8-1-模块热替换原理" tabindex="-1"><a class="header-anchor" href="#_8-1-模块热替换原理"><span>8.1 模块热替换原理</span></a></h3><ul><li>模块热替换的原理和自动刷新原理类似，都需要往要开发的网页中注入一个代理客户端用于连接 DevServer 和网页</li></ul><p><img src="http://img.zhufengpeixun.cn/webpackhmr.png" alt="hotupdate"></p><h3 id="_8-2-配置" tabindex="-1"><a class="header-anchor" href="#_8-2-配置"><span>8.2 配置</span></a></h3><h4 id="_8-2-1-配置hot" tabindex="-1"><a class="header-anchor" href="#_8-2-1-配置hot"><span>8.2.1 配置hot</span></a></h4><ul><li><p>DevServer 默认不会开启模块热替换模式，要开启该模式，只需在启动时带上参数 <code>--hot</code></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">main</span><span class="token operator">:</span><span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token comment">// 该插件的作用就是实现模块热替换，实际上当启动时带上 \`--hot\` 参数，会注入该插件，生成 .hot-update.json 文件。</span></span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 用于启动 HMR 时可以显示模块的相对路径</span></span>
<span class="line">  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Hot Module Replacement 的插件</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token literal-property property">devServer</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 告诉 DevServer 要开启模块热替换模式</span></span>
<span class="line">  <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      </span>
<span class="line"><span class="token punctuation">}</span>  </span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>在启动 Webpack 时带上参数 --hot 其实就是自动为你完成以上配置。</p></blockquote></li></ul><h4 id="_8-2-2-代码实现" tabindex="-1"><a class="header-anchor" href="#_8-2-2-代码实现"><span>8.2.2 代码实现</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&#39;./index.css&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 只有当开启了模块热替换时 module.hot 才存在</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// accept 函数的第一个参数指出当前文件接受哪些子模块的替换，这里表示只接受 ./AppComponent 这个子模块</span></span>
<span class="line">  <span class="token comment">// 第2个参数用于在新的子模块加载完毕后需要执行的逻辑</span></span>
<span class="line">  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;./App&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 新的 AppComponent 加载成功后重新执行下组建渲染逻辑</span></span>
<span class="line">    <span class="token keyword">let</span> App<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./App&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>  </span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>module.hot 是当开启模块热替换后注入到全局的 API，用于控制模块热替换的逻辑</li><li>当子模块发生更新时，更新事件会一层层往上传递，也就是从<code>App.js</code>文件传递到<code>index.js</code>文件， 直到有某层的文件接受了当前变化的模块</li><li>如果事件一直往上抛到最外层都没有文件接受它，就会直接刷新网页</li><li><code>.css</code>文件都会触发模块热替换的原因是<code>style-loader</code>会注入用于接受 CSS 的代码</li></ul>`,109)])])}const o=n(l,[["render",t]]),r=JSON.parse('{"path":"/strong/26.webpack-2-optimize.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/26.webpack-2-optimize.md"}');export{o as comp,r as data};
