import{_ as n,c as a,a as e,o as t}from"./app-CD1YpnS1.js";const p={};function i(l,s){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-create-vite" tabindex="-1"><a class="header-anchor" href="#_1-create-vite"><span>1.create-vite</span></a></h2><h3 id="_1-1-create-vite简介" tabindex="-1"><a class="header-anchor" href="#_1-1-create-vite简介"><span>1.1 create-vite简介</span></a></h3><ul><li>[vite官网](https://cn.vitejs.dev/guide/</li><li><a href="https://www.npmjs.com/package/create-vite" target="_blank" rel="noopener noreferrer">create-vite包</a></li><li><a href="https://github.com/vitejs/vite/tree/main/packages/create-vite" target="_blank" rel="noopener noreferrer">create-vite源码</a></li></ul><h3 id="_1-2-使用" tabindex="-1"><a class="header-anchor" href="#_1-2-使用"><span>1.2 使用</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">npm init vite</span>
<span class="line">Need to install the following packages<span class="token operator">:</span></span>
<span class="line">  create<span class="token operator">-</span>vite</span>
<span class="line">Ok to proceed<span class="token operator">?</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span> y</span>
<span class="line">√ Project name<span class="token operator">:</span> <span class="token operator">...</span> vite<span class="token operator">-</span>project</span>
<span class="line">√ Select a framework<span class="token operator">:</span> » react</span>
<span class="line">√ Select a variant<span class="token operator">:</span> » react</span>
<span class="line"></span>
<span class="line">Scaffolding project <span class="token keyword">in</span> <span class="token constant">C</span><span class="token operator">:</span>\\aprepare\\t1\\vite<span class="token operator">-</span>project<span class="token operator">...</span></span>
<span class="line"></span>
<span class="line">Done<span class="token punctuation">.</span> Now run<span class="token operator">:</span></span>
<span class="line"></span>
<span class="line">  cd vite<span class="token operator">-</span>project</span>
<span class="line">  npm install</span>
<span class="line">  npm run dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-create-vite源码调试" tabindex="-1"><a class="header-anchor" href="#_1-3-create-vite源码调试"><span>1.3 create-vite源码调试</span></a></h3><ul><li><a href="https://www.npmjs.com/package/minimist" target="_blank" rel="noopener noreferrer">minimist</a>解析参数选项,类似的还有<a href="https://www.npmjs.com/package/yargs" target="_blank" rel="noopener noreferrer">yargs</a>和<a href="https://www.npmjs.com/package/commander" target="_blank" rel="noopener noreferrer">commander</a></li><li><a href="https://www.npmjs.com/package/kolorist" target="_blank" rel="noopener noreferrer">kolorist</a>在控制台打印颜色,类似的还有<a href="https://www.npmjs.com/package/chalk" target="_blank" rel="noopener noreferrer">chalk</a></li><li><a href="https://www.npmjs.com/package/prompts" target="_blank" rel="noopener noreferrer">prompts</a>交互式命令行，类似还有<a href="https://www.npmjs.com/package/inquirer" target="_blank" rel="noopener noreferrer">inquirer</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>vitejs<span class="token operator">/</span>vite<span class="token punctuation">.</span>git</span>
<span class="line">cd vite</span>
<span class="line">yarn install</span>
<span class="line">packages\\create<span class="token operator">-</span>vite\\index<span class="token punctuation">.</span>js</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>.vscode\\launch.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pwa-node&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch Program&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;skipFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token string">&quot;&lt;node_internals&gt;/**&quot;</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\${workspaceFolder}\\\\packages\\\\create-vite\\\\index.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string-property property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;vite-project&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-create-vite功能" tabindex="-1"><a class="header-anchor" href="#_1-4-create-vite功能"><span>1.4 create-vite功能</span></a></h3><ul><li>[√] 支持参数解析</li><li>[√] 支持自定义项目名</li><li>[√] 支持空目录检查</li><li>[√] 支持静态项目模板</li><li>[×] 不支持lerna <a href="https://github.com/lerna/lerna" target="_blank" rel="noopener noreferrer">lerna</a></li><li>[×] 不支持文件异步写入 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持多进程执行命令 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持执行动态<code>node</code>命令 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持自动安装依赖 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持自动启动服务 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app</a></li><li>[×] 不支持参数配置 <a href="https://github.com/yarnpkg/yarn" target="_blank" rel="noopener noreferrer">yarn</a></li><li>[×] 不支持<code>gitub</code>和<code>gitee</code>仓库动态读取</li><li>[×] 不支持模板标签选择</li><li>[×] 不支持动态模板渲染</li><li>[×] 不支持插件化配置技术栈 <a href="https://github.com/vuejs/vue-cli" target="_blank" rel="noopener noreferrer">vue-cli</a></li></ul><h2 id="_2-初始化项目" tabindex="-1"><a class="header-anchor" href="#_2-初始化项目"><span>2.初始化项目</span></a></h2><h3 id="_2-1-lerna初始化" tabindex="-1"><a class="header-anchor" href="#_2-1-lerna初始化"><span>2.1 lerna初始化</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir vite2</span>
<span class="line">cd vite2</span>
<span class="line">lerna init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-使用yarn-workspace" tabindex="-1"><a class="header-anchor" href="#_2-2-使用yarn-workspace"><span>2.2 使用yarn workspace</span></a></h3><ul><li>开发多个互相依赖的package时，workspace会自动对package的引用设置软链接(symlink),比yarn link更加方便，且链接仅局限在当前workspace中，不会对整个系统造成影响</li><li>所有package的依赖会安装在根目录的<code>node_modules</code>下，节省磁盘空间，且给了yarn更大的依赖优化空间</li><li>Yarn workspace只会在根目录安装一个node_modules，这有利于提升依赖的安装效率和不同package间的版本复用。而Lerna默认会进到每一个package中运行yarn/npm install，并在每个package中创建一个node_modules</li><li>yarn官方推荐的方案，是集成yarn workspace和lerna,使用yarn workspace来管理依赖，使用lerna来管理npm包的版本发布</li></ul><h4 id="_2-2-1-lerna-json" tabindex="-1"><a class="header-anchor" href="#_2-2-1-lerna-json"><span>2.2.1 lerna.json</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;packages&quot;: [</span>
<span class="line">    &quot;packages/*&quot;</span>
<span class="line">  ],</span>
<span class="line">  &quot;version&quot;: &quot;0.0.0&quot;,</span>
<span class="line">+ &quot;npmClient&quot;: &quot;yarn&quot;,</span>
<span class="line">+ &quot;useWorkspaces&quot;: true</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-package-json" tabindex="-1"><a class="header-anchor" href="#_2-2-2-package-json"><span>2.2.2 package.json</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;name&quot;: &quot;root&quot;,</span>
<span class="line">  &quot;private&quot;: true,</span>
<span class="line">  &quot;devDependencies&quot;: {</span>
<span class="line">    &quot;lerna&quot;: &quot;^4.0.0&quot;</span>
<span class="line">  },</span>
<span class="line">+  &quot;workspaces&quot;: [</span>
<span class="line">+    &quot;packages/*&quot;</span>
<span class="line">+ ]  </span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-创建子包" tabindex="-1"><a class="header-anchor" href="#_2-3-创建子包"><span>2.3 创建子包</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">lerna create @vite2<span class="token operator">/</span>config <span class="token operator">-</span>y <span class="token comment">//配置项</span></span>
<span class="line">lerna create @vite2<span class="token operator">/</span>create <span class="token operator">-</span>y <span class="token comment">//创建项目</span></span>
<span class="line">lerna create vite2 <span class="token operator">-</span>y  <span class="token comment">//核心命令</span></span>
<span class="line">lerna create @vite2<span class="token operator">/</span>settings <span class="token operator">-</span>y  <span class="token comment">//常量定义</span></span>
<span class="line">lerna create @vite2<span class="token operator">/</span>utils <span class="token operator">-</span>y <span class="token comment">//工具方法</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-安装依赖" tabindex="-1"><a class="header-anchor" href="#_2-4-安装依赖"><span>2.4 安装依赖</span></a></h3><ul><li><a href="https://www.npmjs.com/package/axios" target="_blank" rel="noopener noreferrer">axios</a> 请求接口</li><li><a href="https://www.npmjs.com/package/cross-spawn" target="_blank" rel="noopener noreferrer">cross-spawn</a> 开启子进程</li><li><a href="https://www.npmjs.com/package/userhome" target="_blank" rel="noopener noreferrer">userhome</a> 获取用户主目录</li><li><a href="https://www.npmjs.com/package/chalk" target="_blank" rel="noopener noreferrer">chalk</a> 控制台打印彩色文字</li><li><a href="https://www.npmjs.com/package/ejs" target="_blank" rel="noopener noreferrer">ejs</a> 模板渲染</li><li><a href="https://www.npmjs.com/package/execa" target="_blank" rel="noopener noreferrer">execa</a> 通过子进程执行命令</li><li><a href="https://www.npmjs.com/package/glob" target="_blank" rel="noopener noreferrer">glob</a> 按模式匹配文件</li><li><a href="https://www.npmjs.com/package/inquirer" target="_blank" rel="noopener noreferrer">inquirer</a> 交互式命令行选择</li><li><a href="vite2">vite2</a> 核心命令</li><li><a href="@vite2/settings">@vite2/settings</a> 常量配置</li><li><a href="@vite2/utils">@vite2/utils</a> 帮助方法</li><li><a href="@vite2/config">@vite2/config</a> 配置参数</li><li><a href="@vite2/create">@vite2/create</a> 创建项目</li></ul><h4 id="_2-4-1-config-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-1-config-package-json"><span>2.4.1 config\\package.json</span></a></h4><p>packages\\config\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite2/settings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite2/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;fs-extra&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;userhome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-2-create-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-2-create-package-json"><span>2.4.2 create\\package.json</span></a></h4><p>packages\\create\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite2/settings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite2/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;chalk&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.1.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;clone-git-repo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ejs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.6&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;execa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.1.1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;fs-extra&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;glob&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.1.7&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;inquirer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.1.2&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-3-utils-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-3-utils-package-json"><span>2.4.3 utils\\package.json</span></a></h4><p>packages\\utils\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite2/settings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.21.2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;cross-spawn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.0.3&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;userhome&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-4-vite2-package-json" tabindex="-1"><a class="header-anchor" href="#_2-4-4-vite2-package-json"><span>2.4.4 vite2\\package.json</span></a></h4><p>packages\\vite2\\package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite2/config&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;@vite2/create&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.0&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-5-publishconfig" tabindex="-1"><a class="header-anchor" href="#_2-4-5-publishconfig"><span>2.4.5 publishConfig</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://registry.npmjs.org&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/vite41_1630771189288.jpg" alt="vite2"></p><h3 id="_2-5-配置命令" tabindex="-1"><a class="header-anchor" href="#_2-5-配置命令"><span>2.5 配置命令</span></a></h3><h4 id="_2-5-1-package-json" tabindex="-1"><a class="header-anchor" href="#_2-5-1-package-json"><span>2.5.1 package.json</span></a></h4><p>packages\\vite2\\package.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">{</span>
<span class="line">  &quot;name&quot;: &quot;vite2&quot;,</span>
<span class="line">  &quot;version&quot;: &quot;0.0.0&quot;,</span>
<span class="line">  &quot;dependencies&quot;: {</span>
<span class="line">    &quot;@vite2/config&quot;:&quot;^0.0.0&quot;,</span>
<span class="line">    &quot;@vite2/create&quot;:&quot;^0.0.0&quot;</span>
<span class="line">  },</span>
<span class="line">+ &quot;bin&quot;:{</span>
<span class="line">+   &quot;vite2&quot;: &quot;index.js&quot;</span>
<span class="line">+ }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-2-index-js" tabindex="-1"><a class="header-anchor" href="#_2-5-2-index-js"><span>2.5.2 index.js</span></a></h4><p>packages\\vite2\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> </span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token keyword">let</span> argv <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-3-link" tabindex="-1"><a class="header-anchor" href="#_2-5-3-link"><span>2.5.3 link</span></a></h4><ul><li>一定要先添加\`</li><li>这种情况可以<code>vite2\\packages\\vite2</code>目录中执行<code>yarn unlink</code>，再重新link</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn link</span>
<span class="line">yarn global bin </span>
<span class="line">C:\\Users\\zhangrenyang\\AppData\\Local\\Yarn\\bin</span>
<span class="line">C:\\Users\\zhangrenyang\\AppData\\Local\\Yarn\\Data\\link\\vite2</span>
<span class="line">npm bin -g</span>
<span class="line">C:\\Users\\zhangrenyang\\AppData\\Roaming\\npm</span>
<span class="line">vite2 create vite-project</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-实现配置命令" tabindex="-1"><a class="header-anchor" href="#_3-实现配置命令"><span>3.实现配置命令</span></a></h2><h3 id="_3-1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_3-1-安装依赖"><span>3.1 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn workspace @vite2/config  add userhome fs-extra</span>
<span class="line">yarn workspace @vite2/utils  add cross-spawn userhome fs-extra</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-settings-index-js" tabindex="-1"><a class="header-anchor" href="#_3-2-settings-index-js"><span>3.2 settings\\index.js</span></a></h3><p>packages\\settings\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//执行命令脚本</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token constant">COMMAND_SOURCE</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">const args = JSON.parse(process.argv[1]);</span>
<span class="line">const factory = require(&#39;.&#39;);</span>
<span class="line">factory(args);</span>
<span class="line"></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line"><span class="token comment">//配置文件名称</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token constant">RC_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;.vite3rc&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-config-js" tabindex="-1"><a class="header-anchor" href="#_3-3-config-js"><span>3.3 config.js</span></a></h3><p>packages\\utils\\config.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> userhome <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;userhome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs-extra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">RC_NAME</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vite5/settings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> configPath <span class="token operator">=</span> <span class="token function">userhome</span><span class="token punctuation">(</span><span class="token constant">RC_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>configPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  config <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readJSONSync</span><span class="token punctuation">(</span>configPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">config<span class="token punctuation">.</span>configPath<span class="token operator">=</span>configPath<span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-executenodescript-js" tabindex="-1"><a class="header-anchor" href="#_3-4-executenodescript-js"><span>3.4 executeNodeScript.js</span></a></h3><p>packages\\utils\\executeNodeScript.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cross-spawn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">executeNodeScript</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cwd <span class="token punctuation">}</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> childProcess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span></span>
<span class="line">        process<span class="token punctuation">.</span>execPath<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&quot;-e&quot;</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token string">&quot;--&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> cwd<span class="token punctuation">,</span> <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      childProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> executeNodeScript<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-log-js" tabindex="-1"><a class="header-anchor" href="#_3-5-log-js"><span>3.5 log.js</span></a></h3><p>packages\\utils\\log.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;npmlog&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">log<span class="token punctuation">.</span>heading <span class="token operator">=</span> <span class="token string">&#39;vite2&#39;</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> log<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-utils-index-js" tabindex="-1"><a class="header-anchor" href="#_3-6-utils-index-js"><span>3.6 utils\\index.js</span></a></h3><p>packages\\utils\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">exports<span class="token punctuation">.</span>log <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./log&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span>executeNodeScript <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./executeNodeScript&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-packages-config-command-js" tabindex="-1"><a class="header-anchor" href="#_3-7-packages-config-command-js"><span>3.7 packages\\config\\command.js</span></a></h3><p>packages\\config\\command.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>executeNodeScript<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite2/utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">COMMAND_SOURCE</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite2/settings&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token string">&quot;config [key] [value]&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;设置或查看配置项,比如GIT_TYPE设置仓库类型，ORG_NAME设置组织名&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">handler</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">executeNodeScript</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">cwd</span><span class="token operator">:</span> __dirname <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">COMMAND_SOURCE</span><span class="token punctuation">,</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> command<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-8-config-index-js" tabindex="-1"><a class="header-anchor" href="#_3-8-config-index-js"><span>3.8 config\\index.js</span></a></h3><p>packages\\config\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs-extra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> log <span class="token punctuation">,</span>config<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vite2/utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> key<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> argv<span class="token punctuation">;</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;config&#39;</span><span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    config<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeJSON</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>configPath<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">spaces</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;vite3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;(%s=%s)配置成功保存至%s&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> config<span class="token punctuation">.</span>configPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;%s=%s&#39;</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span> config<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> factory<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-9-vite2-index-js" tabindex="-1"><a class="header-anchor" href="#_3-9-vite2-index-js"><span>3.9 vite2\\index.js</span></a></h3><p>packages\\vite2\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">const yargs = require(&quot;yargs/yargs&quot;);</span>
<span class="line">const configCmd = require(&quot;@vite2/config/command&quot;);</span>
<span class="line">async function main() {</span>
<span class="line">    const cli = yargs();</span>
<span class="line">    cli</span>
<span class="line">    .usage(\`Usage: vite2 &lt;command&gt; [options]\`)</span>
<span class="line">    .demandCommand(1, &quot;至少需要一个命令&quot;)</span>
<span class="line">    .strict() </span>
<span class="line">    .recommendCommands()</span>
<span class="line">+   .command(configCmd)</span>
<span class="line">    .parse(process.argv.slice(2));</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">main().catch((err) =&gt; {</span>
<span class="line">    console.error(err);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-实现创建命令" tabindex="-1"><a class="header-anchor" href="#_4-实现创建命令"><span>4.实现创建命令</span></a></h2><h3 id="_4-1-create-command-js" tabindex="-1"><a class="header-anchor" href="#_4-1-create-command-js"><span>4.1 create\\command.js</span></a></h3><p>packages\\create\\command.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">COMMAND_SOURCE</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite2/settings&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span>executeNodeScript<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@vite2/utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token string">&quot;create &lt;name&gt;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;创建项目&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    yargs<span class="token punctuation">.</span><span class="token function">positional</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;项目名称&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">handler</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span>argv<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token literal-property property">cwd</span><span class="token operator">:</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">executeNodeScript</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">cwd</span><span class="token operator">:</span> __dirname <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">COMMAND_SOURCE</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> command<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-create-index-js" tabindex="-1"><a class="header-anchor" href="#_4-2-create-index-js"><span>4.2 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;create&#39;</span><span class="token punctuation">,</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> factory<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-vite2-index-js" tabindex="-1"><a class="header-anchor" href="#_4-3-vite2-index-js"><span>4.3 vite2\\index.js</span></a></h3><p>packages\\vite2\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">const yargs = require(&quot;yargs/yargs&quot;);</span>
<span class="line">const configCmd = require(&quot;@vite2/config/command&quot;);</span>
<span class="line">+const createCmd = require(&quot;@vite2/create/command&quot;);</span>
<span class="line">async function main() {</span>
<span class="line">    const cli = yargs();</span>
<span class="line">    cli</span>
<span class="line">    .usage(\`Usage: vite2 &lt;command&gt; [options]\`)</span>
<span class="line">    .demandCommand(1, &quot;至少需要一个命令&quot;)</span>
<span class="line">    .strict() </span>
<span class="line">    .recommendCommands()</span>
<span class="line">    .command(configCmd)</span>
<span class="line">+   .command(createCmd)</span>
<span class="line">    .parse(process.argv.slice(2));</span>
<span class="line">}</span>
<span class="line">main().catch((err) =&gt; {</span>
<span class="line">    console.error(err);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-创建项目目录" tabindex="-1"><a class="header-anchor" href="#_5-创建项目目录"><span>5.创建项目目录</span></a></h2><h3 id="_5-1-安装" tabindex="-1"><a class="header-anchor" href="#_5-1-安装"><span>5.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn workspace @vite2/create  add chalk fs-extra inquirer</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-create-index-js" tabindex="-1"><a class="header-anchor" href="#_5-2-create-index-js"><span>5.2 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+const path = require(&quot;path&quot;);</span>
<span class="line">+const { red } = require(&quot;chalk&quot;);</span>
<span class="line">+const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">+const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">+const {config, log } = require(&quot;@vite2/utils&quot;);</span>
<span class="line">async function factory(argv) {</span>
<span class="line">+    const { cwd, name } = argv;</span>
<span class="line">+    process.chdir(cwd);//切换为当前命令执行的工作目录</span>
<span class="line">+    const { ORG_NAME } = config;</span>
<span class="line">+    if (!ORG_NAME) {</span>
<span class="line">+        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置组织名称!&quot;);</span>
<span class="line">+    }</span>
<span class="line">+    const targetDir = path.join(process.cwd(), name);</span>
<span class="line">+    log.info(&quot;vite2&quot;, &quot;创建的项目目录为%s&quot;, targetDir);</span>
<span class="line">+    try {</span>
<span class="line">+        await fs.access(targetDir);</span>
<span class="line">+        const files = await fs.readdir(targetDir);</span>
<span class="line">+        if (files.length &gt; 0) {</span>
<span class="line">+            const { overwrite } = await prompt({</span>
<span class="line">+                type: &quot;confirm&quot;,</span>
<span class="line">+                name: &quot;overwrite&quot;,</span>
<span class="line">+                message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">+            });</span>
<span class="line">+            if (overwrite) {</span>
<span class="line">+                await fs.emptyDir(targetDir);</span>
<span class="line">+            } else {</span>
<span class="line">+                throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">+            }</span>
<span class="line">+        }</span>
<span class="line">+    } catch (error) {</span>
<span class="line">+        await fs.mkdirp(targetDir);</span>
<span class="line">+    }</span>
<span class="line">+    log.info(&quot;vite3&quot;, &quot;%s目录已经准备就绪&quot;, targetDir);</span>
<span class="line">}</span>
<span class="line">module.exports = factory;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-下载模板" tabindex="-1"><a class="header-anchor" href="#_6-下载模板"><span>6.下载模板</span></a></h2><ul><li><a href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api" target="_blank" rel="noopener noreferrer">github api</a></li><li><a href="https://gitee.com/api/v5/swagger" target="_blank" rel="noopener noreferrer">gitee api</a></li></ul><h3 id="_6-1-安装" tabindex="-1"><a class="header-anchor" href="#_6-1-安装"><span>6.1 安装</span></a></h3><ul><li><a href="https://www.npmjs.com/package/clone-git-repo" target="_blank" rel="noopener noreferrer">clone-git-repo</a>下载仓库(GitHub, GitLab, Bitbucket,Gitee)<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn workspace @vite2/create  add clone-git-repo</span>
<span class="line">yarn workspace @vite2/utils  add  axios</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_6-2-settings-index-js" tabindex="-1"><a class="header-anchor" href="#_6-2-settings-index-js"><span>6.2 settings\\index.js</span></a></h3><p>packages\\settings\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//执行命令脚本</span>
<span class="line">exports.COMMAND_SOURCE = \`</span>
<span class="line">const args = JSON.parse(process.argv[1]);</span>
<span class="line">const factory = require(&#39;.&#39;);</span>
<span class="line">factory(args);</span>
<span class="line">\`</span>
<span class="line">+//配置文件名称</span>
<span class="line">+exports.RC_NAME = &quot;.vite3rc&quot;;</span>
<span class="line">+//组织的名称</span>
<span class="line">+exports.ORG_NAME = &quot;ORG_NAME&quot;;</span>
<span class="line">+//git仓库类型</span>
<span class="line">+exports.GIT_TYPE = &quot;GIT_TYPE&quot;;</span>
<span class="line">+//模板存放名称</span>
<span class="line">+exports.TEMPLATES = &quot;.vite3_templates&quot;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-utils-request-js" tabindex="-1"><a class="header-anchor" href="#_6-3-utils-request-js"><span>6.3 utils\\request.js</span></a></h3><p>packages\\utils\\request.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">GIT_TYPE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">GITEE</span> <span class="token operator">=</span> <span class="token string">&quot;https://gitee.com/api/v5&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">GITHUB</span> <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token constant">GIT_TYPE</span> <span class="token operator">===</span> <span class="token string">&quot;gitee&quot;</span> <span class="token operator">?</span> <span class="token constant">GITEE</span> <span class="token operator">:</span> <span class="token constant">GITHUB</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token constant">BASE_URL</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> request<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-4-withloading-js" tabindex="-1"><a class="header-anchor" href="#_6-4-withloading-js"><span>6.4 withLoading.js</span></a></h3><p>packages\\utils\\withLoading.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">withLoading</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;ora&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> spinner <span class="token operator">=</span> ora<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  spinner<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> withLoading<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-5-packages-utils-index-js" tabindex="-1"><a class="header-anchor" href="#_6-5-packages-utils-index-js"><span>6.5 packages\\utils\\index.js</span></a></h3><p>packages\\utils\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">exports.log = require(&#39;./log&#39;);</span>
<span class="line">exports.executeNodeScript = require(&#39;./executeNodeScript&#39;);</span>
<span class="line">exports.config = require(&#39;./config&#39;);</span>
<span class="line">+exports.withLoading = require(&#39;./withLoading&#39;);</span>
<span class="line">+exports.request = require(&#39;./request&#39;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-6-create-index-js" tabindex="-1"><a class="header-anchor" href="#_6-6-create-index-js"><span>6.6 create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const path = require(&quot;path&quot;);</span>
<span class="line">+const { promisify } = require(&quot;util&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">+const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">+const userhome = require(&quot;userhome&quot;);</span>
<span class="line">+const clone = promisify(require(&#39;clone-git-repo&#39;));</span>
<span class="line">+const { TEMPLATES } = require(&quot;@vite2/settings&quot;);</span>
<span class="line">+const { config, log,withLoading, request} = require(&quot;@vite2/utils&quot;);</span>
<span class="line">async function factory(argv) {</span>
<span class="line">    const { cwd, name } = argv;</span>
<span class="line">    process.chdir(cwd);//切换为当前命令执行的工作目录</span>
<span class="line">+   const { GIT_TYPE,ORG_NAME } = config;</span>
<span class="line">    if (!ORG_NAME) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置组织名称!&quot;);</span>
<span class="line">    }</span>
<span class="line">    const targetDir = path.join(process.cwd(), name);</span>
<span class="line">    log.info(&quot;vite2&quot;, &quot;创建的项目目录为%s&quot;, targetDir);</span>
<span class="line">    try {</span>
<span class="line">        await fs.access(targetDir);</span>
<span class="line">        const files = await fs.readdir(targetDir);</span>
<span class="line">        if (files.length &gt; 0) {</span>
<span class="line">            const { overwrite } = await prompt({</span>
<span class="line">                type: &quot;confirm&quot;,</span>
<span class="line">                name: &quot;overwrite&quot;,</span>
<span class="line">                message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">            });</span>
<span class="line">            if (overwrite) {</span>
<span class="line">                await fs.emptyDir(targetDir);</span>
<span class="line">            } else {</span>
<span class="line">                throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line">    } catch (error) {</span>
<span class="line">        await fs.mkdirp(targetDir);</span>
<span class="line">    }</span>
<span class="line">    log.info(&quot;vite3&quot;, &quot;%s目录已经准备就绪&quot;, targetDir);</span>
<span class="line">+    let repos = await withLoading(&quot;读取模板列表&quot;, async () =&gt;</span>
<span class="line">+        request.get(\`/orgs/\${ORG_NAME}/repos\`)</span>
<span class="line">+    );</span>
<span class="line">+    let { repo } = await prompt({</span>
<span class="line">+        name: &quot;repo&quot;,</span>
<span class="line">+        type: &quot;list&quot;,</span>
<span class="line">+        message: &quot;请选择模板&quot;,</span>
<span class="line">+        choices: repos.map((repo) =&gt; repo.name)</span>
<span class="line">+    });</span>
<span class="line">+    let tags = await withLoading(&quot;读取标签列表&quot;, async () =&gt;</span>
<span class="line">+        request.get(\`/repos/\${ORG_NAME}/\${repo}/tags\`)</span>
<span class="line">+    );</span>
<span class="line">+    let { tag } = await prompt({</span>
<span class="line">+        name: &quot;tag&quot;,</span>
<span class="line">+        type: &quot;list&quot;,</span>
<span class="line">+        message: &quot;请选择版本&quot;,</span>
<span class="line">+        choices: tags,</span>
<span class="line">+    });</span>
<span class="line">+    let repository = GIT_TYPE + \`:\${ORG_NAME}/\${repo}\`;</span>
<span class="line"> +    if(tag)repository+=\`</span>
<span class="line">+    const downloadDirectory = userhome(TEMPLATES);</span>
<span class="line">+    const repoDirectory = \`\${downloadDirectory}/\${repo}/\${tag}\`;</span>
<span class="line">+    log.info(&quot;vite3&quot;, &quot;准备下载模板到%s&quot;, repoDirectory);</span>
<span class="line">+    try {</span>
<span class="line">+        await fs.access(repoDirectory);</span>
<span class="line">+    } catch (error) {</span>
<span class="line">+        log.info(&quot;vite2&quot;, &quot;从仓库下载%s&quot;, repository);</span>
<span class="line">+        await clone(repository,repoDirectory, {clone:true});</span>
<span class="line">+    }</span>
<span class="line">}</span>
<span class="line">module.exports = factory;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-渲染模板" tabindex="-1"><a class="header-anchor" href="#_7-渲染模板"><span>7.渲染模板</span></a></h2><h3 id="_7-1-安装" tabindex="-1"><a class="header-anchor" href="#_7-1-安装"><span>7.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yarn workspace @vite2/create  add ejs glob execa</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ask.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;projectName&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;请输入项目名称&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;projectVersion&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请输入项目版本&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-packages-settings-index-js" tabindex="-1"><a class="header-anchor" href="#_7-2-packages-settings-index-js"><span>7.2 packages\\settings\\index.js</span></a></h3><p>packages\\settings\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//执行命令脚本</span>
<span class="line">exports.COMMAND_SOURCE = \`</span>
<span class="line">const args = JSON.parse(process.argv[1]);</span>
<span class="line">const factory = require(&#39;.&#39;);</span>
<span class="line">factory(args);</span>
<span class="line">\`</span>
<span class="line">//配置文件名称</span>
<span class="line">exports.RC_NAME = &quot;.vite3rc&quot;;</span>
<span class="line">//组织的名称</span>
<span class="line">exports.ORG_NAME = &quot;ORG_NAME&quot;;</span>
<span class="line">//git仓库类型</span>
<span class="line">exports.GIT_TYPE = &quot;GIT_TYPE&quot;;</span>
<span class="line">//模板存放名称</span>
<span class="line">exports.TEMPLATES = &quot;.vite3_templates&quot;;</span>
<span class="line">+//重命名文件配置</span>
<span class="line">+exports.RENAME_FILES = {</span>
<span class="line">+    _gitignore: &#39;.gitignore&#39;</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-packages-create-index-js" tabindex="-1"><a class="header-anchor" href="#_7-3-packages-create-index-js"><span>7.3 packages\\create\\index.js</span></a></h3><p>packages\\create\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const path = require(&quot;path&quot;);</span>
<span class="line">const { promisify } = require(&quot;util&quot;);</span>
<span class="line">const { red } = require(&quot;chalk&quot;);</span>
<span class="line">const fs = require(&quot;fs-extra&quot;);</span>
<span class="line">const { prompt } = require(&quot;inquirer&quot;);</span>
<span class="line">const userhome = require(&quot;userhome&quot;);</span>
<span class="line">const clone = promisify(require(&#39;clone-git-repo&#39;));</span>
<span class="line">+const glob = promisify(require(&quot;glob&quot;));</span>
<span class="line">+const { render } = require(&quot;ejs&quot;);</span>
<span class="line">+const execa = require(&quot;execa&quot;);</span>
<span class="line">+const { TEMPLATES,RENAME_FILES } = require(&quot;@vite2/settings&quot;);</span>
<span class="line">const { config, log, withLoading, request } = require(&quot;@vite2/utils&quot;);</span>
<span class="line">async function factory(argv) {</span>
<span class="line">    const { cwd, name } = argv;</span>
<span class="line">    process.chdir(cwd);//切换为当前命令执行的工作目录</span>
<span class="line">    const { GIT_TYPE, ORG_NAME } = config;</span>
<span class="line">    if (!ORG_NAME) {</span>
<span class="line">        throw new Error(red(&quot;X&quot;) + &quot; 尚未配置组织名称!&quot;);</span>
<span class="line">    }</span>
<span class="line">    const targetDir = path.join(process.cwd(), name);</span>
<span class="line">    log.info(&quot;vite2&quot;, &quot;创建的项目目录为%s&quot;, targetDir);</span>
<span class="line">    try {</span>
<span class="line">        await fs.access(targetDir);</span>
<span class="line">        const files = await fs.readdir(targetDir);</span>
<span class="line">        if (files.length &gt; 0) {</span>
<span class="line">            const { overwrite } = await prompt({</span>
<span class="line">                type: &quot;confirm&quot;,</span>
<span class="line">                name: &quot;overwrite&quot;,</span>
<span class="line">                message: \`目标目录非空，是否要移除存在的文件并继续?\`,</span>
<span class="line">            });</span>
<span class="line">            if (overwrite) {</span>
<span class="line">                await fs.emptyDir(targetDir);</span>
<span class="line">            } else {</span>
<span class="line">                throw new Error(red(&quot;X&quot;) + &quot; 操作被取消&quot;);</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line">    } catch (error) {</span>
<span class="line">        await fs.mkdirp(targetDir);</span>
<span class="line">    }</span>
<span class="line">    log.info(&quot;vite3&quot;, &quot;%s目录已经准备就绪&quot;, targetDir);</span>
<span class="line">    let repos = await withLoading(&quot;读取模板列表&quot;, async () =&gt;</span>
<span class="line">        request.get(\`/orgs/\${ORG_NAME}/repos\`)</span>
<span class="line">    );</span>
<span class="line">    let { repo } = await prompt({</span>
<span class="line">        name: &quot;repo&quot;,</span>
<span class="line">        type: &quot;list&quot;,</span>
<span class="line">        message: &quot;请选择模板&quot;,</span>
<span class="line">        choices: repos.map((repo) =&gt; repo.name)</span>
<span class="line">    });</span>
<span class="line">    let tags = await withLoading(&quot;读取标签列表&quot;, async () =&gt;</span>
<span class="line">        request.get(\`/repos/\${ORG_NAME}/\${repo}/tags\`)</span>
<span class="line">    );</span>
<span class="line">    let { tag } = await prompt({</span>
<span class="line">        name: &quot;tag&quot;,</span>
<span class="line">        type: &quot;list&quot;,</span>
<span class="line">        message: &quot;请选择版本&quot;,</span>
<span class="line">        choices: tags,</span>
<span class="line">    });</span>
<span class="line">    let repository = GIT_TYPE + \`:\${ORG_NAME}/\${repo}\`;</span>
<span class="line">     if (tag) repository += \`</span>
<span class="line">    const downloadDirectory = userhome(TEMPLATES);</span>
<span class="line">    const repoDirectory = \`\${downloadDirectory}/\${repo}/\${tag}\`;</span>
<span class="line">    log.info(&quot;vite3&quot;, &quot;准备下载模板到%s&quot;, repoDirectory);</span>
<span class="line">    try {</span>
<span class="line">        await fs.access(repoDirectory);</span>
<span class="line">    } catch (error) {</span>
<span class="line">        log.info(&quot;vite2&quot;, &quot;从仓库下载%s&quot;, repository);</span>
<span class="line">        await clone(repository, repoDirectory, { clone: true });</span>
<span class="line">    }</span>
<span class="line">+    let ask = path.join(repoDirectory, &quot;ask.json&quot;);</span>
<span class="line">+    if (fs.existsSync(ask)) {</span>
<span class="line">+        const askOptions = await fs.readJSON(ask);</span>
<span class="line">+        const result = await prompt(askOptions);</span>
<span class="line">+        const files = await glob(\`**/*\`, {</span>
<span class="line">+            cwd: repoDirectory,</span>
<span class="line">+            ignore: [&#39;ask.json&#39;],</span>
<span class="line">+            nodir: true</span>
<span class="line">+        });</span>
<span class="line">+        await Promise.all(files.map(file =&gt; new Promise(async function (resolve) {</span>
<span class="line">+            let content = await fs.readFile(path.join(repoDirectory, file), &#39;utf8&#39;);</span>
<span class="line">+            let renderContent = await render(content, result);</span>
<span class="line">+            let targetName = RENAME_FILES[file] || file;</span>
<span class="line">+            let targetFile = path.join(targetDir, targetName);</span>
<span class="line">+            await fs.ensureDir(path.dirname(targetFile));</span>
<span class="line">+            await fs.writeFile(targetFile, renderContent, &#39;utf8&#39;);</span>
<span class="line">+            resolve();</span>
<span class="line">+        })));</span>
<span class="line">+    } else {</span>
<span class="line">+        await fs.copy(repoDirectory, targetDir);</span>
<span class="line">+    }</span>
<span class="line">+    process.chdir(targetDir);</span>
<span class="line">+    log.info(&quot;vite3&quot;, &quot;在%s初始化 Git 仓库&quot;, targetDir);</span>
<span class="line">+    await execa(&quot;git&quot;, [&quot;init&quot;], { stdio: &quot;inherit&quot; });</span>
<span class="line">+    log.info(&quot;vite3&quot;, &quot;在%s安装依赖&quot;, targetDir);</span>
<span class="line">+    await execa(&quot;npm&quot;, [&quot;install&quot;], { stdio: &quot;inherit&quot; });</span>
<span class="line">+    log.info(&quot;vite3&quot;, &quot;启动服务&quot;);</span>
<span class="line">+    await execa(&quot;node&quot;, [&quot;./node_modules/esbuild/install.js&quot;], {</span>
<span class="line">+        stdio: &quot;inherit&quot;,</span>
<span class="line">+    });</span>
<span class="line">+    await execa(&quot;npm&quot;, [&quot;run&quot;, &quot;dev&quot;], { stdio: &quot;inherit&quot; });</span>
<span class="line">}</span>
<span class="line">module.exports = factory;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-发布" tabindex="-1"><a class="header-anchor" href="#_8-发布"><span>8.发布</span></a></h2><h3 id="_8-1-创建组织" tabindex="-1"><a class="header-anchor" href="#_8-1-创建组织"><span>8.1 创建组织</span></a></h3><ul><li><a href="https://www.npmjs.com/org/create" target="_blank" rel="noopener noreferrer">create</a></li></ul><h3 id="_8-2-发布" tabindex="-1"><a class="header-anchor" href="#_8-2-发布"><span>8.2 发布</span></a></h3><p>package.json</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://registry.npmjs.org&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm whoami</span>
<span class="line">npm login</span>
<span class="line">zhangrenyang2000</span>
<span class="line">lerna publish</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-参考" tabindex="-1"><a class="header-anchor" href="#_9-参考"><span>9.参考</span></a></h2><h3 id="_9-1-lerna" tabindex="-1"><a class="header-anchor" href="#_9-1-lerna"><span>9.1 lerna</span></a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">lerna bootstrap</td><td style="text-align:left;">安装依赖</td></tr><tr><td style="text-align:left;">lerna clean</td><td style="text-align:left;">删除各个包下的node_modules</td></tr><tr><td style="text-align:left;">lerna init</td><td style="text-align:left;">创建新的lerna库</td></tr><tr><td style="text-align:left;">lerna list</td><td style="text-align:left;">查看本地包列表</td></tr><tr><td style="text-align:left;">lerna changed</td><td style="text-align:left;">显示自上次release tag以来有修改的包， 选项通 list</td></tr><tr><td style="text-align:left;">lerna diff</td><td style="text-align:left;">显示自上次release tag以来有修改的包的差异， 执行 git diff</td></tr><tr><td style="text-align:left;">lerna exec</td><td style="text-align:left;">在每个包目录下执行任意命令</td></tr><tr><td style="text-align:left;">lerna run</td><td style="text-align:left;">执行每个包package.json中的脚本命令</td></tr><tr><td style="text-align:left;">lerna add</td><td style="text-align:left;">添加一个包的版本为各个包的依赖</td></tr><tr><td style="text-align:left;">lerna import</td><td style="text-align:left;">引入package</td></tr><tr><td style="text-align:left;">lerna link</td><td style="text-align:left;">链接互相引用的库</td></tr><tr><td style="text-align:left;">lerna create</td><td style="text-align:left;">新建package</td></tr><tr><td style="text-align:left;">lerna publish</td><td style="text-align:left;">发布</td></tr></tbody></table><h3 id="_9-2-yarn" tabindex="-1"><a class="header-anchor" href="#_9-2-yarn"><span>9.2 yarn</span></a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">yarn -v</td><td style="text-align:left;">查看yarn版本</td></tr><tr><td style="text-align:left;">yarn config list</td><td style="text-align:left;">查看yarn的所有配置</td></tr><tr><td style="text-align:left;">yarn config set registry <a href="https://registry.npm.taobao.org/" target="_blank" rel="noopener noreferrer">https://registry.npm.taobao.org/</a></td><td style="text-align:left;">修改yarn的源镜像为淘宝源</td></tr><tr><td style="text-align:left;">yarn config set global-folder &quot;D:\\RTE\\Yarn\\global&quot;</td><td style="text-align:left;">修改全局安装目录, 先创建好目录(global), 我放在了Yarn安装目录下(D:\\RTE\\Yarn\\global)</td></tr><tr><td style="text-align:left;">yarn config set prefix &quot;D:\\RTE\\Yarn\\global\\&quot;</td><td style="text-align:left;">修改全局安装目录的bin目录位置</td></tr><tr><td style="text-align:left;">yarn config set cache-folder &quot;D:\\RTE\\Yarn\\cache&quot;</td><td style="text-align:left;">修改全局缓存目录, 先创建好目录(cache), 和global放在同一层目录下</td></tr><tr><td style="text-align:left;">yarn config list</td><td style="text-align:left;">查看所有配置</td></tr><tr><td style="text-align:left;">yarn global bin</td><td style="text-align:left;">查看当前yarn的bin的位置</td></tr><tr><td style="text-align:left;">yarn global dir</td><td style="text-align:left;">查看当前yarn的全局安装位置</td></tr></tbody></table><h3 id="_9-2-yarn-workspace" tabindex="-1"><a class="header-anchor" href="#_9-2-yarn-workspace"><span>9.2 yarn workspace</span></a></h3><ul><li><a href="https://yarn.bootcss.com/docs/" target="_blank" rel="noopener noreferrer">yarn官网</a></li><li>yarn add &lt;package...&gt; [--ignore-workspace-root-check/-W]</li><li>yarn add &lt;package...&gt; [--dev/-D]</li></ul><table><thead><tr><th style="text-align:left;">作用</th><th style="text-align:left;">命令</th></tr></thead><tbody><tr><td style="text-align:left;">查看工作空间信息</td><td style="text-align:left;">yarn workspaces info</td></tr><tr><td style="text-align:left;">给所有的空间添加依赖</td><td style="text-align:left;">yarn workspaces run add lodash</td></tr><tr><td style="text-align:left;">给根空间添加依赖</td><td style="text-align:left;">yarn add -W -D typescript jest</td></tr><tr><td style="text-align:left;">给某个项目添加依赖</td><td style="text-align:left;">yarn workspace create-react-app3 add commander</td></tr><tr><td style="text-align:left;">删除所有的 node_modules</td><td style="text-align:left;">lerna clean 等于 yarn workspaces run clean</td></tr><tr><td style="text-align:left;">安装和link所有的名</td><td style="text-align:left;">yarn install 等于 lerna bootstrap --npm-client yarn --use-workspaces</td></tr><tr><td style="text-align:left;">重新获取所有的 node_modules</td><td style="text-align:left;">yarn install --force</td></tr><tr><td style="text-align:left;">查看缓存目录</td><td style="text-align:left;">yarn cache dir</td></tr><tr><td style="text-align:left;">清除本地缓存</td><td style="text-align:left;">yarn cache clean</td></tr><tr><td style="text-align:left;">在所有package中运行指定的命令</td><td style="text-align:left;">yarn workspaces run</td></tr></tbody></table><h3 id="_9-3-yargs" tabindex="-1"><a class="header-anchor" href="#_9-3-yargs"><span>9.3 yargs</span></a></h3><ul><li><a href="https://www.npmjs.com/package/yargs" target="_blank" rel="noopener noreferrer">yargs</a>帮助你构建交互命令行工具，可以解析参数生成优雅的用户界面</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;yargs/yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> cli <span class="token operator">=</span> <span class="token function">yargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">cli</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Usage: vite2 &lt;command&gt; [options]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">demandCommand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;至少需要一个命令&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">strict</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">recommendCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token string">&quot;create &lt;name&gt;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;创建项目&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            yargs<span class="token punctuation">.</span><span class="token function">positional</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;项目名称&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">           <span class="token comment">//{ _: [ &#39;create&#39; ], &#39;$0&#39;: &#39;doc\\\\1.yargs.js&#39;, name: &#39;p1&#39; }</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-4-node-e" tabindex="-1"><a class="header-anchor" href="#_9-4-node-e"><span>9.4 node -e</span></a></h3><ul><li>[node -e](https://nodejs.org/api/cli.html</li><li>-e, --eval &quot;script&quot;</li><li>设置<code>stdion: &#39;inherit&#39;</code>,当执行代码时,子进程将会继承主进程的stdin、stdout和stderr</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">node <span class="token operator">-</span>e <span class="token string">&quot;console.log(process.argv)&quot;</span> <span class="token operator">--</span> a b</span>
<span class="line">node <span class="token operator">-</span>e <span class="token string">&quot;console.log(JSON.parse(process.argv[1]))&quot;</span> <span class="token operator">--</span> <span class="token string">&quot;{\\&quot;name\\&quot;:\\&quot;zhufeng\\&quot;}&quot;</span></span>
<span class="line">node <span class="token operator">-</span>e <span class="token string">&quot;console.log(process.cwd())&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cross-spawn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">executeNodeScript</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cwd <span class="token punctuation">}</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> childProcess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span></span>
<span class="line">        process<span class="token punctuation">.</span>execPath<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">[</span><span class="token string">&quot;-e&quot;</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token string">&quot;--&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> cwd<span class="token punctuation">,</span> <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      childProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> executeNodeScript<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-5-clone" tabindex="-1"><a class="header-anchor" href="#_9-5-clone"><span>9.5 clone</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;clone-git-repo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token keyword">let</span> repository <span class="token operator">=</span> &#39;gitee<span class="token operator">:</span>zhufengtemplate<span class="token operator">/</span>template<span class="token operator">-</span>react</span>
<span class="line"><span class="token function">clone</span><span class="token punctuation">(</span>repository<span class="token punctuation">,</span><span class="token string">&#39;./output&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">clone</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,147)])])}const o=n(p,[["render",i]]),r=JSON.parse('{"path":"/strong/138.create-vite.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/138.create-vite.md"}');export{o as comp,r as data};
