import{_ as a,c as n,a as e,o as l}from"./app-CD1YpnS1.js";const p={};function i(t,s){return l(),n("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-什么是-kubernetes" tabindex="-1"><a class="header-anchor" href="#_1-什么是-kubernetes"><span>1.什么是 Kubernetes</span></a></h2><ul><li>Kubernetes 看作是用来是一个部署镜像的平台</li><li>可以用来操作多台机器调度部署镜像</li><li>在 Kubernetes 中，可以使用集群来组织服务器的。集群中会存在一个 <code>Master</code> 节点，该节点是 Kubernetes 集群的控制节点，负责调度集群中其他服务器的资源。其他节点被称为 Node</li></ul><h2 id="_2-基础安装" tabindex="-1"><a class="header-anchor" href="#_2-基础安装"><span>2. 基础安装</span></a></h2><ul><li>Master &amp; Node 节点都需要安装</li></ul><h3 id="_2-1-安装些必备组件" tabindex="-1"><a class="header-anchor" href="#_2-1-安装些必备组件"><span>2.1 安装些必备组件</span></a></h3><ul><li>vim 是 Linux 下的一个文件编辑器</li><li>wget 可以用作文件下载使用</li><li>ntpdate 则是可以用来同步时区</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum install vim wget ntpdate -y</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-关闭防火墙" tabindex="-1"><a class="header-anchor" href="#_2-2-关闭防火墙"><span>2.2 关闭防火墙</span></a></h3><ul><li>kubernetes 会创建防火墙规则,先关闭<code>firewalld</code></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl stop firewalld &amp; systemctl disable firewalld</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-3-关闭-swap-分区" tabindex="-1"><a class="header-anchor" href="#_2-3-关闭-swap-分区"><span>2.3 关闭 Swap 分区</span></a></h3><ul><li>Swap 是 Linux 的交换分区，在系统资源不足时，Swap 分区会启用,这个我们不需要</li><li>应该让新创建的服务自动调度到集群的其他 Node 节点中去，而不是使用 Swap 分区</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">swapoff -a</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-关闭-selinux" tabindex="-1"><a class="header-anchor" href="#_2-4-关闭-selinux"><span>2.4 关闭 Selinux</span></a></h3><ul><li>关闭Selinux是为了支持容器可以访问宿主机文件系统</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">setenforce 0</span>
<span class="line"></span>
<span class="line"> </span>
<span class="line">vi /etc/sysconfig/selinux</span>
<span class="line"> </span>
<span class="line">SELINUX=disabled</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-统一我们的系统时间和时区" tabindex="-1"><a class="header-anchor" href="#_2-5-统一我们的系统时间和时区"><span>2.5 统一我们的系统时间和时区</span></a></h3><ul><li>使用 <code>ntpdate</code> 来统一我们的系统时间和时区,服务器时间与阿里云服务器对齐</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<span class="line">bash -c &quot;echo &#39;Asia/Shanghai&#39; &gt; /etc/timezone&quot;</span>
<span class="line"></span>
<span class="line"> </span>
<span class="line">ntpdate ntp1.aliyun.com</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-安装-docker" tabindex="-1"><a class="header-anchor" href="#_2-6-安装-docker"><span>2.6 安装 Docker</span></a></h3><ul><li>在 kubernetes 中的组件，服务都可以 Docker 镜像方式部署的,所以需要安装Docker</li><li>device-mapper-persistent-data: 存储驱动，Linux上的许多高级卷管理技术</li><li>lvm: 逻辑卷管理器，用于创建逻辑磁盘分区使用</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils device<span class="token operator">-</span>mapper<span class="token operator">-</span>persistent<span class="token operator">-</span>data lvm2</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">sudo yum<span class="token operator">-</span>config<span class="token operator">-</span>manager <span class="token operator">--</span>add<span class="token operator">-</span>repo http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo</span>
<span class="line">yum install docker<span class="token operator">-</span>ce <span class="token operator">-</span>y</span>
<span class="line">systemctl start docker</span>
<span class="line">systemctl enable docker</span>
<span class="line"></span>
<span class="line">sudo mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>docker</span>
<span class="line">sudo tee <span class="token operator">/</span>etc<span class="token operator">/</span>docker<span class="token operator">/</span>daemon<span class="token punctuation">.</span>json <span class="token operator">&lt;&lt;</span><span class="token operator">-</span><span class="token string">&#39;EOF&#39;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://fwvjnv59.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token constant">EOF</span></span>
<span class="line"></span>
<span class="line">sudo systemctl daemon<span class="token operator">-</span>reload</span>
<span class="line">sudo systemctl restart docker<span class="token punctuation">.</span>service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-7-安装-kubernetes-组件" tabindex="-1"><a class="header-anchor" href="#_2-7-安装-kubernetes-组件"><span>2.7 安装 Kubernetes 组件</span></a></h3><h4 id="_2-7-1-切换阿里云源" tabindex="-1"><a class="header-anchor" href="#_2-7-1-切换阿里云源"><span>2.7.1 切换阿里云源</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">etc</span><span class="token regex-delimiter">/</span><span class="token regex-flags">yum</span></span><span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>kubernetes<span class="token punctuation">.</span>repo</span>
<span class="line"><span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span></span>
<span class="line">name<span class="token operator">=</span>Kubernetes</span>
<span class="line">baseurl<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>yum<span class="token operator">/</span>repos<span class="token operator">/</span>kubernetes<span class="token operator">-</span>el7<span class="token operator">-</span>x86_64</span>
<span class="line">enabled<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line">gpgcheck<span class="token operator">=</span><span class="token number">0</span></span>
<span class="line">repo_gpgcheck<span class="token operator">=</span><span class="token number">0</span></span>
<span class="line">gpgkey<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>yum<span class="token operator">/</span>doc<span class="token operator">/</span>yum<span class="token operator">-</span>key<span class="token punctuation">.</span>gpg</span>
<span class="line">        <span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>yum<span class="token operator">/</span>doc<span class="token operator">/</span>rpm<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">-</span>key<span class="token punctuation">.</span>gpg</span>
<span class="line"><span class="token constant">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-7-2-安装-kubernetes-组件" tabindex="-1"><a class="header-anchor" href="#_2-7-2-安装-kubernetes-组件"><span>2.7.2 安装 Kubernetes 组件</span></a></h4><ul><li>kubelet 是 Kubernetes 中的核心组件。它会运行在集群的所有节点上，并负责创建启动服务容器</li><li>kubectl 则是Kubernetes的命令行工具。可以用来管理，删除，创建资源</li><li>kubeadm 则是用来初始化集群，子节点加入的工具</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum install -y kubelet kubeadm kubectl</span>
<span class="line"> </span>
<span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-8-设置bridge-nf-call-iptables" tabindex="-1"><a class="header-anchor" href="#_2-8-设置bridge-nf-call-iptables"><span>2.8 设置bridge-nf-call-iptables</span></a></h3><ul><li>配置内核参数，将桥接的IPV4浏览传递到iptables链</li><li>开启了bridge-nf-call-iptables</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">echo <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token operator">/</span>proc<span class="token operator">/</span>sys<span class="token operator">/</span>net<span class="token operator">/</span>bridge<span class="token operator">/</span>bridge<span class="token operator">-</span>nf<span class="token operator">-</span>call<span class="token operator">-</span>iptables</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-master" tabindex="-1"><a class="header-anchor" href="#_3-master"><span>3. Master</span></a></h2><ul><li>Master 节点是集群内的调度和主要节点</li></ul><h3 id="_3-1-修改主机名称为-master" tabindex="-1"><a class="header-anchor" href="#_3-1-修改主机名称为-master"><span>3.1 修改主机名称为 master</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">hostnamectl set<span class="token operator">-</span>hostname  master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-2-配置hosts" tabindex="-1"><a class="header-anchor" href="#_3-2-配置hosts"><span>3.2 配置hosts</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">ip addr</span>
<span class="line">vim <span class="token operator">/</span>etc<span class="token operator">/</span>hosts</span>
<span class="line"></span>
<span class="line"><span class="token number">172.31</span><span class="token number">.178</span><span class="token number">.169</span>  master  master</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-配置-kubernetes-初始化文件" tabindex="-1"><a class="header-anchor" href="#_3-3-配置-kubernetes-初始化文件"><span>3.3 配置 Kubernetes 初始化文件</span></a></h3><ul><li><code>init-defaults</code> 输出一份默认初始化配置文件</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubeadm config print init-defaults &gt; init-kubeadm.conf</span>
<span class="line">vim init-kubeadm.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>更换 Kubernetes 镜像仓库为阿里云镜像仓库，加速组件拉取</li><li>替换 ip 为自己主机 ip</li><li>配置 pod 网络为 <code>flannel</code> 网段</li><li>为了让集群之间可以互相通信，需要配置子网络,这些在后面的flannel网络中需要用到 <ul><li>10.96.0.0/12 是Kubernetes内部的网络pods需要的网络</li><li>10.244.0.0/16 是Kubernetes内部services需要的网络</li></ul></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">- imageRepository: k8s.gcr.io 更换k8s镜像仓库</span>
<span class="line">+ imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span>
<span class="line">- localAPIEndpointc，advertiseAddress为master ip ,port默认不修改</span>
<span class="line">localAPIEndpoint:</span>
<span class="line"> + advertiseAddress: 172.31.178.169  </span>
<span class="line">  bindPort: 6443</span>
<span class="line"> </span>
<span class="line">networking:</span>
<span class="line">  dnsDomain: cluster.local</span>
<span class="line">  serviceSubnet: 10.96.0.0/12</span>
<span class="line"> + podSubnet: 10.244.0.0/16    </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-拉取其它组件" tabindex="-1"><a class="header-anchor" href="#_3-3-拉取其它组件"><span>3.3 拉取其它组件</span></a></h3><ul><li>kubeadm 可以用来拉取我们的默认组件镜像</li><li>kube-apiserver 提供接口服务，可以让外网访问集群</li><li>kube-controller-manager 内部的控制指令工具</li><li>kube-scheduler 内部的任务调度器</li><li>kube-proxy 反向代理和负载均衡，流量转发</li><li>pause 进程管理工具</li><li>etcd 保持 集群内部的数据一致性</li><li>coredns 集群内网通信</li></ul><p><img src="https://img.zhufengpeixun.com/c844dfc8104d55a90f18d4dc0a57d5c4" alt="c844dfc8104d55a90f18d4dc0a57d5c4"></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 查看缺少的组件</span></span>
<span class="line">kubeadm config images list <span class="token operator">--</span>config init<span class="token operator">-</span>kubeadm<span class="token punctuation">.</span>conf</span>
<span class="line"><span class="token comment">// 拉取缺少的组件</span></span>
<span class="line">kubeadm config images pull <span class="token operator">--</span>config init<span class="token operator">-</span>kubeadm<span class="token punctuation">.</span>conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-初始化-kubernetes" tabindex="-1"><a class="header-anchor" href="#_3-4-初始化-kubernetes"><span>3.4 初始化 Kubernetes</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubeadm init --config init-kubeadm.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><p><code>kubeadm join</code> 可以快速将 Node 节点加入到 Master 集群内</p></li><li><p>Master 节点需要执行的初始化命令</p></li><li><p>将默认的 Kubernetes 认证文件拷贝进 .kube 文件夹内，才能默认使用该配置文件</p></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">Your Kubernetes control<span class="token operator">-</span>plane has initialized successfully<span class="token operator">!</span></span>
<span class="line"></span>
<span class="line">To start using your cluster<span class="token punctuation">,</span> you need to run the following <span class="token keyword">as</span> a regular user<span class="token operator">:</span></span>
<span class="line"></span>
<span class="line">  mkdir <span class="token operator">-</span>p $<span class="token constant">HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube</span>
<span class="line">  sudo cp <span class="token operator">-</span>i <span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>admin<span class="token punctuation">.</span>conf $<span class="token constant">HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube<span class="token operator">/</span>config</span>
<span class="line">  sudo chown <span class="token function">$</span><span class="token punctuation">(</span>id <span class="token operator">-</span>u<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">$</span><span class="token punctuation">(</span>id <span class="token operator">-</span>g<span class="token punctuation">)</span> $<span class="token constant">HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube<span class="token operator">/</span>config</span>
<span class="line"></span>
<span class="line">Alternatively<span class="token punctuation">,</span> <span class="token keyword">if</span> you are the root user<span class="token punctuation">,</span> you can run<span class="token operator">:</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">export</span> <span class="token constant">KUBECONFIG</span><span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>kubernetes<span class="token operator">/</span>admin<span class="token punctuation">.</span>conf</span>
<span class="line"></span>
<span class="line">You should now deploy a pod network to the cluster<span class="token punctuation">.</span></span>
<span class="line">Run <span class="token string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> <span class="token keyword">with</span> one <span class="token keyword">of</span> the options listed at<span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>docs<span class="token operator">/</span>concepts<span class="token operator">/</span>cluster<span class="token operator">-</span>administration<span class="token operator">/</span>addons<span class="token operator">/</span></span>
<span class="line"></span>
<span class="line">Then you can join any number <span class="token keyword">of</span> worker nodes by running the following on each <span class="token keyword">as</span> <span class="token literal-property property">root</span><span class="token operator">:</span></span>
<span class="line"></span>
<span class="line">kubeadm join <span class="token number">172.31</span><span class="token number">.178</span><span class="token number">.169</span><span class="token operator">:</span><span class="token number">6443</span> <span class="token operator">--</span>token abcdef<span class="token punctuation">.</span>0123456789abcdef \\</span>
<span class="line">    <span class="token operator">--</span>discovery<span class="token operator">-</span>token<span class="token operator">-</span>ca<span class="token operator">-</span>cert<span class="token operator">-</span>hash sha256<span class="token operator">:</span>8aac19f4dbe68f1e15ba3d80e141acdc912e353f9757ad69187e8fb9780bc975 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-安装-flannel" tabindex="-1"><a class="header-anchor" href="#_3-5-安装-flannel"><span>3.5 安装 Flannel</span></a></h3><ul><li><code>flannel</code> 主要的作用是通过创建一个虚拟网络，让不同节点下的服务有着全局唯一的IP地址，且服务之前可以互相访问和连接。</li><li>集群内网网络通信协议通信模式采用了Flannel协议</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">wget https://img.zhufengpeixun.com/kube-flannel.yml</span>
<span class="line">docker pull quay.io/coreos/flannel:v0.13.0-rc2</span>
<span class="line">kubectl apply -f kube-flannel.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">net-conf.json: |</span>
<span class="line">    {</span>
<span class="line">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span>
<span class="line">      &quot;Backend&quot;: {</span>
<span class="line">        &quot;Type&quot;: &quot;vxlan&quot;</span>
<span class="line">      }</span>
<span class="line">    }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-查看启动情况" tabindex="-1"><a class="header-anchor" href="#_3-6-查看启动情况"><span>3.6 查看启动情况</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token keyword">get</span> nodes</span>
<span class="line"></span>
<span class="line"><span class="token constant">NAME</span>     <span class="token constant">STATUS</span>   <span class="token constant">ROLES</span>                  <span class="token constant">AGE</span>     <span class="token constant">VERSION</span></span>
<span class="line">master   Ready    control<span class="token operator">-</span>plane<span class="token punctuation">,</span>master   9m34s   v1<span class="token punctuation">.</span><span class="token number">20.4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-node节点配置" tabindex="-1"><a class="header-anchor" href="#_3-7-node节点配置"><span>3.7 Node节点配置</span></a></h3><ul><li>Node 节点的地位则是负责运行服务容器，负责接收调度的。</li><li>先执行基础安装</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">hostnamectl set<span class="token operator">-</span>hostname node1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-8-拷贝-master-节点配置文件" tabindex="-1"><a class="header-anchor" href="#_3-8-拷贝-master-节点配置文件"><span>3.8 拷贝 Master 节点配置文件</span></a></h3><ul><li>将 master 节点的配置文件拷贝 k8s 到 node1 节点</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">scp $HOME/.kube/config root@172.31.178.170:~/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>在node1节点归档配置文件</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir -p $HOME/.kube</span>
<span class="line">sudo mv $HOME/config $HOME/.kube/config</span>
<span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-9-加入-master-节点" tabindex="-1"><a class="header-anchor" href="#_3-9-加入-master-节点"><span>3.9 加入 Master 节点</span></a></h3><ul><li>让 Node 节点加入到 master 集群内</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubeadm join <span class="token number">172.16</span><span class="token number">.81</span><span class="token number">.164</span><span class="token operator">:</span><span class="token number">6443</span> <span class="token operator">--</span>token abcdef<span class="token punctuation">.</span>0123456789abcdef \\</span>
<span class="line">    <span class="token operator">--</span>discovery<span class="token operator">-</span>token<span class="token operator">-</span>ca<span class="token operator">-</span>cert<span class="token operator">-</span>hash sha256<span class="token operator">:</span>b4a059eeffa2e52f2eea7a5d592be10c994c7715c17bda57bbc3757d4f13903d</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>如果刚才的命令丢了，可以在 master 机器上使用 kubeadm token create 重新生成一条命令<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubeadm token create --print-join-command</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h3 id="_3-10-安装-flannel" tabindex="-1"><a class="header-anchor" href="#_3-10-安装-flannel"><span>3.10. 安装 Flannel</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">scp ~/kube-flannel.yml root@172.31.178.170:~/</span>
<span class="line">kubectl apply -f kube-flannel.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-查看状态" tabindex="-1"><a class="header-anchor" href="#_4-查看状态"><span>4. 查看状态</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token keyword">get</span> nodes</span>
<span class="line"><span class="token constant">NAME</span>     <span class="token constant">STATUS</span>   <span class="token constant">ROLES</span>                  <span class="token constant">AGE</span>    <span class="token constant">VERSION</span></span>
<span class="line">master   Ready    control<span class="token operator">-</span>plane<span class="token punctuation">,</span>master   24m    v1<span class="token punctuation">.</span><span class="token number">20.4</span></span>
<span class="line">node1    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 101s   v1<span class="token punctuation">.</span><span class="token number">20.4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-直接布署nginx" tabindex="-1"><a class="header-anchor" href="#_5-直接布署nginx"><span>5.直接布署nginx</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl create deployment nginx --image=nginx</span>
<span class="line"> [root@master ~]</span>
<span class="line">service/nginx exposed</span>
<span class="line">kubectl get pod,svc</span>
<span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span>
<span class="line">pod/nginx-6799fc88d8-bt5n6      1/1     Running   0          5m32s</span>
<span class="line"></span>
<span class="line">curl 127.0.0.1:32636</span>
<span class="line">//快速扩容为3个副本</span>
<span class="line"> [root@master ~]</span>
<span class="line">deployment.apps/nginx scaled</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-通过yaml布署mysql" tabindex="-1"><a class="header-anchor" href="#_6-通过yaml布署mysql"><span>6.通过yaml布署mysql</span></a></h2><h3 id="_6-1-配置文件" tabindex="-1"><a class="header-anchor" href="#_6-1-配置文件"><span>6.1 配置文件</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> ReplicationController                           </span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> mysql                                          </span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">   <span class="token literal-property property">replicas</span><span class="token operator">:</span> <span class="token number">1</span>           </span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">     <span class="token literal-property property">app</span><span class="token operator">:</span> mysql          </span>
<span class="line">   <span class="token literal-property property">template</span><span class="token operator">:</span>             </span>
<span class="line">    <span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">labels</span><span class="token operator">:</span></span>
<span class="line">         <span class="token literal-property property">app</span><span class="token operator">:</span> mysql     </span>
<span class="line">    <span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">       <span class="token literal-property property">containers</span><span class="token operator">:</span>      </span>
<span class="line">       <span class="token operator">-</span> name<span class="token operator">:</span> mysql            </span>
<span class="line">         <span class="token literal-property property">image</span><span class="token operator">:</span> mysql    </span>
<span class="line">        <span class="token literal-property property">ports</span><span class="token operator">:</span> </span>
<span class="line">         <span class="token operator">-</span> containerPort<span class="token operator">:</span> <span class="token number">3306</span>       </span>
<span class="line">         <span class="token literal-property property">env</span><span class="token operator">:</span>                        </span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token constant">MYSQL_ROOT_PASSWORD</span> </span>
<span class="line">          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-创建pod" tabindex="-1"><a class="header-anchor" href="#_6-2-创建pod"><span>6.2 创建POD</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl create <span class="token operator">-</span>f mysql<span class="token operator">-</span>rc<span class="token punctuation">.</span>yaml</span>
<span class="line">replicationcontroller<span class="token operator">/</span>mysql created</span>
<span class="line"></span>
<span class="line">kubectl <span class="token keyword">get</span> pods</span>
<span class="line"><span class="token constant">NAME</span>          <span class="token constant">READY</span>   <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span></span>
<span class="line">mysql         <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running      <span class="token number">0</span>      5m56s</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-查看状态" tabindex="-1"><a class="header-anchor" href="#_6-3-查看状态"><span>6.3 查看状态</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl describe pod mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,81)])])}const c=a(p,[["render",i]]),o=JSON.parse('{"path":"/strong/125.13.k8s.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/125.13.k8s.md"}');export{c as comp,o as data};
