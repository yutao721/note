import{_ as n,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(i,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-formily" tabindex="-1"><a class="header-anchor" href="#_1-formily"><span>1.formily</span></a></h2><ul><li><a href="https://formilyjs.org/zh-CN/guide" target="_blank" rel="noopener noreferrer">formilyjs</a></li><li><a href="https://github.com/alibaba/formily" target="_blank" rel="noopener noreferrer">formily</a></li><li>内容大纲 <ul><li>实现<code>@formily/reactive</code>核心</li><li>实现<code>@formily/reactive-react</code>核心</li><li>实现<code>@formily/core</code>核心</li><li>实现<code>@formily/react</code>核心</li><li>实现<code>@formily/antd</code>核心</li></ul></li></ul><p><img src="https://static.zhufengpeixun.com/formily_1659867545884.svg" alt=""></p><h3 id="_1-1-安装" tabindex="-1"><a class="header-anchor" href="#_1-1-安装"><span>1.1 安装</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">pnpm create vite</span>
<span class="line">pnpm install @formily/reactive @formily/reactive-react @formily/core @formily/react @formily/antd antd moment less --save</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-vite-config-ts" tabindex="-1"><a class="header-anchor" href="#_1-2-vite-config-ts"><span>1.2 vite.config.ts</span></a></h3><p>vite.config.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^~</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">less</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-formily-reactive" tabindex="-1"><a class="header-anchor" href="#_2-formily-reactive"><span>2. @formily/reactive</span></a></h2><ul><li>依赖<a href="https://reactive.formilyjs.org/zh-CN" target="_blank" rel="noopener noreferrer">@formily/reactive</a>响应式解决方案，构建响应式表单的领域模型实现精确渲染</li></ul><p><img src="https://static.zhufengpeixun.com/Reaction_1655437930177.png" alt="Reaction"></p><h3 id="_2-1-observable" tabindex="-1"><a class="header-anchor" href="#_2-1-observable"><span>2.1 observable</span></a></h3><ul><li>[observable](hhttps://reactive.formilyjs.org/zh-CN/guide/concept</li><li>一个<code>observable</code>对象，字面意思是可订阅对象，我们通过创建一个可订阅对象，在每次操作该对象的属性数据的过程中，会自动通知订阅者</li><li><a href="https://reactive.formilyjs.org/zh-CN" target="_blank" rel="noopener noreferrer">@formily/reactive</a> 创建 <a href="https://reactive.formilyjs.org/zh-CN/api/observable" target="_blank" rel="noopener noreferrer">observable</a> 对象主要是通过 <code>ES Proxy</code> 来创建的，它可以做到完美劫持数据操作</li></ul><h3 id="_2-2-reaction" tabindex="-1"><a class="header-anchor" href="#_2-2-reaction"><span>2.2 Reaction</span></a></h3><ul><li>[reaction](https://reactive.formilyjs.org/zh-CN/guide/concept</li><li>它接收一个 <code>tracker</code> 函数，这个函数在执行的时候，如果函数内部有对 <code>observable</code> 对象中的某个属性进行读操作会进行依赖收集，那当前 <code>reaction</code> 就会与该属性进行一个绑定(依赖追踪)，该属性在其它地方发生了写操作，就会触发 <code>tracker</code> 函数重复执行</li><li>从订阅到派发订阅，其实是一个封闭的循环状态机，每次 <code>tracker</code> 函数执行的时候都会重新收集依赖，依赖变化时又会重新触发<code>tracker</code>执行</li></ul><p><img src="https://static.zhufengpeixun.com/reaction_1659865173726.png" alt=""></p><h3 id="_2-3-autorun" tabindex="-1"><a class="header-anchor" href="#_2-3-autorun"><span>2.3 autorun</span></a></h3><ul><li><a href="https://reactive.formilyjs.org/zh-CN/api/autorun" target="_blank" rel="noopener noreferrer">autorun</a>可以创建一个自动执行的响应器</li><li>接收一个 <code>tracker</code> 函数，如果函数内部有消费 <code>observable</code> 数据，数据发生变化时，<code>tracker</code> 函数会重复执行</li></ul><h3 id="_2-4-创建深度可观察对象" tabindex="-1"><a class="header-anchor" href="#_2-4-创建深度可观察对象"><span>2.4 创建深度可观察对象</span></a></h3><ul><li><a href="https://reactive.formilyjs.org/zh-CN/api/observable" target="_blank" rel="noopener noreferrer">observable</a>主要用于创建不同响应式行为的 observable 对象，同时可以作为 annotation 给 define 用于标记响应式属性</li><li><a href="https://reactive.formilyjs.org/zh-CN/api/autorun" target="_blank" rel="noopener noreferrer">autorun</a>接收一个 tracker 函数，如果函数内部有消费 observable 数据，数据发生变化时，tracker 函数会重复执行</li><li><a href="https://reactive.formilyjs.org/zh-CN/api/reaction" target="_blank" rel="noopener noreferrer">reaction</a>接收一个 tracker 函数，与 callback 响应函数，如果 tracker 内部有消费 observable 数据，数据发生变化时，tracker 函数会重复执行，但是 callback 执行必须要求 tracker 函数返回值发生变化时才执行</li><li><a href="https://reactive.formilyjs.org/zh-CN/api/define" target="_blank" rel="noopener noreferrer">define</a>手动定义领域模型，可以指定具体属性的响应式行为，也可以指定某个方法为 batch 模式</li><li><a href="https://reactive.formilyjs.org/zh-CN/api/to-js" target="_blank" rel="noopener noreferrer">toJS</a>深度递归将 observable 对象转换成普通 JS 对象</li><li><a href="https://reactive.formilyjs.org/zh-CN/api/tracker" target="_blank" rel="noopener noreferrer">tracker</a>主要用于接入 React/Vue 的手动追踪依赖工具，在依赖发生变化时不会重复执行 tracker 函数，需要用户手动重复执行，只会触发 scheduler</li></ul><h4 id="_2-4-1-src-main-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-1-src-main-jsx"><span>2.4.1 src\\main.jsx</span></a></h4><p>src\\main.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> autorun <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/reactive&#39;</span></span>
<span class="line"><span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;zhufeng&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">home</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;beijing&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> observableValues <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>observableValues<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>observableValues<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>observableValues<span class="token punctuation">.</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>observableValues<span class="token punctuation">.</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">/* autorun(() =&gt; {</span>
<span class="line">  console.log(observableValues.username);</span>
<span class="line">})</span>
<span class="line">observableValues.username = &#39;jiagou&#39;; */</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://static.zhufengpeixun.com/observeral_1659868285710.png" alt=""></p><h4 id="_2-4-2-reactive-index-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-2-reactive-index-jsx"><span>2.4.2 reactive\\index.jsx</span></a></h4><p>src\\@formily\\reactive\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./observable&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./autorun&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-3-observable-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-3-observable-jsx"><span>2.4.3 observable.jsx</span></a></h4><p>src\\@formily\\reactive\\observable.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./internals&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">createObservable</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-4-handlers-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-4-handlers-jsx"><span>2.4.4 handlers.jsx</span></a></h4><p>src\\@formily\\reactive\\handlers.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> isObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./externals&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./internals&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RawProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./environment&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> baseHandlers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> result <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">const</span> observableResult <span class="token operator">=</span> RawProxy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>observableResult<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> observableResult</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObservable</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">createObservable</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> result<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> newValue <span class="token operator">=</span> <span class="token function">createObservable</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span>
<span class="line">        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue</span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-5-environment-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-5-environment-jsx"><span>2.4.5 environment.jsx</span></a></h4><p>src\\@formily\\reactive\\environment.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//RawProxy.set(target, proxy) 普通对象=&gt;代理对象</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> RawProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">//ProxyRaw.set(proxy, target) 代理对象=&gt;原生对象</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> ProxyRaw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-6-checkers-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-6-checkers-jsx"><span>2.4.6 checkers.jsx</span></a></h4><p>src\\@formily\\reactive\\checkers.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> toString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString</span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isPlainObj</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;[object Object]&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isNormalType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">isPlainObj</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-7-internals-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-7-internals-jsx"><span>2.4.7 internals.jsx</span></a></h4><p>src\\@formily\\reactive\\internals.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> baseHandlers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./handlers&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> isNormalType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./checkers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ProxyRaw<span class="token punctuation">,</span> RawProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./environment&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createObservable</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> raw <span class="token operator">=</span> ProxyRaw<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>raw<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> value</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNormalType</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">createNormalProxy</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> value</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">createNormalProxy</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> baseHandlers<span class="token punctuation">)</span></span>
<span class="line">    ProxyRaw<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> target<span class="token punctuation">)</span></span>
<span class="line">    RawProxy<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> proxy</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-8-externals-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-8-externals-jsx"><span>2.4.8 externals.jsx</span></a></h4><p>src\\@formily\\reactive\\externals.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ProxyRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./environment&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isObservable</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> ProxyRaw<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-9-autorun-jsx" tabindex="-1"><a class="header-anchor" href="#_2-4-9-autorun-jsx"><span>2.4.9 autorun.jsx</span></a></h4><p>src\\@formily\\reactive\\autorun.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">autorun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tracker</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-5-实现autorun" tabindex="-1"><a class="header-anchor" href="#_2-5-实现autorun"><span>2.5 实现autorun</span></a></h3><h4 id="_2-5-1-src-main-jsx" tabindex="-1"><a class="header-anchor" href="#_2-5-1-src-main-jsx"><span>2.5.1 src\\main.jsx</span></a></h4><p>src\\main.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { observable, autorun } from &#39;@/@formily/reactive&#39;</span>
<span class="line">const values = { username: &#39;zhufeng&#39;, home: { name: &#39;beijing&#39; } }</span>
<span class="line">const observableValues = observable(values)</span>
<span class="line">+autorun(() =&gt; {</span>
<span class="line">+  console.log(observableValues.username);</span>
<span class="line">+})</span>
<span class="line">+observableValues.username = &#39;jiagou&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-2-autorun-jsx" tabindex="-1"><a class="header-anchor" href="#_2-5-2-autorun-jsx"><span>2.5.2 autorun.jsx</span></a></h4><p>src\\@formily\\reactive\\autorun.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ReactionStack <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./environment&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">autorun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tracker</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">reaction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        ReactionStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>reaction<span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">tracker</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        ReactionStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">reaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-3-environment-jsx" tabindex="-1"><a class="header-anchor" href="#_2-5-3-environment-jsx"><span>2.5.3 environment.jsx</span></a></h4><p>src\\@formily\\reactive\\environment.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//RawProxy.set(target, proxy) 普通对象=&gt;代理对象</span>
<span class="line">export const RawProxy = new WeakMap()</span>
<span class="line">//ProxyRaw.set(proxy, target) 代理对象=&gt;原生对象</span>
<span class="line">export const ProxyRaw = new WeakMap()</span>
<span class="line">+export const RawReactionsMap = new WeakMap()</span>
<span class="line">+export const ReactionStack = []</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-4-handlers-jsx" tabindex="-1"><a class="header-anchor" href="#_2-5-4-handlers-jsx"><span>2.5.4 handlers.jsx</span></a></h4><p>src\\@formily\\reactive\\handlers.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { isObservable } from &#39;./externals&#39;</span>
<span class="line">import { createObservable } from &#39;./internals&#39;</span>
<span class="line">import { RawProxy } from &#39;./environment&#39;</span>
<span class="line">+import { bindTargetKeyWithCurrentReaction, runReactionsFromTargetKey } from &#39;./reaction&#39;</span>
<span class="line">export const baseHandlers = {</span>
<span class="line">    get(target, key) {</span>
<span class="line">        const result = target[key]</span>
<span class="line">+       bindTargetKeyWithCurrentReaction({ target, key })</span>
<span class="line">        const observableResult = RawProxy.get(result)</span>
<span class="line">        if (observableResult) {</span>
<span class="line">            return observableResult</span>
<span class="line">        }</span>
<span class="line">        if (!isObservable(result)) {</span>
<span class="line">            return createObservable(target, key, result)</span>
<span class="line">        }</span>
<span class="line">        return result;</span>
<span class="line">    },</span>
<span class="line">    set(target, key, value) {</span>
<span class="line">        const newValue = createObservable(target, key, value)</span>
<span class="line">        target[key] = newValue</span>
<span class="line">+       runReactionsFromTargetKey({ target, key })</span>
<span class="line">        return true;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-5-reaction-jsx" tabindex="-1"><a class="header-anchor" href="#_2-5-5-reaction-jsx"><span>2.5.5 reaction.jsx</span></a></h4><p>src\\@formily\\reactive\\reaction.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> isFn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./checkers&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ReactionStack<span class="token punctuation">,</span> RawReactionsMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./environment&#39;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">addRawReactionsMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> reaction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> reactionsMap <span class="token operator">=</span> RawReactionsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>reactionsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> reactionSet <span class="token operator">=</span> reactionsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>reactionSet<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            reactionSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>reaction<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> reactionSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            reactionSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>reaction<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            reactionsMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> reactionSet<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> reactionsMap</span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> reactionSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        reactionSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>reaction<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> reactionsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> reactionSet<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        RawReactionsMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> reactionsMap<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> reactionsMap</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">bindTargetKeyWithCurrentReaction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">operation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> key<span class="token punctuation">,</span> target <span class="token punctuation">}</span> <span class="token operator">=</span> operation</span>
<span class="line">    <span class="token keyword">const</span> current <span class="token operator">=</span> ReactionStack<span class="token punctuation">[</span>ReactionStack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">       <span class="token function">addRawReactionsMap</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> current<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">runReactionsFromTargetKey</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">operation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> key<span class="token punctuation">,</span> target <span class="token punctuation">}</span> <span class="token operator">=</span> operation</span>
<span class="line">    <span class="token function">runReactions</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">runReactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> reactions <span class="token operator">=</span> <span class="token function">getReactionsFromTargetKey</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>reactions<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> reaction <span class="token keyword">of</span> reactions<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">reaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">getReactionsFromTargetKey</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> reactionsMap <span class="token operator">=</span> RawReactionsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>reactionsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> reactionsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-6-checkers-jsx" tabindex="-1"><a class="header-anchor" href="#_2-5-6-checkers-jsx"><span>2.5.6 checkers.jsx</span></a></h4><p>src\\@formily\\reactive\\checkers.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> toString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString</span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isPlainObj</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;[object Object]&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isNormalType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">isPlainObj</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-实现define" tabindex="-1"><a class="header-anchor" href="#_2-6-实现define"><span>2.6 实现define</span></a></h3><p><img src="https://static.zhufengpeixun.com/define_1659861859271.png" alt=""></p><h4 id="_2-6-1-src-main-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-1-src-main-jsx"><span>2.6.1 src\\main.jsx</span></a></h4><p>src\\main.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { observable, autorun, define } from &#39;@/@formily/reactive&#39;</span>
<span class="line">+const form = {</span>
<span class="line">+  values: { username: { value: &#39;zhufeng&#39; } },</span>
<span class="line">+  fields: { username: { name: &#39;用户名&#39; } }</span>
<span class="line">+}</span>
<span class="line">+define(form, {</span>
<span class="line">+  values: observable,</span>
<span class="line">+  fields: observable.shallow</span>
<span class="line">+});</span>
<span class="line">autorun(() =&gt; {</span>
<span class="line">+ console.log(form.values, form.values.username, form.values.username.value);</span>
<span class="line">+ console.log(form.fields, form.fields.username, form.fields.username.name);</span>
<span class="line">})</span>
<span class="line">+form.values.username.value = &#39;jiagou&#39;</span>
<span class="line">+form.fields.username.name = &#39;密码&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-2-reactive-index-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-2-reactive-index-jsx"><span>2.6.2 reactive\\index.jsx</span></a></h4><p>src\\@formily\\reactive\\index.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./observable&#39;</span>
<span class="line">export * from &#39;./autorun&#39;</span>
<span class="line">+export * from &#39;./model&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-3-model-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-3-model-jsx"><span>2.6.3 model.jsx</span></a></h4><p>src\\@formily\\reactive\\model.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getObservableMaker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./internals&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> isObservable<span class="token punctuation">,</span> isAnnotation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./externals&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> annotations</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObservable</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> target</span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> annotations<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> annotation <span class="token operator">=</span> annotations<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAnnotation</span><span class="token punctuation">(</span>annotation<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">getObservableMaker</span><span class="token punctuation">(</span>annotation<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> target</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-4-internals-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-4-internals-jsx"><span>2.6.4 internals.jsx</span></a></h4><p>src\\@formily\\reactive\\internals.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { baseHandlers } from &#39;./handlers&#39;</span>
<span class="line">+import { isNormalType, isFn } from &#39;./checkers&#39;;</span>
<span class="line">+import { ProxyRaw, RawProxy, MakeObservableSymbol, RawShallowProxy } from &#39;./environment&#39;;</span>
<span class="line">+export const createObservable = (target, key, value, shallow) =&gt; {</span>
<span class="line">    if (typeof value !== &#39;object&#39;) return value;</span>
<span class="line">    const raw = ProxyRaw.get(value)</span>
<span class="line">    if (raw) {</span>
<span class="line">        return value</span>
<span class="line">    }</span>
<span class="line">+   if (target) {</span>
<span class="line">+       const parentRaw = ProxyRaw.get(target) || target</span>
<span class="line">+       const isShallowParent = RawShallowProxy.get(parentRaw)</span>
<span class="line">+       if (isShallowParent) return value</span>
<span class="line">+   }</span>
<span class="line">+   if (shallow) return createShallowProxy(value)</span>
<span class="line">    if (isNormalType(value)) return createNormalProxy(value)</span>
<span class="line">    return value</span>
<span class="line">}</span>
<span class="line">+const createShallowProxy = (target) =&gt; {</span>
<span class="line">+    if (isNormalType(target)) return createNormalProxy(target, true)</span>
<span class="line">+    return target</span>
<span class="line">+}</span>
<span class="line">+const createNormalProxy = (target, shallow) =&gt; {</span>
<span class="line">    const proxy = new Proxy(target, baseHandlers)</span>
<span class="line">    ProxyRaw.set(proxy, target)</span>
<span class="line">+   if (shallow) {</span>
<span class="line">+       RawShallowProxy.set(target, proxy)</span>
<span class="line">+   } else {</span>
<span class="line">+       RawProxy.set(target, proxy)</span>
<span class="line">+   }</span>
<span class="line">    return proxy</span>
<span class="line">}</span>
<span class="line">+export const createAnnotation = (maker) =&gt; {</span>
<span class="line">+    const annotation = (target) =&gt; {</span>
<span class="line">+        return maker({ value: target })</span>
<span class="line">+    }</span>
<span class="line">+    if (isFn(maker)) {</span>
<span class="line">+        annotation[MakeObservableSymbol] = maker</span>
<span class="line">+    }</span>
<span class="line">+    return annotation</span>
<span class="line">+}</span>
<span class="line">+export const getObservableMaker = (target) =&gt; {</span>
<span class="line">+    if (target[MakeObservableSymbol]) {</span>
<span class="line">+        if (!target[MakeObservableSymbol][MakeObservableSymbol]) {</span>
<span class="line">+            return target[MakeObservableSymbol]</span>
<span class="line">+        }</span>
<span class="line">+        return getObservableMaker(target[MakeObservableSymbol])</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-5-externals-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-5-externals-jsx"><span>2.6.5 externals.jsx</span></a></h4><p>src\\@formily\\reactive\\externals.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { ProxyRaw, MakeObservableSymbol } from &#39;./environment&#39;</span>
<span class="line">export const isObservable = (target) =&gt; {</span>
<span class="line">    return ProxyRaw.has(target)</span>
<span class="line">}</span>
<span class="line">+export const isAnnotation = (target) =&gt; {</span>
<span class="line">+    return target &amp;&amp; target[MakeObservableSymbol]</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-6-environment-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-6-environment-jsx"><span>2.6.6 environment.jsx</span></a></h4><p>src\\@formily\\reactive\\environment.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//RawProxy.set(target, proxy) 普通对象=&gt;代理对象</span>
<span class="line">export const RawProxy = new WeakMap()</span>
<span class="line">//ProxyRaw.set(proxy, target) 代理对象=&gt;原生对象</span>
<span class="line">export const ProxyRaw = new WeakMap()</span>
<span class="line">export const RawReactionsMap = new WeakMap()</span>
<span class="line">+export const ReactionStack = []</span>
<span class="line">+export const MakeObservableSymbol = Symbol(&#39;MakeObservableSymbol&#39;)</span>
<span class="line">+//RawShallowProxy.set(target, proxy) 原生对象=&gt;代理对象</span>
<span class="line">+export const RawShallowProxy = new WeakMap()</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-7-observable-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-7-observable-jsx"><span>2.6.7 observable.jsx</span></a></h4><p>src\\@formily\\reactive\\observable.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createObservable } from &#39;./internals&#39;;</span>
<span class="line">+import * as annotations from &#39;./annotations&#39;</span>
<span class="line">+import { MakeObservableSymbol } from &#39;./environment&#39;;</span>
<span class="line">export function observable(target) {</span>
<span class="line">    return createObservable(null, null, target)</span>
<span class="line">}</span>
<span class="line">+observable.shallow = annotations.shallow</span>
<span class="line">+observable[MakeObservableSymbol] = annotations.observable</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-8-annotations-index-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-8-annotations-index-jsx"><span>2.6.8 annotations\\index.jsx</span></a></h4><p>src\\@formily\\reactive\\annotations\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./observable&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./shallow&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-9-observable-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-9-observable-jsx"><span>2.6.9 observable.jsx</span></a></h4><p>src\\@formily\\reactive\\annotations\\observable.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createAnnotation<span class="token punctuation">,</span> createObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../internals&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> bindTargetKeyWithCurrentReaction<span class="token punctuation">,</span> runReactionsFromTargetKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../reaction&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token function">createAnnotation</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">createObservable</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">bindTargetKeyWithCurrentReaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> store<span class="token punctuation">.</span>value</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            value <span class="token operator">=</span> <span class="token function">createObservable</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span>
<span class="line">            store<span class="token punctuation">.</span>value <span class="token operator">=</span> value</span>
<span class="line">            <span class="token function">runReactionsFromTargetKey</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            set<span class="token punctuation">,</span></span>
<span class="line">            get<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> store<span class="token punctuation">.</span>value</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-10-shallow-jsx" tabindex="-1"><a class="header-anchor" href="#_2-6-10-shallow-jsx"><span>2.6.10 shallow.jsx</span></a></h4><p>src\\@formily\\reactive\\annotations\\shallow.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createAnnotation<span class="token punctuation">,</span> createObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../internals&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> bindTargetKeyWithCurrentReaction<span class="token punctuation">,</span> runReactionsFromTargetKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../reaction&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> shallow <span class="token operator">=</span> <span class="token function">createAnnotation</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">createObservable</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">bindTargetKeyWithCurrentReaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">target</span><span class="token operator">:</span> target<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> key <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> store<span class="token punctuation">.</span>value</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            value <span class="token operator">=</span> <span class="token function">createObservable</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">            store<span class="token punctuation">.</span>value <span class="token operator">=</span> value</span>
<span class="line">            <span class="token function">runReactionsFromTargetKey</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target<span class="token punctuation">,</span> key <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">                set<span class="token punctuation">,</span></span>
<span class="line">                get<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> target</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> store<span class="token punctuation">.</span>value</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-7-实现tracker" tabindex="-1"><a class="header-anchor" href="#_2-7-实现tracker"><span>2.7 实现Tracker</span></a></h3><h4 id="_2-7-1-src-main-jsx" tabindex="-1"><a class="header-anchor" href="#_2-7-1-src-main-jsx"><span>2.7.1 src\\main.jsx</span></a></h4><p>src\\main.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { observable, Tracker } from &#39;@/@formily/reactive&#39;</span>
<span class="line">const values = { username: &#39;zhufeng&#39;, home: { name: &#39;beijing&#39; } }</span>
<span class="line">+const observableValues = observable(values)</span>
<span class="line">+const tracker = new Tracker(() =&gt; {</span>
<span class="line">+    console.log(&#39;forceUpate&#39;);</span>
<span class="line">+})</span>
<span class="line">+tracker.track(() =&gt; {</span>
<span class="line">+    console.log(observableValues.username);</span>
<span class="line">+})</span>
<span class="line">+observableValues.username = &#39;jiagou&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-7-2-tracker-jsx" tabindex="-1"><a class="header-anchor" href="#_2-7-2-tracker-jsx"><span>2.7.2 tracker.jsx</span></a></h4><p>src\\@formily\\reactive\\tracker.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ReactionStack <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./environment&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Tracker</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">scheduler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>track<span class="token punctuation">.</span>scheduler <span class="token operator">=</span> scheduler<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">track</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        ReactionStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>track<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-7-3-reactive-index-jsx" tabindex="-1"><a class="header-anchor" href="#_2-7-3-reactive-index-jsx"><span>2.7.3 reactive\\index.jsx</span></a></h4><p>src\\@formily\\reactive\\index.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./observable&#39;</span>
<span class="line">export * from &#39;./autorun&#39;</span>
<span class="line">export * from &#39;./model&#39;</span>
<span class="line">+export * from &#39;./tracker&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-7-4-reaction-jsx" tabindex="-1"><a class="header-anchor" href="#_2-7-4-reaction-jsx"><span>2.7.4 reaction.jsx</span></a></h4><p>src\\@formily\\reactive\\reaction.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { ReactionStack, RawReactionsMap } from &#39;./environment&#39;;</span>
<span class="line">/**</span>
<span class="line"> * 把某个对象的某个key和当前的reaction进行绑定</span>
<span class="line"> * @param {*} operation {target,key}</span>
<span class="line"> */</span>
<span class="line">export const bindTargetKeyWithCurrentReaction = (operation) =&gt; {</span>
<span class="line">    const { target, key } = operation;</span>
<span class="line">    //最后一个Reaction就是currentReaction</span>
<span class="line">    const currentReaction = ReactionStack[ReactionStack.length - 1];</span>
<span class="line">    if (currentReaction) {</span>
<span class="line">        addRawReactionsMap(target, key, currentReaction)</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">const addRawReactionsMap = (target, key, reaction) =&gt; {</span>
<span class="line">    //判断此target对象在RawReactionsMap里有没有值</span>
<span class="line">    const reactionsMap = RawReactionsMap.get(target);</span>
<span class="line">    if (reactionsMap) {</span>
<span class="line">        const reactionSet = reactionsMap.get(key);</span>
<span class="line">        if (reactionSet) {</span>
<span class="line">            reactionSet.add(reaction);</span>
<span class="line">        } else {</span>
<span class="line">            let reactionSet = new Set();</span>
<span class="line">            reactionSet.add(reaction);</span>
<span class="line">            reactionsMap.set(key, reactionSet);</span>
<span class="line">        }</span>
<span class="line">        return reactionsMap;</span>
<span class="line">    } else {</span>
<span class="line">        //ArraySet 元素唯1的数组</span>
<span class="line">        let reactionSet = new Set();//源码里作者自己封装了一个ArraySet</span>
<span class="line">        reactionSet.add(reaction);</span>
<span class="line">        const reactionsMap = new Map([[key, reactionSet]]);</span>
<span class="line">        RawReactionsMap.set(target, reactionsMap);</span>
<span class="line">        return reactionsMap;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export const runReactionsFromTargetKey = (operation) =&gt; {</span>
<span class="line">    const { target, key } = operation;</span>
<span class="line">    runReactions(target, key);</span>
<span class="line">}</span>
<span class="line">function runReactions(target, key) {</span>
<span class="line">    const reactions = getReactionsFromTargetKey(target, key);</span>
<span class="line">    if(reactions){</span>
<span class="line">      for (let reaction of reactions) {</span>
<span class="line">        if (isFn(reaction.scheduler)) {</span>
<span class="line">           reaction.scheduler(reaction)</span>
<span class="line">        } else {</span>
<span class="line">           reaction()</span>
<span class="line">        }</span>
<span class="line">      }</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">const getReactionsFromTargetKey = (target, key) =&gt; {</span>
<span class="line">    const reactionsMap = RawReactionsMap.get(target);</span>
<span class="line">    if (reactionsMap) {</span>
<span class="line">        return reactionsMap.get(key)</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-formily-reactive-react" tabindex="-1"><a class="header-anchor" href="#_3-formily-reactive-react"><span>3. @formily/reactive-react</span></a></h2><ul><li><a href="https://reactive.formilyjs.org/zh-CN/api/react/observer" target="_blank" rel="noopener noreferrer">observer</a>接收一个 <code>Function RenderProps</code>，只要在 <code>Function</code> 内部消费到的任何响应式数据，都会随数据变化而自动重新渲染，也更容易实现局部精确渲染 -在 React 中， [observer](https://reactive.formilyjs.org/zh-CN/api/react/observer</li></ul><h3 id="_3-1-src-main-tsx" tabindex="-1"><a class="header-anchor" href="#_3-1-src-main-tsx"><span>3.1 src\\main.tsx</span></a></h3><p>src\\main.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-dom/client&#39;</span></span>
<span class="line"><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">&#39;./Counter&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-src-counter-jsx" tabindex="-1"><a class="header-anchor" href="#_3-2-src-counter-jsx"><span>3.2 src\\Counter.jsx</span></a></h3><p>src\\Counter.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@formily/reactive&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@formily/reactive-react&#39;</span></span>
<span class="line"><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> Counter <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>number<span class="token operator">++</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-reactive-react-index-tsx" tabindex="-1"><a class="header-anchor" href="#_3-3-reactive-react-index-tsx"><span>3.3 reactive-react\\index.tsx</span></a></h3><p>src\\@formily\\reactive-react\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./observer&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-4-observer-jsx" tabindex="-1"><a class="header-anchor" href="#_3-4-observer-jsx"><span>3.4 observer.jsx</span></a></h3><p>src\\@formily\\reactive-react\\observer.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useObserver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./hooks/useObserver&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">wrappedComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">useObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">component</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> wrappedComponent<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-useobserver-jsx" tabindex="-1"><a class="header-anchor" href="#_3-5-useobserver-jsx"><span>3.5 useObserver.jsx</span></a></h3><p>src\\@formily\\reactive-react\\hooks\\useObserver.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Tracker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/reactive&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useObserver</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> forceUpdate <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> instRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        instRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tracker</span><span class="token punctuation">(</span>forceUpdate<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> instRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-formily-core" tabindex="-1"><a class="header-anchor" href="#_4-formily-core"><span>4. @formily/core</span></a></h2><ul><li><a href="https://core.formilyjs.org/" target="_blank" rel="noopener noreferrer">@formily/core</a>的核心意义是将领域模型从UI框架中抽离出来</li><li>Formily内核其实是一个 <code>@formily/reactive</code> 领域模型</li><li>实际消费领域模型则主要是依赖<code>@formily/reactive</code>的响应器机制做依赖追踪来消费</li><li>我们可以在响应器<code>Reactions</code>中消费 <code>Form/Field/ArrayField/ObjectField/VoidField</code>模型中的任意属性，依赖的属性发生变化，响应器就会重复执行</li></ul><p><img src="https://static.zhufengpeixun.com/formilycore_1659691651275.svg" alt=""></p><h3 id="_4-1-src-main-jsx" tabindex="-1"><a class="header-anchor" href="#_4-1-src-main-jsx"><span>4.1 src\\main.jsx</span></a></h3><p>src\\main.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createForm } from &#39;@/@formily/core&#39;</span>
<span class="line">const form = createForm({</span>
<span class="line">    values: {</span>
<span class="line">        username: &#39;zhufeng&#39;</span>
<span class="line">    },</span>
<span class="line">})</span>
<span class="line">console.log(form);</span>
<span class="line">const field = form.createField({ name: &#39;username&#39;, title: &#39;用户名&#39;, value: &#39;zhufeng&#39; });</span>
<span class="line">console.log(field);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-core-index-jsx" tabindex="-1"><a class="header-anchor" href="#_4-2-core-index-jsx"><span>4.2 core\\index.jsx</span></a></h3><p>src\\@formily\\core\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./shared/externals&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./models&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-externals-jsx" tabindex="-1"><a class="header-anchor" href="#_4-3-externals-jsx"><span>4.3 externals.jsx</span></a></h3><p>src\\@formily\\core\\shared\\externals.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/shared&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">createForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Form</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span></span>
<span class="line">    FormPath<span class="token punctuation">,</span></span>
<span class="line">    createForm</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-models-index-jsx" tabindex="-1"><a class="header-anchor" href="#_4-4-models-index-jsx"><span>4.4 models\\index.jsx</span></a></h3><p>src\\@formily\\core\\models\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./Form&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./Field&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-form-jsx" tabindex="-1"><a class="header-anchor" href="#_4-5-form-jsx"><span>4.5 Form.jsx</span></a></h3><p>src\\@formily\\core\\models\\Form.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> define<span class="token punctuation">,</span> observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/reactive&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Field <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Field&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/shared&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token punctuation">{</span></span>
<span class="line">    values<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    fields <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">values</span><span class="token operator">:</span> observable<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">fields</span><span class="token operator">:</span> observable<span class="token punctuation">.</span>shallow</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">makeValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>values <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>values</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">createField</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> address <span class="token operator">=</span> FormPath<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">new</span> <span class="token class-name">Field</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">[</span>address<span class="token punctuation">.</span>entire<span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-field-jsx" tabindex="-1"><a class="header-anchor" href="#_4-6-field-jsx"><span>4.6 Field.jsx</span></a></h3><p>src\\@formily\\core\\models\\Field.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> define<span class="token punctuation">,</span> observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/reactive&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Field</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">address<span class="token punctuation">,</span> props<span class="token punctuation">,</span> form</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>form <span class="token operator">=</span> form<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">locate</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">value</span><span class="token operator">:</span> observable</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">locate</span><span class="token punctuation">(</span><span class="token parameter">address</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>fields<span class="token punctuation">[</span>address<span class="token punctuation">.</span>entire<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-path-index-jsx" tabindex="-1"><a class="header-anchor" href="#_4-7-path-index-jsx"><span>4.7 path\\index.jsx</span></a></h3><p>src\\@formily\\path\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">parse</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pattern</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pattern<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">entire</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">segments</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">entire</span><span class="token operator">:</span> pattern<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">segments</span><span class="token operator">:</span> pattern<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Path</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span>input <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token punctuation">{</span> segments<span class="token punctuation">,</span> entire <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>entire <span class="token operator">=</span> entire</span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>segments <span class="token operator">=</span> segments</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function-variable function">concat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        path<span class="token punctuation">.</span>segments <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>segments<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span></span>
<span class="line">        path<span class="token punctuation">.</span>entire <span class="token operator">=</span> path<span class="token punctuation">.</span>segments<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> path</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-8-shared-index-jsx" tabindex="-1"><a class="header-anchor" href="#_4-8-shared-index-jsx"><span>4.8 shared\\index.jsx</span></a></h3><p>src\\@formily\\shared\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./path&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-9-path-jsx" tabindex="-1"><a class="header-anchor" href="#_4-9-path-jsx"><span>4.9 path.jsx</span></a></h3><p>src\\@formily\\shared\\path.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Path <span class="token keyword">as</span> FormPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/path&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> FormPath <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-formily-antd" tabindex="-1"><a class="header-anchor" href="#_5-formily-antd"><span>5.@formily/antd</span></a></h2><h3 id="_5-1-src-main-jsx" tabindex="-1"><a class="header-anchor" href="#_5-1-src-main-jsx"><span>5.1 src\\main.jsx</span></a></h3><p>src\\main.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom/client&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createForm <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/@formily/core&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormProvider<span class="token punctuation">,</span> Field <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/@formily/react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormItem<span class="token punctuation">,</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/@formily/antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">createForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>FormProvider form<span class="token operator">=</span><span class="token punctuation">{</span>form<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Field</span>
<span class="line">                name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span></span>
<span class="line">                title<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line">                value<span class="token operator">=</span><span class="token string">&quot;jiagou&quot;</span></span>
<span class="line">                decorator<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>FormItem<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                component<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>Input<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>FormProvider<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-form-jsx" tabindex="-1"><a class="header-anchor" href="#_5-2-form-jsx"><span>5.2 Form.jsx</span></a></h3><p>src\\@formily\\core\\models\\Form.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { define, observable } from &#39;@/@formily/reactive&#39;</span>
<span class="line">import { Field } from &#39;./Field&#39;</span>
<span class="line">import { FormPath } from &#39;@/@formily/shared&#39;</span>
<span class="line">+import { batchSubmit } from &#39;../shared/internals&#39;</span>
<span class="line">export class Form {</span>
<span class="line">    values = {}</span>
<span class="line">    fields = {}</span>
<span class="line">    constructor(props) {</span>
<span class="line">        this.initialize(props)</span>
<span class="line">        this.makeObservable()</span>
<span class="line">        this.makeValues()</span>
<span class="line">    }</span>
<span class="line">    initialize(props) {</span>
<span class="line">        this.props = { ...props }</span>
<span class="line">    }</span>
<span class="line">    makeObservable() {</span>
<span class="line">        define(this, {</span>
<span class="line">            values: observable,</span>
<span class="line">            fields: observable.shallow</span>
<span class="line">        })</span>
<span class="line">    }</span>
<span class="line">    makeValues() {</span>
<span class="line">+       this.values = Object.assign({}, this.props.values);</span>
<span class="line">    }</span>
<span class="line">    createField(props) {</span>
<span class="line">        const address = FormPath.parse().concat(props.name)</span>
<span class="line">        new Field(address, props, this)</span>
<span class="line">        return this.fields[address.entire]</span>
<span class="line">    }</span>
<span class="line">+   setValuesIn = (pattern, value) =&gt; {</span>
<span class="line">+       this.values[pattern.entire] = value;</span>
<span class="line">+   }</span>
<span class="line">+   getValuesIn = (pattern) =&gt; {</span>
<span class="line">+       return this.values[pattern.entire];</span>
<span class="line">+   }</span>
<span class="line">+   submit = (onSubmit) =&gt; {</span>
<span class="line">+       return batchSubmit(this, onSubmit)</span>
<span class="line">+   }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-field-jsx" tabindex="-1"><a class="header-anchor" href="#_5-3-field-jsx"><span>5.3 Field.jsx</span></a></h3><p>src\\@formily\\core\\models\\Field.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { define, observable } from &#39;@/@formily/reactive&#39;</span>
<span class="line">export class Field {</span>
<span class="line">    constructor(address, props, form) {</span>
<span class="line">        this.props = { ...props };</span>
<span class="line">        this.form = form;</span>
<span class="line">        this.locate(address)</span>
<span class="line">        this.initialize()</span>
<span class="line">        this.makeObservable()</span>
<span class="line">    }</span>
<span class="line">    initialize() {</span>
<span class="line">        this.value = this.props.value;</span>
<span class="line">+       this.decorator = this.props.decorator</span>
<span class="line">+       this.component = this.props.component</span>
<span class="line">    }</span>
<span class="line">    makeObservable() {</span>
<span class="line">        define(this, {</span>
<span class="line">            value: observable</span>
<span class="line">        })</span>
<span class="line">    }</span>
<span class="line">    locate(address) {</span>
<span class="line">        this.form.fields[address.entire] = this</span>
<span class="line">+       this.path = address;</span>
<span class="line">    }</span>
<span class="line">+   get value() {</span>
<span class="line">+       return this.form.getValuesIn(this.path)</span>
<span class="line">+   }</span>
<span class="line">+   set value(value) {</span>
<span class="line">+       this.form.setValuesIn(this.path, value)</span>
<span class="line">+   }</span>
<span class="line">+   get decorator() {</span>
<span class="line">+       return [this.decoratorType]</span>
<span class="line">+   }</span>
<span class="line">+   set decorator(value) {</span>
<span class="line">+       this.decoratorType = value[0]</span>
<span class="line">+   }</span>
<span class="line">+   get component() {</span>
<span class="line">+       return [this.componentType]</span>
<span class="line">+   }</span>
<span class="line">+   set component(value) {</span>
<span class="line">+       this.componentType = value[0]</span>
<span class="line">+   }</span>
<span class="line">+   onInput = (e) =&gt; {</span>
<span class="line">+       const newValue = e.target.value;</span>
<span class="line">+       this.value = newValue;</span>
<span class="line">+       this.form.values[this.props.name] = newValue;</span>
<span class="line">+   };</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-externals-jsx" tabindex="-1"><a class="header-anchor" href="#_5-4-externals-jsx"><span>5.4 externals.jsx</span></a></h3><p>src\\@formily\\reactive\\externals.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { ProxyRaw, MakeObservableSymbol } from &#39;./environment&#39;</span>
<span class="line">+import { isPlainObj } from &#39;./checkers&#39;;</span>
<span class="line">export const isObservable = (target) =&gt; {</span>
<span class="line">    return ProxyRaw.has(target)</span>
<span class="line">}</span>
<span class="line">export const isAnnotation = (target) =&gt; {</span>
<span class="line">    return target &amp;&amp; target[MakeObservableSymbol]</span>
<span class="line">}</span>
<span class="line">+export const toJS = (values) =&gt; {</span>
<span class="line">+    const visited = new Set()</span>
<span class="line">+    const _toJS = (values) =&gt; {</span>
<span class="line">+        if (visited.has(values)) {</span>
<span class="line">+            return values</span>
<span class="line">+        }</span>
<span class="line">+        if (isPlainObj(values)) {</span>
<span class="line">+            visited.add(values)</span>
<span class="line">+            const res = {}</span>
<span class="line">+            for (const key in values) {</span>
<span class="line">+                res[key] = _toJS(values[key])</span>
<span class="line">+            }</span>
<span class="line">+            return res</span>
<span class="line">+        }</span>
<span class="line">+        return values</span>
<span class="line">+    }</span>
<span class="line">+    return _toJS(values)</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-reactive-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-5-reactive-index-jsx"><span>5.5 reactive\\index.jsx</span></a></h3><p>src\\@formily\\reactive\\index.jsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./observable&#39;</span>
<span class="line">export * from &#39;./autorun&#39;</span>
<span class="line">export * from &#39;./model&#39;</span>
<span class="line">export * from &#39;./tracker&#39;</span>
<span class="line">+export * from &#39;./externals&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-internals-jsx" tabindex="-1"><a class="header-anchor" href="#_5-6-internals-jsx"><span>5.6 internals.jsx</span></a></h3><p>src\\@formily\\core\\shared\\internals.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> toJS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/reactive&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">batchSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> onSubmit</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token function">toJS</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-7-antd-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-7-antd-index-jsx"><span>5.7 antd\\index.jsx</span></a></h3><p>src\\@formily\\antd\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./form-item&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./input&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-8-form-item-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-8-form-item-index-jsx"><span>5.8 form-item\\index.jsx</span></a></h3><p>src\\@formily\\antd\\form-item\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect<span class="token punctuation">,</span> mapProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/react&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">BaseItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> label <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>label<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">{</span>children<span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> FormItem <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    BaseItem<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">mapProps</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> field</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> field<span class="token punctuation">.</span>props<span class="token punctuation">.</span>title <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> FormItem</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-9-input-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-9-input-index-jsx"><span>5.9 input\\index.jsx</span></a></h3><p>src\\@formily\\antd\\input\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect<span class="token punctuation">,</span> mapProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Input <span class="token keyword">as</span> AntdInput <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Input <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    AntdInput<span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">mapProps</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> Input</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-10-react-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-10-react-index-jsx"><span>5.10 react\\index.jsx</span></a></h3><p>src\\@formily\\react\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./components&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./hooks&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./shared&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-11-field-jsx" tabindex="-1"><a class="header-anchor" href="#_5-11-field-jsx"><span>5.11 Field.jsx</span></a></h3><p>src\\@formily\\react\\components\\Field.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useForm <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../hooks&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ReactiveField <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./ReactiveField&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FieldContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../shared&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Field</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token function">useForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> field <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">createField</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>FieldContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>field<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>ReactiveField field<span class="token operator">=</span><span class="token punctuation">{</span>field<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ReactiveField<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>FieldContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-12-formprovider-jsx" tabindex="-1"><a class="header-anchor" href="#_5-12-formprovider-jsx"><span>5.12 FormProvider.jsx</span></a></h3><p>src\\@formily\\react\\components\\FormProvider.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../shared&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">FormProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> form <span class="token operator">=</span> props<span class="token punctuation">.</span>form</span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>FormContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>form<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>FormContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-13-components-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-13-components-index-jsx"><span>5.13 components\\index.jsx</span></a></h3><p>src\\@formily\\react\\components\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./FormProvider&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./Field&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-14-reactivefield-jsx" tabindex="-1"><a class="header-anchor" href="#_5-14-reactivefield-jsx"><span>5.14 ReactiveField.jsx</span></a></h3><p>src\\@formily\\react\\components\\ReactiveField.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/reactive-react&#39;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">ReactiveInternal</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> field <span class="token operator">=</span> props<span class="token punctuation">.</span>field</span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">renderDecorator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span></span>
<span class="line">            field<span class="token punctuation">.</span>decoratorType<span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            children</span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">renderComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> value <span class="token operator">=</span> field<span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            field<span class="token punctuation">.</span><span class="token function">onInput</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span></span>
<span class="line">            field<span class="token punctuation">.</span>componentType<span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                value<span class="token punctuation">,</span></span>
<span class="line">                onChange</span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">renderDecorator</span><span class="token punctuation">(</span><span class="token function">renderComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> ReactiveField <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span>ReactiveInternal<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-15-hooks-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-15-hooks-index-jsx"><span>5.15 hooks\\index.jsx</span></a></h3><p>src\\@formily\\react\\hooks\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./useForm&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./useField&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-16-usefield-jsx" tabindex="-1"><a class="header-anchor" href="#_5-16-usefield-jsx"><span>5.16 useField.jsx</span></a></h3><p>src\\@formily\\react\\hooks\\useField.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FieldContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../shared&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useField</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">useContext</span><span class="token punctuation">(</span>FieldContext<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-17-useform-jsx" tabindex="-1"><a class="header-anchor" href="#_5-17-useform-jsx"><span>5.17 useForm.jsx</span></a></h3><p>src\\@formily\\react\\hooks\\useForm.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../shared&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">useContext</span><span class="token punctuation">(</span>FormContext<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-18-connect-jsx" tabindex="-1"><a class="header-anchor" href="#_5-18-connect-jsx"><span>5.18 connect.jsx</span></a></h3><p>src\\@formily\\react\\shared\\connect.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/@formily/reactive-react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useField <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../hooks&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mapProps</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">observer</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> field <span class="token operator">=</span> <span class="token function">useField</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">const</span> results <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> mapper</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token function">mapper</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> results<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> Target <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> mapper</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">mapper</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>Target<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-19-context-jsx" tabindex="-1"><a class="header-anchor" href="#_5-19-context-jsx"><span>5.19 context.jsx</span></a></h3><p>src\\@formily\\react\\shared\\context.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> FormContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> FieldContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-20-shared-index-jsx" tabindex="-1"><a class="header-anchor" href="#_5-20-shared-index-jsx"><span>5.20 shared\\index.jsx</span></a></h3><p>src\\@formily\\react\\shared\\index.jsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./context&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./connect&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-字段验证" tabindex="-1"><a class="header-anchor" href="#_6-字段验证"><span>6.字段验证</span></a></h2>`,221)])])}const o=n(t,[["render",l]]),r=JSON.parse('{"path":"/strong/155.3.formily.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/155.3.formily.md"}');export{o as comp,r as data};
