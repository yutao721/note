import{_ as s,c as a,a as p,o as e}from"./app-CD1YpnS1.js";const t={};function l(o,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="_1-前端项目最佳实践" tabindex="-1"><a class="header-anchor" href="#_1-前端项目最佳实践"><span>1.前端项目最佳实践</span></a></h2><h3 id="_1-1-工具选择" tabindex="-1"><a class="header-anchor" href="#_1-1-工具选择"><span>1.1 工具选择</span></a></h3><table><thead><tr><th style="text-align:left;">类别</th><th style="text-align:left;">选择</th></tr></thead><tbody><tr><td style="text-align:left;">框架</td><td style="text-align:left;"><a href="https://reactjs.org/" target="_blank" rel="noopener noreferrer">react</a></td></tr><tr><td style="text-align:left;">JS 语言</td><td style="text-align:left;"><a href="http://www.typescriptlang.org" target="_blank" rel="noopener noreferrer">TypeScript</a></td></tr><tr><td style="text-align:left;">CSS 语言</td><td style="text-align:left;"><a href="https://github.com/css-modules/css-modules" target="_blank" rel="noopener noreferrer">css-modules</a>+<a href="http://lesscss.org" target="_blank" rel="noopener noreferrer">less</a>+<a href="https://github.com/postcss/postcss" target="_blank" rel="noopener noreferrer">postcss</a></td></tr><tr><td style="text-align:left;">JS 编译</td><td style="text-align:left;"><a href="https://www.babeljs.cn/" target="_blank" rel="noopener noreferrer">babel</a></td></tr><tr><td style="text-align:left;">模块打包</td><td style="text-align:left;"><a href="https://webpack.github.io/" target="_blank" rel="noopener noreferrer">webpack 全家桶</a></td></tr><tr><td style="text-align:left;">单元测试</td><td style="text-align:left;"><a href="https://github.com/facebook/jest" target="_blank" rel="noopener noreferrer">jest</a>+<a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener noreferrer">enzyme</a>+<a href="https://github.com/puppeteer/puppeteer" target="_blank" rel="noopener noreferrer">puppteer</a>+<a href="https://github.com/jsdom/jsdom" target="_blank" rel="noopener noreferrer">jsdom</a></td></tr><tr><td style="text-align:left;">路由</td><td style="text-align:left;"><a href="https://github.com/ReactTraining/react-router" target="_blank" rel="noopener noreferrer">react-router</a></td></tr><tr><td style="text-align:left;">数据流</td><td style="text-align:left;"><a href="https://dvajs.com" target="_blank" rel="noopener noreferrer">dva</a>+<a href="https://www.redux.org.cn/" target="_blank" rel="noopener noreferrer">redux 生态</a></td></tr><tr><td style="text-align:left;">代码风格</td><td style="text-align:left;"><a href="https://eslint.org/" target="_blank" rel="noopener noreferrer">eslint</a>+<a href="https://prettier.io/" target="_blank" rel="noopener noreferrer">prettier</a></td></tr><tr><td style="text-align:left;">JS 压缩</td><td style="text-align:left;"><a href="https://github.com/terser/terser" target="_blank" rel="noopener noreferrer">TerserJS</a></td></tr><tr><td style="text-align:left;">CSS 压缩</td><td style="text-align:left;"><a href="https://github.com/cssnano/cssnano" target="_blank" rel="noopener noreferrer">cssnano</a></td></tr><tr><td style="text-align:left;">请求库</td><td style="text-align:left;">[umi-request](https://github.com/umijs/umi-request</td></tr><tr><td style="text-align:left;">UI</td><td style="text-align:left;"><a href="https://ant.design/docs/react/introduce-cn" target="_blank" rel="noopener noreferrer">AntDesign</a>+<a href="https://pro.ant.design/index-cn" target="_blank" rel="noopener noreferrer">AntDesignPro</a></td></tr><tr><td style="text-align:left;">国际化</td><td style="text-align:left;"><a href="https://github.com/formatjs/react-intl" target="_blank" rel="noopener noreferrer">react-intl</a></td></tr><tr><td style="text-align:left;">hooks 库</td><td style="text-align:left;"><a href="https://hooks.umijs.org/" target="_blank" rel="noopener noreferrer">umi-hooks</a></td></tr><tr><td style="text-align:left;">静态文档</td><td style="text-align:left;"><a href="https://www.docz.site/" target="_blank" rel="noopener noreferrer">docz</a></td></tr><tr><td style="text-align:left;">微前端</td><td style="text-align:left;"><a href="https://github.com/umijs/qiankun" target="_blank" rel="noopener noreferrer">qiankun</a></td></tr><tr><td style="text-align:left;">图表库</td><td style="text-align:left;"><a href="https://antv.vision/" target="_blank" rel="noopener noreferrer">antv</a></td></tr></tbody></table><h3 id="_1-2-技术栈选型" tabindex="-1"><a class="header-anchor" href="#_1-2-技术栈选型"><span>1.2 技术栈选型</span></a></h3><h4 id="_1-2-1-固定化" tabindex="-1"><a class="header-anchor" href="#_1-2-1-固定化"><span>1.2.1 固定化</span></a></h4><ul><li>React 框架</li><li>TypeScript 语言</li><li>Less+CSS Modules</li><li>Eslint+Prettier+固定配置</li><li>固定数据流方案 dva</li><li>固定 babel 插件</li><li>Jest+Enzyme</li><li>框架版本不允许锁定，^前缀必须有</li><li>主要依赖不允许自定义依赖版本</li></ul><h4 id="_1-2-2-配置化" tabindex="-1"><a class="header-anchor" href="#_1-2-2-配置化"><span>1.2.2 配置化</span></a></h4><ul><li>不仅是框架功能，还有 UI 界面</li><li>路由、布局、菜单、导航、面包屑、权限、请求、埋点、错误处理</li><li>只管写 Page 页面就可以了</li></ul><h5 id="_1-2-2-1-编译态配置" tabindex="-1"><a class="header-anchor" href="#_1-2-2-1-编译态配置"><span>1.2.2.1 编译态配置</span></a></h5><ul><li>给 node.js 使用，比如 webpack、babel 相关配置，静态路由配置</li></ul><h5 id="_1-2-2-2-运行态配置" tabindex="-1"><a class="header-anchor" href="#_1-2-2-2-运行态配置"><span>1.2.2.2 运行态配置</span></a></h5><ul><li>给浏览器用、比如渲染逻辑、动态修改路由、获取用户信息</li></ul><h3 id="_1-3-约定化" tabindex="-1"><a class="header-anchor" href="#_1-3-约定化"><span>1.3 约定化</span></a></h3><ul><li>国际化</li><li>数据流</li><li>MOCK</li><li>目录结构</li><li>404</li><li>权限策略</li><li>Service</li><li>配置文件</li></ul><h3 id="_1-4-理念" tabindex="-1"><a class="header-anchor" href="#_1-4-理念"><span>1.4 理念</span></a></h3><ul><li>通过最佳实践减少不必要的选择的差异</li><li>通过插件和插件集的架构方式，满足不同场景的业务</li><li>通过资产市场和场景市场着力解决 70%的开发者问题</li><li>通过对垂直场景采取强约束的方式，进一步提升研发效率</li><li>不给选择、配置化、约定化</li></ul><h2 id="_2-ant-design-pro" tabindex="-1"><a class="header-anchor" href="#_2-ant-design-pro"><span>2.Ant Design Pro</span></a></h2><ul><li><code>Ant Design Pro</code> 是一个企业级中后台前端/设计解决方案，我们秉承 Ant Design 的设计价值观，致力于在设计规范和基础组件的基础上，继续向上构建，提炼出典型模板/业务组件/配套设计资源，进一步提升企业级中后台产品设计研发过程中的『用户』和『设计者』的体验。</li><li><a href="https://pro.ant.design" target="_blank" rel="noopener noreferrer">pro.ant.design</a></li><li><a href="https://beta-pro.ant.design/index-cn/" target="_blank" rel="noopener noreferrer">beta-pro.ant.design</a></li><li><a href="https://procomponents.ant.design/components/table/" target="_blank" rel="noopener noreferrer">procomponents.ant.design</a></li><li><a href="https://beta-pro.ant.design/docs/getting-started-cn" target="_blank" rel="noopener noreferrer">getting-started-cn</a></li></ul><h3 id="_2-1-启动项目" tabindex="-1"><a class="header-anchor" href="#_2-1-启动项目"><span>2.1 启动项目</span></a></h3><h4 id="_2-1-1-安装" tabindex="-1"><a class="header-anchor" href="#_2-1-1-安装"><span>2.1.1 安装</span></a></h4><ul><li>新建一个空的文件夹作为项目目录，并在目录下执行</li><li><a href="https://www.python.org/downloads/release/python-380/" target="_blank" rel="noopener noreferrer">python-380</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//npm config set python &quot;C:/Python38/python.exe&quot;</span></span>
<span class="line">yarn create umi</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1-2-目录结构" tabindex="-1"><a class="header-anchor" href="#_2-1-2-目录结构"><span>2.1.2 目录结构</span></a></h4><ul><li>我们已经为你生成了一个完整的开发框架，提供了涵盖中后台开发的各类功能和坑位，下面是整个项目的目录结构。</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> ├─config </span>
<span class="line"> ├─mock   </span>
<span class="line">├─public</span>
<span class="line">│  └─icons</span>
<span class="line">├─src</span>
<span class="line"> │  ├─components </span>
<span class="line">│  │  ├─Footer</span>
<span class="line">│  │  ├─HeaderDropdown</span>
<span class="line">│  │  ├─HeaderSearch</span>
<span class="line">│  │  ├─NoticeIcon</span>
<span class="line">│  │  └─RightContent</span>
<span class="line"> │  ├─e2e       </span>
<span class="line"> │  ├─locales   </span>
<span class="line">│  │  ├─en-US</span>
<span class="line">│  │  ├─id-ID</span>
<span class="line">│  │  ├─pt-BR</span>
<span class="line">│  │  ├─zh-CN</span>
<span class="line">│  │  └─zh-TW</span>
<span class="line"> │  ├─pages    </span>
<span class="line">│  │  ├─ListTableList</span>
<span class="line">│  │  │  └─components</span>
<span class="line">│  │  └─user</span>
<span class="line">│  │      └─login</span>
<span class="line"> │  ├─services </span>
<span class="line"> │  └─utils    </span>
<span class="line"> └─tests       </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1-3-本地开发" tabindex="-1"><a class="header-anchor" href="#_2-1-3-本地开发"><span>2.1.3 本地开发</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install</span>
<span class="line">npm start:dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">git init</span>
<span class="line">git add <span class="token operator">-</span><span class="token constant">A</span></span>
<span class="line">git commit <span class="token operator">-</span>m<span class="token string">&quot;1.init&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-用户登录" tabindex="-1"><a class="header-anchor" href="#_2-2-用户登录"><span>2.2 用户登录</span></a></h3><h4 id="_2-2-1-config-proxy-ts" tabindex="-1"><a class="header-anchor" href="#_2-2-1-config-proxy-ts"><span>2.2.1 config\\proxy.ts</span></a></h4><p>config\\proxy.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export default {</span>
<span class="line">  dev: {</span>
<span class="line">    &#39;/api/&#39;: {</span>
<span class="line">+     target: &#39;http://localhost:4000/&#39;,</span>
<span class="line">      changeOrigin: true,</span>
<span class="line">      pathRewrite: { &#39;^&#39;: &#39;&#39; }</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-src-app-tsx" tabindex="-1"><a class="header-anchor" href="#_2-2-2-src-app-tsx"><span>2.2.2 src\\app.tsx</span></a></h4><p>src\\app.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React from &#39;react&#39;;</span>
<span class="line">import { BasicLayoutProps, Settings as LayoutSettings, PageLoading } from &#39;@ant-design/pro-layout&#39;;</span>
<span class="line">import { notification } from &#39;antd&#39;;</span>
<span class="line">import { history, RequestConfig } from &#39;umi&#39;;</span>
<span class="line">import RightContent from &#39;@/components/RightContent&#39;;</span>
<span class="line">import Footer from &#39;@/components/Footer&#39;;</span>
<span class="line">import { ResponseError } from &#39;umi-request&#39;;</span>
<span class="line">import { queryCurrent } from &#39;./services/user&#39;;</span>
<span class="line">import defaultSettings from &#39;../config/defaultSettings&#39;;</span>
<span class="line"></span>
<span class="line">export const initialStateConfig = {</span>
<span class="line">  loading: &lt;PageLoading /&gt;,</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">export async function getInitialState(): Promise&lt;{</span>
<span class="line">  settings?: LayoutSettings;</span>
<span class="line">  currentUser?: API.CurrentUser;</span>
<span class="line">  fetchUserInfo?: () =&gt; Promise&lt;API.CurrentUser | undefined&gt;;</span>
<span class="line">}&gt; {</span>
<span class="line">  const fetchUserInfo = async () =&gt; {</span>
<span class="line">    try {</span>
<span class="line">      const currentUser = await queryCurrent();</span>
<span class="line">      return currentUser;</span>
<span class="line">    } catch (error) {</span>
<span class="line">      history.push(&#39;/user/login&#39;);</span>
<span class="line">    }</span>
<span class="line">    return undefined;</span>
<span class="line">  };</span>
<span class="line">  // 如果是登录页面，不执行</span>
<span class="line">  if (history.location.pathname !== &#39;/user/login&#39;) {</span>
<span class="line">    const currentUser = await fetchUserInfo();</span>
<span class="line">    return {</span>
<span class="line">      fetchUserInfo,</span>
<span class="line">      currentUser,</span>
<span class="line">      settings: defaultSettings,</span>
<span class="line">    };</span>
<span class="line">  }</span>
<span class="line">  return {</span>
<span class="line">    fetchUserInfo,</span>
<span class="line">    settings: defaultSettings,</span>
<span class="line">  };</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export const layout = ({</span>
<span class="line">  initialState,</span>
<span class="line">}: {</span>
<span class="line">  initialState: { settings?: LayoutSettings; currentUser?: API.CurrentUser };</span>
<span class="line">}): BasicLayoutProps =&gt; {</span>
<span class="line">  return {</span>
<span class="line">    rightContentRender: () =&gt; &lt;RightContent /&gt;,</span>
<span class="line">    disableContentMargin: false,</span>
<span class="line">    footerRender: () =&gt; &lt;Footer /&gt;,</span>
<span class="line">    onPageChange: () =&gt; {</span>
<span class="line">      const { currentUser } = initialState;</span>
<span class="line">      const { location } = history;</span>
<span class="line">      // 如果没有登录，重定向到 login</span>
<span class="line">      if (!currentUser &amp;&amp; location.pathname !== &#39;/user/login&#39;) {</span>
<span class="line">        history.push(&#39;/user/login&#39;);</span>
<span class="line">      }</span>
<span class="line">    },</span>
<span class="line">    menuHeaderRender: undefined,</span>
<span class="line">    ...initialState?.settings,</span>
<span class="line">  };</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">const codeMessage = {</span>
<span class="line">  200: &#39;服务器成功返回请求的数据。&#39;,</span>
<span class="line">  201: &#39;新建或修改数据成功。&#39;,</span>
<span class="line">  202: &#39;一个请求已经进入后台排队（异步任务）。&#39;,</span>
<span class="line">  204: &#39;删除数据成功。&#39;,</span>
<span class="line">  400: &#39;发出的请求有错误，服务器没有进行新建或修改数据的操作。&#39;,</span>
<span class="line">  401: &#39;用户没有权限（令牌、用户名、密码错误）。&#39;,</span>
<span class="line">  403: &#39;用户得到授权，但是访问是被禁止的。&#39;,</span>
<span class="line">  404: &#39;发出的请求针对的是不存在的记录，服务器没有进行操作。&#39;,</span>
<span class="line">  405: &#39;请求方法不被允许。&#39;,</span>
<span class="line">  406: &#39;请求的格式不可得。&#39;,</span>
<span class="line">  410: &#39;请求的资源被永久删除，且不会再得到的。&#39;,</span>
<span class="line">  422: &#39;当创建一个对象时，发生一个验证错误。&#39;,</span>
<span class="line">  500: &#39;服务器发生错误，请检查服务器。&#39;,</span>
<span class="line">  502: &#39;网关错误。&#39;,</span>
<span class="line">  503: &#39;服务不可用，服务器暂时过载或维护。&#39;,</span>
<span class="line">  504: &#39;网关超时。&#39;,</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">/**</span>
<span class="line"> * 异常处理程序</span>
<span class="line"> */</span>
<span class="line">const errorHandler = (error: ResponseError) =&gt; {</span>
<span class="line">  const { response } = error;</span>
<span class="line">  if (response &amp;&amp; response.status) {</span>
<span class="line">    const errorText = codeMessage[response.status] || response.statusText;</span>
<span class="line">    const { status, url } = response;</span>
<span class="line"></span>
<span class="line">    notification.error({</span>
<span class="line">      message: \`请求错误 \${status}: \${url}\`,</span>
<span class="line">      description: errorText,</span>
<span class="line">    });</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  if (!response) {</span>
<span class="line">    notification.error({</span>
<span class="line">      description: &#39;您的网络发生异常，无法连接服务器&#39;,</span>
<span class="line">      message: &#39;网络异常&#39;,</span>
<span class="line">    });</span>
<span class="line">  }</span>
<span class="line">  throw error;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line">export const request: RequestConfig = {</span>
<span class="line">   errorHandler,</span>
<span class="line">+  headers:{</span>
<span class="line">+    Authorization:\`Bearer \${localStorage.getItem(&#39;token&#39;)}\`</span>
<span class="line">+  }</span>
<span class="line">};</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-3-src-services-api-d-ts" tabindex="-1"><a class="header-anchor" href="#_2-2-3-src-services-api-d-ts"><span>2.2.3 src\\services\\API.d.ts</span></a></h4><p>src\\services\\API.d.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">declare namespace API {</span>
<span class="line">  export interface CurrentUser {</span>
<span class="line">    avatar?: string;</span>
<span class="line">   username?: string;</span>
<span class="line">    title?: string;</span>
<span class="line">    group?: string;</span>
<span class="line">    signature?: string;</span>
<span class="line">    tags?: {</span>
<span class="line">      key: string;</span>
<span class="line">      label: string;</span>
<span class="line">    }[];</span>
<span class="line">    userid?: string;</span>
<span class="line">    access?: &#39;user&#39; | &#39;guest&#39; | &#39;admin&#39;;</span>
<span class="line">    unreadCount?: number;</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  export interface LoginStateType {</span>
<span class="line">    status?: &#39;ok&#39; | &#39;error&#39;;</span>
<span class="line">    type?: string;</span>
<span class="line">+   token?:string;</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  export interface NoticeIconData {</span>
<span class="line">    id: string;</span>
<span class="line">    key: string;</span>
<span class="line">    avatar: string;</span>
<span class="line">    title: string;</span>
<span class="line">    datetime: string;</span>
<span class="line">    type: string;</span>
<span class="line">    read?: boolean;</span>
<span class="line">    description: string;</span>
<span class="line">    clickClose?: boolean;</span>
<span class="line">    extra: any;</span>
<span class="line">    status: string;</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-4-login-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-2-4-login-index-tsx"><span>2.2.4 login\\index.tsx</span></a></h4><p>src\\pages\\user\\login\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span></span>
<span class="line">  AlipayCircleOutlined<span class="token punctuation">,</span></span>
<span class="line">  LockTwoTone<span class="token punctuation">,</span></span>
<span class="line">  MailTwoTone<span class="token punctuation">,</span></span>
<span class="line">  MobileTwoTone<span class="token punctuation">,</span></span>
<span class="line">  TaobaoCircleOutlined<span class="token punctuation">,</span></span>
<span class="line">  UserOutlined<span class="token punctuation">,</span></span>
<span class="line">  WeiboCircleOutlined<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@ant-design/icons&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Alert<span class="token punctuation">,</span> Space<span class="token punctuation">,</span> message<span class="token punctuation">,</span> Tabs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> ProForm<span class="token punctuation">,</span> <span class="token punctuation">{</span> ProFormCaptcha<span class="token punctuation">,</span> ProFormCheckbox<span class="token punctuation">,</span> ProFormText <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@ant-design/pro-form&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useIntl<span class="token punctuation">,</span> Link<span class="token punctuation">,</span> history<span class="token punctuation">,</span> FormattedMessage<span class="token punctuation">,</span> SelectLang <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;umi&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Footer <span class="token keyword">from</span> <span class="token string">&#39;@/components/Footer&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> fakeAccountLogin<span class="token punctuation">,</span> getFakeCaptcha<span class="token punctuation">,</span> LoginParamsType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/services/login&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&#39;./index.less&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">LoginMessage</span><span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">content</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> content <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token operator">&lt;</span>Alert</span>
<span class="line">    style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">marginBottom</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">    message<span class="token operator">=</span><span class="token punctuation">{</span>content<span class="token punctuation">}</span></span>
<span class="line">    type<span class="token operator">=</span><span class="token string">&quot;error&quot;</span></span>
<span class="line">    showIcon</span>
<span class="line">  <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 此方法会跳转到 redirect 参数所在的位置</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">goto</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> query <span class="token punctuation">}</span> <span class="token operator">=</span> history<span class="token punctuation">.</span>location<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> redirect <span class="token punctuation">}</span> <span class="token operator">=</span> query <span class="token keyword">as</span> <span class="token punctuation">{</span> <span class="token literal-property property">redirect</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> redirect <span class="token operator">||</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">Login</span><span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>submitting<span class="token punctuation">,</span> setSubmitting<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>userLoginState<span class="token punctuation">,</span> setUserLoginState<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span><span class="token constant">API</span><span class="token punctuation">.</span>LoginStateType<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>type<span class="token punctuation">,</span> setType<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;account&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> intl <span class="token operator">=</span> <span class="token function">useIntl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">values</span><span class="token operator">:</span> LoginParamsType</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setSubmitting</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 登录</span></span>
<span class="line">      <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fakeAccountLogin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>values<span class="token punctuation">,</span> type <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&#39;ok&#39;</span> <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span>msg<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&#39;登录成功！&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">goto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token comment">// 如果失败去设置用户错误信息</span></span>
<span class="line">      <span class="token function">setUserLoginState</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;登录失败，请重试！&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">setSubmitting</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> status<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> loginType <span class="token punctuation">}</span> <span class="token operator">=</span> userLoginState<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>lang<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>SelectLang <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>SelectLang <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>content<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>top<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>header<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span>img alt<span class="token operator">=</span><span class="token string">&quot;logo&quot;</span> className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>logo<span class="token punctuation">}</span> src<span class="token operator">=</span><span class="token string">&quot;/logo.svg&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&gt;</span>Ant Design<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>desc<span class="token punctuation">}</span><span class="token operator">&gt;</span>Ant Design 是西湖区最具影响力的 Web 设计规范<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line">        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>main<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>ProForm</span>
<span class="line">            initialValues<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">autoLogin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">            submitter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">searchConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">submitText</span><span class="token operator">:</span> intl<span class="token punctuation">.</span><span class="token function">formatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;pages.login.submit&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">defaultMessage</span><span class="token operator">:</span> <span class="token string">&#39;登录&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dom<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">submitButtonProps</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">loading</span><span class="token operator">:</span> submitting<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">&#39;large&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&#39;100%&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">            onFinish<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token function">handleSubmit</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Tabs activeKey<span class="token operator">=</span><span class="token punctuation">{</span>type<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>setType<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span>Tabs<span class="token punctuation">.</span>TabPane</span>
<span class="line">                key<span class="token operator">=</span><span class="token string">&quot;account&quot;</span></span>
<span class="line">                tab<span class="token operator">=</span><span class="token punctuation">{</span>intl<span class="token punctuation">.</span><span class="token function">formatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;pages.login.accountLogin.tab&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">defaultMessage</span><span class="token operator">:</span> <span class="token string">&#39;账户密码登录&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">              <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Tabs<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line">            <span class="token punctuation">{</span>status <span class="token operator">===</span> <span class="token string">&#39;error&#39;</span> <span class="token operator">&amp;&amp;</span> loginType <span class="token operator">===</span> <span class="token string">&#39;account&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span></span>
<span class="line">              <span class="token operator">&lt;</span>LoginMessage</span>
<span class="line">                content<span class="token operator">=</span><span class="token punctuation">{</span>intl<span class="token punctuation">.</span><span class="token function">formatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;pages.login.accountLogin.errorMessage&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token literal-property property">defaultMessage</span><span class="token operator">:</span> <span class="token string">&#39;账户或密码错误（admin/ant.design)&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">              <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">{</span>type <span class="token operator">===</span> <span class="token string">&#39;account&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span></span>
<span class="line">              <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>ProFormText</span>
<span class="line">                  name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span></span>
<span class="line">                  fieldProps<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">&#39;large&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token operator">&lt;</span>UserOutlined className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>prefixIcon<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                  placeholder<span class="token operator">=</span><span class="token punctuation">{</span>intl<span class="token punctuation">.</span><span class="token function">formatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;pages.login.username.placeholder&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">defaultMessage</span><span class="token operator">:</span> <span class="token string">&#39;用户名: admin or user&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                  rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span></span>
<span class="line">                    <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">(</span></span>
<span class="line">                        <span class="token operator">&lt;</span>FormattedMessage</span>
<span class="line">                          id<span class="token operator">=</span><span class="token string">&quot;pages.login.username.required&quot;</span></span>
<span class="line">                          defaultMessage<span class="token operator">=</span><span class="token string">&quot;请输入用户名!&quot;</span></span>
<span class="line">                        <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>ProFormText<span class="token punctuation">.</span>Password</span>
<span class="line">                  name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">                  fieldProps<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">&#39;large&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token operator">&lt;</span>LockTwoTone className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>prefixIcon<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                  placeholder<span class="token operator">=</span><span class="token punctuation">{</span>intl<span class="token punctuation">.</span><span class="token function">formatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;pages.login.password.placeholder&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">defaultMessage</span><span class="token operator">:</span> <span class="token string">&#39;密码: ant.design&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                  rules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span></span>
<span class="line">                    <span class="token punctuation">{</span></span>
<span class="line">                      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">(</span></span>
<span class="line">                        <span class="token operator">&lt;</span>FormattedMessage</span>
<span class="line">                          id<span class="token operator">=</span><span class="token string">&quot;pages.login.password.required&quot;</span></span>
<span class="line">                          defaultMessage<span class="token operator">=</span><span class="token string">&quot;请输入密码！&quot;</span></span>
<span class="line">                        <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginBottom</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>ProForm<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Footer <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> Login<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-后端" tabindex="-1"><a class="header-anchor" href="#_3-后端"><span>3.后端</span></a></h2><h3 id="_3-1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_3-1-安装依赖"><span>3.1 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i express body-parser  jwt-simple cors express-session connect-mongo mongoose axios -S</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">/</span>api<span class="token operator">/</span>register</span>
<span class="line"><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;password&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;autoLogin&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;account&quot;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">/</span>api<span class="token operator">/</span>login<span class="token operator">/</span>account</span>
<span class="line"><span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;password&quot;</span><span class="token operator">:</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-app-js" tabindex="-1"><a class="header-anchor" href="#_3-2-app-js"><span>3.2 app.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;body-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;jwt-simple&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> Models <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./model&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express-session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> MongoStore <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;connect-mongo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">origin</span><span class="token operator">:</span> config<span class="token punctuation">.</span>origin<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">allowedHeaders</span><span class="token operator">:</span> <span class="token string">&quot;Content-Type,Authorization&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token string">&quot;GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">secret</span><span class="token operator">:</span> config<span class="token punctuation">.</span>secret<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">store</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">MongoStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">url</span><span class="token operator">:</span> config<span class="token punctuation">.</span>dbUrl<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">mongoOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">hello</span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/register&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> hash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;crypto&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">&#39;md5&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&#39;hex&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    user<span class="token punctuation">.</span>avatar <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">https://secure.gravatar.com/avatar/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?s=48</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    user <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/login/account&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&#39;account&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        query<span class="token punctuation">.</span>name <span class="token operator">=</span> user<span class="token punctuation">.</span>username<span class="token punctuation">;</span></span>
<span class="line">        query<span class="token punctuation">.</span>password <span class="token operator">=</span> user<span class="token punctuation">.</span>password<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">let</span> dbUser <span class="token operator">=</span> <span class="token keyword">await</span> Models<span class="token punctuation">.</span>UserModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>dbUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        dbUser<span class="token punctuation">.</span>userid <span class="token operator">=</span> dbUser<span class="token punctuation">.</span>_id<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>dbUser<span class="token punctuation">,</span> config<span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> user<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> dbUser<span class="token punctuation">.</span>currentAuthority <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> user<span class="token punctuation">.</span>type<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token string">&#39;guest&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/currentUser&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> authorization <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;authorization&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>authorization<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> user <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>authorization<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/login/outLogin&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;服务器在4000端口启动!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-model-js" tabindex="-1"><a class="header-anchor" href="#_3-3-model-js"><span>3.3 model.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> conn <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dbUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> UserModel <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//邮箱</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//用户名</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//密码</span></span>
<span class="line">    <span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//头像</span></span>
<span class="line">    <span class="token literal-property property">currentAuthority</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">default</span><span class="token operator">:</span><span class="token string">&#39;user&#39;</span> <span class="token punctuation">}</span><span class="token comment">//当前用户的权限</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    UserModel</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-config-js" tabindex="-1"><a class="header-anchor" href="#_3-4-config-js"><span>3.4 config.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">&#39;pro&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">dbUrl</span><span class="token operator">:</span> <span class="token string">&quot;mongodb://localhost:27017/pro&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://localhost:8000&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-package-json" tabindex="-1"><a class="header-anchor" href="#_3-5-package-json"><span>3.5 package.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">  &quot;scripts&quot;: {</span>
<span class="line">    &quot;start&quot;: &quot;nodemon app.js&quot;</span>
<span class="line">  }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,53)])])}const c=s(t,[["render",l]]),r=JSON.parse('{"path":"/strong/106.12.antpro.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/106.12.antpro.md"}');export{c as comp,r as data};
