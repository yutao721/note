import{_ as s,c as a,a as p,o as t}from"./app-CD1YpnS1.js";const e={};function l(o,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="_1-初始化项目" tabindex="-1"><a class="header-anchor" href="#_1-初始化项目"><span>1.初始化项目</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir zhufeng-jsx-transformer</span>
<span class="line">cd zhufeng-jsx-transformer</span>
<span class="line">yarn add @babel/core @babel/plugin-syntax-jsx @babel/plugin-transform-react-jsx @babel/types  --dev</span>
<span class="line">yarn add react</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-jsx" tabindex="-1"><a class="header-anchor" href="#_2-jsx"><span>2.JSX</span></a></h2><ul><li>React使用JSX来描述用户界面</li><li>JSX是一种JavaScript的语法扩展</li><li><a href="https://babeljs.io/repl" target="_blank" rel="noopener noreferrer">repl</a>可以在线转换代码</li><li><a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">astexplorer</a>可以把代码转换成AST树</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">&lt;h1 id=&quot;title&quot; key=&quot;title&quot; ref=&quot;title&quot;&gt;hello&lt;/h1&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-ast抽象语法树" tabindex="-1"><a class="header-anchor" href="#_3-ast抽象语法树"><span>3. AST抽象语法树</span></a></h2><ul><li>抽象语法树（Abstract Syntax Tree，AST）是源代码语法结构的一种抽象表示。它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构</li></ul><p><img src="http://img.zhufengpeixun.cn/ast.jpg" alt="ast.jpg"></p><h3 id="_3-1-babel工作流" tabindex="-1"><a class="header-anchor" href="#_3-1-babel工作流"><span>3.1 babel工作流</span></a></h3><ul><li>Parse(解析) 将源代码转换成抽象语法树，树上有很多的节点</li><li>Transform(转换) 对抽象语法树进行转换</li><li>Generate(代码生成) 将上一步经过转换过的抽象语法树生成新的代码</li></ul><p><img src="https://img.zhufengpeixun.com/ast-compiler-flow.jpg" alt="ast-compiler-flow.jpg"></p><h3 id="_3-2-babel处理语法树" tabindex="-1"><a class="header-anchor" href="#_3-2-babel处理语法树"><span>3.2 babel处理语法树</span></a></h3><ul><li><a href="https://babeljs.io" target="_blank" rel="noopener noreferrer">babeljs</a>是一个JavaScript编译器</li><li><a href="https://babeljs.io/docs/en/babel-core" target="_blank" rel="noopener noreferrer">@babel/core</a>是Babel编译器的核心</li><li><a href="https://www.npmjs.com/package/babylon" target="_blank" rel="noopener noreferrer">babylon</a>是<a href="https://github.com/babel/babel" target="_blank" rel="noopener noreferrer">Babel</a>使用的JavaScript解析器</li><li><a href="https://babeljs.io/docs/en/babel-types" target="_blank" rel="noopener noreferrer">@babel/types</a> 用于 AST 节点的 Lodash 式工具库</li><li><a href="https://babeljs.io/docs/en/babel-traverse" target="_blank" rel="noopener noreferrer">@babel/traverse</a>用于对 AST 的遍历，维护了整棵树的状态，并且负责替换、移除和添加节点</li><li><a href="https://babeljs.io/docs/en/babel-generator" target="_blank" rel="noopener noreferrer">@babel/generator</a>把AST转成代码</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/core&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/types&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> generate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">function ast() {}</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> ast <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> indent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">padding</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token string">&quot; &quot;</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>indent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>type<span class="token operator">+</span><span class="token string">&#39;进入&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        indent<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">isFunctionDeclaration</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;newAst&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        indent<span class="token operator">-=</span><span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>type<span class="token operator">+</span><span class="token string">&#39;离开&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-旧转换" tabindex="-1"><a class="header-anchor" href="#_3-2-旧转换"><span>3.2 旧转换</span></a></h3><h4 id="_3-2-1-jsx-js" tabindex="-1"><a class="header-anchor" href="#_3-2-1-jsx-js"><span>3.2.1 jsx.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> sourceCode <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;h1 id=&quot;title&quot; key=&quot;title&quot; ref=&quot;title&quot;&gt;hello&lt;/h1&gt;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&#39;@babel/plugin-transform-react-jsx&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">runtime</span><span class="token operator">:</span><span class="token string">&#39;classic&#39;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-转译结果" tabindex="-1"><a class="header-anchor" href="#_3-2-2-转译结果"><span>3.2.2 转译结果</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> React <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span>replacer<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">replacer</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">&#39;_owner&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;_store&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;props&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-新转换" tabindex="-1"><a class="header-anchor" href="#_3-3-新转换"><span>3.3 新转换</span></a></h3><h4 id="_3-3-1-jsx-js" tabindex="-1"><a class="header-anchor" href="#_3-3-1-jsx-js"><span>3.3.1 jsx.js</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const babel = require(&quot;@babel/core&quot;);</span>
<span class="line">const sourceCode = \`&lt;h1 id=&quot;title&quot; key=&quot;title&quot; ref=&quot;title&quot;&gt;hello&lt;/h1&gt;\`;</span>
<span class="line">const result = babel.transform(sourceCode, {</span>
<span class="line">+   plugins: [[&#39;@babel/plugin-transform-react-jsx&#39;,{runtime:&#39;automatic&#39;}]]</span>
<span class="line">});</span>
<span class="line">console.log(result.code);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-2-转译结果" tabindex="-1"><a class="header-anchor" href="#_3-3-2-转译结果"><span>3.3.2 转译结果</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token literal-property property">jsx</span><span class="token operator">:</span>_jsx<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react/jsx-runtime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//import { jsx as _jsx } from &quot;react/jsx-runtime&quot;;</span></span>
<span class="line"><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">key</span><span class="token operator">:</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">ref</span><span class="token operator">:</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span>replacer<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">replacer</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">&#39;_owner&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;_store&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;props&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-实现插件" tabindex="-1"><a class="header-anchor" href="#_4-实现插件"><span>4.实现插件</span></a></h2><ul><li><a href="https://babeljs.io/docs/en/babel-types.html" target="_blank" rel="noopener noreferrer">babel-types文档</a></li><li><a href="https://github.com/brigand/babel-plugin-handbook/blob/master/translations/zh-Hans/README.md" target="_blank" rel="noopener noreferrer">babel插件开发指南</a></li><li><a href="https://babeljs.io/docs/en/babel-plugin-syntax-jsx/" target="_blank" rel="noopener noreferrer">@babel/plugin-syntax-jsx</a>允许解析JSX</li><li>[babel-traverse](https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md</li><li>Visitors(访问者)是一个用于 AST 遍历的模式,用于定义某个节点的操作方法</li><li>Paths(路径) 是一个对象，它表示两个节点之间的连接 <ul><li><code>replaceWith</code>可以用于替换节点</li><li><code>get</code>用于查找特定类型的子路径</li><li><code>find</code> 用于向上查找一个指定条件的路径</li><li><code>unshiftContainer</code>用于把AST节点插入到类似于body这样的数组中</li></ul></li><li>Scope(作用域) <ul><li><code>generateUidIdentifier</code>会生成一个不会和任何本地定义的变量冲突的标识符</li></ul></li></ul><h3 id="_4-1-jsx-js" tabindex="-1"><a class="header-anchor" href="#_4-1-jsx-js"><span>4.1 jsx.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> pluginTransformReactJsx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./plugin-transform-react-jsx&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> sourceCode <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;h1 id=&quot;title&quot; key=&quot;title&quot; ref=&quot;title&quot;&gt;hello&lt;/h1&gt;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>pluginTransformReactJsx<span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-plugin-transform-react-jsx-js" tabindex="-1"><a class="header-anchor" href="#_4-2-plugin-transform-react-jsx-js"><span>4.2 plugin-transform-react-jsx.js</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/types&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> pluginSyntaxJsx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/plugin-syntax-jsx&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> pluginTransformReactJsx <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">inherits</span><span class="token operator">:</span>pluginSyntaxJsx<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">JSXElement</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> callExpression <span class="token operator">=</span> <span class="token function">buildJSXElementCall</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>callExpression<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">buildJSXElementCall</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  </span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">call</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">&quot;jsx&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>name<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> callee <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;_jsx&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> node <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>callee<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> node<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> pluginTransformReactJsx<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-支持属性" tabindex="-1"><a class="header-anchor" href="#_5-支持属性"><span>5.支持属性</span></a></h2><p>plugin-transform-react-jsx.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const types = require(&#39;@babel/types&#39;);</span>
<span class="line">const pluginSyntaxJsx = require(&#39;@babel/plugin-syntax-jsx&#39;).default;</span>
<span class="line">const pluginTransformReactJsx = {</span>
<span class="line">  inherits:pluginSyntaxJsx,</span>
<span class="line">  visitor: {</span>
<span class="line">    JSXElement(path) {</span>
<span class="line">      let callExpression = buildJSXElementCall(path);</span>
<span class="line">      path.replaceWith(callExpression);</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line">function buildJSXElementCall(path) {</span>
<span class="line">+ const openingPath = path.get(&quot;openingElement&quot;);</span>
<span class="line">+ const {name} = openingPath.node.name;</span>
<span class="line">+ const tag = types.stringLiteral(name);</span>
<span class="line">+ const args = [tag];</span>
<span class="line">+ let attributes = [];</span>
<span class="line">+ for (const attrPath of openingPath.get(&quot;attributes&quot;)) {</span>
<span class="line">+   attributes.push(attrPath.node);</span>
<span class="line">+ }</span>
<span class="line">+ const children = buildChildren(path.node);</span>
<span class="line">+ const props = attributes.map(convertAttribute);</span>
<span class="line">+ if (children.length &gt; 0) {</span>
<span class="line">+   props.push(buildChildrenProperty(children));</span>
<span class="line">+ }</span>
<span class="line">+ const attributesObject = types.objectExpression(props);</span>
<span class="line">+ args.push(attributesObject);</span>
<span class="line">  return call(path,&quot;jsx&quot;, args);</span>
<span class="line">}</span>
<span class="line">+function buildChildren(node) {</span>
<span class="line">+  const elements = [];</span>
<span class="line">+  for (let i = 0; i &lt; node.children.length; i++) {</span>
<span class="line">+    let child = node.children[i];</span>
<span class="line">+    if (types.isJSXText(child)) {</span>
<span class="line">+      elements.push(types.stringLiteral(child.value));</span>
<span class="line">+    }</span>
<span class="line">+  }</span>
<span class="line">+  return elements;</span>
<span class="line">+}</span>
<span class="line">+function buildChildrenProperty(children) {</span>
<span class="line">+  let childrenNode;</span>
<span class="line">+  if (children.length === 1) {</span>
<span class="line">+    childrenNode = children[0];</span>
<span class="line">+  } else if (children.length &gt; 1) {</span>
<span class="line">+    childrenNode = types.arrayExpression(children);</span>
<span class="line">+  } else {</span>
<span class="line">+    return undefined;</span>
<span class="line">+  }</span>
<span class="line">+  return types.objectProperty(types.identifier(&quot;children&quot;), childrenNode);</span>
<span class="line">+}</span>
<span class="line">+function convertAttribute(node) {</span>
<span class="line">+  const value = node.value;</span>
<span class="line">+  node.name.type = &quot;Identifier&quot;;</span>
<span class="line">+  return types.objectProperty(node.name, value);</span>
<span class="line">+}</span>
<span class="line">function call(path,name, args) {</span>
<span class="line">  const callee = types.identifier(&#39;_jsx&#39;);</span>
<span class="line">  const node = types.callExpression(callee, args);</span>
<span class="line">  return node;</span>
<span class="line">}</span>
<span class="line">module.exports = pluginTransformReactJsx;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-引入runtime模块" tabindex="-1"><a class="header-anchor" href="#_6-引入runtime模块"><span>6.引入runtime模块</span></a></h2><p>plugin-transform-react-jsx.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/types&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> pluginSyntaxJsx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/plugin-syntax-jsx&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> pluginTransformReactJsx <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">inherits</span><span class="token operator">:</span>pluginSyntaxJsx<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">JSXElement</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> callExpression <span class="token operator">=</span> <span class="token function">buildJSXElementCall</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>callExpression<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">buildJSXElementCall</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> openingPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;openingElement&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token operator">=</span> openingPath<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> tag <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> attributes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> attrPath <span class="token keyword">of</span> openingPath<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attributes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    attributes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attrPath<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token function">buildChildren</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> props <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>convertAttribute<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    props<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">buildChildrenProperty</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">const</span> attributesObject <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">objectExpression</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attributesObject<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">call</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">&quot;jsx&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">buildChildren</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> child <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">isJSXText</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      elements<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> elements<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">buildChildrenProperty</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> childrenNode<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    childrenNode <span class="token operator">=</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    childrenNode <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">arrayExpression</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> types<span class="token punctuation">.</span><span class="token function">objectProperty</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&quot;children&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> childrenNode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">convertAttribute</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> value <span class="token operator">=</span> node<span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">  node<span class="token punctuation">.</span>name<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> types<span class="token punctuation">.</span><span class="token function">objectProperty</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>name<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span> <span class="token keyword">const</span> importedSource <span class="token operator">=</span> <span class="token string">&#39;react/jsx-runtime&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span> <span class="token keyword">const</span> callee <span class="token operator">=</span> <span class="token function">addImport</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>name<span class="token punctuation">,</span>importedSource<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> node <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>callee<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> node<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> <span class="token function">addImport</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span>importName<span class="token punctuation">,</span>importedSource</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> programPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">isProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> scope <span class="token operator">=</span> programPath<span class="token punctuation">.</span>scope<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> localName <span class="token operator">=</span> scope<span class="token punctuation">.</span><span class="token function">generateUidIdentifier</span><span class="token punctuation">(</span>importName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> specifiers  <span class="token operator">=</span> <span class="token punctuation">[</span>types<span class="token punctuation">.</span><span class="token function">importSpecifier</span><span class="token punctuation">(</span>localName<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>importName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">let</span> statement <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">importDeclaration</span><span class="token punctuation">(</span>specifiers<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>importedSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  programPath<span class="token punctuation">.</span><span class="token function">unshiftContainer</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>statement<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">return</span> localName<span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> pluginTransformReactJsx<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,38)])])}const i=s(e,[["render",l]]),u=JSON.parse('{"path":"/strong/123.jsx-runtime.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/123.jsx-runtime.md"}');export{i as comp,u as data};
