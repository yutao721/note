import{_ as n,c as a,a as p,o as e}from"./app-CD1YpnS1.js";const t={};function l(o,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="_1-搭建开发环境" tabindex="-1"><a class="header-anchor" href="#_1-搭建开发环境"><span>1.搭建开发环境</span></a></h2><h3 id="_1-1-初始化项目" tabindex="-1"><a class="header-anchor" href="#_1-1-初始化项目"><span>1.1 初始化项目</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">mkdir 2019zfkt</span>
<span class="line">cd 2019zfkt</span>
<span class="line">cnpm init <span class="token operator">-</span>y</span>
<span class="line">touch <span class="token punctuation">.</span>gitignore</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-安装依赖" tabindex="-1"><a class="header-anchor" href="#_1-2-安装依赖"><span>1.2 安装依赖</span></a></h3><ul><li><code>@types</code>开头的包都是<code>typeScript</code>的声明文件，可以进入<code>node_modules/@types/XX/index.d.ts</code>进行查看</li><li><a href="https://github.com/DefinitelyTyped/DefinitelyTyped" target="_blank" rel="noopener noreferrer">常见的声明文件</a></li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i react react-dom @types/react @types/react-dom react-router-dom @types/react-router-dom react-transition-group @types/react-transition-group react-swipe @types/react-swipe antd qs @types/qs  -S</span>
<span class="line">cnpm i webpack webpack-cli webpack-dev-server html-webpack-plugin -D</span>
<span class="line">cnpm i typescript ts-loader source-map-loader style-loader css-loader less-loader less url-loader file-loader autoprefixer px2rem-loader postcss-loader lib-flexible -D</span>
<span class="line">cnpm i redux react-redux @types/react-redux redux-thunk  redux-logger @types/redux-logger redux-promise @types/redux-promise immer redux-immer -S</span>
<span class="line">cnpm i connected-react-router -S</span>
<span class="line">cnpm i express express-session body-parser cors axios -S</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>ts-loader</code>可以让 Webpack 使用 TypeScript 的标准配置文件<code>tsconfig.json</code>编译 TypeScript 代码。</li><li><code>source-map-loader</code>使用任意来自 Typescript 的<code>sourcemap</code>输出，以此通知 webpack 何时生成自己的 sourcemaps,这让你在调试最终生成的文件时就好像在调试 TypeScript 源码一样。</li></ul><h3 id="_1-3-支持-typescript" tabindex="-1"><a class="header-anchor" href="#_1-3-支持-typescript"><span>1.3 支持 typescript</span></a></h3><ul><li>需要生成一个<code>tsconfig.json</code>文件来告诉<code>ts-loader</code>如何编译代码<code>TypeScript</code>代码</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">tsc --init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span><span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&quot;./src/**/*&quot;</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">项目</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">outDir</td><td style="text-align:left;">指定输出目录</td></tr><tr><td style="text-align:left;">sourceMap</td><td style="text-align:left;">把 ts 文件编译成 js 文件的时候，同时生成对应的 sourceMap 文件</td></tr><tr><td style="text-align:left;">noImplicitAny</td><td style="text-align:left;">如果为 true 的话，TypeScript 编译器无法推断出类型时，它仍然会生成 JavaScript 文件，但是它也会报告一个错误</td></tr><tr><td style="text-align:left;">module：代码规范</td><td style="text-align:left;">target：转换成 es5</td></tr><tr><td style="text-align:left;">jsx</td><td style="text-align:left;">react 模式会生成 React.createElement，在使用前不需要再进行转换操作了，输出文件的扩展名为.js</td></tr><tr><td style="text-align:left;">include</td><td style="text-align:left;">需要编译的目录</td></tr><tr><td style="text-align:left;">allowSyntheticDefaultImports</td><td style="text-align:left;">允许从没有设置默认导出的模块中默认导入。这并不影响代码的输出，仅为了类型检查。</td></tr><tr><td style="text-align:left;">esModuleInterop</td><td style="text-align:left;">设置 esModuleInterop: true 使 typescript 来兼容所有模块方案的导入</td></tr></tbody></table><blockquote><p>在 TypeScript 中，有多种 import 的方式，分别对应了 JavaScript 中不同的 export</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// commonjs 模块</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> xx <span class="token keyword">from</span> <span class="token string">&quot;xx&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 标准 es6 模块</span></span>
<span class="line"><span class="token keyword">import</span> xx <span class="token keyword">from</span> <span class="token string">&quot;xx&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-编写-webpack-配置文件" tabindex="-1"><a class="header-anchor" href="#_1-4-编写-webpack-配置文件"><span>1.4 编写 webpack 配置文件</span></a></h3><ul><li>webpack.config.js</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> tsImportPluginFactory <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ts-import-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//process.env.NODE_ENV == &#39;production&#39; ? &#39;production&#39; : &#39;development&#39;;</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">mode</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//默认是开发模块</span></span>
<span class="line">  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.tsx&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//热更新插件</span></span>
<span class="line">    <span class="token literal-property property">contentBase</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">historyApiFallback</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">//browserHistory的时候，刷新会报404. 自动重定向到index.html</span></span>
<span class="line">      <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&quot;./index.html&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;~&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">//当你加载一个文件的时候,没有指定扩展名的时候，会自动寻找哪些扩展名</span></span>
<span class="line">    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(j|t)sx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">transpileOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token function-variable function">getCustomTransformers</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">before</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">              <span class="token function">tsImportPluginFactory</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">libraryName</span><span class="token operator">:</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">libraryDirectory</span><span class="token operator">:</span> <span class="token string">&quot;es&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">compilerOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&quot;es2015&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;px2rem-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">remPrecesion</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;px2rem-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token literal-property property">remPrecesion</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(jpg|png|gif|svg|jpeg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.html&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">//热更新插件</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-package-json" tabindex="-1"><a class="header-anchor" href="#_1-5-package-json"><span>1.5 package.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">  &quot;scripts&quot;: {</span>
<span class="line">    &quot;build&quot;: &quot;webpack&quot;,</span>
<span class="line">    &quot;dev&quot;: &quot;webpack-dev-server&quot;</span>
<span class="line">  },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6-项目文件" tabindex="-1"><a class="header-anchor" href="#_1-6-项目文件"><span>1.6 项目文件</span></a></h3><h4 id="_1-6-1-src-index-tsx" tabindex="-1"><a class="header-anchor" href="#_1-6-1-src-index-tsx"><span>1.6.1 src\\index.tsx</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-6-2-src-index-html" tabindex="-1"><a class="header-anchor" href="#_1-6-2-src-index-html"><span>1.6.2 src\\index.html</span></a></h4><p>src\\index.html</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>link</span>
<span class="line">      rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span></span>
<span class="line">      href<span class="token operator">=</span><span class="token string">&quot;https://cdn.bootcss.com/normalize/8.0.1/normalize.min.css&quot;</span></span>
<span class="line">    <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>珠峰课堂<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line">  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token keyword">let</span> docEle <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">setRemUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        docEle<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> docEle<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token function">setRemUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span> setRemUnit<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-跑通路由" tabindex="-1"><a class="header-anchor" href="#_2-跑通路由"><span>2.跑通路由</span></a></h2><h3 id="_2-1-src-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-1-src-index-tsx"><span>2.1 src\\index.tsx</span></a></h3><p>src\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Switch<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> zh_CN <span class="token keyword">from</span> <span class="token string">&quot;antd/lib/locale-provider/zh_CN&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./assets/css/common.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Tabs <span class="token keyword">from</span> <span class="token string">&quot;./components/Tabs&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">&quot;./routes/Home&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Mine <span class="token keyword">from</span> <span class="token string">&quot;./routes/Mine&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Profile <span class="token keyword">from</span> <span class="token string">&quot;./routes/Profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ConnectedRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;connected-react-router&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> history <span class="token keyword">from</span> <span class="token string">&quot;./store/history&quot;</span><span class="token punctuation">;</span></span>
<span class="line">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>ConnectedRouter history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>ConfigProvider locale<span class="token operator">=</span><span class="token punctuation">{</span>zh_CN<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>main className<span class="token operator">=</span><span class="token string">&quot;main-container&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/Mine&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Mine<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/profile&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Profile<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Tabs <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>ConfigProvider<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>ConnectedRouter<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-src-assets-css-common-less" tabindex="-1"><a class="header-anchor" href="#_2-2-src-assets-css-common-less"><span>2.2 src\\assets\\css\\common.less</span></a></h3><p>src\\assets\\css\\common.less</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">ul,li{</span>
<span class="line">    list-style: none;</span>
<span class="line">}</span>
<span class="line"> </span>
<span class="line">    margin:0 auto;</span>
<span class="line">    max-width: 750px;</span>
<span class="line">    box-sizing: border-box;</span>
<span class="line">}</span>
<span class="line">.main-container{</span>
<span class="line">    padding:100px 0 120px 0;</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-src-components-tabs-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-3-src-components-tabs-index-tsx"><span>2.3 src\\components\\Tabs\\index.tsx</span></a></h3><p>src\\components\\Tabs\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter<span class="token punctuation">,</span> NavLink <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Tabs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>NavLink exact to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;home&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">&quot;/mine&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;shopping-cart&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>购物车<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">&quot;/profile&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;user&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>个人中心<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>Tabs<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-src-components-tabs-index-less" tabindex="-1"><a class="header-anchor" href="#_2-4-src-components-tabs-index-less"><span>2.4 src\\components\\Tabs\\index.less</span></a></h3><p>src\\components\\Tabs\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">footer <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">position</span><span class="token operator">:</span> fixed<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line">  z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line">   background<span class="token operator">-</span>color<span class="token operator">:</span> </span>
<span class="line">   border<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>02rem solid </span>
<span class="line">  <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span></span>
<span class="line">  justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">  align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">  a <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">flex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span></span>
<span class="line">    justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">    align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">     <span class="token literal-property property">color</span><span class="token operator">:</span> </span>
<span class="line">    i <span class="token punctuation">{</span></span>
<span class="line">      font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>5rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    span <span class="token punctuation">{</span></span>
<span class="line">      font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>3rem<span class="token punctuation">;</span></span>
<span class="line">      line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>5rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&amp;</span><span class="token punctuation">.</span>active <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">color</span><span class="token operator">:</span> blue<span class="token punctuation">;</span></span>
<span class="line">      font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-src-store-history-tsx" tabindex="-1"><a class="header-anchor" href="#_2-5-src-store-history-tsx"><span>2.5 src\\store\\history.tsx</span></a></h3><p>src\\store\\history.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createHashHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;history&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createHashHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-src-store-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_2-6-src-store-action-types-tsx"><span>2.6 src\\store\\action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD</span> <span class="token operator">=</span> <span class="token string">&quot;ADD&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-7-src-store-reducers-home-tsx" tabindex="-1"><a class="header-anchor" href="#_2-7-src-store-reducers-home-tsx"><span>2.7 src\\store\\reducers\\home.tsx</span></a></h3><p>src\\store\\reducers\\home.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">HomeState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">initialState</span><span class="token operator">:</span> HomeState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">state</span><span class="token operator">:</span> HomeState <span class="token operator">=</span> initialState<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">action</span><span class="token operator">:</span> AnyAction</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> HomeState <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-8-src-store-reducers-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-8-src-store-reducers-index-tsx"><span>2.8 src\\store\\reducers\\index.tsx</span></a></h3><p>src\\store\\reducers\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers<span class="token punctuation">,</span> ReducersMapObject<span class="token punctuation">,</span> Reducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connectRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;connected-react-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> history <span class="token keyword">from</span> <span class="token string">&#39;../history&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> home <span class="token keyword">from</span> <span class="token string">&#39;./home&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> mime <span class="token keyword">from</span> <span class="token string">&#39;./mime&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> profile <span class="token keyword">from</span> <span class="token string">&#39;./profile&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">reducers</span><span class="token operator">:</span> ReducersMapObject <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">router</span><span class="token operator">:</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    home<span class="token punctuation">,</span></span>
<span class="line">    mime<span class="token punctuation">,</span></span>
<span class="line">    profile<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">type CombinedState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span>key <span class="token keyword">in</span> keyof <span class="token keyword">typeof</span> reducers<span class="token punctuation">]</span><span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> reducers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">reducer</span><span class="token operator">:</span> Reducer<span class="token operator">&lt;</span>CombinedState<span class="token operator">&gt;</span> <span class="token operator">=</span> combineReducers<span class="token operator">&lt;</span>CombinedState<span class="token operator">&gt;</span><span class="token punctuation">(</span>reducers<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> reducer<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-9-src-store-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-9-src-store-index-tsx"><span>2.9 src\\store\\index.tsx</span></a></h3><p>src\\store\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">,</span> Store<span class="token punctuation">,</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> reducers<span class="token punctuation">,</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./reducers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">&#39;redux-logger&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> thunk<span class="token punctuation">,</span> <span class="token punctuation">{</span> ThunkDispatch<span class="token punctuation">,</span> ThunkAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux-thunk&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> promise <span class="token keyword">from</span> <span class="token string">&#39;redux-promise&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> routerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;connected-react-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> history <span class="token keyword">from</span> <span class="token string">&#39;./history&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">store</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span>CombinedState<span class="token punctuation">,</span> AnyAction<span class="token operator">&gt;</span> <span class="token operator">=</span> createStore<span class="token operator">&lt;</span>CombinedState<span class="token punctuation">,</span> AnyAction<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>reducers<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">,</span> <span class="token function">routerMiddleware</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span><span class="token punctuation">,</span> promise<span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-10-src-routes-home-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-10-src-routes-home-index-tsx"><span>2.10 src\\routes\\Home\\index.tsx</span></a></h3><p>src\\routes\\Home\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PropsWithChildren <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">type Props <span class="token operator">=</span> PropsWithChildren<span class="token operator">&lt;</span>RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-11-src-routes-mine-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-11-src-routes-mine-index-tsx"><span>2.11 src\\routes\\Mine\\index.tsx</span></a></h3><p>src\\routes\\Mine\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PropsWithChildren <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">type Props <span class="token operator">=</span> PropsWithChildren<span class="token operator">&lt;</span>RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Mine</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Mine<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Mine<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-12-src-routes-profile-index-tsx" tabindex="-1"><a class="header-anchor" href="#_2-12-src-routes-profile-index-tsx"><span>2.12 src\\routes\\Profile\\index.tsx</span></a></h3><p>src\\routes\\Profile\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PropsWithChildren <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">type Props <span class="token operator">=</span> PropsWithChildren<span class="token operator">&lt;</span>RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Profile<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Profile<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-13-reducers-mime-tsx" tabindex="-1"><a class="header-anchor" href="#_2-13-reducers-mime-tsx"><span>2.13 reducers\\mime.tsx</span></a></h3><p>src\\store\\reducers\\mime.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">MimeState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">initialState</span><span class="token operator">:</span> MimeState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">state</span><span class="token operator">:</span> MimeState <span class="token operator">=</span> initialState<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">action</span><span class="token operator">:</span> AnyAction</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> MimeState <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-首页头部导航" tabindex="-1"><a class="header-anchor" href="#_3-首页头部导航"><span>3.首页头部导航</span></a></h2><ul><li><a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/index.d.ts" target="_blank" rel="noopener noreferrer">react.d.ts</a></li><li><img src="http://img.zhufengpeixun.cn/zfkelogo.png" alt="zfkelogo"></li></ul><h3 id="_3-1-tsconfig-json" tabindex="-1"><a class="header-anchor" href="#_3-1-tsconfig-json"><span>3.1 tsconfig.json</span></a></h3><p>tsconfig.json</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">  &quot;compilerOptions&quot;: {</span>
<span class="line">    &quot;baseUrl&quot;: &quot;.&quot;,</span>
<span class="line">    &quot;paths&quot;: {</span>
<span class="line">      &quot;@/*&quot;: [</span>
<span class="line">        &quot;./src/*&quot;</span>
<span class="line">      ]</span>
<span class="line">    }</span>
<span class="line">  },</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-homeheader-index-tsx" tabindex="-1"><a class="header-anchor" href="#_3-2-homeheader-index-tsx"><span>3.2 HomeHeader\\index.tsx</span></a></h3><p>src\\routes\\Home\\components\\HomeHeader\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> CSSProperties <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&#39;./index.less&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> classnames <span class="token keyword">from</span> <span class="token string">&#39;classnames&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Transition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-transition-group&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">&#39;@/assets/images/logo.png&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//ts 不认识图片，只认识js jsx tsx</span></span>
<span class="line"><span class="token comment">//let logo = require(&#39;../../../../assets/images/logo.png&#39;);</span></span>
<span class="line"><span class="token comment">//如果是用require加载的话，返回值的default属性才是那个图片地址</span></span>
<span class="line"><span class="token comment">//如果你非要用import如何解决?</span></span>
<span class="line"><span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> defaultStyle <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">transition</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">opacity </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>duration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms ease-in-out</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">TransitionStyles</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">entering</span><span class="token operator">:</span> CSSProperties<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">entered</span><span class="token operator">:</span> CSSProperties<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">exiting</span><span class="token operator">:</span> CSSProperties<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">exited</span><span class="token operator">:</span> CSSProperties<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">transitionStyles</span><span class="token operator">:</span> TransitionStyles <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">entering</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">entered</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">exiting</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">exited</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">currentCategory</span><span class="token operator">:</span> string<span class="token punctuation">;</span><span class="token comment">//当前选中的分类 此数据会放在redux仓库中</span></span>
<span class="line">    <span class="token function-variable function">setCurrentCategory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">currentCategory</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token punctuation">;</span><span class="token comment">// 改变仓库中的分类</span></span>
<span class="line">    <span class="token literal-property property">refreshLessons</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">HomeHeader</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">[</span>isMenuVisible<span class="token punctuation">,</span> setIsMenuVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">setCurrentCategory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> React<span class="token punctuation">.</span>MouseEvent<span class="token operator">&lt;</span>HTMLUListElement<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token literal-property property">target</span><span class="token operator">:</span> HTMLUListElement <span class="token operator">=</span> event<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLUListElement<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> category <span class="token operator">=</span> target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>category<span class="token punctuation">;</span></span>
<span class="line">        props<span class="token punctuation">.</span><span class="token function">setCurrentCategory</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        props<span class="token punctuation">.</span><span class="token function">refreshLessons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">setIsMenuVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token string">&quot;home-header&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;logo-header&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;bars&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsMenuVisible</span><span class="token punctuation">(</span><span class="token operator">!</span>isMenuVisible<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Transition <span class="token keyword">in</span><span class="token operator">=</span><span class="token punctuation">{</span>isMenuVisible<span class="token punctuation">}</span> timeout<span class="token operator">=</span><span class="token punctuation">{</span>duration<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">state</span><span class="token operator">:</span> keyof TransitionStyles</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">                        <span class="token operator">&lt;</span>ul</span>
<span class="line">                            className<span class="token operator">=</span><span class="token string">&quot;category&quot;</span></span>
<span class="line">                            onClick<span class="token operator">=</span><span class="token punctuation">{</span>setCurrentCategory<span class="token punctuation">}</span></span>
<span class="line">                            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">                                <span class="token operator">...</span>defaultStyle<span class="token punctuation">,</span></span>
<span class="line">                                <span class="token operator">...</span>transitionStyles<span class="token punctuation">[</span>state<span class="token punctuation">]</span></span>
<span class="line">                            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                        <span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>li data<span class="token operator">-</span>category<span class="token operator">=</span><span class="token string">&quot;all&quot;</span> className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">active</span><span class="token operator">:</span> props<span class="token punctuation">.</span>currentCategory <span class="token operator">===</span> <span class="token string">&#39;all&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>全部课程<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>li data<span class="token operator">-</span>category<span class="token operator">=</span><span class="token string">&quot;react&quot;</span> className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">active</span><span class="token operator">:</span> props<span class="token punctuation">.</span>currentCategory <span class="token operator">===</span> <span class="token string">&#39;react&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>React课程<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token operator">&lt;</span>li data<span class="token operator">-</span>category<span class="token operator">=</span><span class="token string">&quot;vue&quot;</span> className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">active</span><span class="token operator">:</span> props<span class="token punctuation">.</span>currentCategory <span class="token operator">===</span> <span class="token string">&#39;vue&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Vue课程<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Transition<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> HomeHeader<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-homeheader-index-less" tabindex="-1"><a class="header-anchor" href="#_3-3-homeheader-index-less"><span>3.3 HomeHeader\\index.less</span></a></h3><p>src\\routes\\Home\\components\\HomeHeader\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> @<span class="token constant">BG</span><span class="token operator">:</span> </span>
<span class="line"><span class="token punctuation">.</span>home<span class="token operator">-</span>header <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">position</span><span class="token operator">:</span> fixed<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span></span>
<span class="line">  z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">999</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">.</span>logo<span class="token operator">-</span>header <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">height</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">background</span><span class="token operator">:</span> @<span class="token constant">BG</span><span class="token punctuation">;</span></span>
<span class="line">     <span class="token literal-property property">color</span><span class="token operator">:</span> </span>
<span class="line">    <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span></span>
<span class="line">    justify<span class="token operator">-</span>content<span class="token operator">:</span> space<span class="token operator">-</span>between<span class="token punctuation">;</span></span>
<span class="line">    align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">    img <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">width</span><span class="token operator">:</span> 2rem<span class="token punctuation">;</span></span>
<span class="line">      margin<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    i <span class="token punctuation">{</span></span>
<span class="line">      font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>6rem<span class="token punctuation">;</span></span>
<span class="line">      margin<span class="token operator">-</span>right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">.</span>category <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">top</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>1rem <span class="token number">0</span><span class="token punctuation">.</span>5rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">background</span><span class="token operator">:</span> @<span class="token constant">BG</span><span class="token punctuation">;</span></span>
<span class="line">    li <span class="token punctuation">{</span></span>
<span class="line">      line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>6rem<span class="token punctuation">;</span></span>
<span class="line">      text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">       <span class="token literal-property property">color</span><span class="token operator">:</span> </span>
<span class="line">      font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>3rem<span class="token punctuation">;</span></span>
<span class="line">      border<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>02rem solid <span class="token function">lighten</span><span class="token punctuation">(</span>@<span class="token constant">BG</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token operator">&amp;</span><span class="token punctuation">.</span>active <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">color</span><span class="token operator">:</span> red<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_3-4-action-types-tsx"><span>3.4 action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+ export const SET_CURRENT_CATEGORY = &#39;SET_CURRENT_CATEGORY&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-5-reducers-home-tsx" tabindex="-1"><a class="header-anchor" href="#_3-5-reducers-home-tsx"><span>3.5 reducers\\home.tsx</span></a></h3><p>src\\store\\reducers\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { AnyAction } from &#39;redux&#39;;</span>
<span class="line">+import * as TYPES from &quot;../action-types&quot;;</span>
<span class="line">export interface HomeState {</span>
<span class="line">+    currentCategory: string;</span>
<span class="line">}</span>
<span class="line">let initialState: HomeState = {</span>
<span class="line">+    currentCategory: &#39;all&#39;</span>
<span class="line">};</span>
<span class="line">export default function (state: HomeState = initialState, action: AnyAction): HomeState {</span>
<span class="line">    switch (action.type) {</span>
<span class="line">+        case TYPES.SET_CURRENT_CATEGORY:</span>
<span class="line">+            return { ...state, currentCategory: action.payload };</span>
<span class="line">        default:</span>
<span class="line">            return state;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-actions-home-tsx" tabindex="-1"><a class="header-anchor" href="#_3-6-actions-home-tsx"><span>3.6 actions\\home.tsx</span></a></h3><p>src\\store\\actions\\home.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">TYPES</span> <span class="token keyword">from</span> <span class="token string">&quot;../action-types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">setCurrentCategory</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">currentCategory</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">SET_CURRENT_CATEGORY</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> currentCategory <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-home-index-tsx" tabindex="-1"><a class="header-anchor" href="#_3-7-home-index-tsx"><span>3.7 Home\\index.tsx</span></a></h3><p>src\\routes\\Home\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React, { PropsWithChildren } from &#39;react&#39;;</span>
<span class="line">import { connect } from &#39;react-redux&#39;;</span>
<span class="line">import { RouteComponentProps } from &#39;react-router-dom&#39;;</span>
<span class="line">+import actions from &#39;@/store/actions/home&#39;;</span>
<span class="line">+import HomeHeader from &#39;./components/HomeHeader&#39;;</span>
<span class="line">+import { CombinedState } from &#39;@/store/reducers&#39;;</span>
<span class="line">+import { HomeState } from &#39;@/store/reducers/home&#39;;</span>
<span class="line">+import &#39;./index.less&#39;;</span>
<span class="line">+type StateProps = ReturnType&lt;typeof mapStateToProps&gt;;</span>
<span class="line">+type DispatchProps = typeof actions;</span>
<span class="line">interface Params { }</span>
<span class="line">+type Props = PropsWithChildren&lt;RouteComponentProps&lt;Params&gt; &amp; StateProps &amp; DispatchProps&gt;;</span>
<span class="line">function Home(props: Props) {</span>
<span class="line">    return (</span>
<span class="line">+        &lt;&gt;</span>
<span class="line">+            &lt;HomeHeader</span>
<span class="line">+                currentCategory={props.currentCategory}</span>
<span class="line">+                setCurrentCategory={props.setCurrentCategory}</span>
<span class="line">+                refreshLessons={props.refreshLessons}</span>
<span class="line">+            /&gt;</span>
<span class="line">+        &lt;/&gt;</span>
<span class="line">+    )</span>
<span class="line">}</span>
<span class="line">+let mapStateToProps = (state: CombinedState): HomeState =&gt; state.home;</span>
<span class="line">export default connect(</span>
<span class="line">+    mapStateToProps,</span>
<span class="line">+    actions</span>
<span class="line">)(Home);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-个人中心" tabindex="-1"><a class="header-anchor" href="#_4-个人中心"><span>4.个人中心</span></a></h2><h3 id="_4-1-profile-index-tsx" tabindex="-1"><a class="header-anchor" href="#_4-1-profile-index-tsx"><span>4.1 Profile\\index.tsx</span></a></h3><p>src\\routes\\Profile\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PropsWithChildren<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../store/reducers&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ProfileState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../store/reducers/profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">&quot;../../store/actions/profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token constant">LOGIN_TYPES</span> <span class="token keyword">from</span> <span class="token string">&quot;../../typings/login-types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Descriptions<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Alert<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> NavHeader <span class="token keyword">from</span> <span class="token string">&quot;../../components/NavHeader&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AxiosError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//当前的组件有三个属性来源</span></span>
<span class="line"><span class="token comment">//1.mapStateToProps的返回值 2.actions对象类型 3. 来自路由 4.用户传入进来的其它属性</span></span>
<span class="line">type StateProps <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> mapStateToProps<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">type DispatchProps <span class="token operator">=</span> <span class="token keyword">typeof</span> actions<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">type RouteProps <span class="token operator">=</span> RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">type Props <span class="token operator">=</span> PropsWithChildren<span class="token operator">&lt;</span>StateProps <span class="token operator">&amp;</span> DispatchProps <span class="token operator">&amp;</span> RouteProps<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    props<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">error</span><span class="token operator">:</span> AxiosError</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> content<span class="token punctuation">;</span> <span class="token comment">//里存放着要渲染的内容</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>loginState <span class="token operator">==</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">.</span><span class="token constant">UN_VALIDATE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    content <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>loginState <span class="token operator">==</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">.</span><span class="token constant">LOGINED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    content <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;user-info&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Descriptions title<span class="token operator">=</span><span class="token string">&quot;当前登录用户&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Descriptions<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span><span class="token operator">&gt;</span>珠峰架构<span class="token operator">&lt;</span><span class="token operator">/</span>Descriptions<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Descriptions<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;手机号&quot;</span><span class="token operator">&gt;</span><span class="token number">15718856132</span><span class="token operator">&lt;</span><span class="token operator">/</span>Descriptions<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Descriptions<span class="token punctuation">.</span>Item label<span class="token operator">=</span><span class="token string">&quot;邮箱&quot;</span><span class="token operator">&gt;</span>zhangsan@qq<span class="token punctuation">.</span>com<span class="token operator">&lt;</span><span class="token operator">/</span>Descriptions<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Descriptions<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;danger&quot;</span><span class="token operator">&gt;</span>退出登录<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    content <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Alert</span>
<span class="line">          type<span class="token operator">=</span><span class="token string">&quot;warning&quot;</span></span>
<span class="line">          message<span class="token operator">=</span><span class="token string">&quot;当前未登录&quot;</span></span>
<span class="line">          description<span class="token operator">=</span><span class="token string">&quot;亲爱的用户你好，你当前尚未登录，请你选择注册或者登录&quot;</span></span>
<span class="line">        <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token string">&quot;.5rem&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;dashed&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            登录</span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button</span>
<span class="line">            type<span class="token operator">=</span><span class="token string">&quot;dashed&quot;</span></span>
<span class="line">            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">marginLeft</span><span class="token operator">:</span> <span class="token string">&quot;.5rem&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token operator">&gt;</span></span>
<span class="line">            注册</span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>section<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>NavHeader history<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span>个人中心<span class="token operator">&lt;</span><span class="token operator">/</span>NavHeader<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">{</span>content<span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> mapStateToProps <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> CombinedState<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">ProfileState</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>profile<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> actions<span class="token punctuation">)</span><span class="token punctuation">(</span>Profile<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-routes-profile-index-less" tabindex="-1"><a class="header-anchor" href="#_4-2-routes-profile-index-less"><span>4.2 routes\\Profile\\index.less</span></a></h3><p>src\\routes\\Profile\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">.</span>user<span class="token operator">-</span>info <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_4-3-action-types-tsx"><span>4.3 action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const SET_CURRENT_CATEGORY = &#39;SET_CURRENT_CATEGORY&#39;;</span>
<span class="line"></span>
<span class="line">+export const VALIDATE = &#39;VALIDATE&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-typings-login-types-tsx" tabindex="-1"><a class="header-anchor" href="#_4-4-typings-login-types-tsx"><span>4.4 typings\\login-types.tsx</span></a></h3><p>src\\typings\\login-types.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">enum</span> <span class="token constant">LOGIN_TYPES</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token constant">UN_VALIDATE</span><span class="token punctuation">,</span> <span class="token comment">//未验证过</span></span>
<span class="line">    <span class="token constant">LOGINED</span><span class="token punctuation">,</span>     <span class="token comment">//登录</span></span>
<span class="line">    <span class="token constant">UNLOGIN</span>      <span class="token comment">//未登录</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-reducers-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_4-5-reducers-profile-tsx"><span>4.5 reducers\\profile.tsx</span></a></h3><p>src\\store\\reducers\\profile.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">TYPES</span> <span class="token keyword">from</span> <span class="token string">&quot;../action-types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token constant">LOGIN_TYPES</span> <span class="token keyword">from</span> <span class="token string">&quot;../../typings/login-types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ProfileState</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">loginState</span><span class="token operator">:</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">user</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">error</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">initialState</span><span class="token operator">:</span> ProfileState <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">loginState</span><span class="token operator">:</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">.</span><span class="token constant">UN_VALIDATE</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">state</span><span class="token operator">:</span> ProfileState <span class="token operator">=</span> initialState<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">action</span><span class="token operator">:</span> AnyAction</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> ProfileState <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> <span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">VALIDATE</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token operator">...</span>state<span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">loginState</span><span class="token operator">:</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">.</span><span class="token constant">LOGINED</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">user</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>data<span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token operator">...</span>state<span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">loginState</span><span class="token operator">:</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">.</span><span class="token constant">UNLOGIN</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">error</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">case</span> <span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">LOGOUT</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">...</span>state<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">loginState</span><span class="token operator">:</span> <span class="token constant">LOGIN_TYPES</span><span class="token punctuation">.</span><span class="token constant">UN_VALIDATE</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-actions-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_4-6-actions-profile-tsx"><span>4.6 actions\\profile.tsx</span></a></h3><p>src\\store\\actions\\profile.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">TYPES</span> <span class="token keyword">from</span> <span class="token string">&quot;../action-types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../api/profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">//https://github.com/redux-utilities/redux-promise/blob/master/src/index.js</span></span>
<span class="line">  <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AnyAction <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">VALIDATE</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7-src-store-index-tsx" tabindex="-1"><a class="header-anchor" href="#_4-7-src-store-index-tsx"><span>4.7 src\\store\\index.tsx</span></a></h3><p>src\\store\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { combineReducers, ReducersMapObject, Reducer } from &#39;redux&#39;;</span>
<span class="line">import { connectRouter } from &#39;connected-react-router&#39;;</span>
<span class="line">import history from &#39;../history&#39;;</span>
<span class="line">import home from &#39;./home&#39;;</span>
<span class="line">import mime from &#39;./mime&#39;;</span>
<span class="line">+import profile from &#39;./profile&#39;;</span>
<span class="line">let reducers: ReducersMapObject = {</span>
<span class="line">    router: connectRouter(history),</span>
<span class="line">    home,</span>
<span class="line">    mime,</span>
<span class="line">+   profile,</span>
<span class="line">};</span>
<span class="line">type CombinedState = {</span>
<span class="line">    [key in keyof typeof reducers]: ReturnType&lt;typeof reducers[key]&gt;</span>
<span class="line">}</span>
<span class="line">let reducer: Reducer&lt;CombinedState&gt; = combineReducers&lt;CombinedState&gt;(reducers);</span>
<span class="line"></span>
<span class="line">export { CombinedState }</span>
<span class="line">export default reducer;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-8-api-index-tsx" tabindex="-1"><a class="header-anchor" href="#_4-8-api-index-tsx"><span>4.8 api\\index.tsx</span></a></h3><p>src\\api\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> qs <span class="token keyword">from</span> <span class="token string">&quot;qs&quot;</span><span class="token punctuation">;</span></span>
<span class="line">axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8000&quot;</span><span class="token punctuation">;</span></span>
<span class="line">axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>post<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//axios.defaults.transformRequest = (data = {}) =&gt; qs.stringify(data);</span></span>
<span class="line">axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> access_token <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    config<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>access_token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> config<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> axios<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-9-src-api-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_4-9-src-api-profile-tsx"><span>4.9 src\\api\\profile.tsx</span></a></h3><p>src\\api\\profile.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;./index&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/user/validate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-10-navheader-index-tsx" tabindex="-1"><a class="header-anchor" href="#_4-10-navheader-index-tsx"><span>4.10 NavHeader\\index.tsx</span></a></h3><p>src\\components\\NavHeader\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">history</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">children</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">NavHeader</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;nav-header&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;left&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">goBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-11-navheader-index-less" tabindex="-1"><a class="header-anchor" href="#_4-11-navheader-index-less"><span>4.11 NavHeader\\index.less</span></a></h3><p>src\\components\\NavHeader\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">.</span>nav<span class="token operator">-</span>header <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">position</span><span class="token operator">:</span> fixed<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">height</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span></span>
<span class="line">  z<span class="token operator">-</span>index<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span></span>
<span class="line">  box<span class="token operator">-</span>sizing<span class="token operator">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span></span>
<span class="line">  text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">  line<span class="token operator">-</span>height<span class="token operator">:</span> 1rem<span class="token punctuation">;</span></span>
<span class="line">   background<span class="token operator">-</span>color<span class="token operator">:</span> </span>
<span class="line">   <span class="token literal-property property">color</span><span class="token operator">:</span> </span>
<span class="line">  i <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line">    line<span class="token operator">-</span>height<span class="token operator">:</span> 1rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-注册登陆" tabindex="-1"><a class="header-anchor" href="#_5-注册登陆"><span>5.注册登陆</span></a></h2><h3 id="_5-1-src-index-tsx" tabindex="-1"><a class="header-anchor" href="#_5-1-src-index-tsx"><span>5.1 src\\index.tsx</span></a></h3><p>src\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React from &quot;react&quot;;</span>
<span class="line">import ReactDOM from &quot;react-dom&quot;;</span>
<span class="line">import { Switch, Route, Redirect } from &quot;react-router-dom&quot;;</span>
<span class="line">import { Provider } from &quot;react-redux&quot;;</span>
<span class="line">import store from &quot;./store&quot;;</span>
<span class="line">import { ConfigProvider } from &quot;antd&quot;;</span>
<span class="line">import zh_CN from &quot;antd/lib/locale-provider/zh_CN&quot;;</span>
<span class="line">import &quot;./assets/css/common.less&quot;;</span>
<span class="line">import Tabs from &quot;./components/Tabs&quot;;</span>
<span class="line">import Home from &quot;./routes/Home&quot;;</span>
<span class="line">import Mine from &quot;./routes/Mine&quot;;</span>
<span class="line">import Profile from &quot;./routes/Profile&quot;;</span>
<span class="line">+import Register from &quot;./routes/Register&quot;;</span>
<span class="line">+import Login from &quot;./routes/Login&quot;;</span>
<span class="line">import { ConnectedRouter } from &#39;connected-react-router&#39;;</span>
<span class="line">import history from &#39;./store/history&#39;;</span>
<span class="line">ReactDOM.render(</span>
<span class="line">    &lt;Provider store={store}&gt;</span>
<span class="line">        &lt;ConnectedRouter history={history}&gt;</span>
<span class="line">            &lt;ConfigProvider locale={zh_CN}&gt;</span>
<span class="line">                &lt;main className=&quot;main-container&quot;&gt;</span>
<span class="line">                    &lt;Switch&gt;</span>
<span class="line">                        &lt;Route path=&quot;/&quot; exact component={Home} /&gt;</span>
<span class="line">                        &lt;Route path=&quot;/mine&quot; component={Mine} /&gt;</span>
<span class="line">                        &lt;Route path=&quot;/profile&quot; component={Profile} /&gt;</span>
<span class="line">+                        &lt;Route path=&quot;/register&quot; component={Register} /&gt;</span>
<span class="line">+                        &lt;Route path=&quot;/login&quot; component={Login} /&gt;</span>
<span class="line">                        &lt;Redirect to=&quot;/&quot; /&gt;</span>
<span class="line">                    &lt;/Switch&gt;</span>
<span class="line">                &lt;/main&gt;</span>
<span class="line">                &lt;Tabs /&gt;</span>
<span class="line">            &lt;/ConfigProvider&gt;</span>
<span class="line">        &lt;/ConnectedRouter&gt;</span>
<span class="line">    &lt;/Provider&gt;,</span>
<span class="line">    document.getElementById(&quot;root&quot;)</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-api-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_5-2-api-profile-tsx"><span>5.2 api\\profile.tsx</span></a></h3><p>src\\api\\profile.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import axios from &#39;./index&#39;;</span>
<span class="line">+import { RegisterPayload, LoginPayload } from &#39;../typings/user&#39;;</span>
<span class="line">export function validate() {</span>
<span class="line">    return axios.get(&#39;/user/validate&#39;);</span>
<span class="line">}</span>
<span class="line">+export function register&lt;T&gt;(values: RegisterPayload) {</span>
<span class="line">+    return axios.post&lt;T, T&gt;(&#39;/user/register&#39;, values);</span>
<span class="line">+}</span>
<span class="line">+export function login&lt;T&gt;(values: LoginPayload) {</span>
<span class="line">+    return axios.post&lt;T, T&gt;(&#39;/user/login&#39;, values);</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-routes-profile-index-tsx" tabindex="-1"><a class="header-anchor" href="#_5-3-routes-profile-index-tsx"><span>5.3 routes\\Profile\\index.tsx</span></a></h3><p>src\\routes\\Profile\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React, { PropsWithChildren, useEffect } from &#39;react&#39;;</span>
<span class="line">import { connect } from &#39;react-redux&#39;;</span>
<span class="line">import { CombinedState } from &#39;../../store/reducers&#39;;</span>
<span class="line">import { ProfileState } from &#39;../../store/reducers/profile&#39;;</span>
<span class="line">import actions from &#39;../../store/actions/profile&#39;;</span>
<span class="line">import LOGIN_TYPES from &#39;../../typings/login-types&#39;;</span>
<span class="line">import { RouteComponentProps } from &#39;react-router&#39;;</span>
<span class="line">import { Descriptions, Button, Alert, message } from &#39;antd&#39;;</span>
<span class="line">import NavHeader from &#39;../../components/NavHeader&#39;;</span>
<span class="line">import { AxiosError } from &#39;axios&#39;;</span>
<span class="line">import &#39;./index.less&#39;;</span>
<span class="line">//当前的组件有三个属性来源</span>
<span class="line">//1.mapStateToProps的返回值 2.actions对象类型 3. 来自路由 4.用户传入进来的其它属性</span>
<span class="line">type StateProps = ReturnType&lt;typeof mapStateToProps&gt;;</span>
<span class="line">type DispatchProps = typeof actions;</span>
<span class="line">interface Params { }</span>
<span class="line">type RouteProps = RouteComponentProps&lt;Params&gt;;</span>
<span class="line">type Props = PropsWithChildren&lt;StateProps &amp; DispatchProps &amp; RouteProps&gt;;</span>
<span class="line"></span>
<span class="line">function Profile(props: Props) {</span>
<span class="line">    useEffect(() =&gt; {</span>
<span class="line">        props.validate().catch((error: AxiosError) =&gt; message.error(error.message));</span>
<span class="line">    }, []);</span>
<span class="line">    let content;//里存放着要渲染的内容</span>
<span class="line">    if (props.loginState == LOGIN_TYPES.UN_VALIDATE) {</span>
<span class="line">        content = null;</span>
<span class="line">    } else if (props.loginState == LOGIN_TYPES.LOGINED) {</span>
<span class="line">        content = (</span>
<span class="line">            &lt;div className=&quot;user-info&quot;&gt;</span>
<span class="line">                &lt;Descriptions title=&quot;当前登录用户&quot;&gt;</span>
<span class="line">+                &lt;Descriptions.Item label=&quot;用户名&quot;&gt;{props.user.username}&lt;/Descriptions.Item&gt;</span>
<span class="line">+                &lt;Descriptions.Item label=&quot;邮箱&quot;&gt;{props.user.email}&lt;/Descriptions.Item&gt;</span>
<span class="line">                &lt;/Descriptions&gt;</span>
<span class="line">+                &lt;Button type=&quot;danger&quot; onClick={async () =&gt; {</span>
<span class="line">+                    await props.logout();</span>
<span class="line">+                    props.history.push(&#39;/login&#39;);</span>
<span class="line">+                }}&gt;退出登录&lt;/Button&gt;</span>
<span class="line">            &lt;/div&gt;</span>
<span class="line">        )</span>
<span class="line">    } else {</span>
<span class="line">        content = (</span>
<span class="line">            &lt;&gt;</span>
<span class="line">                &lt;Alert type=&quot;warning&quot; message=&quot;当前未登录&quot; description=&quot;亲爱的用户你好，你当前尚未登录，请你选择注册或者登录&quot; /&gt;</span>
<span class="line">                &lt;div style={{ textAlign: &#39;center&#39;, padding: &#39;.5rem&#39; }}&gt;</span>
<span class="line">                    &lt;Button type=&quot;dashed&quot; onClick={() =&gt; props.history.push(&#39;/login&#39;)}&gt;登录&lt;/Button&gt;</span>
<span class="line">                    &lt;Button type=&quot;dashed&quot; style={{ marginLeft: &#39;.5rem&#39; }} onClick={() =&gt; props.history.push(&#39;/register&#39;)}&gt;注册&lt;/Button&gt;</span>
<span class="line">                &lt;/div&gt;</span>
<span class="line">            &lt;/&gt;</span>
<span class="line">        )</span>
<span class="line">    }</span>
<span class="line">    return (</span>
<span class="line">        (</span>
<span class="line">            &lt;section&gt;</span>
<span class="line">                &lt;NavHeader history={props.history}&gt;个人中心&lt;/NavHeader&gt;</span>
<span class="line">                {content}</span>
<span class="line">            &lt;/section&gt;</span>
<span class="line">        )</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">const mapStateToProps = (initialState: CombinedState): ProfileState =&gt; initialState.profile;</span>
<span class="line">export default connect(</span>
<span class="line">    mapStateToProps,</span>
<span class="line">    actions</span>
<span class="line">)(Profile);</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_5-4-action-types-tsx"><span>5.4 action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const SET_CURRENT_CATEGORY = &#39;SET_CURRENT_CATEGORY&#39;;</span>
<span class="line"></span>
<span class="line">export const VALIDATE = &#39;VALIDATE&#39;;</span>
<span class="line">+export const LOGOUT = &#39;LOGOUT&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-actions-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_5-5-actions-profile-tsx"><span>5.5 actions\\profile.tsx</span></a></h3><p>src\\store\\actions\\profile.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { AnyAction } from &#39;redux&#39;;</span>
<span class="line">import * as TYPES from &#39;../action-types&#39;;</span>
<span class="line">+import { validate, register, login } from &#39;@/api/profile&#39;;</span>
<span class="line">+import { push } from &#39;connected-react-router&#39;;</span>
<span class="line">+import { RegisterPayload, LoginPayload, RegisterResult, LoginResult } from &#39;@/typings/user&#39;;</span>
<span class="line">+import { message } from &quot;antd&quot;;</span>
<span class="line">export default {</span>
<span class="line">    validate(): AnyAction {</span>
<span class="line">        return {</span>
<span class="line">            type: TYPES.VALIDATE,</span>
<span class="line">            payload: validate()</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">+    register(values: RegisterPayload) {</span>
<span class="line">+        return function (dispatch: any) {</span>
<span class="line">+            (async function () {</span>
<span class="line">+                try {</span>
<span class="line">+                    let result: RegisterResult = await register&lt;RegisterResult&gt;(values);</span>
<span class="line">+                    if (result.success) {</span>
<span class="line">+                        dispatch(push(&#39;/login&#39;));</span>
<span class="line">+                    } else {</span>
<span class="line">+                        message.error(result.message);</span>
<span class="line">+                    }</span>
<span class="line">+                } catch (error) {</span>
<span class="line">+                    message.error(&#39;注册失败&#39;);</span>
<span class="line">+                }</span>
<span class="line">+            })();</span>
<span class="line">+        }</span>
<span class="line">+    },</span>
<span class="line">+    login(values: LoginPayload) {</span>
<span class="line">+        return function (dispatch: any) {</span>
<span class="line">+            (async function () {</span>
<span class="line">+                try {</span>
<span class="line">+                    let result: LoginResult = await login&lt;LoginResult&gt;(values);</span>
<span class="line">+                    if (result.success) {</span>
<span class="line">+                        sessionStorage.setItem(&#39;access_token&#39;, result.data.token);</span>
<span class="line">+                        dispatch(push(&#39;/profile&#39;));</span>
<span class="line">+                    } else {</span>
<span class="line">+                        message.error(result.message);</span>
<span class="line">+                    }</span>
<span class="line">+                } catch (error) {</span>
<span class="line">+                    message.error(&#39;登录失败&#39;);</span>
<span class="line">+                }</span>
<span class="line">+            })();</span>
<span class="line">+        }</span>
<span class="line">+    },</span>
<span class="line">+    logout() {</span>
<span class="line">+        return function (dispatch: any) {</span>
<span class="line">+            sessionStorage.removeItem(&#39;access_token&#39;);</span>
<span class="line">+            dispatch({ type: TYPES.LOGOUT });</span>
<span class="line">+            dispatch(push(&#39;/login&#39;));</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-src-typings-user-tsx" tabindex="-1"><a class="header-anchor" href="#_5-6-src-typings-user-tsx"><span>5.6 src\\typings\\user.tsx</span></a></h3><p>src\\typings\\user.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RegisterPayload</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">email</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">confirmPassword</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">LoginPayload</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RegisterResult</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">token</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span>
<span class="line">    <span class="token literal-property property">success</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span></span>
<span class="line">    message<span class="token operator">?</span><span class="token operator">:</span> any</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">LoginResult</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">token</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span>
<span class="line">    <span class="token literal-property property">success</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span></span>
<span class="line">    message<span class="token operator">?</span><span class="token operator">:</span> any</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-7-register-index-tsx" tabindex="-1"><a class="header-anchor" href="#_5-7-register-index-tsx"><span>5.7 Register\\index.tsx</span></a></h3><p>src\\routes\\Register\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">&quot;../../store/actions/profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> NavHeader <span class="token keyword">from</span> <span class="token string">&quot;../../components/NavHeader&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd/lib/form&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../store/reducers&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ProfileState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../store/reducers/profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RegisterPayload <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line">type StateProps <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> mapStateToProps<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">type DispatchProps <span class="token operator">=</span> <span class="token keyword">typeof</span> actions<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">type Props <span class="token operator">=</span> RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token operator">&gt;</span> <span class="token operator">&amp;</span></span>
<span class="line">  StateProps <span class="token operator">&amp;</span></span>
<span class="line">  DispatchProps <span class="token operator">&amp;</span></span>
<span class="line">  FormComponentProps<span class="token operator">&lt;</span>RegisterPayload<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> React<span class="token punctuation">.</span>FormEvent<span class="token operator">&lt;</span>HTMLFormElement<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">errors</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">values</span><span class="token operator">:</span> RegisterPayload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;表单验证失败!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        props<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>form<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>NavHeader history<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span>用户注册<span class="token operator">&lt;</span><span class="token operator">/</span>NavHeader<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;login-form&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;请输入你的用户名!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Input</span>
<span class="line">              prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;user&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,.25)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">              placeholder<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;请输入你的密码!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Input</span>
<span class="line">              prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;lock&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,.25)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">              type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">              placeholder<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&quot;confirmPassword&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;请输入你的确认密码!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Input</span>
<span class="line">              prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;lock&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,.25)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">              type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">              placeholder<span class="token operator">=</span><span class="token string">&quot;确认密码&quot;</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;请输入你的邮箱!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Input</span>
<span class="line">              prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;mail&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,.25)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">              type<span class="token operator">=</span><span class="token string">&quot;email&quot;</span></span>
<span class="line">              placeholder<span class="token operator">=</span><span class="token string">&quot;邮箱&quot;</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button</span>
<span class="line">            type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span></span>
<span class="line">            htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span></span>
<span class="line">            className<span class="token operator">=</span><span class="token string">&quot;login-form-button&quot;</span></span>
<span class="line">          <span class="token operator">&gt;</span></span>
<span class="line">            注册</span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">          或者 <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span><span class="token operator">&gt;</span>立刻登录<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> WrappedRegister <span class="token operator">=</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;login&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Register<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> mapStateToProps <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> CombinedState<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">ProfileState</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>profile<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> actions<span class="token punctuation">)</span><span class="token punctuation">(</span>WrappedRegister<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>routes\\Register\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">.</span>login<span class="token operator">-</span>form <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-8-src-routes-login-index-tsx" tabindex="-1"><a class="header-anchor" href="#_5-8-src-routes-login-index-tsx"><span>5.8 src\\routes\\Login\\index.tsx</span></a></h3><p>src\\routes\\Login\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">&quot;@/store/actions/profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Link<span class="token punctuation">,</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> NavHeader <span class="token keyword">from</span> <span class="token string">&quot;@/components/NavHeader&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd/lib/form&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/store/reducers&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ProfileState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/store/reducers/profile&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> LoginPayload <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line">type StateProps <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> mapStateToProps<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">type DispatchProps <span class="token operator">=</span> <span class="token keyword">typeof</span> actions<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">type Props <span class="token operator">=</span> RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token operator">&gt;</span> <span class="token operator">&amp;</span></span>
<span class="line">  StateProps <span class="token operator">&amp;</span></span>
<span class="line">  DispatchProps <span class="token operator">&amp;</span></span>
<span class="line">  FormComponentProps<span class="token operator">&lt;</span>LoginPayload<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> React<span class="token punctuation">.</span>FormEvent<span class="token operator">&lt;</span>HTMLFormElement<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">errors</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">values</span><span class="token operator">:</span> LoginPayload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;表单验证失败!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        props<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>form<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>NavHeader history<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span>用户登录<span class="token operator">&lt;</span><span class="token operator">/</span>NavHeader<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;login-form&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;请输入你的用户名!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Input</span>
<span class="line">              prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;user&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,.25)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">              placeholder<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;请输入你的密码!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Input</span>
<span class="line">              prefix<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;lock&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(0,0,0,.25)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">              type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span></span>
<span class="line">              placeholder<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span></span>
<span class="line">            <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button</span>
<span class="line">            type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span></span>
<span class="line">            htmlType<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span></span>
<span class="line">            className<span class="token operator">=</span><span class="token string">&quot;login-form-button&quot;</span></span>
<span class="line">          <span class="token operator">&gt;</span></span>
<span class="line">            登录</span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">          或者 <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token operator">&gt;</span>立刻注册<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> WrappedRegister <span class="token operator">=</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;login&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Register<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> mapStateToProps <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> CombinedState<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">ProfileState</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>profile<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> actions<span class="token punctuation">)</span><span class="token punctuation">(</span>WrappedRegister<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>src\\routes\\Login\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">.</span>login<span class="token operator">-</span>form <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-上传头像" tabindex="-1"><a class="header-anchor" href="#_6-上传头像"><span>6.上传头像</span></a></h2><h3 id="_6-1-profile-index-tsx" tabindex="-1"><a class="header-anchor" href="#_6-1-profile-index-tsx"><span>6.1 Profile\\index.tsx</span></a></h3><p>src\\routes\\Profile\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import React, { PropsWithChildren, useEffect, useState } from &#39;react&#39;;</span>
<span class="line">import { connect } from &#39;react-redux&#39;;</span>
<span class="line">import { CombinedState } from &#39;../../store/reducers&#39;;</span>
<span class="line">import { ProfileState } from &#39;../../store/reducers/profile&#39;;</span>
<span class="line">import actions from &#39;../../store/actions/profile&#39;;</span>
<span class="line">import LOGIN_TYPES from &#39;../../typings/login-types&#39;;</span>
<span class="line">import { RouteComponentProps } from &#39;react-router&#39;;</span>
<span class="line">+import { Descriptions, Button, Alert, message, Upload, Icon } from &#39;antd&#39;;</span>
<span class="line">import NavHeader from &#39;../../components/NavHeader&#39;;</span>
<span class="line">import { AxiosError } from &#39;axios&#39;;</span>
<span class="line">import &#39;./index.less&#39;;</span>
<span class="line">//当前的组件有三个属性来源</span>
<span class="line">//1.mapStateToProps的返回值 2.actions对象类型 3. 来自路由 4.用户传入进来的其它属性</span>
<span class="line">type StateProps = ReturnType&lt;typeof mapStateToProps&gt;;</span>
<span class="line">type DispatchProps = typeof actions;</span>
<span class="line">interface Params { }</span>
<span class="line">type RouteProps = RouteComponentProps&lt;Params&gt;;</span>
<span class="line">type Props = PropsWithChildren&lt;StateProps &amp; DispatchProps &amp; RouteProps&gt;;</span>
<span class="line"></span>
<span class="line">function Profile(props: Props) {</span>
<span class="line">+    let [loading, setLoading] = useState(false);</span>
<span class="line">    useEffect(() =&gt; {</span>
<span class="line">        props.validate().catch((error: AxiosError) =&gt; message.error(error.message));</span>
<span class="line">    }, []);</span>
<span class="line">+    const handleChange = (info: any) =&gt; {</span>
<span class="line">+        if (info.file.status === &#39;uploading&#39;) {</span>
<span class="line">+            setLoading(true);</span>
<span class="line">+        } else if (info.file.status === &#39;done&#39;) {</span>
<span class="line">+            let { success, data, message } = info.file.response;</span>
<span class="line">+            if (success) {</span>
<span class="line">+                setLoading(false);</span>
<span class="line">+                props.changeAvatar(data);</span>
<span class="line">+            } else {</span>
<span class="line">+                message.error(message);</span>
<span class="line">+            }</span>
<span class="line">+        }</span>
<span class="line">    };</span>
<span class="line">    let content;//里存放着要渲染的内容</span>
<span class="line"></span>
<span class="line">    if (props.loginState == LOGIN_TYPES.UN_VALIDATE) {</span>
<span class="line">        content = null;</span>
<span class="line">    } else if (props.loginState == LOGIN_TYPES.LOGINED) {</span>
<span class="line">+        const uploadButton = (</span>
<span class="line">+            &lt;div&gt;</span>
<span class="line">+                &lt;Icon type={loading ? &#39;loading&#39; : &#39;plus&#39;} /&gt;</span>
<span class="line">+                &lt;div className=&quot;ant-upload-text&quot;&gt;上传&lt;/div&gt;</span>
<span class="line">+            &lt;/div&gt;</span>
<span class="line">+        );</span>
<span class="line">        content = (</span>
<span class="line">            &lt;div className=&quot;user-info&quot;&gt;</span>
<span class="line">                &lt;Descriptions title=&quot;当前登录用户&quot;&gt;</span>
<span class="line">                    &lt;Descriptions.Item label=&quot;用户名&quot;&gt;{props.user.username}&lt;/Descriptions.Item&gt;</span>
<span class="line">                    &lt;Descriptions.Item label=&quot;邮箱&quot;&gt;{props.user.email}&lt;/Descriptions.Item&gt;</span>
<span class="line">+                    &lt;Descriptions.Item label=&quot;头像&quot;&gt;</span>
<span class="line">+                        &lt;Upload</span>
<span class="line">+                            name=&quot;avatar&quot;</span>
<span class="line">+                            listType=&quot;picture-card&quot;</span>
<span class="line">+                            className=&quot;avatar-uploader&quot;</span>
<span class="line">+                            showUploadList={false}</span>
<span class="line">+                            action=&quot;http://localhost:8000/user/uploadAvatar&quot;</span>
<span class="line">+                            beforeUpload={beforeUpload}</span>
<span class="line">+                            data={{ userId: props.user._id }}</span>
<span class="line">+                            onChange={handleChange}</span>
<span class="line">+                        &gt;</span>
<span class="line">+                            {</span>
<span class="line">+                                props.user.avatar ? &lt;img src={props.user.avatar} alt=&quot;avatar&quot;  /&gt; : uploadButton</span>
<span class="line">+                            }</span>
<span class="line">+                        &lt;/Upload&gt;</span>
<span class="line">+                    &lt;/Descriptions.Item&gt;</span>
<span class="line">                &lt;/Descriptions&gt;</span>
<span class="line">                &lt;Button type=&quot;danger&quot; onClick={async () =&gt; {</span>
<span class="line">                    await props.logout();</span>
<span class="line">                    props.history.push(&#39;/login&#39;);</span>
<span class="line">                }}&gt;退出登录&lt;/Button&gt;</span>
<span class="line">            &lt;/div&gt;</span>
<span class="line">        )</span>
<span class="line">    } else {</span>
<span class="line">        content = (</span>
<span class="line">            &lt;&gt;</span>
<span class="line">                &lt;Alert type=&quot;warning&quot; message=&quot;当前未登录&quot; description=&quot;亲爱的用户你好，你当前尚未登录，请你选择注册或者登录&quot; /&gt;</span>
<span class="line">                &lt;div style={{ textAlign: &#39;center&#39;, padding: &#39;.5rem&#39; }}&gt;</span>
<span class="line">                    &lt;Button type=&quot;dashed&quot; onClick={() =&gt; props.history.push(&#39;/login&#39;)}&gt;登录&lt;/Button&gt;</span>
<span class="line">                    &lt;Button type=&quot;dashed&quot; style={{ marginLeft: &#39;.5rem&#39; }} onClick={() =&gt; props.history.push(&#39;/register&#39;)}&gt;注册&lt;/Button&gt;</span>
<span class="line">                &lt;/div&gt;</span>
<span class="line">            &lt;/&gt;</span>
<span class="line">        )</span>
<span class="line">    }</span>
<span class="line">    return (</span>
<span class="line">        (</span>
<span class="line">            &lt;section&gt;</span>
<span class="line">                &lt;NavHeader history={props.history}&gt;个人中心&lt;/NavHeader&gt;</span>
<span class="line">                {content}</span>
<span class="line">            &lt;/section&gt;</span>
<span class="line">        )</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">+const mapStateToProps = (initialState: CombinedState): ProfileState =&gt; initialState.profile;</span>
<span class="line">+export default connect(</span>
<span class="line">+    mapStateToProps,</span>
<span class="line">+    actions</span>
<span class="line">+)(Profile);</span>
<span class="line"></span>
<span class="line">+function beforeUpload(file: any) {</span>
<span class="line">+    const isJpgOrPng = file.type === &#39;image/jpeg&#39; || file.type === &#39;image/png&#39;;</span>
<span class="line">+    if (!isJpgOrPng) {</span>
<span class="line">+        message.error(&#39;你只能上传JPG/PNG 文件!&#39;);</span>
<span class="line">+    }</span>
<span class="line">+    const isLessThan2M = file.size / 1024 / 1024 &lt; 2;</span>
<span class="line">+    if (!isLessThan2M) {</span>
<span class="line">+        message.error(&#39;图片必须小于2MB!&#39;);</span>
<span class="line">+    }</span>
<span class="line">+    return isJpgOrPng &amp;&amp; isLessThan2M;</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_6-2-action-types-tsx"><span>6.2 action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const SET_CURRENT_CATEGORY = &#39;SET_CURRENT_CATEGORY&#39;;</span>
<span class="line"></span>
<span class="line">export const VALIDATE = &#39;VALIDATE&#39;;</span>
<span class="line">export const LOGOUT = &#39;LOGOUT&#39;;</span>
<span class="line"></span>
<span class="line">+export const CHANGE_AVATAR = &#39;CHANGE_AVATAR&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-reducers-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_6-3-reducers-profile-tsx"><span>6.3 reducers\\profile.tsx</span></a></h3><p>src\\store\\reducers\\profile.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { AnyAction } from &#39;redux&#39;;</span>
<span class="line">import * as TYPES from &quot;../action-types&quot;;</span>
<span class="line">import LOGIN_TYPES from &#39;../../typings/login-types&#39;;</span>
<span class="line">export interface ProfileState {</span>
<span class="line">    loginState: LOGIN_TYPES,</span>
<span class="line">    user: any,</span>
<span class="line">    error: string | null</span>
<span class="line">}</span>
<span class="line">let initialState: ProfileState = {</span>
<span class="line">    loginState: LOGIN_TYPES.UN_VALIDATE,</span>
<span class="line">    user: null,</span>
<span class="line">    error: null</span>
<span class="line">}</span>
<span class="line">export default function (state: ProfileState = initialState, action: AnyAction): ProfileState {</span>
<span class="line">    switch (action.type) {</span>
<span class="line">        case TYPES.VALIDATE:</span>
<span class="line">            if (action.payload.success) {</span>
<span class="line">                return {</span>
<span class="line">                    ...state,</span>
<span class="line">                    loginState: LOGIN_TYPES.LOGINED,</span>
<span class="line">                    user: action.payload.data,</span>
<span class="line">                    error: null</span>
<span class="line">                };</span>
<span class="line">            } else {</span>
<span class="line">                return {</span>
<span class="line">                    ...state,</span>
<span class="line">                    loginState: LOGIN_TYPES.UNLOGIN,</span>
<span class="line">                    user: null,</span>
<span class="line">                    error: action.payload</span>
<span class="line">                };</span>
<span class="line">            }</span>
<span class="line">+        case TYPES.LOGOUT:</span>
<span class="line">+            return { ...state, loginState: LOGIN_TYPES.UN_VALIDATE, user: null, error: null };</span>
<span class="line">+        case TYPES.CHANGE_AVATAR:</span>
<span class="line">+            return { ...state, user: { ...state.user, avatar: action.payload } };</span>
<span class="line">        default:</span>
<span class="line">            return state;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-4-src-store-actions-profile-tsx" tabindex="-1"><a class="header-anchor" href="#_6-4-src-store-actions-profile-tsx"><span>6.4 src\\store\\actions\\profile.tsx</span></a></h3><p>src\\store\\actions\\profile.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { AnyAction } from &#39;redux&#39;;</span>
<span class="line">import * as TYPES from &#39;../action-types&#39;;</span>
<span class="line">import { validate, register, login } from &#39;@/api/profile&#39;;</span>
<span class="line">import { push } from &#39;connected-react-router&#39;;</span>
<span class="line">import { RegisterPayload, LoginPayload, RegisterResult, LoginResult } from &#39;@/typings/user&#39;;</span>
<span class="line">import { message } from &quot;antd&quot;;</span>
<span class="line">export default {</span>
<span class="line">    validate(): AnyAction {</span>
<span class="line">        return {</span>
<span class="line">            type: TYPES.VALIDATE,</span>
<span class="line">            payload: validate()</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    register(values: RegisterPayload) {</span>
<span class="line">        return function (dispatch: any) {</span>
<span class="line">            (async function () {</span>
<span class="line">                try {</span>
<span class="line">                    let result: RegisterResult = await register&lt;RegisterResult&gt;(values);</span>
<span class="line">                    if (result.success) {</span>
<span class="line">                        dispatch(push(&#39;/login&#39;));</span>
<span class="line">                    } else {</span>
<span class="line">                        message.error(result.message);</span>
<span class="line">                    }</span>
<span class="line">                } catch (error) {</span>
<span class="line">                    message.error(&#39;注册失败&#39;);</span>
<span class="line">                }</span>
<span class="line">            })();</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    login(values: LoginPayload) {</span>
<span class="line">        return function (dispatch: any) {</span>
<span class="line">            (async function () {</span>
<span class="line">                try {</span>
<span class="line">                    let result: LoginResult = await login&lt;LoginResult&gt;(values);</span>
<span class="line">                    if (result.success) {</span>
<span class="line">                        sessionStorage.setItem(&#39;access_token&#39;, result.data.token);</span>
<span class="line">                        dispatch(push(&#39;/profile&#39;));</span>
<span class="line">                    } else {</span>
<span class="line">                        message.error(result.message);</span>
<span class="line">                    }</span>
<span class="line">                } catch (error) {</span>
<span class="line">                    message.error(&#39;登录失败&#39;);</span>
<span class="line">                }</span>
<span class="line">            })();</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    logout() {</span>
<span class="line">        return function (dispatch: any) {</span>
<span class="line">            sessionStorage.removeItem(&#39;access_token&#39;);</span>
<span class="line">            dispatch({ type: TYPES.LOGOUT });</span>
<span class="line">            dispatch(push(&#39;/login&#39;));</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">+    changeAvatar(avatar: string) {</span>
<span class="line">+        return {</span>
<span class="line">+            type: TYPES.CHANGE_AVATAR,</span>
<span class="line">+            payload: avatar</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-轮播图" tabindex="-1"><a class="header-anchor" href="#_7-轮播图"><span>7.轮播图</span></a></h2><h3 id="_7-1-store-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_7-1-store-action-types-tsx"><span>7.1 store\\action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const SET_CURRENT_CATEGORY = &#39;SET_CURRENT_CATEGORY&#39;;</span>
<span class="line"></span>
<span class="line">export const VALIDATE = &#39;VALIDATE&#39;;</span>
<span class="line">export const LOGOUT = &#39;LOGOUT&#39;;</span>
<span class="line"></span>
<span class="line">export const CHANGE_AVATAR = &#39;CHANGE_AVATAR&#39;;</span>
<span class="line"></span>
<span class="line">+export const GET_SLIDERS = &#39;GET_SLIDERS&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-store-actions-home-tsx" tabindex="-1"><a class="header-anchor" href="#_7-2-store-actions-home-tsx"><span>7.2 store\\actions\\home.tsx</span></a></h3><p>src\\store\\actions\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as TYPES from &#39;../action-types&#39;;</span>
<span class="line">+import { getSliders } from &#39;@/api/home&#39;;</span>
<span class="line">export default {</span>
<span class="line">    setCurrentCategory(currentCategory: string) {</span>
<span class="line">        return { type: TYPES.SET_CURRENT_CATEGORY, payload: currentCategory };</span>
<span class="line">    },</span>
<span class="line">+    getSliders() {</span>
<span class="line">+        return {</span>
<span class="line">+            type: TYPES.GET_SLIDERS,</span>
<span class="line">+            payload: getSliders()</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-typings-slider-tsx" tabindex="-1"><a class="header-anchor" href="#_7-3-typings-slider-tsx"><span>7.3 typings\\slider.tsx</span></a></h3><p>src\\typings\\slider.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Slider</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">url</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-reducers-home-tsx" tabindex="-1"><a class="header-anchor" href="#_7-4-reducers-home-tsx"><span>7.4 reducers\\home.tsx</span></a></h3><p>src\\store\\reducers\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { AnyAction } from &#39;redux&#39;;</span>
<span class="line">import * as TYPES from &quot;../action-types&quot;;</span>
<span class="line">+import Slider from &#39;@/typings/slider&#39;;</span>
<span class="line">export interface HomeState {</span>
<span class="line">    currentCategory: string;</span>
<span class="line">+    sliders: Slider[];</span>
<span class="line">}</span>
<span class="line">let initialState: HomeState = {</span>
<span class="line">    currentCategory: &#39;all&#39;,</span>
<span class="line">+    sliders: []</span>
<span class="line">};</span>
<span class="line">export default function (state: HomeState = initialState, action: AnyAction): HomeState {</span>
<span class="line">    switch (action.type) {</span>
<span class="line">        case TYPES.SET_CURRENT_CATEGORY:</span>
<span class="line">            return { ...state, currentCategory: action.payload };</span>
<span class="line">+        case TYPES.GET_SLIDERS:</span>
<span class="line">+            return { ...state, sliders: action.payload.data };</span>
<span class="line">        default:</span>
<span class="line">            return state;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-api-home-tsx" tabindex="-1"><a class="header-anchor" href="#_7-5-api-home-tsx"><span>7.5 api\\home.tsx</span></a></h3><p>src\\api\\home.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;./index&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getSliders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/slider/list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-6-homesliders-index-tsx" tabindex="-1"><a class="header-anchor" href="#_7-6-homesliders-index-tsx"><span>7.6 HomeSliders\\index.tsx</span></a></h3><p>src\\routes\\Home\\components\\HomeSliders\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PropsWithChildren<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Carousel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Slider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/lesson&quot;</span><span class="token punctuation">;</span></span>
<span class="line">type Props <span class="token operator">=</span> PropsWithChildren<span class="token operator">&lt;</span><span class="token punctuation">{</span></span>
<span class="line">  children<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span></span>
<span class="line">  sliders<span class="token operator">?</span><span class="token operator">:</span> Slider<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  getSliders<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">HomeSliders</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>sliders<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      props<span class="token punctuation">.</span><span class="token function">getSliders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>Carousel effect<span class="token operator">=</span><span class="token string">&quot;scrollx&quot;</span> autoplay<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">{</span>props<span class="token punctuation">.</span>sliders<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> Slider<span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>url<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Carousel<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> HomeSliders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-7-homesliders-index-less" tabindex="-1"><a class="header-anchor" href="#_7-7-homesliders-index-less"><span>7.7 HomeSliders\\index.less</span></a></h3><p>src\\routes\\Home\\components\\HomeSliders\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">.</span>ant<span class="token operator">-</span>carousel <span class="token punctuation">.</span>slick<span class="token operator">-</span>slide <span class="token punctuation">{</span></span>
<span class="line">  text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line">  line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line">   <span class="token literal-property property">background</span><span class="token operator">:</span> </span>
<span class="line">  <span class="token literal-property property">overflow</span><span class="token operator">:</span> hidden<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">.</span>ant<span class="token operator">-</span>carousel <span class="token punctuation">.</span>slick<span class="token operator">-</span>slide <span class="token punctuation">{</span></span>
<span class="line">   <span class="token literal-property property">color</span><span class="token operator">:</span> </span>
<span class="line">  img <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">.</span>2rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-8-routes-home-index-tsx" tabindex="-1"><a class="header-anchor" href="#_7-8-routes-home-index-tsx"><span>7.8 routes\\Home\\index.tsx</span></a></h3><p>src\\routes\\Home\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import React, { PropsWithChildren, useRef } from &#39;react&#39;;</span>
<span class="line">import { connect } from &#39;react-redux&#39;;</span>
<span class="line">import { RouteComponentProps } from &#39;react-router-dom&#39;;</span>
<span class="line">import actions from &#39;@/store/actions/home&#39;;</span>
<span class="line">import HomeHeader from &#39;./components/HomeHeader&#39;;</span>
<span class="line">import { CombinedState } from &#39;@/store/reducers&#39;;</span>
<span class="line">import { HomeState } from &#39;@/store/reducers/home&#39;;</span>
<span class="line">import HomeSliders from &#39;./components/HomeSliders&#39;;</span>
<span class="line">import &#39;./index.less&#39;;</span>
<span class="line">type StateProps = ReturnType&lt;typeof mapStateToProps&gt;;</span>
<span class="line">type DispatchProps = typeof actions;</span>
<span class="line">interface Params { }</span>
<span class="line">type Props = PropsWithChildren&lt;RouteComponentProps&lt;Params&gt; &amp; StateProps &amp; DispatchProps&gt;;</span>
<span class="line">function Home(props: Props) {</span>
<span class="line">+    const homeContainerRef = useRef(null);</span>
<span class="line">    return (</span>
<span class="line">        &lt;&gt;</span>
<span class="line">            &lt;HomeHeader</span>
<span class="line">                currentCategory={props.currentCategory}</span>
<span class="line">                setCurrentCategory={props.setCurrentCategory}</span>
<span class="line">                 refreshLessons={props.refreshLessons}</span>
<span class="line">            /&gt;</span>
<span class="line">+            &lt;div className=&quot;home-container&quot; ref={homeContainerRef}&gt;</span>
<span class="line">+                &lt;HomeSliders</span>
<span class="line">+                    sliders={props.sliders}</span>
<span class="line">+                    getSliders={props.getSliders} /&gt;</span>
<span class="line">+            &lt;/div&gt;</span>
<span class="line">        &lt;/&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">let mapStateToProps = (state: CombinedState): HomeState =&gt; state.home;</span>
<span class="line">export default connect(</span>
<span class="line">    mapStateToProps,</span>
<span class="line">    actions</span>
<span class="line">)(Home);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-课程列表" tabindex="-1"><a class="header-anchor" href="#_8-课程列表"><span>8.课程列表</span></a></h2><ul><li>记住滚动条的位置</li></ul><h3 id="_8-1-src-api-home-tsx" tabindex="-1"><a class="header-anchor" href="#_8-1-src-api-home-tsx"><span>8.1 src\\api\\home.tsx</span></a></h3><p>src\\api\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import axios from &#39;./index&#39;;</span>
<span class="line">export function getSliders() {</span>
<span class="line">    return axios.get(&#39;/slider/list&#39;);</span>
<span class="line">}</span>
<span class="line">+export function getLessons(currentCategory: string = &#39;all&#39;, offset: number, limit: number) {</span>
<span class="line">+    return axios.get(\`/lesson/list?category=\${currentCategory}&amp;offset=\${offset}&amp;limit=\${limit}\`);</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-src-store-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_8-2-src-store-action-types-tsx"><span>8.2 src\\store\\action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const SET_CURRENT_CATEGORY = &#39;SET_CURRENT_CATEGORY&#39;;</span>
<span class="line"></span>
<span class="line">export const VALIDATE = &#39;VALIDATE&#39;;</span>
<span class="line">export const LOGOUT = &#39;LOGOUT&#39;;</span>
<span class="line"></span>
<span class="line">export const CHANGE_AVATAR = &#39;CHANGE_AVATAR&#39;;</span>
<span class="line"></span>
<span class="line">+export const GET_SLIDERS = &#39;GET_SLIDERS&#39;;</span>
<span class="line"></span>
<span class="line">+export const GET_LESSONS = &#39;GET_LESSONS&#39;;</span>
<span class="line">+export const SET_LESSONS_LOADING = &#39;SET_LESSONS_LOADING&#39;;</span>
<span class="line">+export const SET_LESSONS = &#39;SET_LESSONS&#39;;</span>
<span class="line">+export const REFRESH_LESSONS = &#39;REFRESH_LESSONS&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-typings-lesson-tsx" tabindex="-1"><a class="header-anchor" href="#_8-3-typings-lesson-tsx"><span>8.3 typings\\lesson.tsx</span></a></h3><p>src\\typings\\lesson.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Lesson</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">id</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">title</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">video</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">poster</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">url</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">price</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">category</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">LessonResult</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">data</span><span class="token operator">:</span> Lesson<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">success</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-4-reducers-home-tsx" tabindex="-1"><a class="header-anchor" href="#_8-4-reducers-home-tsx"><span>8.4 reducers\\home.tsx</span></a></h3><p>src\\store\\reducers\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { AnyAction } from &#39;redux&#39;;</span>
<span class="line">import * as TYPES from &quot;../action-types&quot;;</span>
<span class="line">import Slider from &#39;@/typings/slider&#39;;</span>
<span class="line">import Lesson from &#39;@/typings/Lesson&#39;;</span>
<span class="line">+export interface Lesson {</span>
<span class="line">+    id: string;</span>
<span class="line">+    title: string;</span>
<span class="line">+    video: string;</span>
<span class="line">+    poster: string;</span>
<span class="line">+    url: string;</span>
<span class="line">+    price: string;</span>
<span class="line">+    category: string;</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">+export interface Lessons {</span>
<span class="line">+    loading: boolean;</span>
<span class="line">+    list: Lesson[];</span>
<span class="line">+    hasMore: boolean;</span>
<span class="line">+    offset: number;</span>
<span class="line">+    limit: number;</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">export interface HomeState {</span>
<span class="line">    currentCategory: string;</span>
<span class="line">    sliders: Slider[];</span>
<span class="line">+    lessons: Lessons;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">let initialState: HomeState = {</span>
<span class="line">    currentCategory: &#39;all&#39;,</span>
<span class="line">    sliders: [],</span>
<span class="line">+    lessons: {</span>
<span class="line">+        loading: false,</span>
<span class="line">+        list: [],</span>
<span class="line">+        hasMore: true,</span>
<span class="line">+        offset: 0,</span>
<span class="line">+        limit: 5</span>
<span class="line">+    }</span>
<span class="line">};</span>
<span class="line">export default function (state: HomeState = initialState, action: AnyAction): HomeState {</span>
<span class="line">    switch (action.type) {</span>
<span class="line">        case TYPES.SET_CURRENT_CATEGORY:</span>
<span class="line">            return { ...state, currentCategory: action.payload };</span>
<span class="line">        case TYPES.GET_SLIDERS:</span>
<span class="line">            return { ...state, sliders: action.payload.data };</span>
<span class="line">+        case TYPES.SET_LESSONS_LOADING:</span>
<span class="line">+            state.lessons.loading = action.payload;</span>
<span class="line">+            return state;</span>
<span class="line">+        case TYPES.SET_LESSONS:</span>
<span class="line">+            state.lessons.loading = false;</span>
<span class="line">+            state.lessons.hasMore = action.payload.hasMore;</span>
<span class="line">+            state.lessons.list = [...state.lessons.list, ...action.payload.list];</span>
<span class="line">+            state.lessons.offset = state.lessons.offset + action.payload.list.length;</span>
<span class="line">+            return state;</span>
<span class="line">+        case TYPES.REFRESH_LESSONS:</span>
<span class="line">+            state.lessons.loading = false;</span>
<span class="line">+            state.lessons.hasMore = action.payload.hasMore;</span>
<span class="line">+            state.lessons.list = action.payload.list;</span>
<span class="line">+            state.lessons.offset = action.payload.list.length;</span>
<span class="line">+            return state;</span>
<span class="line">        default:</span>
<span class="line">            return state;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-5-actions-home-tsx" tabindex="-1"><a class="header-anchor" href="#_8-5-actions-home-tsx"><span>8.5 actions\\home.tsx</span></a></h3><p>src\\store\\actions\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as TYPES from &#39;../action-types&#39;;</span>
<span class="line">+import { getSliders, getLessons } from &#39;@/api/home&#39;;</span>
<span class="line">export default {</span>
<span class="line">    setCurrentCategory(currentCategory: string) {</span>
<span class="line">        return { type: TYPES.SET_CURRENT_CATEGORY, payload: currentCategory };</span>
<span class="line">    },</span>
<span class="line">    getSliders() {</span>
<span class="line">        return {</span>
<span class="line">            type: TYPES.GET_SLIDERS,</span>
<span class="line">            payload: getSliders()</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">+    getLessons() {</span>
<span class="line">+        return (dispatch: any, getState: any) =&gt; {</span>
<span class="line">+            (async function () {</span>
<span class="line">+                let { currentCategory, lessons: { hasMore, offset, limit, loading } } = getState().home;</span>
<span class="line">+                if (hasMore &amp;&amp; !loading) {</span>
<span class="line">+                    dispatch({ type: TYPES.SET_LESSONS_LOADING, payload: true });</span>
<span class="line">+                    let result = await getLessons(currentCategory, offset, limit);</span>
<span class="line">+                    dispatch({ type: TYPES.SET_LESSONS, payload: result.data });</span>
<span class="line">+                }</span>
<span class="line">+            })();</span>
<span class="line">+        }</span>
<span class="line">+    },</span>
<span class="line">+    refreshLessons() {</span>
<span class="line">+        return (dispatch: any, getState: any) =&gt; {</span>
<span class="line">+            (async function () {</span>
<span class="line">+                let { currentCategory, lessons: { limit, loading } } = getState().home;</span>
<span class="line">+                if (!loading) {</span>
<span class="line">+                    dispatch({ type: TYPES.SET_LESSONS_LOADING, payload: true });</span>
<span class="line">+                    let result = await getLessons(currentCategory, 0, limit);</span>
<span class="line">+                    dispatch({ type: TYPES.REFRESH_LESSONS, payload: result.data });</span>
<span class="line">+                }</span>
<span class="line">+            })();</span>
<span class="line">+        }</span>
<span class="line">+    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-6-src-utils-tsx" tabindex="-1"><a class="header-anchor" href="#_8-6-src-utils-tsx"><span>8.6 src\\utils.tsx</span></a></h3><p>src\\utils.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//ele 要实现此功能DOM对象 callback加载更多的方法</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">loadMore</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">element</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">_loadMore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> clientHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> scrollTop <span class="token operator">=</span> element<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> scrollHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>clientHeight <span class="token operator">+</span> scrollTop <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">&gt;=</span> scrollHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;scroll&quot;</span><span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span>_loadMore<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">downRefresh</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">element</span><span class="token operator">:</span> HTMLDivElement<span class="token punctuation">,</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token literal-property property">startY</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">//变量，存储接下时候的纵坐标</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token literal-property property">distance</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">//本次下拉的距离</span></span>
<span class="line">  <span class="token keyword">let</span> originalTop <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span> <span class="token comment">//最初此元素距离顶部的距离 top=50</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token literal-property property">startTop</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token literal-property property">$timer</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchstart&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> TouchEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>$timer<span class="token punctuation">)</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>$timer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> touchMove <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span>_touchMove<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//只有当此元素处于原始位置才能下拉，如果处于回弹的过程则不能拉了.并且此元素向上卷去的高度==0</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>scrollTop <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      startTop <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span></span>
<span class="line">      startY <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageY<span class="token punctuation">;</span> <span class="token comment">//记录当前点击的纵坐标</span></span>
<span class="line">      element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchmove&quot;</span><span class="token punctuation">,</span> touchMove<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchend&quot;</span><span class="token punctuation">,</span> touchEnd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">_touchMove</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">event</span><span class="token operator">:</span> TouchEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> pageY <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageY<span class="token punctuation">;</span> <span class="token comment">//拿到最新的纵坐标</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>pageY <span class="token operator">&gt;</span> startY<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        distance <span class="token operator">=</span> pageY <span class="token operator">-</span> startY<span class="token punctuation">;</span></span>
<span class="line">        element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> startTop <span class="token operator">+</span> distance <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchmove&quot;</span><span class="token punctuation">,</span> touchMove<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchend&quot;</span><span class="token punctuation">,</span> touchEnd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">touchEnd</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_event</span><span class="token operator">:</span> TouchEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchmove&quot;</span><span class="token punctuation">,</span> touchMove<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchend&quot;</span><span class="token punctuation">,</span> touchEnd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      $timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> currentTop <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentTop <span class="token operator">-</span> originalTop <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> currentTop <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">          element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> originalTop <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">fn</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">wait</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> <span class="token literal-property property">timeout</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">func</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">delay</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> prev <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> prev <span class="token operator">&gt;=</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      prev <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">val</span><span class="token operator">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token operator">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-7-lessonlist-index-tsx" tabindex="-1"><a class="header-anchor" href="#_8-7-lessonlist-index-tsx"><span>8.7 LessonList\\index.tsx</span></a></h3><p>src\\routes\\Home\\components\\LessonList\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> forwardRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Icon<span class="token punctuation">,</span> Card<span class="token punctuation">,</span> Skeleton<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Alert <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/lesson&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span></span>
<span class="line">  children<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line">  lessons<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line">  getLessons<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line">  container<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">LessonList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props<span class="token punctuation">,</span> <span class="token literal-property property">lessonListRef</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>_<span class="token punctuation">,</span> forceUpdate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>lessons<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      props<span class="token punctuation">.</span><span class="token function">getLessons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    lessonListRef<span class="token punctuation">.</span><span class="token function-variable function">current</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> rem <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>container<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> scrollTop <span class="token operator">=</span> props<span class="token punctuation">.</span>container<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//slider=160px h1 50 = 210/50=4.2</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">-</span> <span class="token number">4.2</span> <span class="token operator">*</span> rem <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      start <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>scrollTop <span class="token operator">-</span> <span class="token number">4.2</span> <span class="token operator">*</span> rem<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">6.5</span> <span class="token operator">*</span> rem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6.5*50=325</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span>section className<span class="token operator">=</span><span class="token string">&quot;lesson-list&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;menu&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        全部课程</span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Skeleton</span>
<span class="line">        loading<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>lessons<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> props<span class="token punctuation">.</span>lessons<span class="token punctuation">.</span>loading<span class="token punctuation">}</span></span>
<span class="line">        active</span>
<span class="line">        paragraph<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">rows</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">{</span>props<span class="token punctuation">.</span>lessons<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">lesson</span><span class="token operator">:</span> Lesson<span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">          index <span class="token operator">&gt;=</span> start <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;</span> start <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">?</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>Link</span>
<span class="line">              key<span class="token operator">=</span><span class="token punctuation">{</span>lesson<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>
<span class="line">              to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/detail/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>lesson<span class="token punctuation">.</span>_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> lesson <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span>Card</span>
<span class="line">                hoverable<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span>
<span class="line">                style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&quot;100%&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">                cover<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>img alt<span class="token operator">=</span><span class="token punctuation">{</span>lesson<span class="token punctuation">.</span>title<span class="token punctuation">}</span> src<span class="token operator">=</span><span class="token punctuation">{</span>lesson<span class="token punctuation">.</span>poster<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">              <span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Card<span class="token punctuation">.</span>Meta</span>
<span class="line">                  title<span class="token operator">=</span><span class="token punctuation">{</span>lesson<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span>
<span class="line">                  description<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">价格: ¥</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>lesson<span class="token punctuation">.</span>price<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">元</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span></span>
<span class="line">                <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token number">6.5</span> <span class="token operator">*</span> rem<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">{</span>props<span class="token punctuation">.</span>lessons<span class="token punctuation">.</span>hasMore <span class="token operator">?</span> <span class="token punctuation">(</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button</span>
<span class="line">            onClick<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>getLessons<span class="token punctuation">}</span></span>
<span class="line">            loading<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>lessons<span class="token punctuation">.</span>loading<span class="token punctuation">}</span></span>
<span class="line">            type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span></span>
<span class="line">            block</span>
<span class="line">          <span class="token operator">&gt;</span></span>
<span class="line">            <span class="token punctuation">{</span>props<span class="token punctuation">.</span>lessons<span class="token punctuation">.</span>loading <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;加载更多&quot;</span><span class="token punctuation">}</span></span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span></span>
<span class="line">          <span class="token operator">&lt;</span>Alert</span>
<span class="line">            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">            message<span class="token operator">=</span><span class="token string">&quot;到底了&quot;</span></span>
<span class="line">            type<span class="token operator">=</span><span class="token string">&quot;warning&quot;</span></span>
<span class="line">          <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Skeleton<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span>LessonList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>src\\routes\\Home\\components\\LessonList\\index.less</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">.</span>lesson<span class="token operator">-</span>list <span class="token punctuation">{</span></span>
<span class="line">  h2 <span class="token punctuation">{</span></span>
<span class="line">    line<span class="token operator">-</span>height<span class="token operator">:</span> 1rem<span class="token punctuation">;</span></span>
<span class="line">    i <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">.</span>1rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">.</span>ant<span class="token operator">-</span>card<span class="token punctuation">.</span>ant<span class="token operator">-</span>card<span class="token operator">-</span>bordered<span class="token punctuation">.</span>ant<span class="token operator">-</span>card<span class="token operator">-</span>hoverable <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">.</span>5rem<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">overflow</span><span class="token operator">:</span> hidden<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-8-routes-home-index-tsx" tabindex="-1"><a class="header-anchor" href="#_8-8-routes-home-index-tsx"><span>8.8 routes\\Home\\index.tsx</span></a></h3><p>src\\routes\\Home\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import React, { PropsWithChildren, useRef, useEffect } from &#39;react&#39;;</span>
<span class="line">import { connect } from &#39;react-redux&#39;;</span>
<span class="line">import { RouteComponentProps } from &#39;react-router-dom&#39;;</span>
<span class="line">import actions from &#39;@/store/actions/home&#39;;</span>
<span class="line">import HomeHeader from &#39;./components/HomeHeader&#39;;</span>
<span class="line">import { CombinedState } from &#39;@/store/reducers&#39;;</span>
<span class="line">import { HomeState } from &#39;@/store/reducers/home&#39;;</span>
<span class="line">import HomeSliders from &#39;./components/HomeSliders&#39;;</span>
<span class="line">import &#39;./index.less&#39;;</span>
<span class="line">+import LessonList from &#39;./components/LessonList&#39;;</span>
<span class="line">+import { loadMore, downReferesh,store } from &#39;@/utils&#39;;</span>
<span class="line">type StateProps = ReturnType&lt;typeof mapStateToProps&gt;;</span>
<span class="line">type DispatchProps = typeof actions;</span>
<span class="line">interface Params { }</span>
<span class="line">type Props = PropsWithChildren&lt;RouteComponentProps&lt;Params&gt; &amp; StateProps &amp; DispatchProps&gt;;</span>
<span class="line">function Home(props: Props) {</span>
<span class="line">    const homeContainerRef = useRef(null);</span>
<span class="line">+    const lessonListRef = useRef(null);</span>
<span class="line">+    useEffect(() =&gt; {</span>
<span class="line">+        loadMore(homeContainerRef.current, props.getLessons);</span>
<span class="line">+        downReferesh(homeContainerRef.current, props.refreshLessons);</span>
<span class="line">+        homeContainerRef.current.addEventListener(&#39;scroll&#39;, () =&gt; {</span>
<span class="line">+            lessonListRef.current();</span>
<span class="line">+        });</span>
<span class="line">+       if (props.lessons) {</span>
<span class="line">+            homeContainerRef.current.scrollTop = store.get(&#39;homeScrollTop&#39;);</span>
<span class="line">+        }</span>
<span class="line">+        return () =&gt; {</span>
<span class="line">+            store.set(&#39;homeScrollTop&#39;, homeContainerRef.current.scrollTop);</span>
<span class="line">+        }</span>
<span class="line">+    }, []);</span>
<span class="line">    return (</span>
<span class="line">        &lt;&gt;</span>
<span class="line">            &lt;HomeHeader</span>
<span class="line">                currentCategory={props.currentCategory}</span>
<span class="line">                setCurrentCategory={props.setCurrentCategory}</span>
<span class="line">                refreshLessons={props.refreshLessons}</span>
<span class="line">            /&gt;</span>
<span class="line">            &lt;div className=&quot;home-container&quot; ref={homeContainerRef}&gt;</span>
<span class="line">                &lt;HomeSliders</span>
<span class="line">                    sliders={props.sliders}</span>
<span class="line">                    getSliders={props.getSliders} /&gt;</span>
<span class="line">+                &lt;LessonList</span>
<span class="line">+                    ref={lessonListRef}</span>
<span class="line">+                    container={homeContainerRef}</span>
<span class="line">+                    lessons={props.lessons}</span>
<span class="line">+                    getLessons={props.getLessons} /&gt;</span>
<span class="line">            &lt;/div&gt;</span>
<span class="line">        &lt;/&gt;</span>
<span class="line">    )</span>
<span class="line">}</span>
<span class="line">let mapStateToProps = (state: CombinedState): HomeState =&gt; state.home;</span>
<span class="line">export default connect(</span>
<span class="line">    mapStateToProps,</span>
<span class="line">    actions</span>
<span class="line">)(Home);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-9-routes-home-index-less" tabindex="-1"><a class="header-anchor" href="#_8-9-routes-home-index-less"><span>8.9 routes\\Home\\index.less</span></a></h3><p>src\\routes\\Home\\index.less</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+.home-container{</span>
<span class="line">+    position: fixed;</span>
<span class="line">+    top:1rem;</span>
<span class="line">+    left:0;</span>
<span class="line">+    width:100%;</span>
<span class="line">+    overflow-y: auto;</span>
<span class="line">+    height:calc(100vh - 2.22rem);</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-详情页" tabindex="-1"><a class="header-anchor" href="#_9-详情页"><span>9.详情页</span></a></h2><h3 id="_9-1-src-index-tsx" tabindex="-1"><a class="header-anchor" href="#_9-1-src-index-tsx"><span>9.1 src\\index.tsx</span></a></h3><p>src\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React from &quot;react&quot;;</span>
<span class="line">import ReactDOM from &quot;react-dom&quot;;</span>
<span class="line">import { Switch, Route, Redirect } from &quot;react-router-dom&quot;;</span>
<span class="line">import { Provider } from &quot;react-redux&quot;;</span>
<span class="line">import store from &quot;./store&quot;;</span>
<span class="line">import { ConfigProvider } from &quot;antd&quot;;</span>
<span class="line">import zh_CN from &quot;antd/lib/locale-provider/zh_CN&quot;;</span>
<span class="line">import &quot;./assets/css/common.less&quot;;</span>
<span class="line">import Tabs from &quot;./components/Tabs&quot;;</span>
<span class="line">import Home from &quot;./routes/Home&quot;;</span>
<span class="line">import Mine from &quot;./routes/Mine&quot;;</span>
<span class="line">import Profile from &quot;./routes/Profile&quot;;</span>
<span class="line">import Register from &quot;./routes/Register&quot;;</span>
<span class="line">import Login from &quot;./routes/Login&quot;;</span>
<span class="line">+import Detail from &quot;./routes/Detail&quot;;</span>
<span class="line">import { ConnectedRouter } from &#39;connected-react-router&#39;;</span>
<span class="line">import history from &#39;./store/history&#39;;</span>
<span class="line">ReactDOM.render(</span>
<span class="line">    &lt;Provider store={store}&gt;</span>
<span class="line">        &lt;ConnectedRouter history={history}&gt;</span>
<span class="line">            &lt;ConfigProvider locale={zh_CN}&gt;</span>
<span class="line">                &lt;main className=&quot;main-container&quot;&gt;</span>
<span class="line">                    &lt;Switch&gt;</span>
<span class="line">                        &lt;Route path=&quot;/&quot; exact component={Home} /&gt;</span>
<span class="line">                        &lt;Route path=&quot;/mine&quot; component={Mine} /&gt;</span>
<span class="line">                        &lt;Route path=&quot;/profile&quot; component={Profile} /&gt;</span>
<span class="line">                        &lt;Route path=&quot;/register&quot; component={Register} /&gt;</span>
<span class="line">                        &lt;Route path=&quot;/login&quot; component={Login} /&gt;</span>
<span class="line">+                        &lt;Route path=&quot;/detail/:id&quot; component={Detail} /&gt;</span>
<span class="line">                        &lt;Redirect to=&quot;/&quot; /&gt;</span>
<span class="line">                    &lt;/Switch&gt;</span>
<span class="line">                &lt;/main&gt;</span>
<span class="line">                &lt;Tabs /&gt;</span>
<span class="line">            &lt;/ConfigProvider&gt;</span>
<span class="line">        &lt;/ConnectedRouter&gt;</span>
<span class="line">    &lt;/Provider&gt;,</span>
<span class="line">    document.getElementById(&quot;root&quot;)</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-src-api-home-tsx" tabindex="-1"><a class="header-anchor" href="#_9-2-src-api-home-tsx"><span>9.2 src\\api\\home.tsx</span></a></h3><p>src\\api\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import axios from &#39;./index&#39;;</span>
<span class="line">export function getSliders() {</span>
<span class="line">    return axios.get(&#39;/slider/list&#39;);</span>
<span class="line">}</span>
<span class="line">export function getLessons(currentCategory: string = &#39;all&#39;, offset: number, limit: number) {</span>
<span class="line">    return axios.get(\`/lesson/list?category=\${currentCategory}&amp;offset=\${offset}&amp;limit=\${limit}\`);</span>
<span class="line">}</span>
<span class="line">+export function getLesson&lt;T&gt;(id: string) {</span>
<span class="line">+    return axios.get&lt;T, T&gt;(\`/lesson/\${id}\`);</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-typings-lesson-tsx" tabindex="-1"><a class="header-anchor" href="#_9-3-typings-lesson-tsx"><span>9.3 typings\\lesson.tsx</span></a></h3><p>src\\typings\\lesson.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/lesson&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">LessonResult</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">data</span><span class="token operator">:</span> Lesson<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">success</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-4-routes-detail-index-tsx" tabindex="-1"><a class="header-anchor" href="#_9-4-routes-detail-index-tsx"><span>9.4 routes\\Detail\\index.tsx</span></a></h3><p>src\\routes\\Detail\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Card<span class="token punctuation">,</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> NavHeader <span class="token keyword">from</span> <span class="token string">&quot;@/components/NavHeader&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getLesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/api/home&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/typings/lesson&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> StaticContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> LessonResult <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/typings/lesson&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> Meta <span class="token punctuation">}</span> <span class="token operator">=</span> Card<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span>
<span class="line">type RouteProps <span class="token operator">=</span> RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token punctuation">,</span> StaticContext<span class="token punctuation">,</span> Lesson<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">type Props <span class="token operator">=</span> RouteProps <span class="token operator">&amp;</span> <span class="token punctuation">{</span></span>
<span class="line">    children<span class="token operator">?</span><span class="token operator">:</span> any</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Detail</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">[</span>lesson<span class="token punctuation">,</span> setLesson<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>Lesson<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Lesson<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> <span class="token literal-property property">lesson</span><span class="token operator">:</span> Lesson <span class="token operator">=</span> props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>state<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lesson<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">let</span> id <span class="token operator">=</span> props<span class="token punctuation">.</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">let</span> <span class="token literal-property property">result</span><span class="token operator">:</span> LessonResult <span class="token operator">=</span> <span class="token keyword">await</span> getLesson<span class="token operator">&lt;</span>LessonResult<span class="token operator">&gt;</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success<span class="token punctuation">)</span></span>
<span class="line">                    lesson <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token function">setLesson</span><span class="token punctuation">(</span>lesson<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>NavHeader history<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span>课程详情<span class="token operator">&lt;</span><span class="token operator">/</span>NavHeader<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>Card</span>
<span class="line">                hoverable</span>
<span class="line">                </span>
<span class="line">                cover<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>video src<span class="token operator">=</span><span class="token punctuation">{</span>lesson<span class="token punctuation">.</span>video<span class="token punctuation">}</span> controls autoPlay<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>Meta title<span class="token operator">=</span><span class="token punctuation">{</span>lesson<span class="token punctuation">.</span>title<span class="token punctuation">}</span> description<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>价格<span class="token operator">:</span> <span class="token punctuation">{</span>lesson<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">(</span>Detail<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-购物车" tabindex="-1"><a class="header-anchor" href="#_10-购物车"><span>10.购物车</span></a></h2><h3 id="_10-1-src-index-tsx" tabindex="-1"><a class="header-anchor" href="#_10-1-src-index-tsx"><span>10.1 src\\index.tsx</span></a></h3><p>src\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React from &quot;react&quot;;</span>
<span class="line">import ReactDOM from &quot;react-dom&quot;;</span>
<span class="line">import { Switch, Route, Redirect } from &quot;react-router-dom&quot;;</span>
<span class="line">import { Provider } from &quot;react-redux&quot;;</span>
<span class="line">import { store, persistor } from &quot;./store&quot;;</span>
<span class="line">import { ConfigProvider ,Spin} from &quot;antd&quot;;</span>
<span class="line">import zh_CN from &quot;antd/lib/locale-provider/zh_CN&quot;;</span>
<span class="line">import &quot;./assets/css/common.less&quot;;</span>
<span class="line">import Tabs from &quot;./components/Tabs&quot;;</span>
<span class="line">import Home from &quot;./routes/Home&quot;;</span>
<span class="line">import Mine from &quot;./routes/Mine&quot;;</span>
<span class="line">+import Cart from &quot;./routes/Cart&quot;;</span>
<span class="line">import Profile from &quot;./routes/Profile&quot;;</span>
<span class="line">import Register from &quot;./routes/Register&quot;;</span>
<span class="line">import Login from &quot;./routes/Login&quot;;</span>
<span class="line">import Detail from &quot;./routes/Detail&quot;;</span>
<span class="line">import { ConnectedRouter } from &#39;connected-react-router&#39;;</span>
<span class="line">+import { PersistGate } from &#39;redux-persist/integration/react&#39;</span>
<span class="line">import history from &#39;./store/history&#39;;</span>
<span class="line">ReactDOM.render(</span>
<span class="line">    &lt;Provider store={store}&gt;</span>
<span class="line">+        &lt;PersistGate loading={null} persistor={persistor}&gt;</span>
<span class="line">            &lt;ConnectedRouter history={history}&gt;</span>
<span class="line">                &lt;ConfigProvider locale={zh_CN}&gt;</span>
<span class="line">                    &lt;main className=&quot;main-container&quot;&gt;</span>
<span class="line">                       &lt;div style={{ textAlign: &#39;center&#39;, padding: &#39;20px&#39; }} &gt;</span>
<span class="line">                        &lt;Spin size=&quot;large&quot; /&gt;</span>
<span class="line">                       &lt;/div&gt;</span>
<span class="line">                        &lt;Switch&gt;</span>
<span class="line">                            &lt;Route path=&quot;/&quot; exact component={Home} /&gt;</span>
<span class="line">+                           &lt;Route path=&quot;/cart&quot; component={Cart} /&gt;</span>
<span class="line">                            &lt;Route path=&quot;/profile&quot; component={Profile} /&gt;</span>
<span class="line">                            &lt;Route path=&quot;/register&quot; component={Register} /&gt;</span>
<span class="line">                            &lt;Route path=&quot;/login&quot; component={Login} /&gt;</span>
<span class="line">                            &lt;Route path=&quot;/detail/:id&quot; component={Detail} /&gt;</span>
<span class="line">                            &lt;Redirect to=&quot;/&quot; /&gt;</span>
<span class="line">                        &lt;/Switch&gt;</span>
<span class="line">                    &lt;/main&gt;</span>
<span class="line">                    &lt;Tabs /&gt;</span>
<span class="line">                &lt;/ConfigProvider&gt;</span>
<span class="line">            &lt;/ConnectedRouter&gt;</span>
<span class="line">+        &lt;/PersistGate&gt;</span>
<span class="line">    &lt;/Provider&gt;,</span>
<span class="line">    document.getElementById(&quot;root&quot;)</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-2-src-routes-detail-index-tsx" tabindex="-1"><a class="header-anchor" href="#_10-2-src-routes-detail-index-tsx"><span>10.2 src\\routes\\Detail\\index.tsx</span></a></h3><p>src\\routes\\Detail\\index.tsx</p><pre><code>import React, { useState, useEffect, PropsWithChildren } from &#39;react&#39;;
import { connect } from &#39;react-redux&#39;;
import { Card, Button, Icon } from &#39;antd&#39;;
import NavHeader from &quot;@/components/NavHeader&quot;;
import { getLesson } from &#39;@/api/home&#39;;
import { RouteComponentProps } from &#39;react-router&#39;;
import { Lesson } from &#39;@/typings/lesson&#39;;
import { StaticContext } from &#39;react-router&#39;;
import { LessonResult } from &#39;@/typings/lesson&#39;;
import actions from &#39;@/store/actions/cart&#39;;
import { CombinedState } from &#39;@/store/reducers&#39;;

import &#39;./index.less&#39;;
const { Meta } = Card;
interface Params { id: string }
+type RouteProps = RouteComponentProps&lt;Params, StaticContext, Lesson&gt;;
+type StateProps = ReturnType&lt;typeof mapStateToProps&gt;;
+type DispatchProps = typeof actions;
+type Props = PropsWithChildren&lt;RouteProps &amp; StateProps &amp; DispatchProps&gt;;
function Detail(props: Props) {
    let [lesson, setLesson] = useState&lt;Lesson&gt;({} as Lesson);
    useEffect(() =&gt; {
        (async () =&gt; {
            let lesson: Lesson = props.location.state;
            if (!lesson) {
                let id = props.match.params.id;
                let result: LessonResult = await getLesson&lt;LessonResult&gt;(id);
                if (result.success)
                    lesson = result.data;
            }
            setLesson(lesson);
        })();
    }, []);
+    const addCartItem = (lesson: Lesson) =&gt; {
+        //https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect
 +        let video: HTMLVideoElement = document.querySelector(&#39;
+
+        let cart: HTMLSpanElement = document.querySelector(&#39;.anticon.anticon-solution&#39;);

+        let clonedVideo: HTMLVideoElement = video.cloneNode(true) as HTMLVideoElement;
+        let videoWith = video.offsetWidth;
+        let videoHeight = video.offsetHeight;
+        let cartWith = cart.offsetWidth;
+        let cartHeight = cart.offsetHeight;
+        let videoLeft = video.getBoundingClientRect().left;
+        let videoTop = video.getBoundingClientRect().top;
+        let cartRight = cart.getBoundingClientRect().right;
+        let cartBottom = cart.getBoundingClientRect().bottom;
+        clonedVideo.style.cssText = \`
+          z-index: 1000;
+          opacity:0.8;
+          position:fixed;
+          width:\${videoWith}px;
+          height:\${videoHeight}px;
+          top:\${videoTop}px;
+          left:\${videoLeft}px;
+          transition: all 2s ease-in-out;
+        \`;
+        document.body.appendChild(clonedVideo);
+        setTimeout(function () {
+            clonedVideo.style.left = (cartRight - (cartWith / 2)) + &#39;px&#39;;
+            clonedVideo.style.top = (cartBottom - (cartHeight / 2)) + &#39;px&#39;;
+            clonedVideo.style.width = \`0px\`;
+            clonedVideo.style.height = \`0px\`;
+            clonedVideo.style.opacity = &#39;50&#39;;
+        }, 0);
+        props.addCartItem(lesson);
+    }
    return (
        &lt;&gt;
            &lt;NavHeader history={props.history}&gt;课程详情&lt;/NavHeader&gt;
            &lt;Card
                hoverable
                
+                /*  cover={&lt;video id=&quot;lesson-video&quot; src={lesson.video} controls autoPlay={false} /&gt;} */
+                cover={&lt;img id=&quot;lesson-video&quot; src={lesson.poster} /&gt;}
            &gt;
+                &lt;Meta title={lesson.title} description={
+                    &lt;&gt;
+                        &lt;p&gt;价格: ¥{lesson.price}元&lt;/p&gt;
+                        &lt;p&gt;
+                            &lt;Button
+                                className=&quot;add-cart&quot;
+                                icon=&quot;shopping-cart&quot;
+                                onClick={() =&gt; addCartItem(lesson)}
+                            &gt;加入购物车&lt;/Button&gt;&lt;/p&gt;
+                    &lt;/&gt;
+                } /&gt;
+            &lt;/Card&gt;
        &lt;/&gt;
    )
}
+let mapStateToProps = (state: CombinedState): CombinedState =&gt; state;
export default connect(
+    mapStateToProps,
+    actions
)(Detail);

/**
  * https://cubic-bezier.com/
 * linear:cubic-bezier(0,0,1,1)             匀速运动
 * ease:cubic-bezier(0.25,0.1,0.25,1)       先慢后快再慢
 * ease-in:cubic-bezier(0.42,0,1,1)         先慢后快
 * ease-out:cubic-bezier(0,0,0.58,1)        先快后慢
 * ease-in-out:cubic-bezier(0.42,0,0.58,1)  先慢后快再慢
 */
\`\`

src\\routes\\Detail\\index.less

\`\`\`less
button.add-cart{
    &amp;:hover{
         background-color: 
         color:
    }
}
</code></pre><h3 id="_10-3-action-types-tsx" tabindex="-1"><a class="header-anchor" href="#_10-3-action-types-tsx"><span>10.3 action-types.tsx</span></a></h3><p>src\\store\\action-types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const SET_CURRENT_CATEGORY = &#39;SET_CURRENT_CATEGORY&#39;;</span>
<span class="line"></span>
<span class="line">export const VALIDATE = &#39;VALIDATE&#39;;</span>
<span class="line">export const LOGOUT = &#39;LOGOUT&#39;;</span>
<span class="line"></span>
<span class="line">export const CHANGE_AVATAR = &#39;CHANGE_AVATAR&#39;;</span>
<span class="line"></span>
<span class="line">export const GET_SLIDERS = &#39;GET_SLIDERS&#39;;</span>
<span class="line"></span>
<span class="line">export const GET_LESSONS = &#39;GET_LESSONS&#39;;</span>
<span class="line">export const SET_LESSONS_LOADING = &#39;SET_LESSONS_LOADING&#39;;</span>
<span class="line">export const SET_LESSONS = &#39;SET_LESSONS&#39;;</span>
<span class="line">+export const REFRESH_LESSONS = &#39;REFRESH_LESSONS&#39;;</span>
<span class="line"></span>
<span class="line">+export const ADD_CART_ITEM = &#39;ADD_CART_ITEM&#39;;//向购物车中增一个商品</span>
<span class="line">+export const REMOVE_CART_ITEM = &#39;REMOVE_CART_ITEM&#39;;//从购物车中删除一个商品</span>
<span class="line">+export const CLEAR_CART_ITEMS = &#39;CLEAR_CART_ITEMS&#39;;//清空购物车</span>
<span class="line"></span>
<span class="line">+export const CHANGE_CART_ITEM_COUNT = &#39;CHANGE_CART_ITEM_COUNT&#39;;//直接修改购物车商品的数量减1</span>
<span class="line"></span>
<span class="line">+export const CHANGE_CHECKED_CART_ITEMS = &#39;CHANGE_CHECKED_CART_ITEMS&#39;;//选中商品</span>
<span class="line">+export const SETTLE = &#39;SETTLE&#39;;//结算</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-src-store-index-tsx" tabindex="-1"><a class="header-anchor" href="#_10-4-src-store-index-tsx"><span>10.4 src\\store\\index.tsx</span></a></h3><p>src\\store\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createStore, applyMiddleware, Store, AnyAction, $CombinedState } from &#39;redux&#39;;</span>
<span class="line">import reducers, { CombinedState } from &#39;./reducers&#39;;</span>
<span class="line">import logger from &#39;redux-logger&#39;;</span>
<span class="line">import { Dispatch } from &#39;redux&#39;;</span>
<span class="line">import thunk, { ThunkDispatch } from &#39;redux-thunk&#39;;</span>
<span class="line">import promise from &#39;redux-promise&#39;;</span>
<span class="line">import { routerMiddleware } from &#39;connected-react-router&#39;;</span>
<span class="line">+import { persistStore, persistReducer } from &#39;redux-persist&#39;;</span>
<span class="line">+import storage from &#39;redux-persist/lib/storage&#39;;</span>
<span class="line">import history from &#39;./history&#39;;</span>
<span class="line">+const persistConfig = {</span>
<span class="line">+    key: &#39;root&#39;,</span>
<span class="line">+    storage,</span>
<span class="line">+    whitelist: [&#39;cart&#39;]</span>
<span class="line">+}</span>
<span class="line">+const persistedReducer = persistReducer(persistConfig, reducers)</span>
<span class="line">+let store: Store&lt;CombinedState, AnyAction&gt; = createStore&lt;CombinedState, AnyAction, {}, {}&gt;(persistedReducer, applyMiddleware(thunk, routerMiddleware(history), promise, logger));</span>
<span class="line">+let persistor = persistStore(store);</span>
<span class="line">+export type StoreGetState = () =&gt; CombinedState;</span>
<span class="line">+export type StoreDispatch = Dispatch &amp; ThunkDispatch&lt;CombinedState, any, AnyAction&gt;;</span>
<span class="line">+export { store, persistor };</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-actions-home-tsx" tabindex="-1"><a class="header-anchor" href="#_10-4-actions-home-tsx"><span>10.4 actions\\home.tsx</span></a></h3><p>src\\store\\actions\\home.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as TYPES from &#39;../action-types&#39;;</span>
<span class="line">import { getSliders, getLessons } from &#39;@/api/home&#39;;</span>
<span class="line">+import { StoreGetState, StoreDispatch } from &#39;../index&#39;;</span>
<span class="line">export default {</span>
<span class="line">    setCurrentCategory(currentCategory: string) {</span>
<span class="line">        return { type: TYPES.SET_CURRENT_CATEGORY, payload: currentCategory };</span>
<span class="line">    },</span>
<span class="line">    getSliders() {</span>
<span class="line">        return {</span>
<span class="line">            type: TYPES.GET_SLIDERS,</span>
<span class="line">            payload: getSliders()</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    getLessons() {</span>
<span class="line">+        return (dispatch: StoreDispatch, getState: StoreGetState) =&gt; {</span>
<span class="line">            (async function () {</span>
<span class="line">                let { currentCategory, lessons: { hasMore, offset, limit, loading } } = getState().home;</span>
<span class="line">                if (hasMore &amp;&amp; !loading) {</span>
<span class="line">                    dispatch({ type: TYPES.SET_LESSONS_LOADING, payload: true });</span>
<span class="line">                    let result = await getLessons(currentCategory, offset, limit);</span>
<span class="line">                    dispatch({ type: TYPES.SET_LESSONS, payload: result.data });</span>
<span class="line">                }</span>
<span class="line">            })();</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    refreshLessons() {</span>
<span class="line">+       return (dispatch: StoreDispatch, getState: StoreGetState) =&gt; {</span>
<span class="line">            (async function () {</span>
<span class="line">                let { currentCategory, lessons: { limit, loading } } = getState().home;</span>
<span class="line">                if (!loading) {</span>
<span class="line">                    dispatch({ type: TYPES.SET_LESSONS_LOADING, payload: true });</span>
<span class="line">                    let result = await getLessons(currentCategory, 0, limit);</span>
<span class="line">                    dispatch({ type: TYPES.REFRESH_LESSONS, payload: result.data });</span>
<span class="line">                }</span>
<span class="line">            })();</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-5-reducers-index-tsx" tabindex="-1"><a class="header-anchor" href="#_10-5-reducers-index-tsx"><span>10.5 reducers\\index.tsx</span></a></h3><p>src\\store\\reducers\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { combineReducers, ReducersMapObject, Reducer } from &#39;redux&#39;;</span>
<span class="line">import { connectRouter } from &#39;connected-react-router&#39;;</span>
<span class="line">import history from &#39;../history&#39;;</span>
<span class="line">import home from &#39;./home&#39;;</span>
<span class="line">import mime from &#39;./mime&#39;;</span>
<span class="line">+import cart from &#39;./cart&#39;;</span>
<span class="line">+import { combineReducers } from &#39;redux-immer&#39;;</span>
<span class="line">+import produce from &#39;immer&#39;;</span>
<span class="line">import profile from &#39;./profile&#39;;</span>
<span class="line">let reducers: ReducersMapObject = {</span>
<span class="line">    router: connectRouter(history),</span>
<span class="line">    home,</span>
<span class="line">    mime,</span>
<span class="line">+   cart,</span>
<span class="line">    profile,</span>
<span class="line">};</span>
<span class="line">type CombinedState = {</span>
<span class="line">    [key in keyof typeof reducers]: ReturnType&lt;typeof reducers[key]&gt;</span>
<span class="line">}</span>
<span class="line">+let reducer: Reducer&lt;CombinedState&gt; = combineReducers&lt;CombinedState&gt;(produce, reducers);</span>
<span class="line"></span>
<span class="line">export { CombinedState }</span>
<span class="line">export default reducer;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-6-typings-cart-tsx" tabindex="-1"><a class="header-anchor" href="#_10-6-typings-cart-tsx"><span>10.6 typings\\cart.tsx</span></a></h3><p>src\\typings\\cart.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./lesson&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CartItem</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">lesson</span><span class="token operator">:</span> Lesson<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">count</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">checked</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> type CartState <span class="token operator">=</span> CartItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-7-reducers-cart-tsx" tabindex="-1"><a class="header-anchor" href="#_10-7-reducers-cart-tsx"><span>10.7 reducers\\cart.tsx</span></a></h3><p>src\\store\\reducers\\cart.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CartState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/cart&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actionTypes <span class="token keyword">from</span> <span class="token string">&quot;@/store/action-types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">initialState</span><span class="token operator">:</span> CartState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">state</span><span class="token operator">:</span> CartState <span class="token operator">=</span> initialState<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">action</span><span class="token operator">:</span> AnyAction</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> CartState <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_CART_ITEM</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">let</span> oldIndex <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id</span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token operator">...</span>state<span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">checked</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">lesson</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> lesson <span class="token operator">=</span> state<span class="token punctuation">[</span>oldIndex<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> oldIndex<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span> <span class="token operator">...</span>lesson<span class="token punctuation">,</span> <span class="token literal-property property">count</span><span class="token operator">:</span> lesson<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>oldIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">REMOVE_CART_ITEM</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">let</span> removeIndex <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload</span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> removeIndex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>state<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>removeIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CLEAR_CART_ITEMS</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CHANGE_CART_ITEM_COUNT</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          item<span class="token punctuation">.</span>count <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>count<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> item<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CHANGE_CHECKED_CART_ITEMS</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">let</span> checkedIds <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>checkedIds<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          item<span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">          item<span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> item<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">SETTLE</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>checked<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">      <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-8-actions-cart-tsx" tabindex="-1"><a class="header-anchor" href="#_10-8-actions-cart-tsx"><span>10.8 actions\\cart.tsx</span></a></h3><p>src\\store\\actions\\cart.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actionTypes <span class="token keyword">from</span> <span class="token string">&quot;../action-types&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/lesson&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> push <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;connected-react-router&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> StoreGetState<span class="token punctuation">,</span> StoreDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../index&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">addCartItem</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">lesson</span><span class="token operator">:</span> Lesson</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dispatch</span><span class="token operator">:</span> StoreDispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD_CART_ITEM</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">payload</span><span class="token operator">:</span> lesson<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      message<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;添加课程成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">removeCartItem</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">REMOVE_CART_ITEM</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">payload</span><span class="token operator">:</span> id<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">clearCartItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CLEAR_CART_ITEMS</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">changeCartItemCount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">count</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CHANGE_CART_ITEM_COUNT</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        id<span class="token punctuation">,</span></span>
<span class="line">        count<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">changeCheckedCartItems</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">checkedIds</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">CHANGE_CHECKED_CART_ITEMS</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">payload</span><span class="token operator">:</span> checkedIds<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">settle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dispatch</span><span class="token operator">:</span> StoreDispatch<span class="token punctuation">,</span> <span class="token literal-property property">getState</span><span class="token operator">:</span> StoreGetState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> actionTypes<span class="token punctuation">.</span><span class="token constant">SETTLE</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-9-cart-index-tsx" tabindex="-1"><a class="header-anchor" href="#_10-9-cart-index-tsx"><span>10.9 Cart\\index.tsx</span></a></h3><p>src\\routes\\Cart\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PropsWithChildren<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteComponentProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span></span>
<span class="line">  Table<span class="token punctuation">,</span></span>
<span class="line">  Button<span class="token punctuation">,</span></span>
<span class="line">  InputNumber<span class="token punctuation">,</span></span>
<span class="line">  Popconfirm<span class="token punctuation">,</span></span>
<span class="line">  Icon<span class="token punctuation">,</span></span>
<span class="line">  Row<span class="token punctuation">,</span></span>
<span class="line">  Col<span class="token punctuation">,</span></span>
<span class="line">  Badge<span class="token punctuation">,</span></span>
<span class="line">  Modal<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/store/reducers&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> NavHeader <span class="token keyword">from</span> <span class="token string">&quot;@/components/NavHeader&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/lesson&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> StaticContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">&quot;@/store/actions/cart&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CartItem <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/typings/cart&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">id</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">type RouteProps <span class="token operator">=</span> RouteComponentProps<span class="token operator">&lt;</span>Params<span class="token punctuation">,</span> StaticContext<span class="token punctuation">,</span> Lesson<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">id</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">type StateProps <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> mapStateToProps<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">type DispatchProps <span class="token operator">=</span> <span class="token keyword">typeof</span> actions<span class="token punctuation">;</span></span>
<span class="line">type Props <span class="token operator">=</span> PropsWithChildren<span class="token operator">&lt;</span>RouteProps <span class="token operator">&amp;</span> StateProps <span class="token operator">&amp;</span> DispatchProps<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">Cart</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token punctuation">[</span>settleVisible<span class="token punctuation">,</span> setSettleVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">confirmSettle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setSettleVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">handleOk</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setSettleVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    props<span class="token punctuation">.</span><span class="token function">settle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">handleCancel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setSettleVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> columns <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;商品&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&quot;lesson&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">val</span><span class="token operator">:</span> Lesson<span class="token punctuation">,</span> <span class="token literal-property property">row</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>val<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>单价<span class="token operator">:</span><span class="token punctuation">{</span>val<span class="token punctuation">.</span>price<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;数量&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">dataIndex</span><span class="token operator">:</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">val</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">row</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>InputNumber</span>
<span class="line">          size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span></span>
<span class="line">          min<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line">          max<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span></span>
<span class="line">          value<span class="token operator">=</span><span class="token punctuation">{</span>val<span class="token punctuation">}</span></span>
<span class="line">          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span><span class="token function">changeCartItemCount</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;操作&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">val</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">row</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>Popconfirm</span>
<span class="line">          title<span class="token operator">=</span><span class="token string">&quot;是否要删除商品?&quot;</span></span>
<span class="line">          onConfirm<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span><span class="token function">removeCartItem</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">          okText<span class="token operator">=</span><span class="token string">&quot;是&quot;</span></span>
<span class="line">          cancelText<span class="token operator">=</span><span class="token string">&quot;否&quot;</span></span>
<span class="line">        <span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;danger&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">            删除</span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Popconfirm<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> rowSelection <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">selectedRowKeys</span><span class="token operator">:</span> props<span class="token punctuation">.</span>cart</span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>checked<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">selectedRowKeys</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      props<span class="token punctuation">.</span><span class="token function">changeCheckedCartItems</span><span class="token punctuation">(</span>selectedRowKeys<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token literal-property property">totalCount</span><span class="token operator">:</span> number <span class="token operator">=</span> props<span class="token punctuation">.</span>cart</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>checked<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">total</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">item</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> total <span class="token operator">+</span> item<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> totalPrice <span class="token operator">=</span> props<span class="token punctuation">.</span>cart</span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>checked<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">total</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">item</span><span class="token operator">:</span> CartItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">        total <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>price<span class="token punctuation">)</span> <span class="token operator">*</span> item<span class="token punctuation">.</span>count<span class="token punctuation">,</span></span>
<span class="line">      <span class="token number">0</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>NavHeader history<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span>购物车<span class="token operator">&lt;</span><span class="token operator">/</span>NavHeader<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Table</span>
<span class="line">        rowKey<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> row<span class="token punctuation">.</span>lesson<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>
<span class="line">        rowSelection<span class="token operator">=</span><span class="token punctuation">{</span>rowSelection<span class="token punctuation">}</span></span>
<span class="line">        columns<span class="token operator">=</span><span class="token punctuation">{</span>columns<span class="token punctuation">}</span></span>
<span class="line">        dataSource<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>cart<span class="token punctuation">}</span></span>
<span class="line">        pagination<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>
<span class="line">        size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span></span>
<span class="line">      <span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Row style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token string">&quot;5px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Col span<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;danger&quot;</span> size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>clearCartItems<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            清空</span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Col<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Col span<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          已经选择<span class="token punctuation">{</span>totalCount <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">&lt;</span>Badge count<span class="token operator">=</span><span class="token punctuation">{</span>totalCount<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span>件商品</span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Col<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Col span<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>总价<span class="token operator">:</span> ¥<span class="token punctuation">{</span>totalPrice<span class="token punctuation">}</span>元<span class="token operator">&lt;</span><span class="token operator">/</span>Col<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>Col span<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;danger&quot;</span> size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>confirmSettle<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            去结算</span>
<span class="line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Col<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Row<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>Modal</span>
<span class="line">        title<span class="token operator">=</span><span class="token string">&quot;去结算&quot;</span></span>
<span class="line">        visible<span class="token operator">=</span><span class="token punctuation">{</span>settleVisible<span class="token punctuation">}</span></span>
<span class="line">        onOk<span class="token operator">=</span><span class="token punctuation">{</span>handleOk<span class="token punctuation">}</span></span>
<span class="line">        onCancel<span class="token operator">=</span><span class="token punctuation">{</span>handleCancel<span class="token punctuation">}</span></span>
<span class="line">      <span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>请问你是否要结算<span class="token operator">?</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Modal<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> mapStateToProps <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> CombinedState<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">CombinedState</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> actions<span class="token punctuation">)</span><span class="token punctuation">(</span>Cart<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-项目初始化" tabindex="-1"><a class="header-anchor" href="#_1-项目初始化"><span>1.项目初始化</span></a></h2><h3 id="_1-1-生成项目" tabindex="-1"><a class="header-anchor" href="#_1-1-生成项目"><span>1.1 生成项目</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir server</span>
<span class="line">cd server</span>
<span class="line">cnpm init -y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-安装依赖-1" tabindex="-1"><a class="header-anchor" href="#_1-2-安装依赖-1"><span>1.2 安装依赖</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm i express mongoose body-parser bcryptjs jsonwebtoken morgan cors validator helmet dotenv multer -S</span>
<span class="line">cnpm i typescript  @types/node @types/express @types/mongoose @types/bcryptjs @types/jsonwebtoken  @types/morgan @types/cors @types/validator ts-node-dev nodemon  @types/helmet @types/multer -D</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">模块名</th><th style="text-align:left;">用途</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="https://www.npmjs.com/package/dotenv" target="_blank" rel="noopener noreferrer">dotenv</a></td><td style="text-align:left;">从<code>.env</code>加载到环境变量</td></tr></tbody></table><h3 id="_1-3-初始化-tsconfig-json" tabindex="-1"><a class="header-anchor" href="#_1-3-初始化-tsconfig-json"><span>1.3 初始化 tsconfig.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npx tsconfig.json</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-4-package-json" tabindex="-1"><a class="header-anchor" href="#_1-4-package-json"><span>1.4 package.json</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+  &quot;scripts&quot;: {</span>
<span class="line">+    &quot;build&quot;: &quot;tsc&quot;,</span>
<span class="line">+    &quot;start&quot;: &quot;cross-env PORT=8000  ts-node-dev --respawn src/index.ts&quot;,</span>
<span class="line">+    &quot;dev&quot;: &quot;cross-env PORT=8000 nodemon --exec ts-node --files src/index.ts&quot;</span>
<span class="line">+  }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-gitignore" tabindex="-1"><a class="header-anchor" href="#_1-5-gitignore"><span>1.5 .gitignore</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">node_modules</span>
<span class="line">src/public/upload/</span>
<span class="line">.env</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6-env" tabindex="-1"><a class="header-anchor" href="#_1-6-env"><span>1.6 .env</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token constant">JWT_SECRET_KEY</span><span class="token operator">=</span>zhufeng</span>
<span class="line"><span class="token constant">MONGODB_URL</span><span class="token operator">=</span>mongodb<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>zhufengketang</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-用户管理" tabindex="-1"><a class="header-anchor" href="#_2-用户管理"><span>2.用户管理</span></a></h2><h4 id="_2-1-src-index-ts" tabindex="-1"><a class="header-anchor" href="#_2-1-src-index-ts"><span>2.1 src/index.ts</span></a></h4><p>src/index.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> express<span class="token punctuation">,</span> <span class="token punctuation">{</span> Express<span class="token punctuation">,</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> mongoose <span class="token keyword">from</span> <span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> HttpException <span class="token keyword">from</span> <span class="token string">&quot;./exceptions/HttpException&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> cors <span class="token keyword">from</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> morgan <span class="token keyword">from</span> <span class="token string">&quot;morgan&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> helmet <span class="token keyword">from</span> <span class="token string">&quot;helmet&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> errorMiddleware <span class="token keyword">from</span> <span class="token string">&quot;./middlewares/errorMiddleware&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> userController <span class="token keyword">from</span> <span class="token string">&quot;./controller/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;dotenv/config&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> multer <span class="token keyword">from</span> <span class="token string">&quot;multer&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">destination</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;uploads&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">filename</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">file</span><span class="token operator">:</span> Express<span class="token punctuation">.</span>Multer<span class="token punctuation">.</span>File<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> storage <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">app</span><span class="token operator">:</span> Express <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;hello world&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/user/validate&quot;</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>validate<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/user/register&quot;</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>register<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token string">&quot;/user/uploadAvatar&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;avatar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  userController<span class="token punctuation">.</span>uploadAvatar</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">_res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token literal-property property">error</span><span class="token operator">:</span> HttpException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">&quot;Route not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>errorMiddleware<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">PORT</span><span class="token operator">:</span> number <span class="token operator">=</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">&amp;&amp;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">8000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mongoose<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;useNewUrlParser&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  mongoose<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;useUnifiedTopology&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://localhost/zhufengketang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Running on http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-src-exceptions-httpexception-ts" tabindex="-1"><a class="header-anchor" href="#_2-2-src-exceptions-httpexception-ts"><span>2.2 src/exceptions/HttpException.ts</span></a></h4><p>src/exceptions/HttpException.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">HttpException</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> <span class="token literal-property property">status</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token literal-property property">message</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token keyword">public</span> errors<span class="token operator">?</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> HttpException<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-src-middlewares-errormiddleware-ts" tabindex="-1"><a class="header-anchor" href="#_2-3-src-middlewares-errormiddleware-ts"><span>2.3 src/middlewares/errorMiddleware.ts</span></a></h4><p>src/middlewares/errorMiddleware.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> HttpException <span class="token keyword">from</span> <span class="token string">&quot;../exceptions/HttpException&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">INTERNAL_SERVER_ERROR</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;http-status-codes&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">errorMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">error</span><span class="token operator">:</span> HttpException<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">_request</span><span class="token operator">:</span> Request<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">response</span><span class="token operator">:</span> Response<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">_next</span><span class="token operator">:</span> NextFunction</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">message</span><span class="token operator">:</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">errors</span><span class="token operator">:</span> error<span class="token punctuation">.</span>errors<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> errorMiddleware<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-src-utils-validator-ts" tabindex="-1"><a class="header-anchor" href="#_2-4-src-utils-validator-ts"><span>2.4 src/utils/validator.ts</span></a></h4><p>src/utils/validator.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> validator <span class="token keyword">from</span> <span class="token string">&quot;validator&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> IUserDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RegisterInput</span> <span class="token keyword">extends</span> <span class="token class-name">Partial</span><span class="token operator">&lt;</span>IUserDocument<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  confirmPassword<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RegisterInputValidateResult</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">errors</span><span class="token operator">:</span> RegisterInput<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">valid</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> validateRegisterInput <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">password</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">confirmPassword</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">email</span><span class="token operator">:</span> string</span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">RegisterInputValidateResult</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token literal-property property">errors</span><span class="token operator">:</span> RegisterInput <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errors<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">&quot;用户名不能为空&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errors<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">&quot;密码不能为空&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>confirmPassword <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>confirmPassword<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errors<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">&quot;确认密码不能为空&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validator<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> confirmPassword<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errors<span class="token punctuation">.</span>confirmPassword <span class="token operator">=</span> <span class="token string">&quot;确认密码和密码不相等&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>email <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> validator<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errors<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&quot;邮箱不能为空&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>validator<span class="token punctuation">.</span><span class="token function">isEmail</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errors<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&quot;邮箱格式必须合法&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> errors<span class="token punctuation">,</span> <span class="token literal-property property">valid</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5-src-typings-jwt-ts" tabindex="-1"><a class="header-anchor" href="#_2-5-src-typings-jwt-ts"><span>2.5 src/typings/jwt.ts</span></a></h4><p>src/typings/jwt.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> IUserDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UserPayload</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">id</span><span class="token operator">:</span> IUserDocument<span class="token punctuation">[</span><span class="token string">&#39;_id&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6-src-models-index-ts" tabindex="-1"><a class="header-anchor" href="#_2-6-src-models-index-ts"><span>2.6 src\\models\\index.ts</span></a></h4><p>src\\models\\index.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;./user&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-7-src-models-user-ts" tabindex="-1"><a class="header-anchor" href="#_2-7-src-models-user-ts"><span>2.7 src/models/user.ts</span></a></h4><p>src/models/user.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> mongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> Model<span class="token punctuation">,</span> Document<span class="token punctuation">,</span> HookNextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> validator <span class="token keyword">from</span> <span class="token string">&#39;validator&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> jwt <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserPayload <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../typings/jwt&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> bcrypt <span class="token keyword">from</span> <span class="token string">&#39;bcryptjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IUserDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">email</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">avatar</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function-variable function">generateToken</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> string<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">_doc</span><span class="token operator">:</span> IUserDocument</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">UserSchema</span><span class="token operator">:</span> Schema<span class="token operator">&lt;</span>IUserDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&#39;用户名不能为空&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">minlength</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&#39;最小长度不能少于6位&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">maxlength</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">&#39;最大长度不能大于12位&#39;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">password</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">avatar</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">validate</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">validator</span><span class="token operator">:</span> validator<span class="token punctuation">.</span>isEmail</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">trim</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">UserSchema<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function-variable function">generateToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> UserPayload <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET_KEY</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">&#39;1h&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">UserSchema<span class="token punctuation">.</span>pre<span class="token operator">&lt;</span>IUserDocument<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;save&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">next</span><span class="token operator">:</span> HookNextFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isModified</span><span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token keyword">await</span> bcrypt<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">UserSchema<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;login&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>IUserDocument <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">user</span><span class="token operator">:</span> IUserDocument <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> matched <span class="token operator">=</span> <span class="token keyword">await</span> bcrypt<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>matched<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> user<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> user<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">IUserModel</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">username</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> IUserDocument <span class="token operator">|</span> <span class="token keyword">null</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">User</span><span class="token operator">:</span> IUserModel<span class="token operator">&lt;</span>IUserDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>model<span class="token operator">&lt;</span>IUserDocument<span class="token punctuation">,</span> IUserModel<span class="token operator">&lt;</span>IUserDocument<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> UserSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-8-src-controller-user-ts" tabindex="-1"><a class="header-anchor" href="#_2-8-src-controller-user-ts"><span>2.8 src\\controller\\user.ts</span></a></h4><p>src\\controller\\user.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> validateRegisterInput <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/validator&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> HttpException <span class="token keyword">from</span> <span class="token string">&#39;../exceptions/HttpException&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">UNPROCESSABLE_ENTITY</span><span class="token punctuation">,</span> <span class="token constant">UNAUTHORIZED</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;http-status-codes&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> IUserDocument<span class="token punctuation">,</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models/user&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserPayload <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../typings/jwt&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> jwt <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">validate</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> authorization <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;authorization&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>authorization<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> token <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> UserPayload <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET_KEY</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token keyword">as</span> UserPayload<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">delete</span> user<span class="token punctuation">.</span>password<span class="token punctuation">;</span></span>
<span class="line">                    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token literal-property property">data</span><span class="token operator">:</span> user</span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">用户不合法!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">token不合法!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">token未提供!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">authorization未提供!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> confirmPassword<span class="token punctuation">,</span> email<span class="token punctuation">,</span> addresses <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token punctuation">{</span> valid<span class="token punctuation">,</span> errors <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">validateRegisterInput</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> confirmPassword<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNPROCESSABLE_ENTITY</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">参数验证失败!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> errors<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token literal-property property">user</span><span class="token operator">:</span> IUserDocument <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            username<span class="token punctuation">,</span></span>
<span class="line">            email<span class="token punctuation">,</span></span>
<span class="line">            password<span class="token punctuation">,</span></span>
<span class="line">            addresses</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token literal-property property">oldUser</span><span class="token operator">:</span> IUserDocument <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> user<span class="token punctuation">.</span>username <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNPROCESSABLE_ENTITY</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">用户名重复!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> token <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> token <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    token</span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">登录失败</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">uploadAvatar</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response<span class="token punctuation">,</span> <span class="token literal-property property">next</span><span class="token operator">:</span> NextFunction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> userId <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> avatar <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> userId <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> avatar <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> avatar <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-9-typings-express-d-ts" tabindex="-1"><a class="header-anchor" href="#_2-9-typings-express-d-ts"><span>2.9 typings\\express.d.ts</span></a></h4><p>src\\typings\\express.d.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> IUserDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/user&quot;</span><span class="token punctuation">;</span></span>
<span class="line">declare global <span class="token punctuation">{</span></span>
<span class="line">    namespace Express <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Request</span> <span class="token punctuation">{</span></span>
<span class="line">            currentUser<span class="token operator">?</span><span class="token operator">:</span> IUserDocument <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token literal-property property">file</span><span class="token operator">:</span> Multer<span class="token punctuation">.</span>File</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-轮播图" tabindex="-1"><a class="header-anchor" href="#_3-轮播图"><span>3.轮播图</span></a></h2><h3 id="_3-1-src-index-ts" tabindex="-1"><a class="header-anchor" href="#_3-1-src-index-ts"><span>3.1 src\\index.ts</span></a></h3><p>src\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import express, { Express, Request, Response, NextFunction } from &#39;express&#39;;</span>
<span class="line">import mongoose from &#39;mongoose&#39;;</span>
<span class="line">import HttpException from &#39;./exceptions/HttpException&#39;;</span>
<span class="line">import cors from &#39;cors&#39;;</span>
<span class="line">import morgan from &#39;morgan&#39;;</span>
<span class="line">import helmet from &#39;helmet&#39;;</span>
<span class="line">import errorMiddleware from &#39;./middlewares/errorMiddleware&#39;;</span>
<span class="line">import *  as userController from &#39;./controller/user&#39;;</span>
<span class="line">+import *  as sliderController from &#39;./controller/slider&#39;;</span>
<span class="line">import &quot;dotenv/config&quot;;</span>
<span class="line">import multer from &#39;multer&#39;;</span>
<span class="line">import path from &#39;path&#39;;</span>
<span class="line">+import { Slider } from &#39;./models&#39;;</span>
<span class="line">const storage = multer.diskStorage({</span>
<span class="line">    destination: path.join(__dirname, &#39;public&#39;, &#39;uploads&#39;),</span>
<span class="line">    filename(_req: Request, file: Express.Multer.File, cb) {</span>
<span class="line">        cb(null, Date.now() + path.extname(file.originalname));</span>
<span class="line">    }</span>
<span class="line">});</span>
<span class="line">const upload = multer({ storage });</span>
<span class="line">const app: Express = express();</span>
<span class="line">app.use(morgan(&quot;dev&quot;));</span>
<span class="line">app.use(cors());</span>
<span class="line">app.use(helmet());</span>
<span class="line">app.use(express.static(path.resolve(__dirname, &#39;public&#39;)));</span>
<span class="line">app.use(express.json());</span>
<span class="line">app.use(express.urlencoded({ extended: false }));</span>
<span class="line">app.get(&#39;/&#39;, (_req: Request, res: Response) =&gt; {</span>
<span class="line">    res.json({ success: true, message: &#39;hello world&#39; });</span>
<span class="line">});</span>
<span class="line">app.get(&#39;/user/validate&#39;, userController.validate);</span>
<span class="line">app.post(&#39;/user/register&#39;, userController.register);</span>
<span class="line">app.post(&#39;/user/login&#39;, userController.login);</span>
<span class="line">app.post(&#39;/user/uploadAvatar&#39;, upload.single(&#39;avatar&#39;), userController.uploadAvatar);</span>
<span class="line">+app.get(&#39;/slider/list&#39;, sliderController.list);</span>
<span class="line">app.use((_req: Request, _res: Response, next: NextFunction) =&gt; {</span>
<span class="line">    const error: HttpException = new HttpException(404, &#39;Route not found&#39;);</span>
<span class="line">    next(error);</span>
<span class="line">});</span>
<span class="line">app.use(errorMiddleware);</span>
<span class="line">const PORT: number = (process.env.PORT &amp;&amp; parseInt(process.env.PORT)) || 8000;</span>
<span class="line">(async function () {</span>
<span class="line">    mongoose.set(&#39;useNewUrlParser&#39;, true);</span>
<span class="line">    mongoose.set(&#39;useUnifiedTopology&#39;, true);</span>
<span class="line">    await mongoose.connect(process.env.MONGODB_URL!);</span>
<span class="line">+    await createSliders();</span>
<span class="line">    app.listen(PORT, () =&gt; {</span>
<span class="line">        console.log(\`Running on http://localhost:\${PORT}\`);</span>
<span class="line">    });</span>
<span class="line">})();</span>
<span class="line"></span>
<span class="line">+async function createSliders() {</span>
<span class="line">+    const sliders = await Slider.find();</span>
<span class="line">+    if (sliders.length == 0) {</span>
<span class="line">+        const sliders = [</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/reactnative.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/wechat.png&#39; },</span>
<span class="line">+            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/architect.jpg&#39; }</span>
<span class="line">+        ];</span>
<span class="line">+        Slider.create(sliders);</span>
<span class="line">+    }</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-controller-slider-ts" tabindex="-1"><a class="header-anchor" href="#_3-2-controller-slider-ts"><span>3.2 controller\\slider.ts</span></a></h3><p>src\\controller\\slider.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ISliderDocument<span class="token punctuation">,</span> Slider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">list</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token literal-property property">sliders</span><span class="token operator">:</span> ISliderDocument<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Slider<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> sliders <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-models-slider-ts" tabindex="-1"><a class="header-anchor" href="#_3-3-models-slider-ts"><span>3.3 models\\slider.ts</span></a></h3><p>src\\models\\slider.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> mongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> Document <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ISliderDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">url</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">  <span class="token literal-property property">_doc</span><span class="token operator">:</span> ISliderDocument<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">SliderSchema</span><span class="token operator">:</span> Schema<span class="token operator">&lt;</span>ISliderDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Slider <span class="token operator">=</span></span>
<span class="line">  mongoose<span class="token punctuation">.</span>model <span class="token operator">&lt;</span> ISliderDocument <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token string">&quot;Slider&quot;</span><span class="token punctuation">,</span> SliderSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-src-models-index-ts" tabindex="-1"><a class="header-anchor" href="#_3-4-src-models-index-ts"><span>3.4 src\\models\\index.ts</span></a></h3><p>src\\models\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./user&#39;;</span>
<span class="line">+export * from &#39;./slider&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-课程管理" tabindex="-1"><a class="header-anchor" href="#_4-课程管理"><span>4.课程管理</span></a></h2><h3 id="_4-1-src-index-ts" tabindex="-1"><a class="header-anchor" href="#_4-1-src-index-ts"><span>4.1 src\\index.ts</span></a></h3><p>src\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import express, { Express, Request, Response, NextFunction } from &#39;express&#39;;</span>
<span class="line">import mongoose from &#39;mongoose&#39;;</span>
<span class="line">import HttpException from &#39;./exceptions/HttpException&#39;;</span>
<span class="line">import cors from &#39;cors&#39;;</span>
<span class="line">import morgan from &#39;morgan&#39;;</span>
<span class="line">import helmet from &#39;helmet&#39;;</span>
<span class="line">import errorMiddleware from &#39;./middlewares/errorMiddleware&#39;;</span>
<span class="line">import *  as userController from &#39;./controller/user&#39;;</span>
<span class="line">import *  as sliderController from &#39;./controller/slider&#39;;</span>
<span class="line">+import *  as lessonController from &#39;./controller/lesson&#39;;</span>
<span class="line">import &quot;dotenv/config&quot;;</span>
<span class="line">import multer from &#39;multer&#39;;</span>
<span class="line">import path from &#39;path&#39;;</span>
<span class="line">+import { Slider, Lesson } from &#39;./models&#39;;</span>
<span class="line">const storage = multer.diskStorage({</span>
<span class="line">    destination: path.join(__dirname, &#39;public&#39;, &#39;uploads&#39;),</span>
<span class="line">    filename(_req: Request, file: Express.Multer.File, cb) {</span>
<span class="line">        cb(null, Date.now() + path.extname(file.originalname));</span>
<span class="line">    }</span>
<span class="line">});</span>
<span class="line">const upload = multer({ storage });</span>
<span class="line">const app: Express = express();</span>
<span class="line">app.use(morgan(&quot;dev&quot;));</span>
<span class="line">app.use(cors());</span>
<span class="line">app.use(helmet());</span>
<span class="line">app.use(express.static(path.resolve(__dirname, &#39;public&#39;)));</span>
<span class="line">app.use(express.json());</span>
<span class="line">app.use(express.urlencoded({ extended: false }));</span>
<span class="line">app.get(&#39;/&#39;, (_req: Request, res: Response) =&gt; {</span>
<span class="line">    res.json({ success: true, message: &#39;hello world&#39; });</span>
<span class="line">});</span>
<span class="line">app.get(&#39;/user/validate&#39;, userController.validate);</span>
<span class="line">app.post(&#39;/user/register&#39;, userController.register);</span>
<span class="line">app.post(&#39;/user/login&#39;, userController.login);</span>
<span class="line">app.post(&#39;/user/uploadAvatar&#39;, upload.single(&#39;avatar&#39;), userController.uploadAvatar);</span>
<span class="line">app.get(&#39;/slider/list&#39;, sliderController.list);</span>
<span class="line">+app.get(&#39;/lesson/list&#39;, lessonController.list);</span>
<span class="line">+app.get(&#39;/lesson/:id&#39;, lessonController.get);</span>
<span class="line">app.use((_req: Request, _res: Response, next: NextFunction) =&gt; {</span>
<span class="line">    const error: HttpException = new HttpException(404, &#39;Route not found&#39;);</span>
<span class="line">    next(error);</span>
<span class="line">});</span>
<span class="line">app.use(errorMiddleware);</span>
<span class="line">const PORT: number = (process.env.PORT &amp;&amp; parseInt(process.env.PORT)) || 8000;</span>
<span class="line">(async function () {</span>
<span class="line">    mongoose.set(&#39;useNewUrlParser&#39;, true);</span>
<span class="line">    mongoose.set(&#39;useUnifiedTopology&#39;, true);</span>
<span class="line">    await mongoose.connect(process.env.MONGODB_URL!);</span>
<span class="line">    await createSliders();</span>
<span class="line">+    await createLessons();</span>
<span class="line">    app.listen(PORT, () =&gt; {</span>
<span class="line">        console.log(\`Running on http://localhost:\${PORT}\`);</span>
<span class="line">    });</span>
<span class="line">})();</span>
<span class="line"></span>
<span class="line">async function createSliders() {</span>
<span class="line">    const sliders = await Slider.find();</span>
<span class="line">    if (sliders.length == 0) {</span>
<span class="line">        const sliders = [</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/reactnative.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/wechat.png&#39; },</span>
<span class="line">            { url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/architect.jpg&#39; }</span>
<span class="line">        ];</span>
<span class="line">        Slider.create(sliders);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">+async function createLessons() {</span>
<span class="line">+    const lessons = await Lesson.find();</span>
<span class="line">+    if (lessons.length == 0) {</span>
<span class="line">        const lessons = [</span>
<span class="line">            {</span>
<span class="line">                order: 1,</span>
<span class="line">                title: &#39;1.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥100.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 2,</span>
<span class="line">                title: &#39;2.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥200.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 3,</span>
<span class="line">                title: &#39;3.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥300.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 4,</span>
<span class="line">                title: &#39;4.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥400.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 5,</span>
<span class="line">                title: &#39;5.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥500.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 6,</span>
<span class="line">                title: &#39;6.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥100.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 7,</span>
<span class="line">                title: &#39;7.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥200.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 8,</span>
<span class="line">                title: &#39;8.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥300.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 9,</span>
<span class="line">                title: &#39;9.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥400.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 10,</span>
<span class="line">                title: &#39;10.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥500.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 11,</span>
<span class="line">                title: &#39;11.React全栈架构&#39;,</span>
<span class="line">                &quot;video&quot;: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥600.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 12,</span>
<span class="line">                title: &#39;12.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥700.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 13,</span>
<span class="line">                title: &#39;13.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥800.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 14,</span>
<span class="line">                title: &#39;14.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥900.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 15,</span>
<span class="line">                title: &#39;15.React全栈架构&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/react/img/react.jpg&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/react.png&#39;,</span>
<span class="line">                price: &#39;¥1000.00元&#39;,</span>
<span class="line">                category: &#39;react&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 16,</span>
<span class="line">                title: &#39;16.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥600.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 17,</span>
<span class="line">                title: &#39;17.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥700.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 18,</span>
<span class="line">                title: &#39;18.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥800.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 19,</span>
<span class="line">                title: &#39;19.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥900.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            },</span>
<span class="line">            {</span>
<span class="line">                order: 20,</span>
<span class="line">                title: &#39;20.Vue从入门到项目实战&#39;,</span>
<span class="line">                video: &quot;http://img.zhufengpeixun.cn/gee2.mp4&quot;,</span>
<span class="line">                poster: &quot;http://www.zhufengpeixun.cn/vue/img/vue.png&quot;,</span>
<span class="line">                url: &#39;http://www.zhufengpeixun.cn/themes/jianmo2/images/vue.png&#39;,</span>
<span class="line">                price: &#39;¥1000.00元&#39;,</span>
<span class="line">                category: &#39;vue&#39;</span>
<span class="line">            }</span>
<span class="line">        ];</span>
<span class="line">+       Lesson.create(lessons);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-src-models-index-ts" tabindex="-1"><a class="header-anchor" href="#_4-2-src-models-index-ts"><span>4.2 src\\models\\index.ts</span></a></h3><p>src\\models\\index.ts</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export * from &#39;./user&#39;;</span>
<span class="line">export * from &#39;./slider&#39;;</span>
<span class="line">+export * from &#39;./lesson&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-controller-lesson-ts" tabindex="-1"><a class="header-anchor" href="#_4-3-controller-lesson-ts"><span>4.3 controller\\lesson.ts</span></a></h3><p>src\\controller\\lesson.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ILessonDocument<span class="token punctuation">,</span> Lesson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">list</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token punctuation">{</span> offset<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> category <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span></span>
<span class="line">    offset <span class="token operator">=</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//偏移量</span></span>
<span class="line">    limit <span class="token operator">=</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">5</span> <span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//每页条数</span></span>
<span class="line">    <span class="token keyword">let</span> <span class="token literal-property property">query</span><span class="token operator">:</span> Partial<span class="token operator">&lt;</span>ILessonDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> ILessonDocument<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>category <span class="token operator">&amp;&amp;</span> category <span class="token operator">!=</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        query<span class="token punctuation">.</span>category <span class="token operator">=</span> category<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token keyword">await</span> Lesson<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token keyword">await</span> Lesson<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">order</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> list<span class="token punctuation">,</span> <span class="token literal-property property">hasMore</span><span class="token operator">:</span> total <span class="token operator">&gt;</span> offset <span class="token operator">+</span> limit <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> lesson <span class="token operator">=</span> <span class="token keyword">await</span> Lesson<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> lesson <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-models-lesson-ts" tabindex="-1"><a class="header-anchor" href="#_4-4-models-lesson-ts"><span>4.4 models\\lesson.ts</span></a></h3><p>src\\models\\lesson.ts</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> mongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> Document <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ILessonDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">order</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">//顺序</span></span>
<span class="line">  <span class="token literal-property property">title</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">//标题</span></span>
<span class="line">  <span class="token literal-property property">video</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">//视频</span></span>
<span class="line">  <span class="token literal-property property">poster</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">//海报</span></span>
<span class="line">  <span class="token literal-property property">url</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">//url地址</span></span>
<span class="line">  <span class="token literal-property property">price</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">//价格</span></span>
<span class="line">  <span class="token literal-property property">category</span><span class="token operator">:</span> string<span class="token punctuation">;</span> <span class="token comment">//分类</span></span>
<span class="line">  <span class="token literal-property property">_doc</span><span class="token operator">:</span> ILessonDocument<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">LessonSchema</span><span class="token operator">:</span> Schema<span class="token operator">&lt;</span>ILessonDocument<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">order</span><span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token comment">//顺序</span></span>
<span class="line">    <span class="token literal-property property">title</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">//标题</span></span>
<span class="line">    <span class="token literal-property property">video</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">//视频</span></span>
<span class="line">    <span class="token literal-property property">poster</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">//海报</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">//url地址</span></span>
<span class="line">    <span class="token literal-property property">price</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">//价格</span></span>
<span class="line">    <span class="token literal-property property">category</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">//分类</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> Lesson <span class="token operator">=</span></span>
<span class="line">  mongoose<span class="token punctuation">.</span>model <span class="token operator">&lt;</span> ILessonDocument <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token string">&quot;Lesson&quot;</span><span class="token punctuation">,</span> LessonSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,332)])])}const c=n(t,[["render",l]]),r=JSON.parse('{"path":"/strong/82.12.ketang-front.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/82.12.ketang-front.md"}');export{c as comp,r as data};
