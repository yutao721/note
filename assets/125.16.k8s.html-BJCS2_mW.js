import{_ as a,c as n,a as e,o as p}from"./app-CD1YpnS1.js";const l={};function t(r,s){return p(),n("div",null,[...s[0]||(s[0]=[e(`<h2 id="_1-项目仓库" tabindex="-1"><a class="header-anchor" href="#_1-项目仓库"><span>1.项目仓库</span></a></h2><ul><li>前端技术栈为 React + craco</li><li>后端技术栈为 MySQL + eggjs</li><li><a href="https://gitee.com/zhufengpeixun/cicd-frontend" target="_blank" rel="noopener noreferrer">cicd-frontend</a></li><li><a href="https://gitee.com/zhufengpeixun/cicd-backend" target="_blank" rel="noopener noreferrer">cicd-backend</a></li></ul><p><img src="https://img.zhufengpeixun.com/a76602920941e0b8aba1a8b757a4c287" alt="a76602920941e0b8aba1a8b757a4c287"></p><h2 id="_2-添加一个节点" tabindex="-1"><a class="header-anchor" href="#_2-添加一个节点"><span>2.添加一个节点</span></a></h2><ul><li>增加一个node2的节点</li></ul><h2 id="_2-布署msyql" tabindex="-1"><a class="header-anchor" href="#_2-布署msyql"><span>2 布署MSYQL</span></a></h2><h3 id="_2-1-设置污点" tabindex="-1"><a class="header-anchor" href="#_2-1-设置污点"><span>2.1 设置污点</span></a></h3><ul><li>Node2节点机器只用于部署MySQL服务</li><li>可以给节点加污点，只用来布署MySQL服务</li><li>node1增加webserver的污点</li><li>node2增加mysql的污点</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl taint nodes node1 webserver<span class="token operator">:</span>NoSchedule</span>
<span class="line">kubectl taint nodes node2 mysql<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">:</span>NoSchedule</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-创建数据目录" tabindex="-1"><a class="header-anchor" href="#_2-2-创建数据目录"><span>2.2 创建数据目录</span></a></h3><ul><li>在本地创建MYSQL数据文件夹然后挂载进<code>MySQL</code>容器</li><li>以方便MySQL 数据可以持久化</li><li>在node2上创建mysql数据文件夹</li><li>此文件夹要为<code>空</code>，不然启动MYSQL会失败</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">mkdir <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>将root密码存入 secret 内保存<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl create secret generic mysql<span class="token operator">-</span>auth <span class="token operator">--</span>from<span class="token operator">-</span>literal<span class="token operator">=</span>username<span class="token operator">=</span>root  <span class="token operator">--</span>from<span class="token operator">-</span>literal<span class="token operator">=</span>password<span class="token operator">=</span>root</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p>vi deployment-cicd-mysql.yaml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> apps<span class="token operator">/</span>v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> Deployment</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> cicd<span class="token operator">-</span>mysql</span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">replicas</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">matchLabels</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>mysql</span>
<span class="line">  <span class="token literal-property property">template</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">labels</span><span class="token operator">:</span></span>
<span class="line">        <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>mysql</span>
<span class="line">    <span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">tolerations</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> key<span class="token operator">:</span> <span class="token string">&quot;mysql&quot;</span></span>
<span class="line">        <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token string">&quot;Equal&quot;</span></span>
<span class="line">        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span></span>
<span class="line">        <span class="token literal-property property">effect</span><span class="token operator">:</span> <span class="token string">&quot;NoSchedule&quot;</span></span>
<span class="line">      <span class="token literal-property property">containers</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> name<span class="token operator">:</span> cicd<span class="token operator">-</span>mysql</span>
<span class="line">        <span class="token literal-property property">image</span><span class="token operator">:</span> mysql<span class="token operator">:</span><span class="token number">5.7</span></span>
<span class="line">        <span class="token literal-property property">imagePullPolicy</span><span class="token operator">:</span> IfNotPresent</span>
<span class="line">        <span class="token literal-property property">args</span><span class="token operator">:</span></span>
<span class="line">        <span class="token operator">-</span> <span class="token string">&quot;--ignore-db-dir=lost+found&quot;</span></span>
<span class="line">        <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">        <span class="token operator">-</span> containerPort<span class="token operator">:</span> <span class="token number">3306</span></span>
<span class="line">        <span class="token literal-property property">volumeMounts</span><span class="token operator">:</span></span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> mysql<span class="token operator">-</span>data</span>
<span class="line">          <span class="token literal-property property">mountPath</span><span class="token operator">:</span> <span class="token string">&quot;/var/lib/mysql&quot;</span></span>
<span class="line">        <span class="token literal-property property">env</span><span class="token operator">:</span></span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token constant">MYSQL_ROOT_PASSWORD</span></span>
<span class="line">          <span class="token literal-property property">valueFrom</span><span class="token operator">:</span></span>
<span class="line">            <span class="token literal-property property">secretKeyRef</span><span class="token operator">:</span></span>
<span class="line">              <span class="token literal-property property">name</span><span class="token operator">:</span> mysql<span class="token operator">-</span>auth</span>
<span class="line">              <span class="token literal-property property">key</span><span class="token operator">:</span> password</span>
<span class="line">      <span class="token literal-property property">volumes</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> name<span class="token operator">:</span> mysql<span class="token operator">-</span>data</span>
<span class="line">        <span class="token literal-property property">hostPath</span><span class="token operator">:</span> </span>
<span class="line">          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql</span>
<span class="line">          <span class="token literal-property property">type</span><span class="token operator">:</span> Directory          </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> [root@master project]</span>
<span class="line">deployment.apps/cicd-mysql created</span>
<span class="line"></span>
<span class="line">//查看容器内的日志 方便查看报错</span>
<span class="line">kubectl get pods</span>
<span class="line">kubectl describe pods cicd-mysql-bcb77c759-bdrd8</span>
<span class="line">kubectl logs cicd-mysql-6cbd4f95-g64hh </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vi service-cicd-mysql.yaml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> Service</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> service<span class="token operator">-</span>cicd<span class="token operator">-</span>mysql</span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>mysql</span>
<span class="line">  <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">  <span class="token operator">-</span> protocol<span class="token operator">:</span> <span class="token constant">TCP</span></span>
<span class="line">    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3306</span></span>
<span class="line">    <span class="token literal-property property">targetPort</span><span class="token operator">:</span> <span class="token number">3306</span></span>
<span class="line">  <span class="token literal-property property">type</span><span class="token operator">:</span> NodePort</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>让配置文件生效</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f service-cicd-mysql.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>连接数据库初始化数据</p></li><li><p>-h 为任意节点的公网或内网IP</p></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">mysql <span class="token operator">-</span>h172<span class="token punctuation">.</span><span class="token number">31.178</span><span class="token number">.169</span> <span class="token operator">-</span><span class="token constant">P32636</span> <span class="token operator">-</span>uroot <span class="token operator">-</span>proot </span>
<span class="line">mysql <span class="token operator">-</span>h118<span class="token punctuation">.</span><span class="token number">190.156</span><span class="token number">.138</span> <span class="token operator">-</span><span class="token constant">P32636</span> <span class="token operator">-</span>uroot <span class="token operator">-</span>proot</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">create database cicd<span class="token punctuation">;</span></span>
<span class="line">use cicd<span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">users</span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token constant">COMMENT</span> <span class="token string">&#39;ID&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">name</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token string">&#39;姓名&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">age</span><span class="token template-punctuation string">\`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token string">&#39;年龄&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">sex</span><span class="token template-punctuation string">\`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token string">&#39;性别；1男 2女&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">id</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">9</span> <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-布署后端" tabindex="-1"><a class="header-anchor" href="#_3-布署后端"><span>3 布署后端</span></a></h2><h3 id="_3-1-新建jenkins项目" tabindex="-1"><a class="header-anchor" href="#_3-1-新建jenkins项目"><span>3.1 新建jenkins项目</span></a></h3><ul><li>cicd-backend</li><li>设置git源码地址</li><li>配置git私钥</li><li>配置DOCKER_LOGIN_USERNAME和DOCKER_LOGIN_PASSWORD</li></ul><h3 id="_3-2-添加构建布署" tabindex="-1"><a class="header-anchor" href="#_3-2-添加构建布署"><span>3.2 添加构建布署</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> </span>
<span class="line">time<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>date <span class="token string">&quot;+%Y%m%d%H%M%S&quot;</span><span class="token punctuation">)</span></span>
<span class="line">npm install <span class="token operator">--</span>registry<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org</span>
<span class="line">docker build <span class="token operator">-</span>t <span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span><span class="token operator">/</span>cicd<span class="token operator">-</span>backend<span class="token operator">:</span>$time <span class="token punctuation">.</span></span>
<span class="line">docker login <span class="token operator">-</span>u $<span class="token constant">DOCKER_LOGIN_USERNAME</span> <span class="token operator">-</span>p $<span class="token constant">DOCKER_LOGIN_PASSWORD</span> <span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span></span>
<span class="line">docker push <span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span><span class="token operator">/</span>cicd<span class="token operator">-</span>backend<span class="token operator">:</span>$time</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-配置信息" tabindex="-1"><a class="header-anchor" href="#_3-3-配置信息"><span>3.3 配置信息</span></a></h3><h4 id="_3-3-1-数据库地址" tabindex="-1"><a class="header-anchor" href="#_3-3-1-数据库地址"><span>3.3.1 数据库地址</span></a></h4><p>vi mysql.config.yaml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> ConfigMap</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> mysql<span class="token operator">-</span>config</span>
<span class="line"><span class="token literal-property property">data</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&quot;service-cicd-mysql&quot;</span>  </span>
<span class="line">  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">&quot;3306&quot;</span></span>
<span class="line">  <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">&quot;cicd&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f  mysql.config.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-2-数据库账号" tabindex="-1"><a class="header-anchor" href="#_3-3-2-数据库账号"><span>3.3.2 数据库账号</span></a></h4><p>vi mysql-auth.yaml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">apiVersion: v1</span>
<span class="line">kind: Secret</span>
<span class="line">metadata:</span>
<span class="line">  name: mysql-auth</span>
<span class="line">stringData:</span>
<span class="line">  username: root</span>
<span class="line">  password: root</span>
<span class="line">type: Opaque</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f  mysql.config.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-3-私有仓库认证" tabindex="-1"><a class="header-anchor" href="#_3-3-3-私有仓库认证"><span>3.3.3 私有仓库认证</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl create secret docker<span class="token operator">-</span>registry <span class="token keyword">private</span><span class="token operator">-</span>registry \\</span>
<span class="line"><span class="token operator">--</span>docker<span class="token operator">-</span>username<span class="token operator">=</span>admin \\</span>
<span class="line"><span class="token operator">--</span>docker<span class="token operator">-</span>password<span class="token operator">=</span>admin123 \\</span>
<span class="line"><span class="token operator">--</span>docker<span class="token operator">-</span>email<span class="token operator">=</span>admin@example<span class="token punctuation">.</span>org \\</span>
<span class="line"><span class="token operator">--</span>docker<span class="token operator">-</span>server<span class="token operator">=</span><span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-4-后台deployment" tabindex="-1"><a class="header-anchor" href="#_3-3-4-后台deployment"><span>3.3.4 后台Deployment</span></a></h4><p>vi cicd-backend.yaml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> apps<span class="token operator">/</span>v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> Deployment</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> cicd<span class="token operator">-</span>backend</span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">matchLabels</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>backend</span>
<span class="line">  <span class="token literal-property property">replicas</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token literal-property property">template</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">labels</span><span class="token operator">:</span></span>
<span class="line">        <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>backend</span>
<span class="line">    <span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">imagePullSecrets</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token keyword">private</span><span class="token operator">-</span>registry</span>
<span class="line">      <span class="token literal-property property">containers</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> name<span class="token operator">:</span> cicd<span class="token operator">-</span>backend</span>
<span class="line">        <span class="token literal-property property">imagePullPolicy</span><span class="token operator">:</span> Always</span>
<span class="line">        <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token string">&quot;115.28.139.92:8082/cicd-backend:20210321202052&quot;</span></span>
<span class="line">        <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">        <span class="token operator">-</span> containerPort<span class="token operator">:</span> <span class="token number">7001</span></span>
<span class="line">        <span class="token literal-property property">env</span><span class="token operator">:</span></span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token constant">MYSQL_HOST</span></span>
<span class="line">          <span class="token literal-property property">valueFrom</span><span class="token operator">:</span></span>
<span class="line">            <span class="token literal-property property">configMapKeyRef</span><span class="token operator">:</span></span>
<span class="line">              <span class="token literal-property property">name</span><span class="token operator">:</span> mysql<span class="token operator">-</span>config</span>
<span class="line">              <span class="token literal-property property">key</span><span class="token operator">:</span> host</span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token constant">MYSQL_PORT</span></span>
<span class="line">          <span class="token literal-property property">valueFrom</span><span class="token operator">:</span></span>
<span class="line">            <span class="token literal-property property">configMapKeyRef</span><span class="token operator">:</span></span>
<span class="line">              <span class="token literal-property property">name</span><span class="token operator">:</span> mysql<span class="token operator">-</span>config</span>
<span class="line">              <span class="token literal-property property">key</span><span class="token operator">:</span> port</span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token constant">MYSQL_DATABASE</span></span>
<span class="line">          <span class="token literal-property property">valueFrom</span><span class="token operator">:</span></span>
<span class="line">            <span class="token literal-property property">configMapKeyRef</span><span class="token operator">:</span></span>
<span class="line">              <span class="token literal-property property">name</span><span class="token operator">:</span> mysql<span class="token operator">-</span>config</span>
<span class="line">              <span class="token literal-property property">key</span><span class="token operator">:</span> database</span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token constant">MYSQL_USER</span></span>
<span class="line">          <span class="token literal-property property">valueFrom</span><span class="token operator">:</span></span>
<span class="line">            <span class="token literal-property property">secretKeyRef</span><span class="token operator">:</span></span>
<span class="line">             <span class="token literal-property property">name</span><span class="token operator">:</span> mysql<span class="token operator">-</span>auth</span>
<span class="line">             <span class="token literal-property property">key</span><span class="token operator">:</span> username     </span>
<span class="line">        <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token constant">MYSQL_PASSWORD</span></span>
<span class="line">          <span class="token literal-property property">valueFrom</span><span class="token operator">:</span></span>
<span class="line">            <span class="token literal-property property">secretKeyRef</span><span class="token operator">:</span></span>
<span class="line">             <span class="token literal-property property">name</span><span class="token operator">:</span> mysql<span class="token operator">-</span>auth</span>
<span class="line">             <span class="token literal-property property">key</span><span class="token operator">:</span> password        </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f  cicd-backend.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-3-5-后台service" tabindex="-1"><a class="header-anchor" href="#_3-3-5-后台service"><span>3.3.5 后台Service</span></a></h4><ul><li>vi service-cicd-backend.yaml</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> Service</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> service<span class="token operator">-</span>cicd<span class="token operator">-</span>backend</span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>backend</span>
<span class="line">  <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">  <span class="token operator">-</span> protocol<span class="token operator">:</span> <span class="token constant">TCP</span></span>
<span class="line">    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">7001</span></span>
<span class="line">    <span class="token literal-property property">targetPort</span><span class="token operator">:</span> <span class="token number">7001</span></span>
<span class="line">  <span class="token literal-property property">type</span><span class="token operator">:</span> NodePort</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl apply <span class="token operator">-</span>f  service<span class="token operator">-</span>cicd<span class="token operator">-</span>backend<span class="token punctuation">.</span>yaml</span>
<span class="line">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.31</span><span class="token number">.178</span><span class="token number">.169</span><span class="token operator">:</span><span class="token number">31300</span><span class="token operator">/</span>user<span class="token operator">/</span>list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-布署前端" tabindex="-1"><a class="header-anchor" href="#_4-布署前端"><span>4 布署前端</span></a></h2><h3 id="_4-1-安装编译器" tabindex="-1"><a class="header-anchor" href="#_4-1-安装编译器"><span>4.1 安装编译器</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum -y install gcc gcc-c++ kernel-devel</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-1-新建jenkins项目" tabindex="-1"><a class="header-anchor" href="#_4-1-新建jenkins项目"><span>4.1 新建jenkins项目</span></a></h3><ul><li>cicd-frontend</li><li>设置git源码地址</li><li>配置git私钥</li><li>配置DOCKER_LOGIN_USERNAME和DOCKER_LOGIN_PASSWORD</li></ul><h3 id="_4-1-配置构建步骤" tabindex="-1"><a class="header-anchor" href="#_4-1-配置构建步骤"><span>4.1 配置构建步骤</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"> </span>
<span class="line">time<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>date <span class="token string">&quot;+%Y%m%d%H%M%S&quot;</span><span class="token punctuation">)</span></span>
<span class="line">npm install <span class="token operator">--</span>registry<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org</span>
<span class="line">npm run build</span>
<span class="line">docker build <span class="token operator">-</span>t <span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span><span class="token operator">/</span>cicd<span class="token operator">-</span>frontend<span class="token operator">:</span>$time <span class="token punctuation">.</span></span>
<span class="line">docker login <span class="token operator">-</span>u $<span class="token constant">DOCKER_LOGIN_USERNAME</span> <span class="token operator">-</span>p $<span class="token constant">DOCKER_LOGIN_PASSWORD</span> <span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span></span>
<span class="line">docker push <span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span><span class="token operator">/</span>cicd<span class="token operator">-</span>frontend<span class="token operator">:</span>$time</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-配置构建步骤" tabindex="-1"><a class="header-anchor" href="#_4-2-配置构建步骤"><span>4.2 配置构建步骤</span></a></h3><p>vi cicd-frontend.yaml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> apps<span class="token operator">/</span>v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> Deployment</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> cicd<span class="token operator">-</span>frontend</span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">matchLabels</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>frontend</span>
<span class="line">  <span class="token literal-property property">replicas</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token literal-property property">template</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">labels</span><span class="token operator">:</span></span>
<span class="line">        <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>frontend</span>
<span class="line">    <span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">      <span class="token literal-property property">imagePullSecrets</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> name<span class="token operator">:</span> <span class="token keyword">private</span><span class="token operator">-</span>registry</span>
<span class="line">      <span class="token literal-property property">containers</span><span class="token operator">:</span></span>
<span class="line">      <span class="token operator">-</span> name<span class="token operator">:</span> cicd<span class="token operator">-</span>frontend</span>
<span class="line">        <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token number">115.28</span><span class="token number">.139</span><span class="token number">.92</span><span class="token operator">:</span><span class="token number">8082</span><span class="token operator">/</span>cicd<span class="token operator">-</span>frontend<span class="token operator">:</span><span class="token number">20210321204724</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f  cicd-frontend.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>vi service-cicd-frontend.yaml</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1</span>
<span class="line"><span class="token literal-property property">kind</span><span class="token operator">:</span> Service</span>
<span class="line"><span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> service<span class="token operator">-</span>cicd<span class="token operator">-</span>frontend</span>
<span class="line"><span class="token literal-property property">spec</span><span class="token operator">:</span></span>
<span class="line">  <span class="token literal-property property">selector</span><span class="token operator">:</span></span>
<span class="line">    <span class="token literal-property property">app</span><span class="token operator">:</span> cicd<span class="token operator">-</span>frontend</span>
<span class="line">  <span class="token literal-property property">ports</span><span class="token operator">:</span></span>
<span class="line">  <span class="token operator">-</span> protocol<span class="token operator">:</span> <span class="token constant">TCP</span></span>
<span class="line">    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">80</span></span>
<span class="line">    <span class="token literal-property property">targetPort</span><span class="token operator">:</span> <span class="token number">80</span></span>
<span class="line">  <span class="token literal-property property">type</span><span class="token operator">:</span> NodePort</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">kubectl apply -f  service-cicd-frontend.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token keyword">get</span> svc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">118.190.156.138:31753</span><span class="token regex-delimiter">/</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_5-集成jenkins" tabindex="-1"><a class="header-anchor" href="#_5-集成jenkins"><span>5.集成jenkins</span></a></h2><h3 id="_5-1-添加全局配置文件" tabindex="-1"><a class="header-anchor" href="#_5-1-添加全局配置文件"><span>5.1 添加全局配置文件</span></a></h3><ul><li>系统管理=&gt;Managed files=&gt;Add a new Config=&gt;Custom file</li><li>Name设置为k8s-config</li><li>把master上的<code>~/.kube/config</code>拷贝到Content中</li></ul><h3 id="_5-2-安装kubectl" tabindex="-1"><a class="header-anchor" href="#_5-2-安装kubectl"><span>5.2 安装kubectl</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">cat <span class="token operator">&lt;&lt;</span><span class="token constant">EOF</span> <span class="token operator">&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">etc</span><span class="token regex-delimiter">/</span><span class="token regex-flags">yum</span></span><span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>kubernetes<span class="token punctuation">.</span>repo</span>
<span class="line"><span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span></span>
<span class="line">name<span class="token operator">=</span>Kubernetes</span>
<span class="line">baseurl<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>yum<span class="token operator">/</span>repos<span class="token operator">/</span>kubernetes<span class="token operator">-</span>el7<span class="token operator">-</span>x86_64</span>
<span class="line">enabled<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line">gpgcheck<span class="token operator">=</span><span class="token number">0</span></span>
<span class="line">repo_gpgcheck<span class="token operator">=</span><span class="token number">0</span></span>
<span class="line">gpgkey<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>yum<span class="token operator">/</span>doc<span class="token operator">/</span>yum<span class="token operator">-</span>key<span class="token punctuation">.</span>gpg</span>
<span class="line">        <span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>yum<span class="token operator">/</span>doc<span class="token operator">/</span>rpm<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">-</span>key<span class="token punctuation">.</span>gpg</span>
<span class="line"><span class="token constant">EOF</span></span>
<span class="line">yum install <span class="token operator">-</span>y kubectl</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-绑定配置文件" tabindex="-1"><a class="header-anchor" href="#_5-3-绑定配置文件"><span>5.3 绑定配置文件</span></a></h3><ul><li>打开项目配置</li><li>选择绑定=&gt;Provide Configuration files=&gt;Target选择<code>k8s-config</code>=&gt;Target输入<code>k8s-config.yaml</code></li></ul><h3 id="_5-4-shell" tabindex="-1"><a class="header-anchor" href="#_5-4-shell"><span>5.4 shell</span></a></h3><ul><li>使用 <code>kubectl set image</code> 命令快速设置镜像地址版本</li><li>格式为：kubectl set image deployment/[deployment名称] [容器名称]=[镜像版本]</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> </span>
<span class="line">time=$(date &quot;+%Y%m%d%H%M%S&quot;)</span>
<span class="line">npm install --registry=https://registry.npm.taobao.org</span>
<span class="line">docker build -t 115.28.139.92:8082/cicd-backend:$time .</span>
<span class="line">docker login -u $DOCKER_LOGIN_USERNAME -p $DOCKER_LOGIN_PASSWORD 115.28.139.92:8082</span>
<span class="line">docker push 115.28.139.92:8082/cicd-backend:$time</span>
<span class="line">+kubectl --kubeconfig=k8s-config.yaml set image deployment/cicd-backend cicd-backend=115.28.139.92:8082/cicd-backend:$time</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>deployment.apps/cicd-backend image updated</code>表示更新成功</p></blockquote><h2 id="_6-推送触发构建" tabindex="-1"><a class="header-anchor" href="#_6-推送触发构建"><span>6.推送触发构建</span></a></h2><h3 id="_6-1-安装插件" tabindex="-1"><a class="header-anchor" href="#_6-1-安装插件"><span>6.1 安装插件</span></a></h3><ul><li>publish over ssh(方便操作远程的服务器)</li><li>gitee</li><li>Last Changes(可视化查看git文件变化)</li></ul><h3 id="_6-2-构建触发器" tabindex="-1"><a class="header-anchor" href="#_6-2-构建触发器"><span>6.2 构建触发器</span></a></h3><ul><li>Gitee webhook触发构建,并记录<code>webhook URL</code>地址</li><li>生成 Gitee WebHook 密码</li></ul><h2 id="_6-3-配置webhooks" tabindex="-1"><a class="header-anchor" href="#_6-3-配置webhooks"><span>6.3 配置WebHooks</span></a></h2><ul><li>打开项目的WebHooks管理页面</li><li>配置<code>webhookURL</code>和<code>WebHook 密码</code></li></ul><h2 id="_6-参考" tabindex="-1"><a class="header-anchor" href="#_6-参考"><span>6.参考</span></a></h2><ul><li>强行删除pod<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">kubectl <span class="token keyword">delete</span> pod  cicd<span class="token operator">-</span>mysql<span class="token operator">-</span>84795bc9d7<span class="token operator">-</span>fpjmp       <span class="token operator">--</span>force <span class="token operator">--</span>grace<span class="token operator">-</span>period<span class="token operator">=</span><span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul>`,81)])])}const i=a(l,[["render",t]]),c=JSON.parse('{"path":"/strong/125.16.k8s.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/125.16.k8s.md"}');export{i as comp,c as data};
