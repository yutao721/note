import{_ as s,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function c(l,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h2 id="_1-generator" tabindex="-1"><a class="header-anchor" href="#_1-generator"><span>1. Generator</span></a></h2><h3 id="_1-1-generator" tabindex="-1"><a class="header-anchor" href="#_1-1-generator"><span>1.1 Generator</span></a></h3><ul><li>Generator是生成器，一个函数如果加了*，他就会变成一个<code>生成器</code>函数，他的运行结果会返回一个<code>迭代器</code>对象</li><li>ES6规范中规定迭代器必须有一个next方法，这个方法会返回一个对象，这个对象具有<code>done</code>和<code>value</code>两个属性 <ul><li><code>done</code>表示当前迭代器是否已经执行完，执行完为true，否则为false</li><li><code>value</code>表示当前步骤返回的值</li></ul></li><li>当调用迭代器的<code>next</code>方法时，会继续往下执行,遇到<code>yield</code>关键字都会暂停执行,并会将<code>yield</code>后面表达式的值作为返回对象的<code>value</code></li></ul><p><img src="https://img.zhufengpeixun.com/generatororiginal.png" alt="generatororiginal"></p><p><img src="https://img.zhufengpeixun.com/generatorexecflow.png" alt="generatorexecflow"></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> r1 <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 返回值是 <span class="token punctuation">{</span> value: 1, done: false <span class="token punctuation">}</span></span>
<span class="line"> * 此时并没有给变量a赋值，调用下一个next的时候才会给变量a赋值</span>
<span class="line"> */</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 先把值valueA赋值给变量a,并继续向下执行，遇到第2个yield停止</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">let</span> r2 <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;aValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 再次调用next时没有传参，所以b的值为undefined</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">let</span> r3 <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;bValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 再次调用next时没有传参，所以c的值为undefined,执行结束，done为true</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">let</span> r4 <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;cValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r4<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-throw" tabindex="-1"><a class="header-anchor" href="#_1-3-throw"><span>1.3 throw</span></a></h3><ul><li><code>throw</code>方法可以在函数体外部抛出错误，然后在函数里面捕获</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> r1 <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> r2 <span class="token operator">=</span>  iterator<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">&#39;出错了&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-return" tabindex="-1"><a class="header-anchor" href="#_1-4-return"><span>1.4 return</span></a></h3><ul><li><code>throw</code>方法可以终止当前迭代器</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> r1 <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> r2 <span class="token operator">=</span>  iterator<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-co" tabindex="-1"><a class="header-anchor" href="#_1-5-co"><span>1.5 co</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token parameter">generator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        result <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> </span>
<span class="line">            <span class="token function">next</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">co</span><span class="token punctuation">(</span>generator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-7-generator" tabindex="-1"><a class="header-anchor" href="#_1-7-generator"><span>1.7 generator</span></a></h3><h4 id="_1-7-1-使用" tabindex="-1"><a class="header-anchor" href="#_1-7-1-使用"><span>1.7.1 使用</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">var</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//{ value: 1, done: false }</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;aValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 2, done: false }</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;bValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 3, done: false }</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;cValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: undefined, done: true }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-7-2-实现" tabindex="-1"><a class="header-anchor" href="#_1-7-2-实现"><span>1.7.2 实现</span></a></h4><ul><li><a href="https://babeljs.io/repl" target="_blank" rel="noopener noreferrer">repl</a></li><li><a href="https://github.com/facebook/regenerator/blob/master/packages/regenerator-runtime/runtime.js" target="_blank" rel="noopener noreferrer">runtime.js</a></li></ul><h5 id="_1-7-2-1-generator-js" tabindex="-1"><a class="header-anchor" href="#_1-7-2-1-generator-js"><span>1.7.2.1 generator.js</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">/* eslint-disable no-fallthrough */</span></span>
<span class="line"><span class="token keyword">let</span> regeneratorRuntime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./regeneratorRuntime&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">var</span> _marked <span class="token operator">=</span> regeneratorRuntime<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span>generator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> regeneratorRuntime<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">generator$</span><span class="token punctuation">(</span><span class="token parameter">_context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">switch</span> <span class="token punctuation">(</span>_context<span class="token punctuation">.</span>prev <span class="token operator">=</span> _context<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span></span>
<span class="line">          _context<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span></span>
<span class="line">          a <span class="token operator">=</span> _context<span class="token punctuation">.</span>sent<span class="token punctuation">;</span></span>
<span class="line">          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          _context<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span></span>
<span class="line">          b <span class="token operator">=</span> _context<span class="token punctuation">.</span>sent<span class="token punctuation">;</span></span>
<span class="line">          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          _context<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span></span>
<span class="line">          c <span class="token operator">=</span> _context<span class="token punctuation">.</span>sent<span class="token punctuation">;</span></span>
<span class="line">          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">:</span></span>
<span class="line">        <span class="token keyword">case</span> <span class="token string">&quot;end&quot;</span><span class="token operator">:</span></span>
<span class="line">          <span class="token keyword">return</span> _context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> _marked<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">var</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//{ value: 1, done: false }</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;aValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 2, done: false }</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;bValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: 3, done: false }</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;cValue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//{ value: undefined, done: true }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-7-2-2-regeneratorruntime-js" tabindex="-1"><a class="header-anchor" href="#_1-7-2-2-regeneratorruntime-js"><span>1.7.2.2 regeneratorRuntime.js</span></a></h5><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span></span>
<span class="line">    next <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">mark</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">genFun</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> genFun<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">exports<span class="token punctuation">.</span><span class="token function-variable function">wrap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">innerFn<span class="token punctuation">,</span> outerFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> generator <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>outerFn<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    generator<span class="token punctuation">.</span><span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        context<span class="token punctuation">.</span>sent <span class="token operator">=</span> arg<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">innerFn</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            value<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">done</span><span class="token operator">:</span> context<span class="token punctuation">.</span>done</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> generator<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-redux-saga实战" tabindex="-1"><a class="header-anchor" href="#_2-redux-saga实战"><span>2. redux-saga实战</span></a></h2><h3 id="_2-1-初始化项目" tabindex="-1"><a class="header-anchor" href="#_2-1-初始化项目"><span>2.1 初始化项目</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">create-react-app zhufeng-redux-saga</span>
<span class="line">cd zhufeng-redux-saga</span>
<span class="line">cnpm i redux react-redux redux-saga -S</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.zhufengpeixun.com/redux-saga-flow2.jpg" alt="redux-saga-flow2.jpg"></p><p><img src="https://img.zhufengpeixun.com/react-redux-flow.jpg" alt="react-redux-flow.jpg"></p><h3 id="_2-2-实现计数器" tabindex="-1"><a class="header-anchor" href="#_2-2-实现计数器"><span>2.2 实现计数器</span></a></h3><h4 id="_2-2-1-action-types-js" tabindex="-1"><a class="header-anchor" href="#_2-2-1-action-types-js"><span>2.2.1 action-types.js</span></a></h4><p>src\\store\\action-types.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD</span><span class="token operator">=</span><span class="token string">&#39;ADD&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-2-2-reducer-js" tabindex="-1"><a class="header-anchor" href="#_2-2-2-reducer-js"><span>2.2.2 reducer.js</span></a></h4><p>src\\store\\reducer.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actionTypes <span class="token keyword">from</span> <span class="token string">&#39;./action-types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">number</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">case</span> actionTypes<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">number</span><span class="token operator">:</span> state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">            <span class="token keyword">return</span> state<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> reducer<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-3-store-index-js" tabindex="-1"><a class="header-anchor" href="#_2-2-3-store-index-js"><span>2.2.3 store\\index.js</span></a></h4><p>src\\store\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">&#39;./reducer&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> store<span class="token operator">=</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-4-actions-js" tabindex="-1"><a class="header-anchor" href="#_2-2-4-actions-js"><span>2.2.4 actions.js</span></a></h4><p>src\\store\\actions.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actionTypes <span class="token keyword">from</span> <span class="token string">&#39;./action-types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>actionTypes<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> actions<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-5-counter-js" tabindex="-1"><a class="header-anchor" href="#_2-2-5-counter-js"><span>2.2.5 Counter.js</span></a></h4><p>src\\components\\Counter.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">&#39;../store/actions&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">,</span></span>
<span class="line">    actions</span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-6-src-index-js" tabindex="-1"><a class="header-anchor" href="#_2-2-6-src-index-js"><span>2.2.6 src\\index.js</span></a></h4><p>src\\index.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">&#39;./components/Counter&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./store&#39;</span><span class="token punctuation">;</span></span>
<span class="line">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>Counter<span class="token operator">/</span><span class="token operator">&gt;</span></span>
<span class="line"> <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-saga计数器" tabindex="-1"><a class="header-anchor" href="#_2-3-saga计数器"><span>2.3 saga计数器</span></a></h3><h4 id="_2-3-1-src-store-sagas-js" tabindex="-1"><a class="header-anchor" href="#_2-3-1-src-store-sagas-js"><span>2.3.1 src\\store\\sagas.js</span></a></h4><p>src\\store\\sagas.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> put<span class="token punctuation">,</span> take<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux-saga/effects&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actionTypes <span class="token keyword">from</span> <span class="token string">&#39;./action-types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>actionTypes<span class="token punctuation">.</span><span class="token constant">ASYNC_ADD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>actionTypes<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> </span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;已经达到最大值&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-2-action-types-js" tabindex="-1"><a class="header-anchor" href="#_2-3-2-action-types-js"><span>2.3.2 action-types.js</span></a></h4><p>src\\store\\action-types.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const ADD=&#39;ADD&#39;;</span>
<span class="line">+export const ASYNC_ADD=&#39;ASYNC_ADD&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-3-actions-js" tabindex="-1"><a class="header-anchor" href="#_2-3-3-actions-js"><span>2.3.3 actions.js</span></a></h4><p>src\\store\\actions.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as actionTypes from &#39;./action-types&#39;;</span>
<span class="line">const actions = {</span>
<span class="line">    add() {</span>
<span class="line">+      return {type:actionTypes.ASYNC_ADD}</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default actions;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-4-src-store-index-js" tabindex="-1"><a class="header-anchor" href="#_2-3-4-src-store-index-js"><span>2.3.4 src\\store\\index.js</span></a></h4><p>src\\store\\index.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import {createStore,applyMiddleware} from &#39;redux&#39;;</span>
<span class="line">import reducer from &#39;./reducer&#39;;</span>
<span class="line">+import createSagaMiddleware from &#39;redux-saga&#39;;</span>
<span class="line">+import {rootSaga} from &#39;./sagas&#39;;</span>
<span class="line">+let sagaMiddleware=createSagaMiddleware();</span>
<span class="line">+let store=applyMiddleware(sagaMiddleware)(createStore)(reducer);</span>
<span class="line">+sagaMiddleware.run(rootSaga);</span>
<span class="line">export default store;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-实现take和put" tabindex="-1"><a class="header-anchor" href="#_3-实现take和put"><span>3 实现take和put</span></a></h2><ul><li>take 监听action，暂停Generator，匹配的action被发起时，恢复执行。take结合fork，可以实现takeEvery和takeLatest的效果</li><li>put 相当于dispatch，分发一个action</li></ul><h3 id="_3-1-index-js" tabindex="-1"><a class="header-anchor" href="#_3-1-index-js"><span>3.1 index.js</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/redux-saga/blob/master/packages/core/src/index.js" target="_blank" rel="noopener noreferrer">index.js</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./middleware&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-2-middleware-js" tabindex="-1"><a class="header-anchor" href="#_3-2-middleware-js"><span>3.2 middleware.js</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/redux-saga/blob/master/packages/core/src/internal/middleware.js" target="_blank" rel="noopener noreferrer">middleware.js</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> stdChannel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./channel&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> runSaga <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./runSaga&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">sagaMiddlewareFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token function">stdChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> boundRunSaga<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">sagaMiddleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> getState<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    boundRunSaga <span class="token operator">=</span> <span class="token function">runSaga</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      channel<span class="token punctuation">,</span></span>
<span class="line">      dispatch<span class="token punctuation">,</span></span>
<span class="line">      getState<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        channel<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  sagaMiddleware<span class="token punctuation">.</span><span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">boundRunSaga</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> sagaMiddleware<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> sagaMiddlewareFactory<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-channel-js" tabindex="-1"><a class="header-anchor" href="#_3-3-channel-js"><span>3.3 channel.js</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/redux-saga/blob/master/packages/core/src/internal/channel.js" target="_blank" rel="noopener noreferrer">channel.js</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">stdChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> currentTakers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span> matcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    cb<span class="token punctuation">[</span><span class="token string">&#39;MATCH&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> matcher<span class="token punctuation">;</span></span>
<span class="line">    cb<span class="token punctuation">.</span><span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">      currentTakers <span class="token operator">=</span> currentTakers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span>item<span class="token operator">!==</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    currentTakers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> takers <span class="token operator">=</span> currentTakers<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> takers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> taker <span class="token operator">=</span> takers<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>taker<span class="token punctuation">[</span><span class="token string">&#39;MATCH&#39;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        taker<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">taker</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    take<span class="token punctuation">,</span></span>
<span class="line">    put</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-runsaga-js" tabindex="-1"><a class="header-anchor" href="#_3-4-runsaga-js"><span>3.4 runSaga.js</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/redux-saga/blob/master/packages/core/src/internal/runSaga.js" target="_blank" rel="noopener noreferrer">runSaga.js</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> proc <span class="token keyword">from</span> <span class="token string">&#39;./proc&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">runSaga</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token punctuation">{</span> channel<span class="token punctuation">,</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  saga<span class="token punctuation">,</span></span>
<span class="line">  <span class="token operator">...</span>args</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> iterator <span class="token operator">=</span> <span class="token function">saga</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    channel<span class="token punctuation">,</span></span>
<span class="line">    dispatch<span class="token punctuation">,</span></span>
<span class="line">    getState<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">proc</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> iterator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5-effecttypes-js" tabindex="-1"><a class="header-anchor" href="#_3-5-effecttypes-js"><span>3.5 effectTypes.js</span></a></h4><p>src\\redux-saga\\effectTypes.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">TAKE</span> <span class="token operator">=</span> <span class="token string">&#39;TAKE&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PUT</span> <span class="token operator">=</span> <span class="token string">&#39;PUT&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-effectrunnermap-js" tabindex="-1"><a class="header-anchor" href="#_3-6-effectrunnermap-js"><span>3.6 effectRunnerMap.js</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/redux-saga/blob/master/packages/core/src/internal/effectRunnerMap.js" target="_blank" rel="noopener noreferrer">effectRunnerMap.js</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effectTypes <span class="token keyword">from</span> <span class="token string">&#39;./effectTypes&#39;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runTakeEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>pattern<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">matcher</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span>type <span class="token operator">===</span> pattern<span class="token punctuation">;</span></span>
<span class="line">  env<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runPutEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> effectRunnerMap <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">TAKE</span><span class="token punctuation">]</span><span class="token operator">:</span> runTakeEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">]</span><span class="token operator">:</span> runPutEffect</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> effectRunnerMap<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-proc-js" tabindex="-1"><a class="header-anchor" href="#_3-6-proc-js"><span>3.6 proc.js</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/redux-saga/blob/master/packages/core/src/internal/proc.js" target="_blank" rel="noopener noreferrer">proc.js</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> effectRunnerMap <span class="token keyword">from</span> <span class="token string">&#39;./effectRunnerMap&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">proc</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> iterator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">,</span> isErr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>isErr<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      result <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      result <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">runEffect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">,</span> next<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">runEffect</span><span class="token punctuation">(</span><span class="token parameter">effect<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>effect<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> effectRunner <span class="token operator">=</span> effectRunnerMap<span class="token punctuation">[</span>effect<span class="token punctuation">.</span>type<span class="token punctuation">]</span></span>
<span class="line">      <span class="token function">effectRunner</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> effect<span class="token punctuation">.</span>payload<span class="token punctuation">,</span> next<span class="token punctuation">,</span><span class="token punctuation">{</span>runEffect<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-effects-js" tabindex="-1"><a class="header-anchor" href="#_3-7-effects-js"><span>3.7 effects.js</span></a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/redux-saga/blob/master/packages/core/src/effects.js" target="_blank" rel="noopener noreferrer">effects.js</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effectTypes <span class="token keyword">from</span> <span class="token string">&#39;./effectTypes&#39;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">makeEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  type<span class="token punctuation">,</span></span>
<span class="line">  payload</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token parameter">pattern</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">makeEffect</span><span class="token punctuation">(</span>effectTypes<span class="token punctuation">.</span><span class="token constant">TAKE</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> pattern <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">makeEffect</span><span class="token punctuation">(</span>effectTypes<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-支持产出iterator" tabindex="-1"><a class="header-anchor" href="#_4-支持产出iterator"><span>4. 支持产出iterator</span></a></h2><h3 id="_4-1-sagas-js" tabindex="-1"><a class="header-anchor" href="#_4-1-sagas-js"><span>4.1 sagas.js</span></a></h3><p>src\\store\\sagas.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> put<span class="token punctuation">,</span> take<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux-saga/effects&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actionTypes <span class="token keyword">from</span> <span class="token string">&#39;./action-types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>actionTypes<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">         <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>actionTypes<span class="token punctuation">.</span><span class="token constant">ASYNC_ADD</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">         <span class="token keyword">yield</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">     <span class="token punctuation">}</span> </span>
<span class="line">     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;已经达到最大值&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-is-js" tabindex="-1"><a class="header-anchor" href="#_4-2-is-js"><span>4.2 is.js</span></a></h3><p>src\\redux-saga\\is.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> f <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">iterator</span> <span class="token operator">=</span> <span class="token parameter">it</span> <span class="token operator">=&gt;</span> it <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>throw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-proc-js" tabindex="-1"><a class="header-anchor" href="#_4-3-proc-js"><span>4.3 proc.js</span></a></h3><p>src\\redux-saga\\proc.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import effectRunnerMap from &#39;./effectRunnerMap&#39;;</span>
<span class="line">+import * as is  from &#39;./is&#39;;</span>
<span class="line">+export default function proc(env, iterator,cont) {</span>
<span class="line">  next();</span>
<span class="line">  function next(arg, isErr) {</span>
<span class="line">    let result;</span>
<span class="line">    if (isErr) {</span>
<span class="line">      result = iterator.throw(arg);</span>
<span class="line">    } else {</span>
<span class="line">      result = iterator.next(arg);</span>
<span class="line">    }</span>
<span class="line">    if (!result.done) {</span>
<span class="line">      runEffect(result.value, next)</span>
<span class="line">+    }else{</span>
<span class="line">+      cont&amp;&amp;cont(result.value);</span>
<span class="line">+    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  function runEffect(effect, next) {</span>
<span class="line">+    if(is.iterator(effect)){</span>
<span class="line">+      proc(env,effect,next);</span>
<span class="line">+    }else if (effect) {</span>
<span class="line">      const effectRunner = effectRunnerMap[effect.type]</span>
<span class="line">+     effectRunner(env, effect.payload, next,{runEffect});</span>
<span class="line">    } else {</span>
<span class="line">      next();</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-支持takeevery" tabindex="-1"><a class="header-anchor" href="#_5-支持takeevery"><span>5. 支持takeEvery</span></a></h2><ul><li>takeEvery 监听action，每监听到一个action，就执行一次操作</li><li>fork 异步非阻塞调用，无阻塞的执行fn，执行fn时，不会暂停Generator</li><li>一个 task 就像是一个在后台运行的进程，在基于redux-saga的应用程序中，可以同时运行多个task</li></ul><h3 id="_5-1-sagas-js" tabindex="-1"><a class="header-anchor" href="#_5-1-sagas-js"><span>5.1 sagas.js</span></a></h3><p>src\\store\\sagas.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { put, takeEvery} from &#39;../redux-saga/effects&#39;;</span>
<span class="line">//import { put, take} from &#39;redux-saga/effects&#39;;</span>
<span class="line">import * as actionTypes from &#39;./action-types&#39;;</span>
<span class="line"></span>
<span class="line">export function* add() {</span>
<span class="line">  yield put({type:actionTypes.ADD});</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function* rootSaga() {</span>
<span class="line">+  yield takeEvery(actionTypes.ASYNC_ADD,add);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-effecttypes-js" tabindex="-1"><a class="header-anchor" href="#_5-2-effecttypes-js"><span>5.2 effectTypes.js</span></a></h3><p>src\\redux-saga\\effectTypes.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const TAKE = &#39;TAKE&#39;;</span>
<span class="line">export const PUT = &#39;PUT&#39;;</span>
<span class="line">+export const FORK = &#39;FORK&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-effects-js" tabindex="-1"><a class="header-anchor" href="#_5-3-effects-js"><span>5.3 effects.js</span></a></h3><p>src\\redux-saga\\effects.js import * as effectTypes from &#39;./effectTypes&#39;</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const makeEffect = (type, payload) =&gt; ({</span>
<span class="line">  type,</span>
<span class="line">  payload</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">export function take(pattern) {</span>
<span class="line">  return makeEffect(effectTypes.TAKE, { pattern })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function put(action) {</span>
<span class="line">  return makeEffect(effectTypes.PUT, { action })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">+export function fork(fn) {</span>
<span class="line">+  return makeEffect(effectTypes.FORK, { fn })</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">+export function takeEvery(pattern, saga) {</span>
<span class="line">+  function* takeEveryHelper() {</span>
<span class="line">+    while (true) {</span>
<span class="line">+      yield take(pattern);</span>
<span class="line">+      yield fork(saga);</span>
<span class="line">+    }</span>
<span class="line">+  }</span>
<span class="line">+</span>
<span class="line">+  return fork(takeEveryHelper);</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-effectrunnermap-js" tabindex="-1"><a class="header-anchor" href="#_5-4-effectrunnermap-js"><span>5.4 effectRunnerMap.js</span></a></h3><p>src\\redux-saga\\effectRunnerMap.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effectTypes <span class="token keyword">from</span> <span class="token string">&#39;./effectTypes&#39;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">import</span> proc <span class="token keyword">from</span> <span class="token string">&quot;./proc&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runTakeEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>pattern<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">matcher</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span>type <span class="token operator">===</span> pattern<span class="token punctuation">;</span></span>
<span class="line">  env<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runPutEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> <span class="token function">runForkEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> taskIterator <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token function">proc</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> taskIterator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> effectRunnerMap <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">TAKE</span><span class="token punctuation">]</span><span class="token operator">:</span> runTakeEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">]</span><span class="token operator">:</span> runPutEffect<span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span> <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">FORK</span><span class="token punctuation">]</span><span class="token operator">:</span> runForkEffect</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> effectRunnerMap<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-支持promise" tabindex="-1"><a class="header-anchor" href="#_6-支持promise"><span>6 支持promise</span></a></h2><h3 id="_6-1-sagas-js" tabindex="-1"><a class="header-anchor" href="#_6-1-sagas-js"><span>6.1 sagas.js</span></a></h3><p>src\\store\\sagas.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { put, takeEvery} from &#39;../redux-saga/effects&#39;;</span>
<span class="line">//import { put, takeEvery} from &#39;redux-saga/effects&#39;;</span>
<span class="line">import * as actionTypes from &#39;./action-types&#39;;</span>
<span class="line">+const delay=ms =&gt; new Promise((resolve,reject) =&gt; {</span>
<span class="line">+  setTimeout(() =&gt; {</span>
<span class="line">+      resolve();</span>
<span class="line">+  },ms);</span>
<span class="line">+});</span>
<span class="line">export function* add() {</span>
<span class="line">+  yield delay(1000);</span>
<span class="line">  yield put({type:actionTypes.ADD});</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function* rootSaga() {</span>
<span class="line">  yield takeEvery(actionTypes.ASYNC_ADD,add);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-is-js" tabindex="-1"><a class="header-anchor" href="#_6-2-is-js"><span>6.2 is.js</span></a></h3><p>src\\redux-saga\\is.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> f <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">iterator</span> <span class="token operator">=</span> <span class="token parameter">it</span> <span class="token operator">=&gt;</span> it <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>throw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">promise</span> <span class="token operator">=</span> <span class="token parameter">p</span> <span class="token operator">=&gt;</span> p <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>then<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-proc-js" tabindex="-1"><a class="header-anchor" href="#_6-3-proc-js"><span>6.3 proc.js</span></a></h3><p>src\\redux-saga\\proc.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import effectRunnerMap from &#39;./effectRunnerMap&#39;;</span>
<span class="line">+import * as is from &#39;./is&#39;;</span>
<span class="line">+function resolvePromise(promise, cb) {</span>
<span class="line">+  promise.then(cb, function (error) {</span>
<span class="line">+    cb(error, true);</span>
<span class="line">+  });</span>
<span class="line">+}</span>
<span class="line">export default function proc(env, iterator,cont) {</span>
<span class="line">  next();</span>
<span class="line">  function next(arg, isErr) {</span>
<span class="line">    let result;</span>
<span class="line">    if (isErr) {</span>
<span class="line">      result = iterator.throw(arg);</span>
<span class="line">    } else {</span>
<span class="line">      result = iterator.next(arg);</span>
<span class="line">    }</span>
<span class="line">    if (!result.done) {</span>
<span class="line">      runEffect(result.value, next)</span>
<span class="line">    }else{</span>
<span class="line">      cont&amp;&amp;cont(result.value);</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  function runEffect(effect, next) {</span>
<span class="line">+    if (is.promise(effect)) {</span>
<span class="line">+      resolvePromise(effect, next);</span>
<span class="line">+    }else if(is.iterator(effect)){</span>
<span class="line">      proc(env,effect,next);</span>
<span class="line">    }else if (effect) {</span>
<span class="line">      const effectRunner = effectRunnerMap[effect.type]</span>
<span class="line">      effectRunner(env, effect.payload, next,{runEffect});</span>
<span class="line">    } else {</span>
<span class="line">      next();</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-支持call" tabindex="-1"><a class="header-anchor" href="#_7-支持call"><span>7.支持call</span></a></h2><ul><li>异步阻塞调用</li></ul><h3 id="_7-1-sagas-js" tabindex="-1"><a class="header-anchor" href="#_7-1-sagas-js"><span>7.1 sagas.js</span></a></h3><p>src\\store\\sagas.js <code>\`</code>diff +import { put, takeEvery,call} from &#39;../redux-saga/effects&#39;; //import { put, takeEvery,call} from &#39;redux-saga/effects&#39;; import * as actionTypes from &#39;./action-types&#39;; const delay=ms =&gt; new Promise((resolve,reject) =&gt; { setTimeout(() =&gt; {</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">resolve();</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>},ms); }); export function* add() {</p><ul><li>yield call(delay,1000); yield put({type:actionTypes.ADD}); }</li></ul><p>export function* rootSaga() { yield takeEvery(actionTypes.ASYNC_ADD,add); }</p><pre><code> ##
src\\redux-saga\\effectTypes.js
\`\`\`diff
export const TAKE = &#39;TAKE&#39;;
export const PUT = &#39;PUT&#39;;
export const FORK = &#39;FORK&#39;;
+export const CALL = &#39;CALL&#39;;
</code></pre><h3 id="_7-3-effects-js" tabindex="-1"><a class="header-anchor" href="#_7-3-effects-js"><span>7.3 effects.js</span></a></h3><p>src\\redux-saga\\effects.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const makeEffect = (type, payload) =&gt; ({</span>
<span class="line">  type,</span>
<span class="line">  payload</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">export function take(pattern) {</span>
<span class="line">  return makeEffect(effectTypes.TAKE, { pattern })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function put(action) {</span>
<span class="line">  return makeEffect(effectTypes.PUT, { action })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function fork(fn) {</span>
<span class="line">  return makeEffect(&#39;FORK&#39;, { fn })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function takeEvery(pattern, saga) {</span>
<span class="line">  function* takeEveryHelper() {</span>
<span class="line">    while (true) {</span>
<span class="line">      yield take(pattern);</span>
<span class="line">      yield fork(saga);</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  return fork(takeEveryHelper);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">+export function call(fn, ...args) {</span>
<span class="line">+  return makeEffect(effectTypes.CALL, { fn, args })</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-effectrunnermap-js" tabindex="-1"><a class="header-anchor" href="#_7-4-effectrunnermap-js"><span>7.4 effectRunnerMap.js</span></a></h3><p>src\\redux-saga\\effectRunnerMap.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effectTypes <span class="token keyword">from</span> <span class="token string">&#39;./effectTypes&#39;</span></span>
<span class="line"><span class="token keyword">import</span> proc <span class="token keyword">from</span> <span class="token string">&quot;./proc&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> is <span class="token keyword">from</span> <span class="token string">&#39;./is&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runTakeEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>pattern<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">matcher</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span>type <span class="token operator">===</span> pattern<span class="token punctuation">;</span></span>
<span class="line">  env<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runPutEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runForkEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> taskIterator <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">proc</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> taskIterator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> <span class="token function">runCallEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn<span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">return</span> result</span>
<span class="line"><span class="token operator">+</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> effectRunnerMap <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">TAKE</span><span class="token punctuation">]</span><span class="token operator">:</span> runTakeEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">]</span><span class="token operator">:</span> runPutEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">FORK</span><span class="token punctuation">]</span><span class="token operator">:</span> runForkEffect<span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span> <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CALL</span><span class="token punctuation">]</span><span class="token operator">:</span> runCallEffect</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> effectRunnerMap<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-支持cps" tabindex="-1"><a class="header-anchor" href="#_8-支持cps"><span>8 支持cps</span></a></h2><h3 id="_8-1-sagas-js" tabindex="-1"><a class="header-anchor" href="#_8-1-sagas-js"><span>8.1 sagas.js</span></a></h3><p>src\\store\\sagas.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { put, takeEvery,call,cps} from &#39;../redux-saga/effects&#39;;</span>
<span class="line">//import { put, takeEvery,call,cps} from &#39;redux-saga/effects&#39;;</span>
<span class="line">import * as actionTypes from &#39;./action-types&#39;;</span>
<span class="line">const delay = (ms,callback)=&gt;{</span>
<span class="line">    setTimeout(() =&gt; {</span>
<span class="line">        callback(null,&#39;ok&#39;);</span>
<span class="line">    },ms);</span>
<span class="line">}</span>
<span class="line">export function* add() {</span>
<span class="line">+  let data = yield cps(delay,1000);</span>
<span class="line">+  console.log(data);</span>
<span class="line">  yield put({type:actionTypes.ADD});</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function* rootSaga() {</span>
<span class="line">  yield takeEvery(actionTypes.ASYNC_ADD,add);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-is-js" tabindex="-1"><a class="header-anchor" href="#_8-2-is-js"><span>8.2 is.js</span></a></h3><p>src\\redux-saga\\is.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> f <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">iterator</span> <span class="token operator">=</span> <span class="token parameter">it</span> <span class="token operator">=&gt;</span> it <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>throw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">promise</span> <span class="token operator">=</span> <span class="token parameter">p</span> <span class="token operator">=&gt;</span> p <span class="token operator">&amp;&amp;</span> <span class="token function">func</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>then<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">undef</span> <span class="token operator">=</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> v <span class="token operator">===</span> <span class="token keyword">undefined</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-effecttypes-js" tabindex="-1"><a class="header-anchor" href="#_8-3-effecttypes-js"><span>8.3 effectTypes.js</span></a></h3><p>src\\redux-saga\\effectTypes.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const TAKE = &#39;TAKE&#39;;</span>
<span class="line">export const PUT = &#39;PUT&#39;;</span>
<span class="line">export const FORK = &#39;FORK&#39;;</span>
<span class="line">export const CALL = &#39;CALL&#39;;</span>
<span class="line">+export const CPS = &#39;CPS&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-4-effects-js" tabindex="-1"><a class="header-anchor" href="#_8-4-effects-js"><span>8.4 effects.js</span></a></h3><p>src\\redux-saga\\effects.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as effectTypes from &#39;./effectTypes&#39;</span>
<span class="line">const makeEffect = (type, payload) =&gt; ({</span>
<span class="line">  type,</span>
<span class="line">  payload</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">export function take(pattern) {</span>
<span class="line">  return makeEffect(effectTypes.TAKE, { pattern })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function put(action) {</span>
<span class="line">  return makeEffect(effectTypes.PUT, { action })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function fork(fn) {</span>
<span class="line">  return makeEffect(effectTypes.FORK, { fn })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function takeEvery(pattern, saga) {</span>
<span class="line">  function* takeEveryHelper() {</span>
<span class="line">    while (true) {</span>
<span class="line">      yield take(pattern);</span>
<span class="line">      yield fork(saga);</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  return fork(takeEveryHelper);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function call(fn, ...args) {</span>
<span class="line">  return makeEffect(effectTypes.CALL, { fn, args })</span>
<span class="line">}</span>
<span class="line">+export function cps(fn, ...args) {</span>
<span class="line">+  return makeEffect(effectTypes.CPS, { fn, args })</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-5-effectrunnermap-js" tabindex="-1"><a class="header-anchor" href="#_8-5-effectrunnermap-js"><span>8.5 effectRunnerMap.js</span></a></h3><p>src\\redux-saga\\effectRunnerMap.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effectTypes <span class="token keyword">from</span> <span class="token string">&#39;./effectTypes&#39;</span></span>
<span class="line"><span class="token keyword">import</span> proc <span class="token keyword">from</span> <span class="token string">&quot;./proc&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> is  <span class="token keyword">from</span> <span class="token string">&#39;./is&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runTakeEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>pattern<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">matcher</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span>type <span class="token operator">===</span> pattern<span class="token punctuation">;</span></span>
<span class="line">  env<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runPutEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runForkEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> taskIterator <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">proc</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> taskIterator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runCallEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn<span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> result</span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> <span class="token function">runCPSEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>context<span class="token punctuation">,</span>fn<span class="token punctuation">,</span>args<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> <span class="token function-variable function">cpsCb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">undef</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>      <span class="token function">cb</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>      <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cpsCb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> effectRunnerMap <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">TAKE</span><span class="token punctuation">]</span><span class="token operator">:</span> runTakeEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">]</span><span class="token operator">:</span> runPutEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">FORK</span><span class="token punctuation">]</span><span class="token operator">:</span> runForkEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CALL</span><span class="token punctuation">]</span><span class="token operator">:</span> runCallEffect<span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span> <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CPS</span><span class="token punctuation">]</span><span class="token operator">:</span> runCPSEffect</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> effectRunnerMap<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-支持all" tabindex="-1"><a class="header-anchor" href="#_9-支持all"><span>9.支持all</span></a></h2><ul><li><code>all</code>合并多个异步操作,当某个操作失败或者全部操作成功则进行返回</li><li><code>all</code>中的异步操作是并发也是同步,不用等一个结束,也不用等另一个开始</li></ul><h3 id="_9-1-sagas-js" tabindex="-1"><a class="header-anchor" href="#_9-1-sagas-js"><span>9.1 sagas.js</span></a></h3><p>src\\store\\sagas.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { put, takeEvery,call,cps,all,take} from &#39;../redux-saga/effects&#39;;</span>
<span class="line">//import { put, takeEvery,call,cps,all,take} from &#39;redux-saga/effects&#39;;</span>
<span class="line">import * as actionTypes from &#39;./action-types&#39;;</span>
<span class="line"></span>
<span class="line">+export function* add1() {</span>
<span class="line">+  for (let i=0;i&lt;3;i++){</span>
<span class="line">+      yield take(actionTypes.ASYNC_ADD);</span>
<span class="line">+      yield put({type:actionTypes.ADD});</span>
<span class="line">+  }</span>
<span class="line">+  return &#39;add1&#39;;</span>
<span class="line">+}</span>
<span class="line">+export function* add2() {</span>
<span class="line">+  for (let i=0;i&lt;3;i++){</span>
<span class="line">+      yield take(actionTypes.ASYNC_ADD);</span>
<span class="line">+      yield put({type:actionTypes.ADD});</span>
<span class="line">+  }</span>
<span class="line">+  return &#39;add2&#39;;</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">export function* rootSaga() {</span>
<span class="line">+  let result = yield all([add1(),add2()]);</span>
<span class="line">+  console.log(&#39;done&#39;,result);</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-effecttypes-js" tabindex="-1"><a class="header-anchor" href="#_9-2-effecttypes-js"><span>9.2 effectTypes.js</span></a></h3><p>src\\redux-saga\\effectTypes.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const TAKE = &#39;TAKE&#39;;</span>
<span class="line">export const PUT = &#39;PUT&#39;;</span>
<span class="line">export const FORK = &#39;FORK&#39;;</span>
<span class="line">export const CALL = &#39;CALL&#39;;</span>
<span class="line">export const CPS = &#39;CPS&#39;;</span>
<span class="line">+export const ALL = &#39;ALL&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-effects-js" tabindex="-1"><a class="header-anchor" href="#_9-3-effects-js"><span>9.3 effects.js</span></a></h3><p>src\\redux-saga\\effects.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as effectTypes from &#39;./effectTypes&#39;</span>
<span class="line">const makeEffect = (type, payload) =&gt; ({</span>
<span class="line">  type,</span>
<span class="line">  payload</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">export function take(pattern) {</span>
<span class="line">  return makeEffect(effectTypes.TAKE, { pattern })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function put(action) {</span>
<span class="line">  return makeEffect(effectTypes.PUT, { action })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function fork(fn) {</span>
<span class="line">  return makeEffect(effectTypes.FORK, { fn })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function takeEvery(pattern, saga) {</span>
<span class="line">  function* takeEveryHelper() {</span>
<span class="line">    while (true) {</span>
<span class="line">      yield take(pattern);</span>
<span class="line">      yield fork(saga);</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  return fork(takeEveryHelper);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function call(fn, ...args) {</span>
<span class="line">  return makeEffect(effectTypes.CALL, { fn, args })</span>
<span class="line">}</span>
<span class="line">export function cps(fn, ...args) {</span>
<span class="line">  return makeEffect(effectTypes.CPS, { fn, args })</span>
<span class="line">}</span>
<span class="line">+export function all(effects) {</span>
<span class="line">+  return makeEffect(effectTypes.ALL, effects)</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-4-utils-js" tabindex="-1"><a class="header-anchor" href="#_9-4-utils-js"><span>9.4 utils.js</span></a></h3><p>src\\redux-saga\\utils.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createAllStyleChildCallbacks</span><span class="token punctuation">(</span><span class="token parameter">shape<span class="token punctuation">,</span> parentCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> totalCount <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> completedCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>totalCount<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> childCallbacks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">checkEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>completedCount <span class="token operator">===</span> totalCount<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">parentCallback</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      childCallbacks<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        results<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">;</span></span>
<span class="line">        completedCount<span class="token operator">++</span></span>
<span class="line">        <span class="token function">checkEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> childCallbacks</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-5-effectrunnermap-js" tabindex="-1"><a class="header-anchor" href="#_9-5-effectrunnermap-js"><span>9.5 effectRunnerMap.js</span></a></h3><p>src\\redux-saga\\effectRunnerMap.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> proc <span class="token keyword">from</span> <span class="token string">&quot;./proc&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> is  <span class="token keyword">from</span> <span class="token string">&#39;./is&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effectTypes <span class="token keyword">from</span> <span class="token string">&#39;./effectTypes&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>createAllStyleChildCallbacks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./utils&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runTakeEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>pattern<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">matcher</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span>type <span class="token operator">===</span> pattern<span class="token punctuation">;</span></span>
<span class="line">  env<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runPutEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runForkEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> taskIterator <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">proc</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> taskIterator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runCallEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn<span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> result</span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runCPSEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>context<span class="token punctuation">,</span>fn<span class="token punctuation">,</span>args<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">cpsCb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">undef</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">cb</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cpsCb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> <span class="token function">runAllEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> effects<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token punctuation">{</span> runEffect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>effects<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> childCallbacks <span class="token operator">=</span> <span class="token function">createAllStyleChildCallbacks</span><span class="token punctuation">(</span>effects<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token function">runEffect</span><span class="token punctuation">(</span>effects<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> childCallbacks<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> effectRunnerMap <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">TAKE</span><span class="token punctuation">]</span><span class="token operator">:</span> runTakeEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">]</span><span class="token operator">:</span> runPutEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">FORK</span><span class="token punctuation">]</span><span class="token operator">:</span> runForkEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CALL</span><span class="token punctuation">]</span><span class="token operator">:</span> runCallEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CPS</span><span class="token punctuation">]</span><span class="token operator">:</span> runCPSEffect<span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">]</span><span class="token operator">:</span> runAllEffect</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> effectRunnerMap<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-支持cancel" tabindex="-1"><a class="header-anchor" href="#_10-支持cancel"><span>10.支持cancel</span></a></h2><ul><li>cancel 指示 middleware 取消之前的 fork 任务，cancel 是一个无阻塞 Effect</li></ul><h3 id="_10-1-sagas-js" tabindex="-1"><a class="header-anchor" href="#_10-1-sagas-js"><span>10.1 sagas.js</span></a></h3><p>src\\store\\sagas.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { put, takeEvery,call,cps,all,take,cancel,fork,delay} from &#39;../redux-saga/effects&#39;;</span>
<span class="line">//import { put, takeEvery,call,cps,all,take,delay,cancel,fork} from &#39;redux-saga/effects&#39;;</span>
<span class="line">import * as actionTypes from &#39;./action-types&#39;;</span>
<span class="line">+export function* add() {</span>
<span class="line">+  while(true){</span>
<span class="line">+      yield delay(1000);</span>
<span class="line">+      yield put({type:actionTypes.ADD});</span>
<span class="line">+  }</span>
<span class="line">+}</span>
<span class="line">+export function* addWatcher() {</span>
<span class="line">+  const task = yield fork(add);</span>
<span class="line">+  yield take(actionTypes.STOP_ADD);</span>
<span class="line">+  yield cancel(task);</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">+export function* rootSaga() {</span>
<span class="line">+  let result = yield addWatcher();</span>
<span class="line">+  console.log(&#39;done&#39;,result);</span>
<span class="line">+}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-2-effecttypes-js" tabindex="-1"><a class="header-anchor" href="#_10-2-effecttypes-js"><span>10.2 effectTypes.js</span></a></h3><p>src\\redux-saga\\effectTypes.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const TAKE = &#39;TAKE&#39;;</span>
<span class="line">export const PUT = &#39;PUT&#39;;</span>
<span class="line">export const FORK = &#39;FORK&#39;;</span>
<span class="line">export const CALL = &#39;CALL&#39;;</span>
<span class="line">export const CPS = &#39;CPS&#39;;</span>
<span class="line">export const ALL = &#39;ALL&#39;;</span>
<span class="line">+export const CANCEL = &#39;CANCEL&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-3-effects-js" tabindex="-1"><a class="header-anchor" href="#_10-3-effects-js"><span>10.3 effects.js</span></a></h3><p>src\\redux-saga\\effects.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as effectTypes from &#39;./effectTypes&#39;</span>
<span class="line">const makeEffect = (type, payload) =&gt; ({</span>
<span class="line">  type,</span>
<span class="line">  payload</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">export function take(pattern) {</span>
<span class="line">  return makeEffect(effectTypes.TAKE, { pattern })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function put(action) {</span>
<span class="line">  return makeEffect(effectTypes.PUT, { action })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function fork(fn) {</span>
<span class="line">  return makeEffect(effectTypes.FORK, { fn })</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function takeEvery(pattern, saga) {</span>
<span class="line">  function* takeEveryHelper() {</span>
<span class="line">    while (true) {</span>
<span class="line">      yield take(pattern);</span>
<span class="line">      yield fork(saga);</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  return fork(takeEveryHelper);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export function call(fn, ...args) {</span>
<span class="line">  return makeEffect(effectTypes.CALL, { fn, args })</span>
<span class="line">}</span>
<span class="line">export function cps(fn, ...args) {</span>
<span class="line">  return makeEffect(effectTypes.CPS, { fn, args })</span>
<span class="line">}</span>
<span class="line">export function all(effects) {</span>
<span class="line">  return makeEffect(effectTypes.ALL, effects)</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">+export function cancel(task) {</span>
<span class="line">+  return makeEffect(effectTypes.CANCEL, task)</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">+export default function delayP(ms, val = true) {</span>
<span class="line">+  const promise = new Promise(resolve =&gt; {</span>
<span class="line">+    setTimeout(resolve, ms, val);</span>
<span class="line">+  })</span>
<span class="line">+  return promise</span>
<span class="line">+}</span>
<span class="line">+export const delay = call.bind(null, delayP)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-4-effectrunnermap-js" tabindex="-1"><a class="header-anchor" href="#_10-4-effectrunnermap-js"><span>10.4 effectRunnerMap.js</span></a></h3><p>src\\redux-saga\\effectRunnerMap.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> proc <span class="token keyword">from</span> <span class="token string">&quot;./proc&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> is  <span class="token keyword">from</span> <span class="token string">&#39;./is&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effectTypes <span class="token keyword">from</span> <span class="token string">&#39;./effectTypes&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>createAllStyleChildCallbacks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./utils&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runTakeEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>pattern<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">matcher</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span>type <span class="token operator">===</span> pattern<span class="token punctuation">;</span></span>
<span class="line">  env<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runPutEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runForkEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> taskIterator <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token function">proc</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> taskIterator<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token function">cb</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runCallEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span> fn<span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> result</span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runCPSEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> <span class="token punctuation">{</span>context<span class="token punctuation">,</span>fn<span class="token punctuation">,</span>args<span class="token punctuation">}</span><span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token function-variable function">cpsCb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">undef</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">cb</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cpsCb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">runAllEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> effects<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> <span class="token punctuation">{</span> runEffect <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>effects<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> childCallbacks <span class="token operator">=</span> <span class="token function">createAllStyleChildCallbacks</span><span class="token punctuation">(</span>effects<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">runEffect</span><span class="token punctuation">(</span>effects<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> childCallbacks<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> <span class="token function">runCancelEffect</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> task<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>  task<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span>  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> effectRunnerMap <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">TAKE</span><span class="token punctuation">]</span><span class="token operator">:</span> runTakeEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">]</span><span class="token operator">:</span> runPutEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">FORK</span><span class="token punctuation">]</span><span class="token operator">:</span> runForkEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CALL</span><span class="token punctuation">]</span><span class="token operator">:</span> runCallEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CPS</span><span class="token punctuation">]</span><span class="token operator">:</span> runCPSEffect<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">]</span><span class="token operator">:</span> runAllEffect<span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span> <span class="token punctuation">[</span>effectTypes<span class="token punctuation">.</span><span class="token constant">CANCEL</span><span class="token punctuation">]</span><span class="token operator">:</span> runCancelEffect</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> effectRunnerMap<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-5-symbols-js" tabindex="-1"><a class="header-anchor" href="#_10-5-symbols-js"><span>10.5 symbols.js</span></a></h3><p>src\\redux-saga\\symbols.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span>  <span class="token constant">TASK_CANCEL</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&#39;TASK_CANCEL&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_10-6-proc-js" tabindex="-1"><a class="header-anchor" href="#_10-6-proc-js"><span>10.6 proc.js</span></a></h3><p>src\\redux-saga\\proc.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import effectRunnerMap from &#39;./effectRunnerMap&#39;;</span>
<span class="line">+import {TASK_CANCEL} from &#39;./symbols&#39;;</span>
<span class="line">import * as is  from &#39;./is&#39;;</span>
<span class="line"></span>
<span class="line">function resolvePromise(promise, cb) {</span>
<span class="line">  promise.then(cb, function (error) {</span>
<span class="line">    cb(error, true);</span>
<span class="line">  });</span>
<span class="line">}</span>
<span class="line">export default function proc(env, iterator,cont) {</span>
<span class="line">+ let task = {cancel:()=&gt;next(TASK_CANCEL)};</span>
<span class="line">  next();</span>
<span class="line">  function next(arg, isErr) {</span>
<span class="line">    let result;</span>
<span class="line">    if (isErr) {</span>
<span class="line">      result = iterator.throw(arg);</span>
<span class="line">+    }else if(arg === TASK_CANCEL){</span>
<span class="line">+      result = iterator.return(arg);</span>
<span class="line">+    } else {</span>
<span class="line">      result = iterator.next(arg);</span>
<span class="line">    }</span>
<span class="line">    if (!result.done) {</span>
<span class="line">      runEffect(result.value, next)</span>
<span class="line">    }else{</span>
<span class="line">      cont&amp;&amp;cont(result.value);</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line"></span>
<span class="line">  function runEffect(effect, next) {</span>
<span class="line">    if (is.promise(effect)) {</span>
<span class="line">      resolvePromise(effect, next);</span>
<span class="line">    }else if(is.iterator(effect)){</span>
<span class="line">      proc(env,effect,next);</span>
<span class="line">    }else if (effect) {</span>
<span class="line">      const effectRunner = effectRunnerMap[effect.type]</span>
<span class="line">      effectRunner(env, effect.payload, next,{runEffect});</span>
<span class="line">    } else {</span>
<span class="line">      next();</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">+  return task;</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-7-action-types-js" tabindex="-1"><a class="header-anchor" href="#_10-7-action-types-js"><span>10.7 action-types.js</span></a></h3><p>src\\store\\action-types.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export const ASYNC_ADD=&#39;ASYNC_ADD&#39;;</span>
<span class="line">export const ADD=&#39;ADD&#39;;</span>
<span class="line">+export const STOP_ADD=&#39;STOP_ADD&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-8-actions-js" tabindex="-1"><a class="header-anchor" href="#_10-8-actions-js"><span>10.8 actions.js</span></a></h3><p>src\\store\\actions.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as actionTypes from &#39;./action-types&#39;;</span>
<span class="line">const actions = {</span>
<span class="line">    add() {</span>
<span class="line">        return {type:actionTypes.ASYNC_ADD}</span>
<span class="line">    },</span>
<span class="line">+    stop() {</span>
<span class="line">+        return {type:actionTypes.STOP_ADD}</span>
<span class="line">+    }</span>
<span class="line">}</span>
<span class="line">export default actions;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-9-counter-js" tabindex="-1"><a class="header-anchor" href="#_10-9-counter-js"><span>10.9 Counter.js</span></a></h3><p>src\\components\\Counter.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React,{Component} from &#39;react&#39;</span>
<span class="line">import {connect} from &#39;react-redux&#39;;</span>
<span class="line">import actions from &#39;../store/actions&#39;;</span>
<span class="line">class Counter extends Component{</span>
<span class="line">    render() {</span>
<span class="line">        return (</span>
<span class="line">            &lt;div&gt;</span>
<span class="line">                &lt;p&gt;{this.props.number}&lt;/p&gt;</span>
<span class="line">+               &lt;button onClick={this.props.stop}&gt;stop&lt;/button&gt;</span>
<span class="line">            &lt;/div&gt;</span>
<span class="line">      )</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line">export default connect(</span>
<span class="line">    state =&gt; state,</span>
<span class="line">    actions</span>
<span class="line">)(Counter);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,197)])])}const o=s(t,[["render",c]]),u=JSON.parse('{"path":"/strong/113.redux-saga.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/113.redux-saga.md"}');export{o as comp,u as data};
