import{_ as s,c as a,a as e,o as p}from"./app-CD1YpnS1.js";const t={};function l(o,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h2 id="_1-redux中间件" tabindex="-1"><a class="header-anchor" href="#_1-redux中间件"><span>1. Redux中间件</span></a></h2><ul><li>如果没有中间件的运用,redux 的工作流程是这样 <code>action -&gt; reducer</code>，这是相当于同步操作，由dispatch 触发action后，直接去reducer执行相应的动作</li><li>但是在某些比较复杂的业务逻辑中，这种同步的实现方式并不能很好的解决我们的问题。比如我们有一个这样的需求，点击按钮 -&gt; 获取服务器数据 -&gt; 渲染视图，因为获取服务器数据是需要异步实现，所以这时候我就需要引入中间件改变redux同步执行的流程，形成异步流程来实现我们所要的逻辑，有了中间件，redux 的工作流程就变成这样 action -&gt; middlewares -&gt; reducer，点击按钮就相当于dispatch 触发action，接下去获取服务器数据 middlewares 的执行，当 middlewares 成功获取到服务器就去触发reducer对应的动作，更新需要渲染视图的数据</li><li>中间件的机制可以让我们改变数据流，实现如异步 action ，action 过滤，日志输出，异常报告等功能。</li></ul><p><img src="http://img.zhufengpeixun.cn/reduxmiddleware.jpg" alt="reduxmiddleware"></p><h2 id="_2-日志中间件" tabindex="-1"><a class="header-anchor" href="#_2-日志中间件"><span>2. 日志中间件</span></a></h2><ul><li>我们改写了<code>dispatch</code>方法,实现了在更改状态时打印前后的状态</li><li>但是这种方案并不好。所以我们可以采用中间的方式</li></ul><h3 id="_2-1-实现日志" tabindex="-1"><a class="header-anchor" href="#_2-1-实现日志"><span>2.1 实现日志</span></a></h3><p>src\\store\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> Store<span class="token punctuation">,</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">&#39;./reducers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./reducers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">store</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span>CombinedState<span class="token punctuation">,</span> AnyAction<span class="token operator">&gt;</span> <span class="token operator">=</span> createStore<span class="token operator">&lt;</span>CombinedState<span class="token punctuation">,</span> AnyAction<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter1</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">counter2</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> dispatch <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span></span>
<span class="line">store<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">action</span><span class="token operator">:</span> AnyAction</span><span class="token punctuation">)</span><span class="token operator">:</span> AnyAction <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> action<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-实现异步" tabindex="-1"><a class="header-anchor" href="#_2-2-实现异步"><span>2.2 实现异步</span></a></h3><p>src\\store\\index.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> Store<span class="token punctuation">,</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../redux&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">&#39;./reducers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./reducers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token literal-property property">store</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span>CombinedState<span class="token punctuation">,</span> AnyAction<span class="token operator">&gt;</span> <span class="token operator">=</span> createStore<span class="token operator">&lt;</span>CombinedState<span class="token punctuation">,</span> AnyAction<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter1</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">counter2</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> dispatch <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span></span>
<span class="line">store<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">action</span><span class="token operator">:</span> AnyAction</span><span class="token punctuation">)</span><span class="token operator">:</span> AnyAction <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> action<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-日志中间件" tabindex="-1"><a class="header-anchor" href="#_3-日志中间件"><span>3. 日志中间件</span></a></h2><h3 id="_3-1-store-index-tsx" tabindex="-1"><a class="header-anchor" href="#_3-1-store-index-tsx"><span>3.1 store\\index.tsx</span></a></h3><p>src\\store\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+import { createStore, Store, AnyAction, Middleware, MiddlewareAPI, StoreEnhancer, StoreEnhancerStoreCreator, applyMiddleware } from &#39;../redux&#39;;</span>
<span class="line">import reducer from &#39;./reducers&#39;;</span>
<span class="line">import { CombinedState } from &#39;./reducers&#39;;</span>
<span class="line">+//const store: Store&lt;CombinedState, AnyAction&gt; = createStore&lt;CombinedState, AnyAction, {}, {}&gt;(reducer, { counter1: { number: 0 }, counter2: { number: 0 } });</span>
<span class="line">+let logger: Middleware = (api: MiddlewareAPI) =&gt; (next: any) =&gt; (action: any) =&gt; {</span>
<span class="line">+    console.log(api.getState());</span>
<span class="line">+    next(action);</span>
<span class="line">+    console.log(api.getState());</span>
<span class="line">+    return action;</span>
<span class="line">+};</span>
<span class="line">+let storeEnhancer: StoreEnhancer = applyMiddleware(logger);</span>
<span class="line">+let storeEnhancerStoreCreator: StoreEnhancerStoreCreator = storeEnhancer(createStore);</span>
<span class="line">+let store: Store = storeEnhancerStoreCreator(reducer);</span>
<span class="line">+export default store;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-redux-types-tsx" tabindex="-1"><a class="header-anchor" href="#_3-2-redux-types-tsx"><span>3.2 redux\\types.tsx</span></a></h3><p>src\\redux\\types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">export interface Action&lt;T = any&gt; {</span>
<span class="line">    type: T</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export interface AnyAction extends Action {</span>
<span class="line">    [extraProps: string]: any</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">export type Reducer&lt;S = any, A extends Action = AnyAction&gt; = (</span>
<span class="line">    state: S | undefined,</span>
<span class="line">    action: A</span>
<span class="line">) =&gt; S</span>
<span class="line"></span>
<span class="line">+export interface Dispatch&lt;A extends Action = AnyAction&gt; {</span>
<span class="line">+    &lt;T extends A&gt;(action: T): T</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">export interface Unsubscribe {</span>
<span class="line">    (): void</span>
<span class="line">}</span>
<span class="line">export interface Store&lt;S = any, A extends Action = AnyAction&gt; {</span>
<span class="line">    dispatch: Dispatch&lt;A&gt;;</span>
<span class="line">    getState(): S;</span>
<span class="line">    subscribe(listener: () =&gt; void): Unsubscribe;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">+export interface Middleware&lt;</span>
<span class="line">+    DispatchExt = {},</span>
<span class="line">+    S = any,</span>
<span class="line">+    D extends Dispatch = Dispatch</span>
<span class="line">+    &gt; {</span>
<span class="line">+    (api: MiddlewareAPI&lt;D, S&gt;): (</span>
<span class="line">+        next: Dispatch&lt;AnyAction&gt;</span>
<span class="line">+    ) =&gt; (action: any) =&gt; any</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">+export interface MiddlewareAPI&lt;D extends Dispatch = Dispatch, S = any&gt; {</span>
<span class="line">+    dispatch: D</span>
<span class="line">+    getState(): S</span>
<span class="line">+}</span>
<span class="line"></span>
<span class="line">+export type StoreEnhancer = (</span>
<span class="line">+    next: StoreEnhancerStoreCreator</span>
<span class="line">+) =&gt; StoreEnhancerStoreCreator</span>
<span class="line">+export type StoreEnhancerStoreCreator = &lt;</span>
<span class="line">+    S = any,</span>
<span class="line">+    A extends Action = AnyAction</span>
<span class="line">+    &gt;(</span>
<span class="line">+    reducer: Reducer&lt;S, A&gt;,</span>
<span class="line">+    preloadedState?: S</span>
<span class="line">+) =&gt; Store&lt;S, A&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-redux-index-tsx" tabindex="-1"><a class="header-anchor" href="#_3-3-redux-index-tsx"><span>3.3 redux\\index.tsx</span></a></h3><p>src\\redux\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import createStore from &#39;./createStore&#39;;</span>
<span class="line">import bindActionCreators from &#39;./bindActionCreators&#39;;</span>
<span class="line">import combineReducers from &#39;./combineReducers&#39;;</span>
<span class="line">+import applyMiddleware from &#39;./applyMiddleware&#39;</span>
<span class="line">export {</span>
<span class="line">    createStore,</span>
<span class="line">    bindActionCreators,</span>
<span class="line">    combineReducers,</span>
<span class="line">+    applyMiddleware</span>
<span class="line">}</span>
<span class="line">export * from &#39;./types&#39;;</span>
<span class="line">export * from &#39;./bindActionCreators&#39;;</span>
<span class="line">export * from &#39;./combineReducers&#39;;</span>
<span class="line">+export * from &#39;./applyMiddleware&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-redux-compose-tsx" tabindex="-1"><a class="header-anchor" href="#_3-4-redux-compose-tsx"><span>3.4 redux\\compose.tsx</span></a></h3><p>src\\redux\\compose.tsx</p><ul><li><a href="https://github.com/reduxjs/redux/blob/master/src/compose.ts" target="_blank" rel="noopener noreferrer">compose</a></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&#39;1&#39;</span><span class="token operator">+</span>str<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">add2</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&#39;2&#39;</span><span class="token operator">+</span>str<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">add3</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&#39;3&#39;</span><span class="token operator">+</span>str<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>add3<span class="token punctuation">,</span>add2<span class="token punctuation">,</span>add1<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;zhufeng&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funcs<span class="token operator">:</span> Function<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> funcs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-applymiddleware-tsx" tabindex="-1"><a class="header-anchor" href="#_3-5-applymiddleware-tsx"><span>3.5 applyMiddleware.tsx</span></a></h3><p>src\\redux\\applyMiddleware.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> compose <span class="token keyword">from</span> <span class="token string">&#39;./compose&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Middleware<span class="token punctuation">,</span> Store<span class="token punctuation">,</span> StoreEnhancer<span class="token punctuation">,</span> Dispatch<span class="token punctuation">,</span> MiddlewareAPI<span class="token punctuation">,</span> StoreCreator<span class="token punctuation">,</span> Action<span class="token punctuation">,</span> AnyAction<span class="token punctuation">,</span> Reducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./&#39;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter"><span class="token operator">...</span>middlewares<span class="token operator">:</span> Middleware<span class="token punctuation">[</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> StoreEnhancer</span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter"><span class="token operator">...</span>middlewares<span class="token operator">:</span> Middleware<span class="token punctuation">[</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> StoreEnhancer <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">createStore</span><span class="token operator">:</span> StoreCreator</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span><span class="token operator">&gt;</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token literal-property property">reducer</span><span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">let</span> <span class="token literal-property property">dispatch</span><span class="token operator">:</span> Dispatch<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">const</span> <span class="token literal-property property">middlewareAPI</span><span class="token operator">:</span> MiddlewareAPI <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">getState</span><span class="token operator">:</span> store<span class="token punctuation">.</span>getState<span class="token punctuation">,</span></span>
<span class="line">            <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">const</span> chain <span class="token operator">=</span> middlewares<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">middleware</span> <span class="token operator">=&gt;</span> <span class="token function">middleware</span><span class="token punctuation">(</span>middlewareAPI<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        dispatch <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token operator">...</span>chain<span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token operator">...</span>store<span class="token punctuation">,</span></span>
<span class="line">            dispatch</span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>函数兼容性判断</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">x</span><span class="token operator">:</span> string <span class="token operator">|</span> number<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">y</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">y <span class="token operator">=</span> x<span class="token punctuation">;</span></span>
<span class="line">x <span class="token operator">=</span> y<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Action</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> string</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">NameAction</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AgeAction</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AllAction</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span> number<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Dispatch</span><span class="token operator">&lt;</span><span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>action<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">dispatchNameAction</span><span class="token operator">:</span> Dispatch<span class="token operator">&lt;</span>NameAction<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">dispatchAgeAction</span><span class="token operator">:</span> Dispatch<span class="token operator">&lt;</span>AgeAction<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> <span class="token literal-property property">dispatchAllAction</span><span class="token operator">:</span> Dispatch<span class="token operator">&lt;</span>AllAction<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">dispatchNameAction <span class="token operator">=</span> dispatchAgeAction<span class="token punctuation">;</span><span class="token comment">//处理少的能赋值给处理多的</span></span>
<span class="line">dispatchAgeAction <span class="token operator">=</span> dispatchNameAction<span class="token punctuation">;</span><span class="token comment">//处理多的不能赋值给处理少的</span></span>
<span class="line">dispatchAllAction <span class="token operator">=</span> dispatchNameAction<span class="token punctuation">;</span></span>
<span class="line">dispatchAllAction <span class="token operator">=</span> dispatchAgeAction<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-级联中间件" tabindex="-1"><a class="header-anchor" href="#_4-级联中间件"><span>4. 级联中间件</span></a></h2><p><img src="http://img.zhufengpeixun.cn/reduxmiddleware.png" alt="applyMiddleware"></p><h3 id="_4-1-store-index-tsx" tabindex="-1"><a class="header-anchor" href="#_4-1-store-index-tsx"><span>4.1 store\\index.tsx</span></a></h3><p>src\\store\\index.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import { createStore, Store, AnyAction, Middleware, MiddlewareAPI, StoreEnhancer, StoreEnhancerStoreCreator, applyMiddleware } from &#39;../redux&#39;;</span>
<span class="line">import reducer from &#39;./reducers&#39;;</span>
<span class="line">import { CombinedState } from &#39;./reducers&#39;;</span>
<span class="line">//const store: Store&lt;CombinedState, AnyAction&gt; = createStore&lt;CombinedState, AnyAction, {}, {}&gt;(reducer, { counter1: { number: 0 }, counter2: { number: 0 } });</span>
<span class="line">let logger: Middleware = (api: MiddlewareAPI) =&gt; (next: any) =&gt; (action: any) =&gt; {</span>
<span class="line">    console.log(api.getState());</span>
<span class="line">    next(action);</span>
<span class="line">    console.log(api.getState());</span>
<span class="line">    return action;</span>
<span class="line">};</span>
<span class="line">+let thunk: Middleware = (api: MiddlewareAPI) =&gt; (next: any) =&gt; (action: any) =&gt; {</span>
<span class="line">+    if (typeof action == &#39;function&#39;) {</span>
<span class="line">+        return action(api.dispatch, api.getState);</span>
<span class="line">+    }</span>
<span class="line">+    return next(action);</span>
<span class="line">+};</span>
<span class="line">+function isPromise(obj: any) {</span>
<span class="line">+    return !!obj &amp;&amp; (typeof obj === &#39;object&#39; || typeof obj === &#39;function&#39;) &amp;&amp; typeof obj.then === &#39;function&#39;;</span>
<span class="line">+}</span>
<span class="line">+let promise: Middleware = (api: MiddlewareAPI) =&gt; (next: any) =&gt; (action: any) =&gt; {</span>
<span class="line">+    return isPromise(action.payload)</span>
<span class="line">+        ? action.payload</span>
<span class="line">+            .then((result: any) =&gt; api.dispatch({ ...action, payload: result }))</span>
<span class="line">+            .catch((error: any) =&gt; {</span>
<span class="line">+                api.dispatch({ ...action, payload: error, error: true });</span>
<span class="line">+                return Promise.reject(error);</span>
<span class="line">+            })</span>
<span class="line">+        : next(action);</span>
<span class="line">+};</span>
<span class="line">+let storeEnhancer: StoreEnhancer = applyMiddleware(thunk, promise, logger);</span>
<span class="line">let storeEnhancerStoreCreator: StoreEnhancerStoreCreator = storeEnhancer(createStore);</span>
<span class="line">let store: Store = storeEnhancerStoreCreator(reducer);</span>
<span class="line">export default store;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-actions-counter1-tsx" tabindex="-1"><a class="header-anchor" href="#_4-2-actions-counter1-tsx"><span>4.2 actions\\counter1.tsx</span></a></h3><p>src\\store\\actions\\counter1.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import * as types from &#39;../action-types&#39;;</span>
<span class="line">+import { AnyAction, Dispatch } from &#39;../../redux&#39;;</span>
<span class="line">const actions = {</span>
<span class="line">    increment1(): AnyAction {</span>
<span class="line">        return { type: types.INCREMENT1 };</span>
<span class="line">    },</span>
<span class="line">+    increment1Async() {</span>
<span class="line">+        return function (dispatch: Dispatch) {</span>
<span class="line">+            setTimeout(() =&gt; {</span>
<span class="line">+                dispatch({ type: types.INCREMENT1 });</span>
<span class="line">+            }, 1000);</span>
<span class="line">+        }</span>
<span class="line">+    },</span>
<span class="line">+    increment1Promise() {</span>
<span class="line">+        return {</span>
<span class="line">+            type: types.INCREMENT1,</span>
<span class="line">+            payload: new Promise((resolve: any, reject: any) =&gt; {</span>
<span class="line">+                setTimeout(() =&gt; {</span>
<span class="line">+                    let result = Math.random();</span>
<span class="line">+                    if (result &gt; .5) {</span>
<span class="line">+                        resolve(result);</span>
<span class="line">+                    } else {</span>
<span class="line">+                        reject(result);</span>
<span class="line">+                    }</span>
<span class="line">+                }, 1000);</span>
<span class="line">+            })</span>
<span class="line">+        }</span>
<span class="line">+    },</span>
<span class="line">    decrement1(): AnyAction {</span>
<span class="line">        return { type: types.DECREMENT1 };</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">export default actions;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-counter1-tsx" tabindex="-1"><a class="header-anchor" href="#_4-3-counter1-tsx"><span>4.3 Counter1.tsx</span></a></h3><p>src\\components\\Counter1.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">import React, { Component } from &#39;react&#39;;</span>
<span class="line">import actions from &#39;../store/actions/counter1&#39;;</span>
<span class="line">import { CombinedState } from &#39;../store/reducers&#39;;</span>
<span class="line">import { Counter1State } from &#39;../store/reducers/counter1&#39;;</span>
<span class="line">import { connect } from &#39;../react-redux&#39;;</span>
<span class="line">+import { ActionCreatorsMapObject, AnyAction } from &#39;../redux&#39;;</span>
<span class="line">type Props = Counter1State &amp; typeof actions;</span>
<span class="line">class Counter1 extends Component&lt;Props&gt; {</span>
<span class="line">    render() {</span>
<span class="line">        let { number, increment1, decrement1 } = this.props;</span>
<span class="line">        return (</span>
<span class="line">            &lt;div&gt;</span>
<span class="line">                &lt;p&gt;{number}&lt;/p&gt;</span>
<span class="line">                &lt;button onClick={increment1}&gt;+&lt;/button&gt;</span>
<span class="line">+                &lt;button onClick={this.props.increment1Async}&gt;异步+1&lt;/button&gt;</span>
<span class="line">+                &lt;button onClick={this.props.increment1Promise}&gt;promise异步+1&lt;/button&gt;</span>
<span class="line">            &lt;/div&gt;</span>
<span class="line">        )</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">let mapStateToProps = (state: CombinedState): Counter1State =&gt; state.counter1;</span>
<span class="line">+export default connect&lt;any&gt;(</span>
<span class="line">    mapStateToProps,</span>
<span class="line">    actions</span>
<span class="line">)(Counter1)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-connect-tsx" tabindex="-1"><a class="header-anchor" href="#_4-4-connect-tsx"><span>4.4 connect.tsx</span></a></h3><p>src\\react-redux\\connect.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> bindActionCreators<span class="token punctuation">,</span> Unsubscribe<span class="token punctuation">,</span> AnyAction<span class="token punctuation">,</span> ActionCreatorsMapObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../redux&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> ReactReduxContext <span class="token keyword">from</span> <span class="token string">&quot;./context&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> CombinedState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../store/reducers&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ContextValue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./types&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">MapStateToProps</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">(</span>state<span class="token operator">:</span> CombinedState<span class="token punctuation">)</span><span class="token operator">:</span> any<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">MapDispatchToProps</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span>method<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token operator">&lt;</span>Action <span class="token operator">=</span> AnyAction<span class="token operator">&gt;</span><span class="token punctuation">(</span>mapStateToProps<span class="token operator">:</span> MapStateToProps<span class="token punctuation">,</span> <span class="token literal-property property">mapDispatchToProps</span><span class="token operator">:</span> ActionCreatorsMapObject<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">wrapWithConnect</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">WrappedComponent</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ComponentType<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">static</span> contextType <span class="token operator">=</span> ReactReduxContext<span class="token punctuation">;</span></span>
<span class="line">            <span class="token literal-property property">unsubscribe</span><span class="token operator">:</span> Unsubscribe<span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">context</span><span class="token operator">:</span> ContextValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span>
<span class="line">                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>                <span class="token keyword">let</span> actions <span class="token operator">=</span> bindActionCreators<span class="token operator">&lt;</span>Action<span class="token punctuation">,</span> ActionCreatorsMapObject<span class="token operator">&lt;</span>Action<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span></span>
<span class="line">                    mapDispatchToProps<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span>dispatch</span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>actions<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-bindactioncreators-tsx" tabindex="-1"><a class="header-anchor" href="#_4-5-bindactioncreators-tsx"><span>4.5 bindActionCreators.tsx</span></a></h3><p>src\\redux\\bindActionCreators.tsx</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Dispatch<span class="token punctuation">,</span> AnyAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ActionCreator</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">A</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ActionCreatorsMapObject</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> ActionCreator<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> bindActionCreators<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">M</span> <span class="token keyword">extends</span> <span class="token class-name">ActionCreatorsMapObject</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token literal-property property">actionCreators</span><span class="token operator">:</span> <span class="token constant">M</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">dispatch</span><span class="token operator">:</span> Dispatch<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">M</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> bindActionCreators<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">M</span> <span class="token keyword">extends</span> <span class="token class-name">ActionCreatorsMapObject</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token literal-property property">actionCreators</span><span class="token operator">:</span> <span class="token constant">M</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>    dispatch<span class="token operator">:</span> Dispatch<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">M</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token operator">+</span>    <span class="token keyword">const</span> <span class="token literal-property property">boundActionCreators</span><span class="token operator">:</span> ActionCreatorsMapObject<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> actionCreators<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> actionCreator <span class="token operator">=</span> actionCreators<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> actionCreator <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            boundActionCreators<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> bindActionCreator<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>actionCreator<span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> boundActionCreators <span class="token keyword">as</span> <span class="token constant">M</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">+</span><span class="token keyword">function</span> bindActionCreator<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token literal-property property">actionCreator</span><span class="token operator">:</span> ActionCreator<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token operator">+</span>    dispatch<span class="token operator">:</span> Dispatch<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">actionCreator</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6-redux-types-tsx" tabindex="-1"><a class="header-anchor" href="#_4-6-redux-types-tsx"><span>4.6 redux\\types.tsx</span></a></h3><p>src\\redux\\types.tsx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">+export interface Dispatch&lt;A = AnyAction&gt; {</span>
<span class="line">    &lt;T extends A&gt;(action: T): T</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,51)])])}const i=s(t,[["render",l]]),r=JSON.parse('{"path":"/strong/82.5.redux_middleware.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/82.5.redux_middleware.md"}');export{i as comp,r as data};
