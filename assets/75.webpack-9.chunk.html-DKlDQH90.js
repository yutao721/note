import{_ as s,c as a,a as p,o as e}from"./app-CD1YpnS1.js";const t={};function c(l,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="_1-chunk" tabindex="-1"><a class="header-anchor" href="#_1-chunk"><span>1.chunk</span></a></h2><ul><li>chunkGroup 由 chunk 组成，一个 chunkGroup 可以包含多个 chunk，在生成/优化 chunk graph 时会用到</li><li>chunk 由 module 组成，一个 chunk 可以包含多个 module,它是 webpack 编译打包后输出的最终文件</li><li>module 就是不同的资源文件，包含了你的代码中提供的例如：js/css/图片 等文件，在编译环节，webpack 会根据不同 module 之间的依赖关系去组合生成 chunk</li></ul><h2 id="_2-seal" tabindex="-1"><a class="header-anchor" href="#_2-seal"><span>2.seal</span></a></h2><ul><li>根据 addEntry 方法中收集到入口文件组成的 _preparedEntrypoints 数组</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function">seal</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">beforeChunks</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> preparedEntrypoint <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_preparedEntrypoints<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> module <span class="token operator">=</span> preparedEntrypoint<span class="token punctuation">.</span>module<span class="token punctuation">;</span><span class="token comment">//入口模块</span></span>
<span class="line">            <span class="token keyword">const</span> name <span class="token operator">=</span> preparedEntrypoint<span class="token punctuation">.</span>name<span class="token punctuation">;</span><span class="token comment">//入口点名称 main</span></span>
<span class="line">            <span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addChunk</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//新建chunk并添加到chunks中 </span></span>
<span class="line">            <span class="token keyword">const</span> entrypoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entrypoint</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成入口点，其实是一个chunkGroup</span></span>
<span class="line">            entrypoint<span class="token punctuation">.</span><span class="token function">setRuntimeChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置运行时chunk</span></span>
<span class="line">            entrypoint<span class="token punctuation">.</span><span class="token function">addOrigin</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> preparedEntrypoint<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//增加来源 ./src/index.js</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>namedChunkGroups<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//key为chunk名称，值为chunkGroup</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>entrypoints<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//入口点key为chunk名称，值为chunkGroup</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span>chunkGroups<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加一个新的chunkGroup</span></span>
<span class="line">            GraphHelpers<span class="token punctuation">.</span><span class="token function">connectChunkGroupAndChunk</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//建立起 chunkGroup 和 chunk 之间的关系</span></span>
<span class="line">            GraphHelpers<span class="token punctuation">.</span><span class="token function">connectChunkAndModule</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//建立起 chunk 和 module 之间的关系</span></span>
<span class="line">            chunk<span class="token punctuation">.</span>entryModule <span class="token operator">=</span> module<span class="token punctuation">;</span><span class="token comment">//代码块的入口模块</span></span>
<span class="line">            chunk<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token comment">//代码块的名称</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">assignDepth</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-buildchunkgraph" tabindex="-1"><a class="header-anchor" href="#_3-buildchunkgraph"><span>3.buildChunkGraph</span></a></h2><ul><li>遍历 <code>module graph</code> 模块依赖图建立起 <code>basic chunk graph</code> 依赖图</li><li>遍历第一步创建的 <code>chunk graph</code> 依赖图，依据之前的 <code>module graph</code> 来优化 <code>chunk graph</code></li></ul><h3 id="_3-1-文件" tabindex="-1"><a class="header-anchor" href="#_3-1-文件"><span>3.1 文件</span></a></h3><h4 id="_3-1-1-index-js" tabindex="-1"><a class="header-anchor" href="#_3-1-1-index-js"><span>3.1.1 index.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> common <span class="token keyword">from</span> <span class="token string">&#39;./common.js&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./lazy.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-common-js" tabindex="-1"><a class="header-anchor" href="#_3-1-2-common-js"><span>3.1.2 common.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> title <span class="token keyword">from</span> <span class="token string">&#39;./title.js&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-1-3-lazy-js" tabindex="-1"><a class="header-anchor" href="#_3-1-3-lazy-js"><span>3.1.3 lazy.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> title <span class="token keyword">from</span> <span class="token string">&#39;./title.js&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./common.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> lazy <span class="token operator">=</span> <span class="token string">&#39;lazy&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-4-title-js" tabindex="-1"><a class="header-anchor" href="#_3-1-4-title-js"><span>3.1.4 title.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token string">&#39;title&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-2-module-graph" tabindex="-1"><a class="header-anchor" href="#_3-2-module-graph"><span>3.2 module graph</span></a></h3><ul><li>对这次 compilation 收集到的 modules 进行一次遍历</li><li>在遍历 module 的过程中，会对这个 module 的 dependencies 依赖进行处理</li><li>同时还会处理这个 module 的 blocks(即在你的代码通过异步 API 加载的模块),个异步 block 都会被加入到遍历的过程当中，被当做一个 module 来处理</li><li>遍历的过程结束后会建立起基本的 module graph，包含普通的 module 及异步 module(block)，最终存储到一个 map 表(blockInfoMap)当中</li><li>[buildChunkGraph](https://github.com/webpack/webpack/blob/c9d4ff7b054fc581c96ce0e53432d44f9dd8ca72/lib/buildChunkGraph.js</li></ul><p><img src="http://img.zhufengpeixun.cn/extraceBlockInfoMap.jpg" alt="extraceBlockInfoMap"></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">extraceBlockInfoMap</span> <span class="token operator">=</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">iteratorDependency</span> <span class="token operator">=</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> ref <span class="token operator">=</span> compilation<span class="token punctuation">.</span><span class="token function">getDependencyReference</span><span class="token punctuation">(</span>currentModule<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//没有模块的跳过</span></span>
<span class="line">        <span class="token keyword">const</span> refModule <span class="token operator">=</span> ref<span class="token punctuation">.</span>module<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>refModule<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        blockInfoModules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>refModule<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">iteratorBlockPrepare</span> <span class="token operator">=</span> <span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        blockInfoBlocks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        blockQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将 block 加入到 blockQueue 当中，从而进入到下一次的遍历过程当中</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> currentModule<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> block<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> blockQueue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> blockInfoModules<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> blockInfoBlocks<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> module <span class="token keyword">of</span> compilation<span class="token punctuation">.</span>modules<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//循环所有的模块</span></span>
<span class="line">        blockQueue <span class="token operator">=</span> <span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//基于此模块创建一个数组blockQueue</span></span>
<span class="line">        currentModule <span class="token operator">=</span> module<span class="token punctuation">;</span><span class="token comment">//当前模块等于此模块</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>blockQueue<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            block <span class="token operator">=</span> blockQueue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//取出一个模块</span></span>
<span class="line">            blockInfoModules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//唯一的模块集合</span></span>
<span class="line">            blockInfoBlocks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//块数组</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>variables<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//变量</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> variable <span class="token keyword">of</span> block<span class="token punctuation">.</span>variables<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> dep <span class="token keyword">of</span> variable<span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span> <span class="token function">iteratorDependency</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//普通依赖</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> dep <span class="token keyword">of</span> block<span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span> <span class="token function">iteratorDependency</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>blocks<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//异步代码块依赖</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> b <span class="token keyword">of</span> block<span class="token punctuation">.</span>blocks<span class="token punctuation">)</span> <span class="token function">iteratorBlockPrepare</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">const</span> blockInfo <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">modules</span><span class="token operator">:</span> blockInfoModules<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">blocks</span><span class="token operator">:</span> blockInfoBlocks</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            blockInfoMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> blockInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> blockInfoMap<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>blockInfoMap</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">NormalModule</span> <span class="token keyword">extends</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>   index<span class="token punctuation">.</span>js</span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ImportDependenciesBlock</span> <span class="token keyword">extends</span> <span class="token class-name">AsyncDependenciesBlock</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span> lazy<span class="token punctuation">.</span>js</span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">NormalModule</span> <span class="token keyword">extends</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span> common<span class="token punctuation">.</span>js</span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">NormalModule</span> <span class="token keyword">extends</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span> title<span class="token punctuation">.</span>js</span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ImportDependenciesBlock</span> <span class="token keyword">extends</span> <span class="token class-name">AsyncDependenciesBlock</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span> common<span class="token punctuation">.</span>js</span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">NormalModule</span> <span class="token keyword">extends</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span> title<span class="token punctuation">.</span>js</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-生成chunk-graph" tabindex="-1"><a class="header-anchor" href="#_3-3-生成chunk-graph"><span>3.3 生成chunk graph</span></a></h3><ul><li>[buildChunkGraph PART ONE](https://github.com/webpack/webpack/blob/c9d4ff7b054fc581c96ce0e53432d44f9dd8ca72/lib/buildChunkGraph.js</li></ul><p><img src="http://img.zhufengpeixun.cn/buildChunkGraph2.jpg" alt="buildChunkGraph2"></p><h4 id="_3-3-1-创建queue" tabindex="-1"><a class="header-anchor" href="#_3-3-1-创建queue"><span>3.3.1 创建queue</span></a></h4><ul><li>将传入的 entryPoint(chunkGroup) 转化为一个新的 <code>queue</code></li><li>chunkGroupInfoMap chunkGroup信息</li><li>minAvailableModules 最小可跟踪的模块集合</li><li>skippedItems 可以跳过的模块</li><li>chunkGroupCounters key为chunkGroup,值为索引</li><li>blockChunkGroups key为依赖块，值为chunkGroup</li><li>allCreatedChunkGroups 所有创建的chunkGroup</li><li>chunkDependencies key为chunkGroup,值为依赖的chunkGroup数组 {block,chunkGroup}</li><li>queueConnect key为chunkGroup,值为一个依赖的chunkGroup数组</li><li>availableModulesToBeMerged 父chunkGroup的模块</li><li>outdatedChunkGroupInfo 过期的chunkGroup信息</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> module <span class="token operator">=</span> chunk<span class="token punctuation">.</span>entryModule<span class="token punctuation">;</span></span>
<span class="line">queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ENTER_MODULE</span><span class="token punctuation">,</span> <span class="token comment">//(需要被处理的模块类型，不同的处理类型的模块会经过不同的流程处理，初始为 ENTER_MODULE(1))</span></span>
<span class="line">    <span class="token literal-property property">block</span><span class="token operator">:</span> module<span class="token punctuation">,</span><span class="token comment">//k (入口 module)</span></span>
<span class="line">    module<span class="token punctuation">,</span><span class="token comment">//(入口 module)</span></span>
<span class="line">    chunk<span class="token punctuation">,</span><span class="token comment">// (seal 阶段一开始为每个入口 module 创建的空 chunk)</span></span>
<span class="line">    chunkGroup<span class="token comment">//(entryPoint 即 chunkGroup 类型)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">visitModules</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">compilation<span class="token punctuation">,</span></span>
<span class="line">    inputChunkGroups<span class="token punctuation">,</span></span>
<span class="line">    chunkGroupInfoMap<span class="token punctuation">,</span></span>
<span class="line">    chunkDependencies<span class="token punctuation">,</span></span>
<span class="line">    blocksWithNestedBlocks<span class="token punctuation">,</span></span>
<span class="line">    allCreatedChunkGroups</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> logger <span class="token operator">=</span> compilation<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;webpack.buildChunkGraph.visitModules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> namedChunkGroups <span class="token punctuation">}</span> <span class="token operator">=</span> compilation<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;prepare&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> blockInfoMap <span class="token operator">=</span> <span class="token function">extraceBlockInfoMap</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Map<span class="token punctuation">&lt;</span>ChunkGroup<span class="token punctuation">,</span> <span class="token punctuation">{</span> index<span class="token operator">:</span> number<span class="token punctuation">,</span> index2<span class="token operator">:</span> number <span class="token punctuation">}</span><span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">const</span> chunkGroupCounters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//计数器</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunkGroup <span class="token keyword">of</span> inputChunkGroups<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        chunkGroupCounters<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">//每个chunkGroup有两个索引，默认值都是0</span></span>
<span class="line">            <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">index2</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> nextFreeModuleIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//下一个空闲的模块索引</span></span>
<span class="line">    <span class="token keyword">let</span> nextFreeModuleIndex2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//下一个空闲的模块索引</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Map<span class="token punctuation">&lt;</span>DependenciesBlock<span class="token punctuation">,</span> ChunkGroup<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">const</span> blockChunkGroups <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> <span class="token constant">ADD_AND_ENTER_MODULE</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//增加并进入模块</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token constant">ENTER_MODULE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//进入模块</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token constant">PROCESS_BLOCK</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//处理代码块</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token constant">LEAVE_MODULE</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">//离开模块</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>QueueItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span> <span class="token parameter">queue</span> the queue array (will be mutated)</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>ChunkGroup<span class="token punctuation">}</span></span> <span class="token parameter">chunkGroup</span> chunk group</span>
<span class="line">     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>QueueItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span> the queue array again</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">reduceChunkGroupToQueueItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">queue<span class="token punctuation">,</span> chunkGroup</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> chunkGroup<span class="token punctuation">.</span>chunks<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> module <span class="token operator">=</span> chunk<span class="token punctuation">.</span>entryModule<span class="token punctuation">;</span></span>
<span class="line">            queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ENTER_MODULE</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">block</span><span class="token operator">:</span> module<span class="token punctuation">,</span></span>
<span class="line">                module<span class="token punctuation">,</span></span>
<span class="line">                chunk<span class="token punctuation">,</span></span>
<span class="line">                chunkGroup</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        chunkGroupInfoMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">            chunkGroup<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">minAvailableModules</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">minAvailableModulesOwned</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">availableModulesToBeMerged</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">skippedItems</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">resultingAvailableModules</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">undefined</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> queue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Start with the provided modules/chunks  把entryPoint(chunkGroup) 转化为一个新的 queue</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>QueueItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> queue <span class="token operator">=</span> inputChunkGroups</span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>reduceChunkGroupToQueueItem<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Map<span class="token punctuation">&lt;</span>ChunkGroup<span class="token punctuation">,</span> Set<span class="token punctuation">&lt;</span>ChunkGroup<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">const</span> queueConnect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Set<span class="token punctuation">&lt;</span>ChunkGroupInfo<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">const</span> outdatedChunkGroupInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>QueueItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> queueDelayed <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;prepare&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Module<span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> module<span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Chunk<span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> chunk<span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>ChunkGroup<span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> chunkGroup<span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>DependenciesBlock<span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> block<span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Set<span class="token punctuation">&lt;</span>Module<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> minAvailableModules<span class="token punctuation">;</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>QueueItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> skippedItems<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// For each async Block in graph</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>AsyncDependenciesBlock<span class="token punctuation">}</span></span> <span class="token parameter">b</span> iterating over each Async DepBlock</span>
<span class="line">     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword">void</span><span class="token punctuation">}</span></span></span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">iteratorBlock</span> <span class="token operator">=</span> <span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 1. We create a chunk for this Block</span></span>
<span class="line">        <span class="token comment">// but only once (blockChunkGroups map)</span></span>
<span class="line">        <span class="token keyword">let</span> c <span class="token operator">=</span> blockChunkGroups<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            c <span class="token operator">=</span> namedChunkGroups<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>chunkName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span><span class="token function">isInitial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                compilation<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token keyword">new</span> <span class="token class-name">AsyncDependencyToInitialChunkError</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>chunkName<span class="token punctuation">,</span> module<span class="token punctuation">,</span> b<span class="token punctuation">.</span>loc<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                c <span class="token operator">=</span> chunkGroup<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//调用addChunkInGroup为这个异步的 block 新建一个 chunk 以及 chunkGroup</span></span>
<span class="line">                c <span class="token operator">=</span> compilation<span class="token punctuation">.</span><span class="token function">addChunkInGroup</span><span class="token punctuation">(</span></span>
<span class="line">                    b<span class="token punctuation">.</span>groupOptions <span class="token operator">||</span> b<span class="token punctuation">.</span>chunkName<span class="token punctuation">,</span></span>
<span class="line">                    module<span class="token punctuation">,</span></span>
<span class="line">                    b<span class="token punctuation">.</span>loc<span class="token punctuation">,</span></span>
<span class="line">                    b<span class="token punctuation">.</span>request</span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//调用 GraphHelpers 模块提供的 connectChunkGroupAndChunk 建立起这个新建的 chunk 和 chunkGroup 之间的联系</span></span>
<span class="line">                <span class="token comment">//这里新建的 chunk 也就是在你的代码当中使用异步API 加载模块时，webpack 最终会单独给这个模块输出一个 chunk，但是此时这个 chunk 为一个空的 chunk，没有加入任何依赖的 module</span></span>
<span class="line">                chunkGroupCounters<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">index2</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                blockChunkGroups<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                allCreatedChunkGroups<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// TODO webpack 5 remove addOptions check</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>addOptions<span class="token punctuation">)</span> c<span class="token punctuation">.</span><span class="token function">addOptions</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>groupOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            c<span class="token punctuation">.</span><span class="token function">addOrigin</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> b<span class="token punctuation">.</span>loc<span class="token punctuation">,</span> b<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 2. We store the Block+Chunk mapping as dependency for the chunk</span></span>
<span class="line">        <span class="token comment">//建立起当前 module 所属的 chunkGroup 和 block 以及这个 block 所属的 chunkGroup 之间的依赖关系，并存储至 chunkDependencies Map 表中，</span></span>
<span class="line">        <span class="token comment">//这个 Map 表主要用于后面优化 chunk graph</span></span>
<span class="line">        <span class="token keyword">let</span> deps <span class="token operator">=</span> chunkDependencies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deps<span class="token punctuation">)</span> chunkDependencies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">,</span> <span class="token punctuation">(</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">block</span><span class="token operator">:</span> b<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">chunkGroup</span><span class="token operator">:</span> c</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 3. We create/update the chunk group info</span></span>
<span class="line">        <span class="token keyword">let</span> connectList <span class="token operator">=</span> queueConnect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>connectList <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            connectList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            queueConnect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">,</span> connectList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        connectList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 4. We enqueue the DependenciesBlock for traversal</span></span>
<span class="line">        <span class="token comment">//向queueDelayed 中添加一个 action 类型为 PROCESS_BLOCK,module 为当前所属的 module，block 为当前 module 依赖的异步模块</span></span>
<span class="line">        <span class="token comment">//chunk(chunkGroup 当中的第一个 chunk) 及 chunkGroup 都是处理异步模块生成的新项，而这里向 queueDelayed 数据集当中添加的新项主要就是用于 queue 的外层遍历</span></span>
<span class="line">        queueDelayed<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">PROCESS_BLOCK</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">block</span><span class="token operator">:</span> b<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">module</span><span class="token operator">:</span> module<span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">chunk</span><span class="token operator">:</span> c<span class="token punctuation">.</span>chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">chunkGroup</span><span class="token operator">:</span> c</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Iterative traversal of the Module graph</span></span>
<span class="line">    <span class="token comment">// Recursive would be simpler to write but could result in Stack Overflows</span></span>
<span class="line">    <span class="token comment">//开始进入到外层的遍历当中，即对 queueDelayed 数据集进行处理</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;visiting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//每一轮的内层遍历都对应于同一个 chunkGroup，即每一轮内层的遍历都是对这个 chunkGroup 当中所包含的所有的 module 进行处理</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> queueItem <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            module <span class="token operator">=</span> queueItem<span class="token punctuation">.</span>module<span class="token punctuation">;</span></span>
<span class="line">            block <span class="token operator">=</span> queueItem<span class="token punctuation">.</span>block<span class="token punctuation">;</span></span>
<span class="line">            chunk <span class="token operator">=</span> queueItem<span class="token punctuation">.</span>chunk<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>chunkGroup <span class="token operator">!==</span> queueItem<span class="token punctuation">.</span>chunkGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                chunkGroup <span class="token operator">=</span> queueItem<span class="token punctuation">.</span>chunkGroup<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> chunkGroupInfo <span class="token operator">=</span> chunkGroupInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                minAvailableModules <span class="token operator">=</span> chunkGroupInfo<span class="token punctuation">.</span>minAvailableModules<span class="token punctuation">;</span></span>
<span class="line">                skippedItems <span class="token operator">=</span> chunkGroupInfo<span class="token punctuation">.</span>skippedItems<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">switch</span> <span class="token punctuation">(</span>queueItem<span class="token punctuation">.</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">case</span> <span class="token constant">ADD_AND_ENTER_MODULE</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>minAvailableModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token comment">// already in parent chunks</span></span>
<span class="line">                        <span class="token comment">// skip it for now, but enqueue for rechecking when minAvailableModules shrinks</span></span>
<span class="line">                        skippedItems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>queueItem<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token comment">// We connect Module and Chunk when not already done</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        module<span class="token punctuation">.</span><span class="token function">addChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token comment">// already connected, skip it</span></span>
<span class="line">                        <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// fallthrough</span></span>
<span class="line">                <span class="token comment">//在 queue 中新增一个 action 为 LEAVE_MODULE 的项会在后面遍历的流程当中使用</span></span>
<span class="line">                <span class="token keyword">case</span> <span class="token constant">ENTER_MODULE</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>chunkGroup <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">const</span> index <span class="token operator">=</span> chunkGroup<span class="token punctuation">.</span><span class="token function">getModuleIndex</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            chunkGroup<span class="token punctuation">.</span><span class="token function">setModuleIndex</span><span class="token punctuation">(</span></span>
<span class="line">                                module<span class="token punctuation">,</span></span>
<span class="line">                                chunkGroupCounters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">.</span>index<span class="token operator">++</span></span>
<span class="line">                            <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>index <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        module<span class="token punctuation">.</span>index <span class="token operator">=</span> nextFreeModuleIndex<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">LEAVE_MODULE</span><span class="token punctuation">,</span></span>
<span class="line">                        block<span class="token punctuation">,</span></span>
<span class="line">                        module<span class="token punctuation">,</span></span>
<span class="line">                        chunk<span class="token punctuation">,</span></span>
<span class="line">                        chunkGroup</span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// fallthrough</span></span>
<span class="line">                <span class="token comment">//当 ENTRY_MODULE 的阶段进行完后，立即进入到了 PROCESS_BLOCK 阶段</span></span>
<span class="line">                <span class="token keyword">case</span> <span class="token constant">PROCESS_BLOCK</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// 根据 module graph 依赖图保存的模块映射 blockInfoMap 获取这个 module（称为A） 的同步依赖 modules 及异步依赖 blocks</span></span>
<span class="line">                    <span class="token keyword">const</span> blockInfo <span class="token operator">=</span> blockInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// Buffer items because order need to be reverse to get indicies correct</span></span>
<span class="line">                    <span class="token keyword">const</span> skipBuffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">const</span> queueBuffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// Traverse all referenced modules</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> refModule <span class="token keyword">of</span> blockInfo<span class="token punctuation">.</span>modules<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token doc-comment comment">/**</span>
<span class="line">                         * 判断当前这个 module(A) 所属的 chunk 当中是否包含了其依赖 modules 当中的 module(B)，</span>
<span class="line">                         * 如果不包含的话，那么会在 queue 当中加入新的项，新加入的项目的 action 为 ADD_AND_ENTER_MODULE，</span>
<span class="line">                         * 即这个新增项在下次遍历的时候，首先会进入到 ADD_AND_ENTER_MODULE 阶段</span>
<span class="line">                         */</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">containsModule</span><span class="token punctuation">(</span>refModule<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token comment">// skip early if already connected</span></span>
<span class="line">                            <span class="token keyword">continue</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>minAvailableModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>refModule<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token comment">// already in parent chunks, skip it for now</span></span>
<span class="line">                            skipBuffer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                                <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ADD_AND_ENTER_MODULE</span><span class="token punctuation">,</span></span>
<span class="line">                                <span class="token literal-property property">block</span><span class="token operator">:</span> refModule<span class="token punctuation">,</span></span>
<span class="line">                                <span class="token literal-property property">module</span><span class="token operator">:</span> refModule<span class="token punctuation">,</span></span>
<span class="line">                                chunk<span class="token punctuation">,</span></span>
<span class="line">                                chunkGroup</span>
<span class="line">                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token keyword">continue</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token comment">// enqueue the add and enter to enter in the correct order</span></span>
<span class="line">                        <span class="token comment">// this is relevant with circular dependencies</span></span>
<span class="line">                        queueBuffer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">ADD_AND_ENTER_MODULE</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">block</span><span class="token operator">:</span> refModule<span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">module</span><span class="token operator">:</span> refModule<span class="token punctuation">,</span></span>
<span class="line">                            chunk<span class="token punctuation">,</span></span>
<span class="line">                            chunkGroup</span>
<span class="line">                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token comment">// Add buffered items in reversed order</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> skipBuffer<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        skippedItems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>skipBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> queueBuffer<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>queueBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">//调用iteratorBlock方法来处理这个 module(A) 依赖的所有的异步 blocks</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> block <span class="token keyword">of</span> blockInfo<span class="token punctuation">.</span>blocks<span class="token punctuation">)</span> <span class="token function">iteratorBlock</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>blockInfo<span class="token punctuation">.</span>blocks<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> module <span class="token operator">!==</span> block<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        blocksWithNestedBlocks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">case</span> <span class="token constant">LEAVE_MODULE</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>chunkGroup <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">const</span> index <span class="token operator">=</span> chunkGroup<span class="token punctuation">.</span><span class="token function">getModuleIndex2</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            chunkGroup<span class="token punctuation">.</span><span class="token function">setModuleIndex2</span><span class="token punctuation">(</span></span>
<span class="line">                                module<span class="token punctuation">,</span></span>
<span class="line">                                chunkGroupCounters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">.</span>index2<span class="token operator">++</span></span>
<span class="line">                            <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>index2 <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        module<span class="token punctuation">.</span>index2 <span class="token operator">=</span> nextFreeModuleIndex2<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;visiting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>queueConnect<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;calculating available modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//计算出这个chunkGroup新的父模块，以便这些子chunkGroup可以获取新的模块</span></span>
<span class="line">            <span class="token comment">// Figure out new parents for chunk groups</span></span>
<span class="line">            <span class="token comment">// to get new available modules for these children</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>chunkGroup<span class="token punctuation">,</span> targets<span class="token punctuation">]</span> <span class="token keyword">of</span> queueConnect<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> info <span class="token operator">=</span> chunkGroupInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当前信息</span></span>
<span class="line">                <span class="token keyword">let</span> minAvailableModules <span class="token operator">=</span> info<span class="token punctuation">.</span>minAvailableModules<span class="token punctuation">;</span><span class="token comment">//(chunkGroup 可追踪的最小 module 数据集)</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//为这个点创建一个新的模块数据集,添加所有的本chunkgroup所有的chunk里的模块</span></span>
<span class="line">                <span class="token keyword">const</span> resultingAvailableModules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>minAvailableModules<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> chunkGroup<span class="token punctuation">.</span>chunks<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> m <span class="token keyword">of</span> chunk<span class="token punctuation">.</span>modulesIterable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        resultingAvailableModules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                info<span class="token punctuation">.</span>resultingAvailableModules <span class="token operator">=</span> resultingAvailableModules<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    info<span class="token punctuation">.</span>children <span class="token operator">=</span> targets<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> target <span class="token keyword">of</span> targets<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        info<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 2. Update chunk group info 更新chunkGroup信息</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> target <span class="token keyword">of</span> targets<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">let</span> chunkGroupInfo <span class="token operator">=</span> chunkGroupInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>chunkGroupInfo <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        chunkGroupInfo <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token literal-property property">chunkGroup</span><span class="token operator">:</span> target<span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">minAvailableModules</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">minAvailableModulesOwned</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">availableModulesToBeMerged</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">skippedItems</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">resultingAvailableModules</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">undefined</span></span>
<span class="line">                        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">                        chunkGroupInfoMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> chunkGroupInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    chunkGroupInfo<span class="token punctuation">.</span>availableModulesToBeMerged<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></span>
<span class="line">                        resultingAvailableModules</span>
<span class="line">                    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    outdatedChunkGroupInfo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>chunkGroupInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            queueConnect<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;calculating available modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>outdatedChunkGroupInfo<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                logger<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;merging available modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//合并模块</span></span>
<span class="line">                <span class="token comment">// Execute the merge</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> info <span class="token keyword">of</span> outdatedChunkGroupInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">const</span> availableModulesToBeMerged <span class="token operator">=</span> info<span class="token punctuation">.</span>availableModulesToBeMerged<span class="token punctuation">;</span><span class="token comment">//父模块</span></span>
<span class="line">                    <span class="token keyword">let</span> cachedMinAvailableModules <span class="token operator">=</span> info<span class="token punctuation">.</span>minAvailableModules<span class="token punctuation">;</span><span class="token comment">//最小化模块集</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 1. Get minimal available modules</span></span>
<span class="line">                    <span class="token comment">// It doesn&#39;t make sense to traverse a chunk again with more available modules.</span></span>
<span class="line">                    <span class="token comment">// This step calculates the minimal available modules and skips traversal when</span></span>
<span class="line">                    <span class="token comment">// the list didn&#39;t shrink.</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>availableModulesToBeMerged<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        availableModulesToBeMerged<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>bySetSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token keyword">let</span> changed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> availableModules <span class="token keyword">of</span> availableModulesToBeMerged<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedMinAvailableModules <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            cachedMinAvailableModules <span class="token operator">=</span> availableModules<span class="token punctuation">;</span></span>
<span class="line">                            info<span class="token punctuation">.</span>minAvailableModules <span class="token operator">=</span> cachedMinAvailableModules<span class="token punctuation">;</span></span>
<span class="line">                            info<span class="token punctuation">.</span>minAvailableModulesOwned <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                            changed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>minAvailableModulesOwned<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                <span class="token comment">// We own it and can modify it</span></span>
<span class="line">                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> m <span class="token keyword">of</span> cachedMinAvailableModules<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>availableModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                        cachedMinAvailableModules<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                        changed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                                    <span class="token punctuation">}</span></span>
<span class="line">                                <span class="token punctuation">}</span></span>
<span class="line">                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> m <span class="token keyword">of</span> cachedMinAvailableModules<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>availableModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                        <span class="token comment">// cachedMinAvailableModules need to be modified</span></span>
<span class="line">                                        <span class="token comment">// but we don&#39;t own it</span></span>
<span class="line">                                        <span class="token comment">// construct a new Set as intersection of cachedMinAvailableModules and availableModules</span></span>
<span class="line">                                        <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Set<span class="token punctuation">&lt;</span>Module<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">                                        <span class="token keyword">const</span> newSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                        <span class="token keyword">const</span> iterator <span class="token operator">=</span> cachedMinAvailableModules<span class="token punctuation">[</span></span>
<span class="line">                                            Symbol<span class="token punctuation">.</span>iterator</span>
<span class="line">                                        <span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                        <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>IteratorResult<span class="token punctuation">&lt;</span>Module<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">                                        <span class="token keyword">let</span> it<span class="token punctuation">;</span></span>
<span class="line">                                        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>it <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                            <span class="token keyword">const</span> module <span class="token operator">=</span> it<span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">                                            <span class="token keyword">if</span> <span class="token punctuation">(</span>module <span class="token operator">===</span> m<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                                            newSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                        <span class="token punctuation">}</span></span>
<span class="line">                                        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>it <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                            <span class="token keyword">const</span> module <span class="token operator">=</span> it<span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">                                            <span class="token keyword">if</span> <span class="token punctuation">(</span>availableModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                                newSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                            <span class="token punctuation">}</span></span>
<span class="line">                                        <span class="token punctuation">}</span></span>
<span class="line">                                        cachedMinAvailableModules <span class="token operator">=</span> newSet<span class="token punctuation">;</span></span>
<span class="line">                                        info<span class="token punctuation">.</span>minAvailableModulesOwned <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                                        info<span class="token punctuation">.</span>minAvailableModules <span class="token operator">=</span> newSet<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                                        <span class="token comment">// Update the cache from the first queue</span></span>
<span class="line">                                        <span class="token comment">// if the chunkGroup is currently cached</span></span>
<span class="line">                                        <span class="token keyword">if</span> <span class="token punctuation">(</span>chunkGroup <span class="token operator">===</span> info<span class="token punctuation">.</span>chunkGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                            minAvailableModules <span class="token operator">=</span> cachedMinAvailableModules<span class="token punctuation">;</span></span>
<span class="line">                                        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                                        changed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                                        <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                                    <span class="token punctuation">}</span></span>
<span class="line">                                <span class="token punctuation">}</span></span>
<span class="line">                            <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    availableModulesToBeMerged<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>changed<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 2. Reconsider skipped items</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> queueItem <span class="token keyword">of</span> info<span class="token punctuation">.</span>skippedItems<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>queueItem<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    info<span class="token punctuation">.</span>skippedItems<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 3. Reconsider children chunk groups</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>children <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">const</span> chunkGroup <span class="token operator">=</span> info<span class="token punctuation">.</span>chunkGroup<span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> c <span class="token keyword">of</span> info<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token keyword">let</span> connectList <span class="token operator">=</span> queueConnect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token keyword">if</span> <span class="token punctuation">(</span>connectList <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                                connectList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                                queueConnect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">,</span> connectList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token punctuation">}</span></span>
<span class="line">                            connectList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                outdatedChunkGroupInfo<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                logger<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;merging available modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//当队列中所有的元素处理完成后处理queueDelayed</span></span>
<span class="line">        <span class="token comment">//这个对获取合局正确的索引非常重要</span></span>
<span class="line">        <span class="token comment">//异步blocks应该在所有的同步blocks处理完成后再处理</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> tempQueue <span class="token operator">=</span> queue<span class="token punctuation">;</span></span>
<span class="line">            queue <span class="token operator">=</span> queueDelayed<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            queueDelayed <span class="token operator">=</span> tempQueue<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-优化chunk-graph" tabindex="-1"><a class="header-anchor" href="#_3-4-优化chunk-graph"><span>3.4 优化chunk graph</span></a></h3><ul><li>[buildChunkGraph PART TWO](https://github.com/webpack/webpack/blob/c9d4ff7b054fc581c96ce0e53432d44f9dd8ca72/lib/buildChunkGraph.js</li><li>[afterChunks](https://github.com/webpack/webpack/blob/c9d4ff7b054fc581c96ce0e53432d44f9dd8ca72/lib/Compilation.js</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Set<span class="token punctuation">&lt;</span>DependenciesBlock<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> <span class="token parameter">blocksWithNestedBlocks</span> block拥有子block的标识</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Map<span class="token punctuation">&lt;</span>ChunkGroup<span class="token punctuation">,</span> ChunkGroupDep<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> <span class="token parameter">chunkDependencies</span> chunk groups的依赖</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Map<span class="token punctuation">&lt;</span>ChunkGroup<span class="token punctuation">,</span> ChunkGroupInfo<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> <span class="token parameter">chunkGroupInfoMap</span> chunkgroup到可用的modules的映射</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">connectChunkGroups</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token parameter">blocksWithNestedBlocks<span class="token punctuation">,</span></span>
<span class="line">    chunkDependencies<span class="token punctuation">,</span></span>
<span class="line">    chunkGroupInfoMap</span></span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Set<span class="token punctuation">&lt;</span>Module<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> */</span></span>
<span class="line">    <span class="token keyword">let</span> resultingAvailableModules<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 帮助函数，检查是否代码块中是否已经有了所有模块</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>ChunkGroup<span class="token punctuation">}</span></span> <span class="token parameter">chunkGroup</span>  要检查的chunkGroup</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Set<span class="token punctuation">&lt;</span>Module<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> <span class="token parameter">availableModules</span> 模块集合</span>
<span class="line">     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>boolean<span class="token punctuation">}</span></span> 如果所有的模块都在这个chunk中存在就返回true</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">areModulesAvailable</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunkGroup<span class="token punctuation">,</span> availableModules</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> chunkGroup<span class="token punctuation">.</span>chunks<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> module <span class="token keyword">of</span> chunk<span class="token punctuation">.</span>modulesIterable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>availableModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// For each edge in the basic chunk graph</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>ChunkGroupDep<span class="token punctuation">}</span></span> <span class="token parameter">dep</span> the dependency used for filtering</span>
<span class="line">     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>boolean<span class="token punctuation">}</span></span> used to filter &quot;edges&quot; (aka Dependencies) that were pointing</span>
<span class="line">     * to modules that are already available. Also filters circular dependencies in the chunks graph</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">filterFn</span> <span class="token operator">=</span> <span class="token parameter">dep</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> depChunkGroup <span class="token operator">=</span> dep<span class="token punctuation">.</span>chunkGroup<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// TODO is this needed?</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>blocksWithNestedBlocks<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>dep<span class="token punctuation">.</span>block<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">areModulesAvailable</span><span class="token punctuation">(</span>depChunkGroup<span class="token punctuation">,</span> resultingAvailableModules<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// break all modules are already available</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//遍历所有的deps,检查是否这个chunkGroup是否需要连接</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>chunkGroup<span class="token punctuation">,</span> deps<span class="token punctuation">]</span> <span class="token keyword">of</span> chunkDependencies<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 1.从map中获取到chunkGroup的信息对象</span></span>
<span class="line">        <span class="token keyword">const</span> info <span class="token operator">=</span> chunkGroupInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        resultingAvailableModules <span class="token operator">=</span> info<span class="token punctuation">.</span>resultingAvailableModules<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 2. Foreach edge</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">const</span> dep <span class="token operator">=</span> deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// Filter inline, rather than creating a new array from \`.filter()\`</span></span>
<span class="line">            <span class="token comment">// TODO check if inlining filterFn makes sense here</span></span>
<span class="line">            <span class="token comment">//判断 chunkGroup 提供的 newAvailableModules(可以将 newAvailableModules 理解为这个 chunkGroup 所有 module 的集合setA)和</span></span>
<span class="line">            <span class="token comment">// deps 依赖中的 chunkGroup (由异步 block 创建的 chunkGroup)所包含的 chunk 当中所有的 module 集合(setB)包含关系：</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filterFn</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">continue</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">const</span> depChunkGroup <span class="token operator">=</span> dep<span class="token punctuation">.</span>chunkGroup<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> depBlock <span class="token operator">=</span> dep<span class="token punctuation">.</span>block<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 5. 建立起 deps 依赖中的异步 block 和 chunkGroup 的依赖关系</span></span>
<span class="line">            GraphHelpers<span class="token punctuation">.</span><span class="token function">connectDependenciesBlockAndChunkGroup</span><span class="token punctuation">(</span></span>
<span class="line">                depBlock<span class="token punctuation">,</span></span>
<span class="line">                depChunkGroup</span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 6. chunkGroup 和 deps 依赖中的 chunkGroup 之间的依赖关系 </span></span>
<span class="line">            <span class="token comment">//（这个依赖关系也决定了在 webpack 编译完成后输出的文件当中是否会有 deps 依赖中的 chunkGroup 所包含的 chunk）</span></span>
<span class="line">            GraphHelpers<span class="token punctuation">.</span><span class="token function">connectChunkGroupParentAndChild</span><span class="token punctuation">(</span>chunkGroup<span class="token punctuation">,</span> depChunkGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * Remove all unconnected chunk groups</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Compilation<span class="token punctuation">}</span></span> <span class="token parameter">compilation</span> the compilation</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Iterable<span class="token punctuation">&lt;</span>ChunkGroup<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> <span class="token parameter">allCreatedChunkGroups</span> all chunk groups that where created before</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">cleanupUnconnectedGroups</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> allCreatedChunkGroups</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunkGroup <span class="token keyword">of</span> allCreatedChunkGroups<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>chunkGroup<span class="token punctuation">.</span><span class="token function">getNumberOfParents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//开始处理没有依赖关系的 chunkGroup</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> chunkGroup<span class="token punctuation">.</span>chunks<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> idx <span class="token operator">=</span> compilation<span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> compilation<span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                chunk<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;unconnected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            chunkGroup<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;unconnected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://img.zhufengpeixun.cn/finalchunkgraphs.jpg" alt="finalchunkgraphs"></p>`,33)])])}const i=s(t,[["render",c]]),u=JSON.parse('{"path":"/strong/75.webpack-9.chunk.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/75.webpack-9.chunk.md"}');export{i as comp,u as data};
