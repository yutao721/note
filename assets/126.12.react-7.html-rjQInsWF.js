import{_ as e,c as t,a,b as s,d as l,w as c,r as o,o as i,e as u}from"./app-CD1YpnS1.js";const r={};function k(d,n){const p=o("RouteLink");return i(),t("div",null,[n[3]||(n[3]=a(`<h2 id="_1-位运算" tabindex="-1"><a class="header-anchor" href="#_1-位运算"><span>1.位运算</span></a></h2><h3 id="_1-1-比特" tabindex="-1"><a class="header-anchor" href="#_1-1-比特"><span>1.1 比特</span></a></h3><ul><li>比特(bit)是表示信息的最小单位</li><li>比特(bit)是二进制单位(binary unit)的缩写</li><li>比特(bit)只有两种状态：0和1</li><li>一般来说n比特的信息量可以表示出2的n次方种选择</li></ul><p><img src="https://static.zhufengpeixun.com/bits_1644547153133.png" alt="bit"></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token number">0b1000</span><span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">8</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">~</span><span class="token number">7</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-2-数值数据" tabindex="-1"><a class="header-anchor" href="#_1-2-数值数据"><span>1.2 数值数据</span></a></h3><h4 id="_1-2-1-无符号数据的表示" tabindex="-1"><a class="header-anchor" href="#_1-2-1-无符号数据的表示"><span>1.2.1 无符号数据的表示</span></a></h4><ul><li>原码: 3个bit能表示8个数 0 1 2 3 4 5 6 7</li></ul><p><img src="https://static.zhufengpeixun.com/unsigned_1644551839369.gif" alt=""></p><h4 id="_1-2-2-有符号数据的表示" tabindex="-1"><a class="header-anchor" href="#_1-2-2-有符号数据的表示"><span>1.2.2 有符号数据的表示</span></a></h4><h5 id="_1-2-2-1-原码" tabindex="-1"><a class="header-anchor" href="#_1-2-2-1-原码"><span>1.2.2.1 原码</span></a></h5><ul><li>符号: 用0、1表示正负号,放在数值的最高位,0表示正数，1表示负数</li><li>原码: 3个bit能表示8个数 +0 +1 +2 +3 -0 -1 -2 -3</li></ul><p><img src="https://static.zhufengpeixun.com/originalcode_1644551851223.gif" alt=""></p><h5 id="_1-2-2-2-反码" tabindex="-1"><a class="header-anchor" href="#_1-2-2-2-反码"><span>1.2.2.2 反码</span></a></h5><ul><li>反码:正数不变,负数的除符号位外取反</li></ul><p><img src="https://static.zhufengpeixun.com/completation_1644551871239.gif" alt=""></p><h5 id="_1-2-2-3-补码" tabindex="-1"><a class="header-anchor" href="#_1-2-2-3-补码"><span>1.2.2.3 补码</span></a></h5><ul><li>补码:正数不变,负数在反码的基础上加1</li><li>补码解决了,可以带符号位进行运算,不需要单独标识</li><li>补码解决了自然码正负0的表示方法</li><li>补码实现了减法变加法</li></ul><p><img src="https://static.zhufengpeixun.com/bumacunzai_1644551883284.png" alt=""></p><p><img src="https://static.zhufengpeixun.com/transfromnetoim_1644551902137.png" alt=""></p><h3 id="_1-3-位运算" tabindex="-1"><a class="header-anchor" href="#_1-3-位运算"><span>1.3 位运算</span></a></h3><ul><li>[Binary Bitwise Operators](https://262.ecma-international.org/5.1/</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_AND" target="_blank" rel="noopener noreferrer">按位与</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_OR" target="_blank" rel="noopener noreferrer">按位或</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_XOR" target="_blank" rel="noopener noreferrer">按位异或</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_NOT" target="_blank" rel="noopener noreferrer">按位非</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Left_shift" target="_blank" rel="noopener noreferrer">左移</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Right_shift" target="_blank" rel="noopener noreferrer">有符号右移</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Unsigned_right_shift" target="_blank" rel="noopener noreferrer">无符号右移</a></li></ul><table><thead><tr><th style="text-align:left;">运算</th><th style="text-align:left;">使用</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">按位与(&amp;)</td><td style="text-align:left;">x &amp; y</td><td style="text-align:left;">每一个比特位都为1时，结果为1，否则为0</td></tr><tr><td style="text-align:left;">按位或(<img src="https://static.zhufengpeixun.com/huo_1645097073861.png" alt="">)</td><td style="text-align:left;">x <img src="https://static.zhufengpeixun.com/huo_1645097073861.png" alt=""> y</td><td style="text-align:left;">每一个比特位都为0时，结果为0，否则为1</td></tr><tr><td style="text-align:left;">按位异或(^)</td><td style="text-align:left;">x ^ y</td><td style="text-align:left;">每一个比特位相同结果为0，否则为1</td></tr><tr><td style="text-align:left;">按位非(~)</td><td style="text-align:left;">~ x</td><td style="text-align:left;">对每一个比特位取反，0变为1，1变为0</td></tr><tr><td style="text-align:left;">左移(&lt;&lt;)</td><td style="text-align:left;">x &lt;&lt; y</td><td style="text-align:left;">将x的每一个比特位左移y位，右侧补充0</td></tr><tr><td style="text-align:left;">有符号右移(&gt;&gt;)</td><td style="text-align:left;">x &gt;&gt; y</td><td style="text-align:left;">将x的每一个比特位向右移y个位，右侧移除位丢弃，左侧填充为最高位</td></tr><tr><td style="text-align:left;">无符号右移(&gt;&gt;&gt;)</td><td style="text-align:left;">x &gt;&gt;&gt; y</td><td style="text-align:left;">将x的每一个比特位向右移y个位，右侧移除位丢弃，左侧填充为0</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b100</span><span class="token punctuation">;</span><span class="token comment">//4</span></span>
<span class="line"><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0b011</span><span class="token punctuation">;</span><span class="token comment">//3</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//000 0</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//111 7 </span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">^</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//111 7 </span></span>
<span class="line"><span class="token comment">//按位非运算时，任何数字x的运算结果都是-(x + 1)。例如，〜4运算结果为-5</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//-5</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//111</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b001</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//左移</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0b100</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//无符号右移(&gt;&gt;&gt;) 丢弃被移除的位 左侧补0</span></span>
<span class="line"><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0b100</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0b010</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//有符号右移(&gt;&gt;) 丢弃被移除的位 左侧填充最高位</span></span>
<span class="line"><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">0b101</span><span class="token punctuation">;</span><span class="token comment">//-3    110</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-使用" tabindex="-1"><a class="header-anchor" href="#_1-4-使用"><span>1.4 使用</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//定义常量</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">OP_INSERT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0b001</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">OP_REMOVE</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 0b010</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> <span class="token constant">OP</span> <span class="token operator">=</span> <span class="token number">0b000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//增加操作</span></span>
<span class="line"><span class="token constant">OP</span> <span class="token operator">|=</span> <span class="token constant">OP_INSERT</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">OP</span> <span class="token operator">|=</span> <span class="token constant">OP_REMOVE</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">OP</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0b11</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//删除操作</span></span>
<span class="line"><span class="token constant">OP</span> <span class="token operator">=</span> <span class="token constant">OP</span> <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token constant">OP_INSERT</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">OP</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0b10</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//判断包含</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">OP</span> <span class="token operator">&amp;</span> <span class="token constant">OP_INSERT</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">OP_INSERT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">OP</span> <span class="token operator">&amp;</span> <span class="token constant">OP_REMOVE</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">OP_REMOVE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//判断不包含</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">OP</span> <span class="token operator">&amp;</span> <span class="token constant">OP_INSERT</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">OP</span> <span class="token operator">&amp;</span> <span class="token constant">OP_REMOVE</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-es5规范" tabindex="-1"><a class="header-anchor" href="#_1-5-es5规范"><span>1.5 ES5规范</span></a></h3><ul><li>[Binary Bitwise Operators](https://262.ecma-international.org/5.1/</li><li>[ToInt32: (Signed 32 Bit Integer)](https://262.ecma-international.org/5.1/</li><li>位运算只支持整数运算</li><li>位运算中的左右操作数都会转换为有符号32位整型, 且返回结果也是有符号32位整型</li><li>操作数的大小超过Int32范围(-2^31 ~ 2^31-1). 超过范围的二进制位会被截断, 取低位32bit</li></ul><h3 id="_1-6-hydration" tabindex="-1"><a class="header-anchor" href="#_1-6-hydration"><span>1.6 Hydration</span></a></h3><ul><li>水合反应（ hydrated reaction），也叫作水化</li><li>是指物质溶解在水里时，与水发生的化学作用,水合分子的过程</li><li>组件在服务器端拉取数据(水)，并在服务器端首次渲染</li><li>脱水: 对组件进行脱水，变成HTML字符串，脱去动态数据，成为风干标本快照</li><li>注水：发送到客户端后，重新注入数据(水)，重新变成可交互组件</li></ul><p><img src="https://static.zhufengpeixun.com/huoyiner_1644572048109.jfif" alt=""><br><img src="https://static.zhufengpeixun.com/saiyiner_1644571994221.jfif" alt=""><br><img src="https://static.zhufengpeixun.com/paofayiner_1644572007011.jpeg" alt=""></p><h3 id="_1-7-react中的应用场景" tabindex="-1"><a class="header-anchor" href="#_1-7-react中的应用场景"><span>1.7 React中的应用场景</span></a></h3><ul><li>React中用lane(车道)模型来表示任务优先级</li><li>一共有31条优先级，数字越小优先级越高，某些车道的优先级相同</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/clz32()" target="_blank" rel="noopener noreferrer">clz32</a>函数返回开头的 0 的个数</li></ul><p><img src="https://static.zhufengpeixun.com/lanes_1645074174970.jfif" alt=""></p><p><img src="https://static.zhufengpeixun.com/che_dao_1645080741671.jpg" alt=""></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">//一共有16种优先级</span></span>
<span class="line"><span class="token comment">//同步优先级</span></span>
<span class="line"><span class="token keyword">const</span> SyncLanePriority <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> SyncBatchedLanePriority <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//离散事件优先级</span></span>
<span class="line"><span class="token keyword">const</span> InputDiscreteHydrationLanePriority <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> InputDiscreteLanePriority <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//连续事件优先级</span></span>
<span class="line"><span class="token keyword">const</span> InputContinuousHydrationLanePriority <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> InputContinuousLanePriority <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//默认优先级</span></span>
<span class="line"><span class="token keyword">const</span> DefaultHydrationLanePriority <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> DefaultLanePriority <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//渐变优先级</span></span>
<span class="line"><span class="token keyword">const</span> TransitionHydrationPriority <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> TransitionPriority <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> RetryLanePriority <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> SelectiveHydrationLanePriority <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//空闲优先级</span></span>
<span class="line"><span class="token keyword">const</span> IdleHydrationLanePriority <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> IdleLanePriority <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//离屏优先级</span></span>
<span class="line"><span class="token keyword">const</span> OffscreenLanePriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//未设置优先级</span></span>
<span class="line"><span class="token keyword">const</span> NoLanePriority <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 一共有31条车道</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">const</span> TotalLanes <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//没有车道，所有位都为0</span></span>
<span class="line"><span class="token keyword">const</span> NoLanes <span class="token operator">=</span> <span class="token number">0b0000000000000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> NoLane <span class="token operator">=</span> <span class="token number">0b0000000000000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//同步车道，优先级最高</span></span>
<span class="line"><span class="token keyword">const</span> SyncLane <span class="token operator">=</span> <span class="token number">0b0000000000000000000000000000001</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> SyncBatchedLane <span class="token operator">=</span> <span class="token number">0b0000000000000000000000000000010</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//离散用户交互车道 click</span></span>
<span class="line"><span class="token keyword">const</span> InputDiscreteHydrationLane <span class="token operator">=</span> <span class="token number">0b0000000000000000000000000000100</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> InputDiscreteLanes <span class="token operator">=</span> <span class="token number">0b0000000000000000000000000011000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//连续交互车道 mousemove</span></span>
<span class="line"><span class="token keyword">const</span> InputContinuousHydrationLane <span class="token operator">=</span> <span class="token number">0b0000000000000000000000000100000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> InputContinuousLanes <span class="token operator">=</span> <span class="token number">0b0000000000000000000000011000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//默认车道</span></span>
<span class="line"><span class="token keyword">const</span> DefaultHydrationLane <span class="token operator">=</span> <span class="token number">0b0000000000000000000000100000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> DefaultLanes <span class="token operator">=</span> <span class="token number">0b0000000000000000000111000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//渐变车道</span></span>
<span class="line"><span class="token keyword">const</span> TransitionHydrationLane <span class="token operator">=</span> <span class="token number">0b0000000000000000001000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> TransitionLanes <span class="token operator">=</span> <span class="token number">0b0000000001111111110000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//重试车道</span></span>
<span class="line"><span class="token keyword">const</span> RetryLanes <span class="token operator">=</span> <span class="token number">0b0000011110000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> SomeRetryLane <span class="token operator">=</span> <span class="token number">0b0000010000000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//选择性水合车道</span></span>
<span class="line"><span class="token keyword">const</span> SelectiveHydrationLane <span class="token operator">=</span> <span class="token number">0b0000100000000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//非空闲车道</span></span>
<span class="line"><span class="token keyword">const</span> NonIdleLanes <span class="token operator">=</span> <span class="token number">0b0000111111111111111111111111111</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> IdleHydrationLane <span class="token operator">=</span> <span class="token number">0b0001000000000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//空闲车道</span></span>
<span class="line"><span class="token keyword">const</span> IdleLanes <span class="token operator">=</span> <span class="token number">0b0110000000000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//离屏车道</span></span>
<span class="line"><span class="token keyword">const</span> OffscreenLane <span class="token operator">=</span> <span class="token number">0b1000000000000000000000000000000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 分离出所有比特位中最右边的1</span>
<span class="line"> * 分离出最高优先级的车道</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">lanes</span> 车道</span>
<span class="line"> * <span class="token keyword">@returns</span> 车道</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getHighestPriorityLane</span><span class="token punctuation">(</span><span class="token parameter">lanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> lanes <span class="token operator">&amp;</span> <span class="token operator">-</span>lanes<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//console.log(getHighestPriorityLane(InputDiscreteLanes));//8 0b1000</span></span>
<span class="line"><span class="token comment">//console.log(&#39;0000000000000000000000000011000&#39;);</span></span>
<span class="line"><span class="token comment">//console.log(&#39;1111111111111111111111111101000&#39;);</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 分离出所有比特位中最左边的1</span>
<span class="line"> * 分离出最低优先级的车道</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">lanes</span> 车道</span>
<span class="line"> * <span class="token keyword">@returns</span> 车道</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getLowestPriorityLane</span><span class="token punctuation">(</span><span class="token parameter">lanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">clz32</span><span class="token punctuation">(</span>lanes<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> NoLanes <span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> index<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getLowestPriorityLane</span><span class="token punctuation">(</span>InputDiscreteLanes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//16 0b10000</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;0000000000000000000000000011000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">clz32</span><span class="token punctuation">(</span>InputDiscreteLanes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//27</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">31</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">clz32</span><span class="token punctuation">(</span>InputDiscreteLanes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-最小堆" tabindex="-1"><a class="header-anchor" href="#_2-最小堆"><span>2. 最小堆</span></a></h2><p><img src="https://static.zhufengpeixun.com/xiao_ding_dui_1643273795848.png" alt=""></p><h3 id="_2-1-二叉树" tabindex="-1"><a class="header-anchor" href="#_2-1-二叉树"><span>2.1 二叉树</span></a></h3><ul><li>每个节点最多有两个子节点</li></ul><p><img src="https://static.zhufengpeixun.com/er_cha_shu_1643273951562.jpg" alt=""></p><h3 id="_2-2-满二叉树" tabindex="-1"><a class="header-anchor" href="#_2-2-满二叉树"><span>2.2 满二叉树</span></a></h3><ul><li>除最后一层无任何子节点外，每一层上的所有结点都有两个子结点的二叉树</li></ul><p><img src="https://static.zhufengpeixun.com/man_er_cha_shu_1643274395792.jpg" alt=""></p><h3 id="_2-3-完全二叉树" tabindex="-1"><a class="header-anchor" href="#_2-3-完全二叉树"><span>2.3 完全二叉树</span></a></h3><ul><li>叶子结点只能出现在最下层和次下层</li><li>且最下层的叶子结点集中在树的左部</li></ul><p><img src="https://static.zhufengpeixun.com/wan_quan_er_cha_shu_1643274486956.jpg" alt=""></p><h3 id="_2-4-最小堆" tabindex="-1"><a class="header-anchor" href="#_2-4-最小堆"><span>2.4 最小堆</span></a></h3><ul><li><a href="https://www.processon.com/diagraming/61f26156e0b34d06c3b5bf48" target="_blank" rel="noopener noreferrer">processon</a></li><li>最小堆是一种经过排序的完全二叉树</li><li>其中任一非终端节点的数据值均不大于其左子节点和右子节点的值</li><li>根结点值是所有堆结点值中最小者</li><li>编号关系 <ul><li>左子节点编号=父节点编号<em>2 1</em>2=2</li><li>右子节点编号=左子节点编号+1</li><li>父节点编号=子节点编号/2 2/2=1</li></ul></li><li>索引关系 <ul><li>左子节点索引=(父节点索引+1)*2-1 (0+1)*2-1=1</li><li>右子节点索引=左子节点索引+1</li><li>父节点索引=(子节点索引-1)/2 (1-1)/2=0</li></ul></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Unsigned_right_shift" target="_blank" rel="noopener noreferrer">Unsigned_right_shift</a></li></ul><p><img src="https://static.zhufengpeixun.com/zui_xiao_dui_1_1643275468911.jpg" alt=""></p><h3 id="_2-5-schedulerminheap-js" tabindex="-1"><a class="header-anchor" href="#_2-5-schedulerminheap-js"><span>2.5 SchedulerMinHeap.js</span></a></h3><ul><li>peek() 查看堆的顶点</li><li>pop() 弹出堆的定点后需要调用<code>siftDown</code>函数向下调整堆</li><li>push() 添加新节点后需要调用<code>siftUp</code>函数向上调整堆</li><li>siftDown() 向下调整堆结构, 保证最小堆</li><li>siftUp() 需要向上调整堆结构, 保证最小堆</li></ul><p>react\\packages\\scheduler\\src\\SchedulerMinHeap.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">heap<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> index <span class="token operator">=</span> heap<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line">  heap<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">siftUp</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> node<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token parameter">heap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> first <span class="token operator">=</span> heap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> first <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> first<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token parameter">heap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> first <span class="token operator">=</span> heap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> last <span class="token operator">=</span> heap<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>last <span class="token operator">!==</span> first<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      heap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> last<span class="token punctuation">;</span></span>
<span class="line">      <span class="token function">siftDown</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> last<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> first<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">siftUp</span><span class="token punctuation">(</span><span class="token parameter">heap<span class="token punctuation">,</span> node<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> parentIndex <span class="token operator">=</span> index <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> parent <span class="token operator">=</span> heap<span class="token punctuation">[</span>parentIndex<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token function">compare</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> node<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      heap<span class="token punctuation">[</span>parentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span></span>
<span class="line">      heap<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> parent<span class="token punctuation">;</span></span>
<span class="line">      index <span class="token operator">=</span> parentIndex<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">siftDown</span><span class="token punctuation">(</span><span class="token parameter">heap<span class="token punctuation">,</span> node<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> length <span class="token operator">=</span> heap<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> leftIndex <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> left <span class="token operator">=</span> heap<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> rightIndex <span class="token operator">=</span> leftIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> right <span class="token operator">=</span> heap<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">;</span> </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token function">compare</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> node<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token function">compare</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> left<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        heap<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> right<span class="token punctuation">;</span></span>
<span class="line">        heap<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span></span>
<span class="line">        index <span class="token operator">=</span> rightIndex<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        heap<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> left<span class="token punctuation">;</span></span>
<span class="line">        heap<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span></span>
<span class="line">        index <span class="token operator">=</span> leftIndex<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token function">compare</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> node<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      heap<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> right<span class="token punctuation">;</span></span>
<span class="line">      heap<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span></span>
<span class="line">      index <span class="token operator">=</span> rightIndex<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> diff <span class="token operator">=</span> a<span class="token punctuation">.</span>sortIndex <span class="token operator">-</span> b<span class="token punctuation">.</span>sortIndex<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> diff <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">?</span> diff <span class="token operator">:</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> push<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> peek <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./SchedulerMinHeap&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> heap <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">push</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">push</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">push</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">peek</span><span class="token punctuation">(</span>heap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">push</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">push</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">push</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">push</span><span class="token punctuation">(</span>heap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">peek</span><span class="token punctuation">(</span>heap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">pop</span><span class="token punctuation">(</span>heap<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">peek</span><span class="token punctuation">(</span>heap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-链表" tabindex="-1"><a class="header-anchor" href="#_3-链表"><span>3. 链表</span></a></h2><ul><li>链表是一种物理存储单元上非连续、非顺序的存储结构</li><li>数据元素的逻辑顺序是通过链表中的指针链接次序实现的</li><li>链表由一系列结点组成</li><li>每个结点包括两个部分：一个是存储数据元素的数据域，另一个是存储下一个结点地址的指针域</li></ul><h3 id="_3-1-链表分类" tabindex="-1"><a class="header-anchor" href="#_3-1-链表分类"><span>3.1 链表分类</span></a></h3><h4 id="_3-1-1-单向链表" tabindex="-1"><a class="header-anchor" href="#_3-1-1-单向链表"><span>3.1.1 单向链表</span></a></h4><p><img src="https://static.zhufengpeixun.com/dan_xiang_lian_biao_1644749400974.jpg" alt=""></p><h4 id="_3-1-2-双向链表" tabindex="-1"><a class="header-anchor" href="#_3-1-2-双向链表"><span>3.1.2 双向链表</span></a></h4><p><img src="https://static.zhufengpeixun.com/shuang_xiang_lian_biao_1644749407158.jpg" alt=""></p><h4 id="_3-1-3-循环链表" tabindex="-1"><a class="header-anchor" href="#_3-1-3-循环链表"><span>3.1.3 循环链表</span></a></h4><p><img src="https://static.zhufengpeixun.com/xun_huan_lian_biao_1644749414532.jpg" alt=""></p><p><img src="https://static.zhufengpeixun.com/queuepending_1644750048819.png" alt=""></p><h4 id="_3-1-4-示例" tabindex="-1"><a class="header-anchor" href="#_3-1-4-示例"><span>3.1.4 示例</span></a></h4><h5 id="_3-1-4-1-reactfiberlane-js" tabindex="-1"><a class="header-anchor" href="#_3-1-4-1-reactfiberlane-js"><span>3.1.4.1 ReactFiberLane.js</span></a></h5><p>ReactFiberLane.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const NoLanes = 0b00;</span>
<span class="line">const NoLane = 0b00;</span>
<span class="line">const SyncLane = 0b01;</span>
<span class="line">const SyncBatchedLane = 0b10;</span>
<span class="line">/**</span>
<span class="line"> * 判断subset是不是set的子集</span>
<span class="line"> * @param {*} set </span>
<span class="line"> * @param {*} subset </span>
<span class="line"> * @returns </span>
<span class="line"> */</span>
<span class="line">function isSubsetOfLanes(set, subset) {</span>
<span class="line">    return (set &amp; subset) === subset;</span>
<span class="line">}</span>
<span class="line">/**</span>
<span class="line"> * 合并两个车道</span>
<span class="line"> * @param {*} a </span>
<span class="line"> * @param {*} b </span>
<span class="line"> * @returns </span>
<span class="line"> */</span>
<span class="line">function mergeLanes(a, b) {</span>
<span class="line">    return a | b;</span>
<span class="line">}</span>
<span class="line">module.exports = {</span>
<span class="line">    NoLane,</span>
<span class="line">    NoLanes,</span>
<span class="line">    SyncLane,</span>
<span class="line">    SyncBatchedLane,</span>
<span class="line">    isSubsetOfLanes,</span>
<span class="line">    mergeLanes</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-1-4-2-reactupdatequeue-js" tabindex="-1"><a class="header-anchor" href="#_3-1-4-2-reactupdatequeue-js"><span>3.1.4.2 ReactUpdateQueue.js</span></a></h5><p>ReactUpdateQueue.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> NoLane<span class="token punctuation">,</span> NoLanes<span class="token punctuation">,</span> isSubsetOfLanes<span class="token punctuation">,</span> mergeLanes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./ReactFiberLane&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">initializeUpdateQueue</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">    <span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">baseState</span><span class="token operator">:</span> fiber<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span><span class="token comment">//本次更新前该Fiber节点的state,Update基于该state计算更新后的state</span></span>
<span class="line">        <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">//本次更新前该Fiber节点已保存的Update链表头</span></span>
<span class="line">        <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">//本次更新前该Fiber节点已保存的Update链表尾</span></span>
<span class="line">        <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//触发更新时，产生的Update会保存在shared.pending中形成单向环状链表</span></span>
<span class="line">            <span class="token comment">//当由Update计算state时这个环会被剪开并连接在lastBaseUpdate后面</span></span>
<span class="line">            <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    fiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> queue<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">enqueueUpdate</span><span class="token punctuation">(</span><span class="token parameter">fiber<span class="token punctuation">,</span> update</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> updateQueue <span class="token operator">=</span> fiber<span class="token punctuation">.</span>updateQueue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>updateQueue <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> sharedQueue <span class="token operator">=</span> updateQueue<span class="token punctuation">.</span>shared<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> pending <span class="token operator">=</span> sharedQueue<span class="token punctuation">.</span>pending<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pending <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        update<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        update<span class="token punctuation">.</span>next <span class="token operator">=</span> pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span></span>
<span class="line">        pending<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    sharedQueue<span class="token punctuation">.</span>pending <span class="token operator">=</span> update<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 处理更新队列</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">fiber</span> </span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">renderLanes</span> </span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">processUpdateQueue</span><span class="token punctuation">(</span><span class="token parameter">fiber<span class="token punctuation">,</span> renderLanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//获取此fiber上的更新队列</span></span>
<span class="line">    <span class="token keyword">const</span> queue <span class="token operator">=</span> fiber<span class="token punctuation">.</span>updateQueue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//获取第一个更新</span></span>
<span class="line">    <span class="token keyword">let</span> firstBaseUpdate <span class="token operator">=</span> queue<span class="token punctuation">.</span>firstBaseUpdate<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> lastBaseUpdate <span class="token operator">=</span> queue<span class="token punctuation">.</span>lastBaseUpdate<span class="token punctuation">;</span> </span>
<span class="line">    <span class="token comment">//判断一下是否在等待生效的的更新，如果有，变成base队列</span></span>
<span class="line">    <span class="token keyword">let</span> pendingQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>pending<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//等待生效的队列是循环队列</span></span>
<span class="line">        queue<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </span>
<span class="line">        <span class="token comment">//最后一个等待的更新 update4</span></span>
<span class="line">        <span class="token keyword">const</span> lastPendingUpdate <span class="token operator">=</span> pendingQueue<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//第一个等待的更新 update1</span></span>
<span class="line">        <span class="token keyword">const</span> firstPendingUpdate <span class="token operator">=</span> lastPendingUpdate<span class="token punctuation">.</span>next<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//把环剪断，最后一个不再指向第一个</span></span>
<span class="line">        lastPendingUpdate<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//把等待生效的队列添加到base队列中</span></span>
<span class="line">        <span class="token comment">//如果base队列为空</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastBaseUpdate <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            firstBaseUpdate <span class="token operator">=</span> firstPendingUpdate<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">//否则就把当前的更新队列添加到base队列的尾部</span></span>
<span class="line">            lastBaseUpdate<span class="token punctuation">.</span>next <span class="token operator">=</span> firstPendingUpdate<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//尾部也接上</span></span>
<span class="line">        lastBaseUpdate <span class="token operator">=</span> lastPendingUpdate<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> </span>
<span class="line">    <span class="token comment">//开始计算新的状态</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstBaseUpdate <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//先获取老的值{number:0}</span></span>
<span class="line">        <span class="token keyword">let</span> newState <span class="token operator">=</span> queue<span class="token punctuation">.</span>baseState<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> newLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">let</span> newBaseState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//新的基础状态</span></span>
<span class="line">        <span class="token keyword">let</span> newFirstBaseUpdate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//第一个跳过的更新</span></span>
<span class="line">        <span class="token keyword">let</span> newLastBaseUpdate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//新的最后一个基本更新</span></span>
<span class="line">        <span class="token keyword">let</span> update <span class="token operator">=</span> firstBaseUpdate<span class="token punctuation">;</span><span class="token comment">//指向第一个更新</span></span>
<span class="line">        <span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//获取更新车道</span></span>
<span class="line">            <span class="token keyword">const</span> updateLane <span class="token operator">=</span> update<span class="token punctuation">.</span>lane<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//如果优先级不够，跳过这个更新，如果这是第一个跳过的更新，上一个状态和更新成为newBaseState和newFirstBaseUpdate</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isSubsetOfLanes</span><span class="token punctuation">(</span>renderLanes<span class="token punctuation">,</span> updateLane<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">lane</span><span class="token operator">:</span> updateLane<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">payload</span><span class="token operator">:</span> update<span class="token punctuation">.</span>payload</span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>newLastBaseUpdate <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    newFirstBaseUpdate <span class="token operator">=</span> newLastBaseUpdate <span class="token operator">=</span> clone<span class="token punctuation">;</span><span class="token comment">// first=last=update1</span></span>
<span class="line">                    newBaseState <span class="token operator">=</span> newState<span class="token punctuation">;</span><span class="token comment">//0</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    newLastBaseUpdate <span class="token operator">=</span> newLastBaseUpdate<span class="token punctuation">.</span>next <span class="token operator">=</span> clone<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">//更新队列中的剩下的优先级</span></span>
<span class="line">                newLanes <span class="token operator">=</span> <span class="token function">mergeLanes</span><span class="token punctuation">(</span>newLanes<span class="token punctuation">,</span> updateLane<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//如果有足够的优先级 如果有曾经跳过的更新，仍然追加在后面</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>newLastBaseUpdate <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token comment">//NoLane是所有的优先级的子集，永远不会被跳过</span></span>
<span class="line">                        <span class="token literal-property property">lane</span><span class="token operator">:</span> NoLane<span class="token punctuation">,</span></span>
<span class="line">                        <span class="token literal-property property">payload</span><span class="token operator">:</span> update<span class="token punctuation">.</span>payload</span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">                    newLastBaseUpdate <span class="token operator">=</span> newLastBaseUpdate<span class="token punctuation">.</span>next <span class="token operator">=</span> clone<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                newState <span class="token operator">=</span> <span class="token function">getStateFromUpdate</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> newState<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            update <span class="token operator">=</span> update<span class="token punctuation">.</span>next<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newLastBaseUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            newBaseState <span class="token operator">=</span> newState<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        queue<span class="token punctuation">.</span>baseState <span class="token operator">=</span> newBaseState<span class="token punctuation">;</span></span>
<span class="line">        queue<span class="token punctuation">.</span>firstBaseUpdate <span class="token operator">=</span> newFirstBaseUpdate<span class="token punctuation">;</span></span>
<span class="line">        queue<span class="token punctuation">.</span>lastBaseUpdate <span class="token operator">=</span> newLastBaseUpdate<span class="token punctuation">;</span></span>
<span class="line">        fiber<span class="token punctuation">.</span>lanes <span class="token operator">=</span> newLanes<span class="token punctuation">;</span></span>
<span class="line">        fiber<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> newState<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getStateFromUpdate</span><span class="token punctuation">(</span><span class="token parameter">update<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> payload <span class="token operator">=</span> update<span class="token punctuation">.</span>payload<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> partialState <span class="token operator">=</span> <span class="token function">payload</span><span class="token punctuation">(</span>prevState<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> partialState<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    initializeUpdateQueue<span class="token punctuation">,</span></span>
<span class="line">    enqueueUpdate<span class="token punctuation">,</span></span>
<span class="line">    processUpdateQueue</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-1-4-3-use-js" tabindex="-1"><a class="header-anchor" href="#_3-1-4-3-use-js"><span>3.1.4.3 use.js</span></a></h5><p>use.js</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_4-树的遍历" tabindex="-1"><a class="header-anchor" href="#_4-树的遍历"><span>4. 树的遍历</span></a></h2><p><img src="https://static.zhufengpeixun.com/dfs_he_bfs1_1644891966511.jpg" alt=""></p><h3 id="_4-1-深度优先-dfs" tabindex="-1"><a class="header-anchor" href="#_4-1-深度优先-dfs"><span>4.1 深度优先(DFS)</span></a></h3><ul><li>深度优先搜索英文缩写为DFS即<code>Depth First Search</code></li><li>其过程简要来说是对每一个可能的分支路径深入到不能再深入为止，而且每个节点只能访问一次</li><li>应用场景 <ul><li>React虚拟DOM的构建</li><li>React的fiber树构建</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    node<span class="token punctuation">.</span>children<span class="token operator">&amp;&amp;</span>node<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">dfs</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> root <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;B&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;B1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;B2&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;C&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;C1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;C2&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">dfs</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-广度优先-bfs" tabindex="-1"><a class="header-anchor" href="#_4-2-广度优先-bfs"><span>4.2 广度优先(BFS)</span></a></h3><ul><li>宽度优先搜索算法（又称广度优先搜索），其英文全称是Breadth First Search</li><li>算法首先搜索距离为<code>k</code>的所有顶点，然后再去搜索距离为<code>k+l</code>的其他顶点</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> current<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        current<span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> current<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">let</span> root <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;B&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;B1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;B2&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;C&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;C1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;C2&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token function">bfs</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-栈" tabindex="-1"><a class="header-anchor" href="#_5-栈"><span>5. 栈</span></a></h2><ul><li>栈（stack）又名堆栈，它是一种运算受限的线性表</li><li>限定仅在表尾进行插入和删除操作的线性表，这一端被称为栈顶，相对地，把另一端称为栈底</li><li>向一个栈插入新元素又称作进栈、入栈或压栈，它是把新元素放到栈顶元素的上面，使之成为新的栈顶元素</li><li>从一个栈删除元素又称作出栈或退栈，它是把栈顶元素删除掉，使其相邻的元素成为新的栈顶元素</li></ul><h3 id="_5-1-栈代码" tabindex="-1"><a class="header-anchor" href="#_5-1-栈代码"><span>5.1 栈代码</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">Stack</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>top<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">.</span>top<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>top<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stack.size()&#39;</span><span class="token punctuation">,</span> stack<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stack.peek&#39;</span><span class="token punctuation">,</span> stack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stack.pop()&#39;</span><span class="token punctuation">,</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stack.peek()&#39;</span><span class="token punctuation">,</span> stack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;4&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stack.peek&#39;</span><span class="token punctuation">,</span> stack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">stack<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stack.size&#39;</span><span class="token punctuation">,</span> stack<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;5&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;stack.peek&#39;</span><span class="token punctuation">,</span> stack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-应用场景" tabindex="-1"><a class="header-anchor" href="#_5-2-应用场景"><span>5.2 应用场景</span></a></h3><h4 id="_5-2-1-app-js" tabindex="-1"><a class="header-anchor" href="#_5-2-1-app-js"><span>5.2.1 App.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> NumberContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token operator">&lt;</span>NumberContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;A&#39;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>NumberContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">v1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">                    <span class="token operator">&lt;</span>NumberContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;B&#39;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>NumberContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">v2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">                                <span class="token operator">&lt;</span>NumberContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;C&#39;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>
<span class="line">                                    <span class="token operator">&lt;</span>NumberContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span></span>
<span class="line">                                        <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">v3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></span>
<span class="line">                                            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span>
<span class="line">                                                <span class="token punctuation">{</span>v1<span class="token punctuation">}</span> <span class="token punctuation">{</span>v2<span class="token punctuation">}</span> <span class="token punctuation">{</span>v3<span class="token punctuation">}</span></span>
<span class="line">                                            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                                        <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                                    <span class="token operator">&lt;</span><span class="token operator">/</span>NumberContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span></span>
<span class="line">                                <span class="token operator">&lt;</span><span class="token operator">/</span>NumberContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span></span>
<span class="line">                            <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token operator">/</span>NumberContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>NumberContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>NumberContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>NumberContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-2-reactfiberstack-js" tabindex="-1"><a class="header-anchor" href="#_5-2-2-reactfiberstack-js"><span>5.2.2 ReactFiberStack.js</span></a></h4><p>src\\react\\packages\\react-reconciler\\src\\ReactFiberStack.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> valueStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">createCursor</span><span class="token punctuation">(</span><span class="token parameter">defaultValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">current</span><span class="token operator">:</span> defaultValue<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token parameter">cursor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    cursor<span class="token punctuation">.</span>current <span class="token operator">=</span> valueStack<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    valueStack<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">    index<span class="token operator">--</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">cursor<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    index<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">    valueStack<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> cursor<span class="token punctuation">.</span>current<span class="token punctuation">;</span></span>
<span class="line">    cursor<span class="token punctuation">.</span>current <span class="token operator">=</span> value<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span>  <span class="token punctuation">{</span></span>
<span class="line">    createCursor<span class="token punctuation">,</span> isEmpty<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> push</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-3-reactfibernewcontext-js" tabindex="-1"><a class="header-anchor" href="#_5-2-3-reactfibernewcontext-js"><span>5.2.3 ReactFiberNewContext.js</span></a></h4><p>src\\react\\packages\\react-reconciler\\src\\ReactFiberNewContext.js</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">pushProvider</span><span class="token punctuation">(</span><span class="token parameter">providerFiber<span class="token punctuation">,</span> nextValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> context <span class="token operator">=</span> providerFiber<span class="token punctuation">.</span>type<span class="token punctuation">.</span>_context<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">push</span><span class="token punctuation">(</span>valueCursor<span class="token punctuation">,</span> context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">,</span> providerFiber<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    context<span class="token punctuation">.</span>_currentValue <span class="token operator">=</span> nextValue<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">popProvider</span><span class="token punctuation">(</span><span class="token parameter">providerFiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> currentValue <span class="token operator">=</span> valueCursor<span class="token punctuation">.</span>current<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">pop</span><span class="token punctuation">(</span>valueCursor<span class="token punctuation">,</span> providerFiber<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> context <span class="token operator">=</span> providerFiber<span class="token punctuation">.</span>type<span class="token punctuation">.</span>_context<span class="token punctuation">;</span></span>
<span class="line">    context<span class="token punctuation">.</span>_currentValue <span class="token operator">=</span> currentValue<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span>  <span class="token punctuation">{</span></span>
<span class="line">    pushProvider<span class="token punctuation">,</span> popProvider</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-4-use-js" tabindex="-1"><a class="header-anchor" href="#_5-2-4-use-js"><span>5.2.4 use.js</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> createCursor<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> push <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./ReactFiberStack.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> pushProvider<span class="token punctuation">,</span> popProvider <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./ReactFiberNewContext.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> valueCursor <span class="token operator">=</span> <span class="token function">createCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> providerFiber <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">_context</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">pushProvider</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">,</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">.</span>type<span class="token punctuation">.</span>_context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">pushProvider</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">,</span> <span class="token string">&#39;B&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">.</span>type<span class="token punctuation">.</span>_context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">pushProvider</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">,</span> <span class="token string">&#39;C&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">.</span>type<span class="token punctuation">.</span>_context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">popProvider</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">.</span>type<span class="token punctuation">.</span>_context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">popProvider</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">.</span>type<span class="token punctuation">.</span>_context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">popProvider</span><span class="token punctuation">(</span>providerFiber<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-二进制" tabindex="-1"><a class="header-anchor" href="#_6-二进制"><span>6.二进制</span></a></h2>`,100)),s("ul",null,[n[1]||(n[1]=s("li",null,"计算机用二进制来存储数字",-1)),n[2]||(n[2]=s("li",null,"为了简化运算，二进制数都是用一个字节(8个二进制位)来简化说明",-1)),s("li",null,[l(p,{to:"/strong/unit.html"},{default:c(()=>[...n[0]||(n[0]=[u("在线工具",-1)])]),_:1})])]),n[4]||(n[4]=a(`<h3 id="_6-1-真值" tabindex="-1"><a class="header-anchor" href="#_6-1-真值"><span>6.1 真值</span></a></h3><ul><li>8位二进制数能表示的真值范围是[-2^8, +2^8]</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> + 00000001 </span>
<span class="line"> - 00000001 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-原码" tabindex="-1"><a class="header-anchor" href="#_6-2-原码"><span>6.2 原码</span></a></h3><ul><li>由于计算机只能存储0和1，不能存储正负</li><li>所以用8个二进制位的最高位来表示符号，0表示正，1表示负，用后七位来表示真值的绝对值</li><li>这种表示方法称为原码表示法，简称原码</li><li>由于<code>10000000</code>的意思是-0，这个没有意义，所有这个数字被用来表示-128</li><li>由于最高位被用来表示符号了，现在能表示的范围是[-2^7, +2^7-1]，即[-128, +127]</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> 0 0000001 </span>
<span class="line"> 1 0000001 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-反码" tabindex="-1"><a class="header-anchor" href="#_6-3-反码"><span>6.3 反码</span></a></h3><ul><li>反码是另一种表示数字的方法</li><li>其规则是整数的反码何其原码一样</li><li>负数的反码将其原码的符号位不变，其余各位按位取反</li><li>反码的表示范围是[-2^7, +2^7-1]，即[-128, +127]</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> 0 0000001 </span>
<span class="line"> 1 1111110 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-4-补码" tabindex="-1"><a class="header-anchor" href="#_6-4-补码"><span>6.4 补码</span></a></h3><ul><li>补码是为了简化运算，将减法变为加法而发明的数字表示法</li><li>其规则是整数的补码和原码一样，负数的补码是其反码末尾加1</li><li>8位补码表示的范围是[-2^7, +2^7-1]，即[-128, +127]</li><li>快速计算负数补码的规则就是，由其原码低位向高位找到第一个1，1和其低位不变，1前面的高位按位取反即可</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"> 0 0000001 </span>
<span class="line"> 1 1111111 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-5-二进制数整数" tabindex="-1"><a class="header-anchor" href="#_6-5-二进制数整数"><span>6.5 二进制数整数</span></a></h3><ul><li>只要对js中的任何数字做位运算操作系统内部都会将其转换成整形</li><li>js中的这种整形是区分正负数的</li><li>js中的整数的表示范围是[-2^31, +2^31-1]，即[-2147483648, +2147483647]</li></ul><h3 id="_6-6-非" tabindex="-1"><a class="header-anchor" href="#_6-6-非"><span>6.6 ~非</span></a></h3><ul><li>~操作符会将操作数的每一位取反，如果是1则变为0，如果是0则边为1</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token number">0b00000011</span></span>
<span class="line"><span class="token number">3</span></span>
<span class="line"><span class="token operator">~</span><span class="token number">0b00000011</span> <span class="token operator">=&gt;</span>  <span class="token number">0b11111100</span></span>
<span class="line"><span class="token operator">-</span><span class="token number">4</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">0b00000011</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token string">&#39;-4&#39;</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">0b00000011</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token string">&#39;-100&#39;</span></span>
<span class="line"></span>
<span class="line">求补码的真值</span>
<span class="line"><span class="token number">1</span> 表示负号</span>
<span class="line">剩下的 <span class="token number">1111100</span> 开始转换</span>
<span class="line"><span class="token number">1111100</span> 减<span class="token number">1</span></span>
<span class="line"><span class="token number">1111011</span> 取反</span>
<span class="line"><span class="token number">0000100</span> <span class="token number">4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-7-gethighestprioritylane" tabindex="-1"><a class="header-anchor" href="#_6-7-gethighestprioritylane"><span>6.7 getHighestPriorityLane</span></a></h3><ul><li>可以找到最右边的1</li><li>最右边的1右边的全是0，全是0取反就全是1，再加上就会全部进位到1取反的位置</li><li>最右边的1和右边的数跟原来的值是完全一样的，左边的全是反的</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 分离出所有比特位中最右边的1</span>
<span class="line"> * 分离出最高优先级的车道</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">lanes</span> 车道</span>
<span class="line"> * <span class="token keyword">@returns</span> 车道</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getHighestPriorityLane</span><span class="token punctuation">(</span><span class="token parameter">lanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> lanes <span class="token operator">&amp;</span> <span class="token operator">-</span>lanes<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">lanes<span class="token operator">=</span><span class="token number">0b00001100</span><span class="token operator">=</span><span class="token number">12</span></span>
<span class="line"><span class="token operator">-</span>lanes<span class="token operator">=</span><span class="token operator">-</span><span class="token number">12</span></span>
<span class="line"><span class="token number">1</span></span>
<span class="line"><span class="token number">0001100</span></span>
<span class="line"><span class="token number">1110011</span></span>
<span class="line"><span class="token number">1110100</span></span>
<span class="line"><span class="token number">11110100</span></span>
<span class="line"><span class="token number">00001100</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-8-左移" tabindex="-1"><a class="header-anchor" href="#_6-8-左移"><span>6.8 左移</span></a></h3><ul><li>左移的规则就是每一位都向左移动一位，末尾补0，其效果相当于×2</li><li>计算机就是用移位操作来计算乘法的</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">(</span><span class="token number">0b00000010</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="有符号右移-6-9-有符号右移-有符号右移" tabindex="-1"><a class="header-anchor" href="#有符号右移-6-9-有符号右移-有符号右移"><span>&gt; 有符号右移&quot;&gt;6.9 &gt;&gt; 有符号右移 [&gt; 有符号右移&quot;&gt; #](</span></a></h3><ul><li>有符号右移也就是移位的时候高位补的是其符号位，整数则补0，负数则补1</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0b111</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;-100&quot;</span></span>
<span class="line"><span class="token operator">-</span><span class="token number">0b111</span> <span class="token operator">-</span><span class="token number">7</span></span>
<span class="line"><span class="token number">100000111</span> 原码</span>
<span class="line"><span class="token number">111111000</span> 反码</span>
<span class="line"><span class="token number">111111001</span> 补码</span>
<span class="line"><span class="token number">111111100</span></span>
<span class="line"></span>
<span class="line"><span class="token number">1</span></span>
<span class="line"><span class="token number">111111100</span></span>
<span class="line"><span class="token number">111111011</span></span>
<span class="line"><span class="token number">000000100</span></span>
<span class="line"><span class="token number">1000000100</span></span>
<span class="line"><span class="token operator">-</span><span class="token number">100</span></span>
<span class="line"><span class="token operator">-</span><span class="token number">4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="无符号右移-6-10-无符号右移-无符号右移" tabindex="-1"><a class="header-anchor" href="#无符号右移-6-10-无符号右移-无符号右移"><span>&gt;&gt;无符号右移&quot;&gt;6.10 &gt;&gt;&gt;无符号右移 [&gt;&gt;无符号右移&quot;&gt; #](</span></a></h3><ul><li>右移的时候高位始终补0</li><li>整数和有符号右移没有区别</li><li>负数右移后会变为正数</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">(</span><span class="token number">0b111</span><span class="token operator">&gt;&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">&gt;&gt;&gt;</span> <span class="token string">&quot;11&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0b111</span><span class="token operator">&gt;&gt;&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">&gt;&gt;&gt;</span> <span class="token string">&quot;1111111111111111111111111111100&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token number">00000000000000000000000000000111</span></span>
<span class="line"><span class="token number">11111111111111111111111111111000</span></span>
<span class="line"><span class="token number">11111111111111111111111111111001</span></span>
<span class="line"><span class="token number">01111111111111111111111111111100</span></span>
<span class="line"><span class="token number">2147483644</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,30))])}const m=e(r,[["render",k]]),b=JSON.parse('{"path":"/strong/126.12.react-7.html","title":"","lang":"en-US","frontmatter":{},"git":{"updatedTime":1681290319000,"contributors":[{"name":"yutao","username":"yutao","email":"642231346@qq.com","commits":1,"url":"https://github.com/yutao"}],"changelog":[{"hash":"f5ab8c9d34991ec274f7f652439afe5b2afb6147","time":1681290319000,"email":"642231346@qq.com","author":"yutao","message":"modify"}]},"filePathRelative":"strong/126.12.react-7.md"}');export{m as comp,b as data};
