 ## 1.Vite 

* [Vite (æ³•è¯­æ„ä¸º "å¿«é€Ÿçš„"ï¼Œå‘éŸ³ /vit/)](https://cn.vitejs.dev/)æ˜¯ä¸‹ä¸€ä»£å‰ç«¯å¼€å‘ä¸æ„å»ºå·¥å…·
* ğŸ’¡ æé€Ÿçš„æœåŠ¡å¯åŠ¨ ä½¿ç”¨åŸç”Ÿ ESM æ–‡ä»¶ï¼Œæ— éœ€æ‰“åŒ…!
* âš¡ï¸ è½»é‡å¿«é€Ÿçš„çƒ­é‡è½½ æ— è®ºåº”ç”¨ç¨‹åºå¤§å°å¦‚ä½•ï¼Œéƒ½å§‹ç»ˆæå¿«çš„æ¨¡å—çƒ­é‡è½½ï¼ˆHMRï¼‰
* ğŸ› ï¸ ä¸°å¯Œçš„åŠŸèƒ½ å¯¹ TypeScriptã€JSXã€CSS ç­‰æ”¯æŒå¼€ç®±å³ç”¨ã€‚
* ğŸ“¦ ä¼˜åŒ–çš„æ„å»º å¯é€‰ â€œå¤šé¡µåº”ç”¨â€ æˆ– â€œåº“â€ æ¨¡å¼çš„é¢„é…ç½® Rollup æ„å»º
* ğŸ”© é€šç”¨çš„æ’ä»¶ åœ¨å¼€å‘å’Œæ„å»ºä¹‹é—´å…±äº« Rollup-superset æ’ä»¶æ¥å£ã€‚
* ğŸ”‘ å®Œå…¨ç±»å‹åŒ–çš„ API çµæ´»çš„ API å’Œå®Œæ•´ TypeS

 ### 1.1 å®‰è£…ä¾èµ– 

```
npm install vue  --save
npm install  @vitejs/plugin-vue  vite --save-dev
```

 ### 1.2 é…ç½®æ–‡ä»¶ 

vite.config.js

```javascript
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue()],
});
```

 ### 1.3 package.json 

package.json

```javascript
{
  "name": "vite2-prepare",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build"
  },
  "dependencies": {
    "vue": "^3.0.5"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^1.2.4",
    "vite": "^2.4.0"
  }
}
```

 ### 1.4 index.html 

index.html

```javascript
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
```

 ### 1.5 src\\main.js 

src\\main.js

```javascript
import { createApp } from "vue";
import App from "./App.vue";
 createApp(App).mount("
```

 ### 1.6 src\\App.vue 

src\\App.vue

```
<template>
  <h1>App</h1>
</template>
```

 ## 2.esbuild ä»‹ç» 

* [ESbuild](https://esbuild.github.io/api/) æ˜¯ä¸€æ¬¾åŸºäº Golang å¼€å‘çš„ä¸€æ¬¾æ‰“åŒ…å·¥å…·ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„æ‰“åŒ…å·¥å…·ï¼Œä¸»æ‰“æ€§èƒ½ä¼˜åŠ¿ï¼Œåœ¨æ„å»ºé€Ÿåº¦ä¸Šå¯ä»¥å¿« 10~100 å€

![](https://static.zhufengpeixun.com/ESbuild_1653147079963.jpeg)

 ### 2.1 å®‰è£… 

```
npm install esbuild
```

 ### 2.2 ä½¿ç”¨ 

 #### 2.2.1 main.js 

```javascript
console.log("title");
```

 #### 2.2.2 esbuild.js 

```javascript
require("esbuild").buildSync({
  entryPoints: ["main.js"],
  outfile: "out.js",
});
```

 ### 2.3 å†…å®¹ç±»å‹ 

 * [content-types](https://esbuild.github.io/content-types/
* æ¯ä¸ªå†…å®¹ç±»å‹éƒ½æœ‰ä¸€ä¸ªå…³è”çš„`åŠ è½½å™¨`ï¼Œå®ƒå‘Šè¯‰ esbuild å¦‚ä½•è§£é‡Šæ–‡ä»¶å†…å®¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸäº›æ–‡ä»¶æ‰©å±•åå·²ç»ä¸ºå®ƒä»¬é…ç½®äº†åŠ è½½å™¨ï¼Œå°½ç®¡å¯ä»¥è¦†ç›–é»˜è®¤å€¼

 #### 2.3.1 main.js 

```javascript
let title = <h1>hello</h1>;
console.log("title");
```

 #### 2.3.2 esbuild.js 

```javascript
require("esbuild").buildSync({
  entryPoints: ["main.js"],
  bundle: true,
  loader: { ".js": "jsx" },
  outfile: "out.js",
});
```

 ### 2.4 plugin 

 * [plugins](https://esbuild.github.io/plugins/
* [plugins](https://github.com/esbuild/community-plugins)
* ä¸€ä¸ª esbuild æ’ä»¶æ˜¯ä¸€ä¸ªåŒ…å« name å’Œ setup å‡½æ•°çš„å¯¹è±¡
* å®ƒä»¬ä»¥æ•°ç»„çš„å½¢å¼ä¼ é€’ç»™æ„å»º API è°ƒç”¨,`setup`å‡½æ•°åœ¨æ¯æ¬¡`BUILD API`è°ƒç”¨æ—¶éƒ½ä¼šè¿è¡Œä¸€æ¬¡

 #### 2.4.1 å‘½åç©ºé—´ 

* æ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ªå…³è”çš„å‘½åç©ºé—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œesbuild åœ¨ file å‘½åç©ºé—´ä¸­è¿è¡Œï¼Œè¯¥å‘½åç©ºé—´å¯¹åº”äºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶
* ä½†æ˜¯ esbuild ä¹Ÿå¯ä»¥å¤„ç†åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šæ²¡æœ‰å¯¹åº”ä½ç½®çš„â€œè™šæ‹Ÿâ€æ¨¡å—
* æ’ä»¶å¯ç”¨äºåˆ›å»ºè™šæ‹Ÿæ¨¡å—ã€‚è™šæ‹Ÿæ¨¡å—é€šå¸¸ä½¿ç”¨å‘½åç©ºé—´è€Œä¸æ˜¯ file å°†å®ƒä»¬ä¸æ–‡ä»¶ç³»ç»Ÿæ¨¡å—åŒºåˆ†å¼€æ¥,é€šå¸¸å‘½åç©ºé—´ç‰¹å®šäºåˆ›å»ºå®ƒä»¬çš„æ’ä»¶

 #### 2.4.2 è¿‡æ»¤å™¨ 

* æ¯ä¸ªå›è°ƒéƒ½å¿…é¡»æä¾›ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºè¿‡æ»¤å™¨ã€‚å½“è·¯å¾„ä¸å…¶è¿‡æ»¤å™¨ä¸åŒ¹é…æ—¶ï¼Œesbuild ä½¿ç”¨å®ƒæ¥è·³è¿‡è°ƒç”¨å›è°ƒ
* å‘½åç©ºé—´ä¹Ÿå¯ç”¨äºè¿‡æ»¤ã€‚å›è°ƒå¿…é¡»æä¾›è¿‡æ»¤æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©æä¾›å‘½åç©ºé—´ä»¥è¿›ä¸€æ­¥é™åˆ¶åŒ¹é…çš„è·¯å¾„

 #### 2.4.3 Resolve å›è°ƒ 

* ä½¿ç”¨æ·»åŠ çš„å›è°ƒ onResolve å°†åœ¨ esbuild æ„å»ºçš„æ¯ä¸ªæ¨¡å—ä¸­çš„æ¯ä¸ªå¯¼å…¥è·¯å¾„ä¸Šè¿è¡Œ
* å›è°ƒå¯ä»¥è‡ªå®šä¹‰ esbuild å¦‚ä½•è¿›è¡Œè·¯å¾„è§£æã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥æ‹¦æˆªå¯¼å…¥è·¯å¾„å¹¶å°†å®ƒä»¬é‡å®šå‘åˆ°å…¶ä»–åœ°æ–¹ã€‚å®ƒè¿˜å¯ä»¥å°†è·¯å¾„æ ‡è®°ä¸ºå¤–éƒ¨
* å›è°ƒå¯ä»¥è¿”å›è€Œä¸æä¾›å°†è·¯å¾„è§£æçš„è´£ä»»ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå›è°ƒçš„è·¯å¾„ã€‚å¯¹äºç»™å®šçš„å¯¼å…¥è·¯å¾„ï¼ŒonResolve æ‰€æœ‰æ’ä»¶çš„æ‰€æœ‰å›è°ƒéƒ½å°†æŒ‰ç…§å®ƒä»¬æ³¨å†Œçš„é¡ºåºè¿è¡Œï¼Œç›´åˆ°æœ‰äººè´Ÿè´£è·¯å¾„è§£æã€‚å¦‚æœæ²¡æœ‰å›è°ƒè¿”å›è·¯å¾„ï¼Œesbuild å°†è¿è¡Œå…¶é»˜è®¤è·¯å¾„è§£æé€»è¾‘

 #### 2.4.4 Resolve å‚æ•° 

* å½“ esbuild è°ƒç”¨ç”± æ³¨å†Œçš„å›è°ƒæ—¶ onResolveï¼Œå®ƒå°†ä¸ºè¿™äº›å‚æ•°æä¾›æœ‰å…³å¯¼å…¥è·¯å¾„çš„ä¿¡æ¯ï¼š
* path è¿™æ˜¯æ¥è‡ªåº•å±‚æ¨¡å—æºä»£ç çš„é€å­—æœªè§£æè·¯å¾„
* namespace è¿™æ˜¯åŒ…å«è¦è§£æçš„æ­¤å¯¼å…¥çš„æ¨¡å—çš„åç§°ç©ºé—´

 #### 2.4.5 onLoad å›è°ƒ 

* onLoad å°†ä¸ºæ¯ä¸ªæœªæ ‡è®°ä¸ºå¤–éƒ¨çš„å”¯ä¸€è·¯å¾„/å‘½åç©ºé—´å¯¹è¿è¡Œæ·»åŠ çš„å›è°ƒ
* å®ƒçš„å·¥ä½œæ˜¯è¿”å›æ¨¡å—çš„å†…å®¹å¹¶å‘Šè¯‰ esbuild å¦‚ä½•è§£é‡Šå®ƒ
* å›è°ƒå¯ä»¥åœ¨ä¸æä¾›æ¨¡å—å†…å®¹çš„æƒ…å†µä¸‹è¿”å›ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŠ è½½æ¨¡å—çš„è´£ä»»è¢«ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ³¨å†Œçš„å›è°ƒã€‚å¯¹äºç»™å®šçš„æ¨¡å—ï¼ŒonLoad æ‰€æœ‰æ’ä»¶çš„æ‰€æœ‰å›è°ƒéƒ½å°†æŒ‰ç…§å®ƒä»¬æ³¨å†Œçš„é¡ºåºè¿è¡Œï¼Œç›´åˆ°æœ‰äººè´Ÿè´£åŠ è½½æ¨¡å—ã€‚å¦‚æœæ²¡æœ‰å›è°ƒè¿”å›æ¨¡å—çš„å†…å®¹ï¼Œesbuild å°†è¿è¡Œå…¶é»˜è®¤çš„æ¨¡å—åŠ è½½é€»è¾‘

 #### 2.4.6 onLoad é€‰é¡¹ 

* filter æ¯ä¸ªå›è°ƒéƒ½å¿…é¡»æä¾›ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚å½“è·¯å¾„ä¸æ­¤è¿‡æ»¤å™¨ä¸åŒ¹é…æ—¶ï¼Œå°†è·³è¿‡æ³¨å†Œçš„å›è°ƒ
* namespace è¿™æ˜¯å¯é€‰çš„ã€‚å¦‚æœæä¾›ï¼Œå›è°ƒä»…åœ¨æä¾›çš„å‘½åç©ºé—´ä¸­çš„æ¨¡å—å†…çš„è·¯å¾„ä¸Šè¿è¡Œ

 #### 2.4.7 load ç»“æœ 

* contents å°†æ­¤è®¾ç½®ä¸ºå­—ç¬¦ä¸²ä»¥æŒ‡å®šæ¨¡å—çš„å†…å®¹ã€‚å¦‚æœè®¾ç½®äº†æ­¤é¡¹ï¼Œåˆ™ä¸ä¼šé’ˆå¯¹æ­¤å·²è§£æè·¯å¾„è¿è¡Œæ›´å¤šåŠ è½½å›è°ƒã€‚å¦‚æœæœªè®¾ç½®ï¼Œesbuild å°†ç»§ç»­è¿è¡Œåœ¨å½“å‰å›è°ƒä¹‹åæ³¨å†Œçš„åŠ è½½å›è°ƒã€‚ç„¶åï¼Œå¦‚æœå†…å®¹ä»æœªè®¾ç½®ï¼Œå¦‚æœè§£æçš„è·¯å¾„åœ¨ file å‘½åç©ºé—´ä¸­ï¼Œesbuild å°†é»˜è®¤ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½å†…å®¹
* loader è¿™å‘Šè¯‰ esbuild å¦‚ä½•è§£é‡Šå†…å®¹ã€‚ä¾‹å¦‚ï¼Œjs åŠ è½½å™¨å°†å†…å®¹è§£é‡Šä¸º JavaScriptï¼Œcss åŠ è½½å™¨å°†å†…å®¹è§£é‡Šä¸º CSSã€‚js å¦‚æœæœªæŒ‡å®šï¼Œåˆ™åŠ è½½ç¨‹åºé»˜è®¤ä¸ºã€‚æœ‰å…³æ‰€æœ‰å†…ç½®åŠ è½½ç¨‹åºçš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…å†…å®¹ç±»å‹é¡µé¢ã€‚

 #### 2.4.1 entry.js 

```javascript
import { Path } from "env";
console.log(`Path is ${Path}`);
```

 #### 2.4.2 envPlugin 

```javascript
let envPlugin = {
  name: "env",
  setup(build) {
    //æ‹¦æˆªåä¸ºenvçš„å¯¼å…¥è·¯å¾„ï¼Œä»¥ä¾¿esbuildä¸ä¼šå°è¯•å°†å®ƒä»¬æ˜ å°„åˆ°æ–‡ä»¶ç³»ç»Ÿä½ç½®
    //ç”¨env-nsåç§°ç©ºé—´æ ‡è®°å®ƒä»¬ï¼Œä»¥ä¾¿ä¸ºè¯¥æ’ä»¶ä¿ç•™å®ƒä»¬
    build.onResolve({ filter: /^env$/ }, (args) => ({
      path: args.path,
      namespace: "env-ns",
    }));
    //åŠ è½½å¸¦æœ‰env-nsåç§°ç©ºé—´æ ‡è®°çš„è·¯å¾„ï¼Œå®ƒä»¬çš„è¡Œä¸ºå°±åƒæŒ‡å‘åŒ…å«ç¯å¢ƒå˜é‡çš„JSONæ–‡ä»¶ä¸€æ ·
    build.onLoad({ filter: /.*/, namespace: "env-ns" }, () => ({
      contents: JSON.stringify(process.env),
      loader: "json",
    }));
  },
};

require("esbuild")
  .build({
    entryPoints: ["entry.js"],
    bundle: true,
    outfile: "out.js",
    plugins: [envPlugin],
  })
  .catch(() => process.exit(1));
```