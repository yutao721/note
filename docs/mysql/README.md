# q

## sd

### 一、 基础与核心概念

1. **数据库与表**
    * **数据库 (Database)**：存储数据的集合，是表的容器。
    * **表 (Table)**：结构化的数据文件，由行和列组成，类似于 Excel 表格。
    * **行 (Row)**：表中的一条记录，也称为元组。
    * **列 (Column)**：表中的一个字段，定义了数据的类型，也称为属性。

2. **数据类型**
    * **数值类型**：`INT`, `BIGINT`, `DECIMAL`, `FLOAT`, `DOUBLE` 等。
    * **字符串类型**：`CHAR`, `VARCHAR`, `TEXT`, `BLOB` 等。
    * **日期时间类型**：`DATE`, `TIME`, `DATETIME`, `TIMESTAMP`, `YEAR`。

3. **SQL (Structured Query Language)**
    * **DDL (Data Definition Language)**：数据定义语言，用于定义数据库对象。
        * `CREATE`：创建数据库或表。
        * `ALTER`：修改表结构。
        * `DROP`：删除数据库或表。
        * `TRUNCATE`：清空表数据，但保留表结构。
    * **DML (Data Manipulation Language)**：数据操纵语言，用于操作数据。
        * `INSERT`：插入数据。
        * `UPDATE`：更新数据。
        * `DELETE`：删除数据。
    * **DQL (Data Query Language)**：数据查询语言。
        * `SELECT`：查询数据，是 SQL 的核心。
    * **DCL (Data Control Language)**：数据控制语言，用于管理权限。
        * `GRANT`：授予权限。
        * `REVOKE`：撤销权限。
    * **TCL (Transaction Control Language)**：事务控制语言。
        * `COMMIT`：提交事务。
        * `ROLLBACK`：回滚事务。
        * `SAVEPOINT`：设置保存点。

---

### 二、 核心查询与高级查询

1. **基础查询**
    * `SELECT ... FROM ...`：基本查询。
    * `WHERE`：条件过滤。
    * `ORDER BY`：排序。
    * `LIMIT`：限制返回行数。
    * `DISTINCT`：去重。

2. **高级查询**
    * **聚合函数**：`COUNT()`, `SUM()`, `AVG()`, `MAX()`, `MIN()`。
    * `GROUP BY`：分组。
    * `HAVING`：对分组后的结果进行过滤。
    * **连接查询**
        * `INNER JOIN`：内连接。
        * `LEFT JOIN`：左外连接。
        * `RIGHT JOIN`：右外连接。
        * `FULL JOIN` (MySQL 不直接支持，可用 `UNION` 模拟)。
    * **子查询**：查询中嵌套查询。
    * **公用表表达式**：使用 `WITH` 关键字创建临时结果集，使复杂查询更清晰。

---

### 三、 索引与性能优化

1. **索引 (Index)**
    * **作用**：极大提高查询速度，但会降低写入速度。
    * **类型**：
        * **主键索引 (PRIMARY KEY)**：唯一且非空。
        * **唯一索引 (UNIQUE)**：列值唯一，但允许为 NULL。
        * **普通索引 (INDEX)**：最基本的索引。
        * **组合索引**：在多个列上创建索引。
        * **全文索引 (FULLTEXT)**：用于文本搜索。
    * **索引原理**：B+ 树结构（最常用）、哈希索引。

2. **性能优化**
    * **`EXPLAIN` 分析**：使用 `EXPLAIN` 关键字分析 SQL 执行计划，查看是否使用了索引、查询类型等。
    * **慢查询日志 (Slow Query Log)**：定位执行慢的 SQL 语句。
    * **SQL 优化技巧**：
        * 避免 `SELECT *`。
        * 在 `WHERE` 和 `ORDER BY` 的列上建立索引。
        * 避免在索引列上使用函数或计算。
        * 用 `JOIN` 替代子查询（部分场景）。
        * 小表驱动大表。
    * **数据库设计优化**：
        * 遵循三大范式，但有时为了性能会进行反范式设计。
        * 选择合适的数据类型（如用 `VARCHAR` 代替 `CHAR` 节省空间）。

---

### 四、 事务与锁

1. **事务 (Transaction)**
    * **ACID 特性**：
        * **原子性**：事务是一个不可分割的工作单位。
        * **一致性**：事务前后数据库的完整性没有被破坏。
        * **隔离性**：多个事务并发执行时，一个事务的执行不应被其他事务干扰。
        * **持久性**：一旦事务提交，其结果就是永久性的。
    * **隔离级别**（从低到高，解决并发问题能力增强，但并发性能降低）：
        * **读未提交**：可能发生脏读。
        * **读已提交**：避免脏读，但可能发生不可重复读。
        * **可重复读**：MySQL 默认级别，避免脏读和不可重复读，但可能发生幻读。
        * **串行化**：最高级别，所有事务串行执行，完全避免并发问题，但性能最低。

2. **锁 (Locking)**
    * **锁类型**：
        * **共享锁**：又称读锁，多个事务可以同时读取同一资源，但不能修改。
        * **排他锁**：又称写锁，只有一个事务能获取，其他事务不能读也不能写。
    * **锁粒度**：
        * **表级锁**：开销小，加锁快，但并发度低。
        * **行级锁**：开销大，加锁慢，但并发度高。InnoDB 存储引擎支持。
    * **乐观锁与悲观锁**：是两种并发控制的思想。

---

### 五、 存储引擎

1. **InnoDB (默认推荐)**
    * **特性**：支持事务、行级锁、外键、崩溃恢复。
    * **适用场景**：需要高可靠性、事务支持的应用，如订单系统、金融系统。

2. **MyISAM (早期默认)**
    * **特性**：不支持事务、表级锁、读取速度快。
    * **适用场景**：以读为主、插入不频繁、对事务没有要求的场景，如日志系统、内容管理系统。

3. **Memory**
    * **特性**：数据存储在内存中，速度极快，但服务重启后数据会丢失。
    * **适用场景**：需要快速访问的临时数据，如缓存。

---

### 六、 日志系统

1. **错误日志**：记录 MySQL 启动、运行或停止时出现的问题。
2. **慢查询日志**：记录执行时间超过指定阈值的 SQL 语句。
3. **二进制日志**：记录所有更改数据的语句（DDL、DML），主要用于数据恢复和主从复制。
4. **查询日志**：记录所有收到的 SQL 语句，开销较大，通常在调试时使用。
5. **重做日志**：InnoDB 特有，用于崩溃后恢复数据，保证事务的持久性。
6. **回滚日志**：InnoDB 特有，用于实现事务的原子性和多版本并发控制。

---

### 七、 主从复制与高可用

1. **主从复制**
    * **原理**：基于主服务器的二进制日志，从服务器读取并重放日志来同步数据。
    * **作用**：读写分离、数据备份、高可用性基础。

2. **高可用架构**
    * **主从切换**：当主库宕机时，将从库提升为新主库。
    * **双主模型**：两个节点互为主从。
    * **集群方案**：如 MySQL Cluster (NDB)、InnoDB Cluster 等。

---

### 八、 分库分表

* **背景**：当单表数据量过大（如超过千万）时，性能会急剧下降。
* **分库**：将数据分散到不同的数据库实例中。
* **分表**：将一张大表拆分成多张小表。
* **策略**：
  * **垂直拆分**：按业务模块拆分，将不同业务的表放到不同的库或表中。
  * **水平拆分**：按数据行拆分，如按用户 ID 的范围或哈希值进行拆分。

---

### 九、 运维与监控

1. **备份与恢复**
    * **物理备份**：直接复制数据文件，速度快（如 `xtrabackup`）。
    * **逻辑备份**：导出 SQL 文件，速度慢但更通用（如 `mysqldump`）。
2. **监控**
    * 监控 `QPS`（每秒查询数）、`TPS`（每秒事务数）、连接数、缓存命中率、磁盘 I/O 等指标。
    * 常用工具：Prometheus + Grafana、Zabbix 等。

---

### 十、 安全

1. **用户与权限管理**：合理创建用户并授予最小必要权限。
2. **数据加密**：传输层加密（SSL）、存储加密。
3. **SQL 注入防范**：在应用层使用预编译语句。

---

这个知识图谱涵盖了从入门到精通 MySQL 所需的绝大部分核心内容。学习时建议从 **基础概念** 和 **SQL 语句** 入手，然后深入 **索引与优化**，再逐步学习 **事务、锁、存储引擎** 等底层原理，最后扩展到 **高可用、分库分表** 等架构层面知识。祝你学习顺利！
