<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jiaHang的博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="专注前端技术栈分享，做一个爱折腾的前端">
    <link rel="preload" href="/note/assets/css/0.styles.725ed339.css" as="style"><link rel="preload" href="/note/assets/js/app.02190172.js" as="script"><link rel="preload" href="/note/assets/js/2.2dccd611.js" as="script"><link rel="preload" href="/note/assets/js/35.c486c7ec.js" as="script"><link rel="prefetch" href="/note/assets/js/10.a05513c9.js"><link rel="prefetch" href="/note/assets/js/11.7ceb6923.js"><link rel="prefetch" href="/note/assets/js/12.fb88bae4.js"><link rel="prefetch" href="/note/assets/js/13.4b17ba74.js"><link rel="prefetch" href="/note/assets/js/14.ce1cd100.js"><link rel="prefetch" href="/note/assets/js/15.6a480c60.js"><link rel="prefetch" href="/note/assets/js/16.6d6b8a6a.js"><link rel="prefetch" href="/note/assets/js/17.c36721ad.js"><link rel="prefetch" href="/note/assets/js/18.77bcea9f.js"><link rel="prefetch" href="/note/assets/js/19.f262839a.js"><link rel="prefetch" href="/note/assets/js/20.5b1b9830.js"><link rel="prefetch" href="/note/assets/js/21.76b74656.js"><link rel="prefetch" href="/note/assets/js/22.e663cec2.js"><link rel="prefetch" href="/note/assets/js/23.c1f1c7e7.js"><link rel="prefetch" href="/note/assets/js/24.5ddffc93.js"><link rel="prefetch" href="/note/assets/js/25.95b0061c.js"><link rel="prefetch" href="/note/assets/js/26.c4c127de.js"><link rel="prefetch" href="/note/assets/js/27.234a7f7e.js"><link rel="prefetch" href="/note/assets/js/28.3bb3b4b8.js"><link rel="prefetch" href="/note/assets/js/29.1339c108.js"><link rel="prefetch" href="/note/assets/js/3.6e8c2ef0.js"><link rel="prefetch" href="/note/assets/js/30.3235f9a2.js"><link rel="prefetch" href="/note/assets/js/31.2a4efe07.js"><link rel="prefetch" href="/note/assets/js/32.d3d3c893.js"><link rel="prefetch" href="/note/assets/js/33.eaca5eef.js"><link rel="prefetch" href="/note/assets/js/34.684f8bf3.js"><link rel="prefetch" href="/note/assets/js/36.2f90f872.js"><link rel="prefetch" href="/note/assets/js/37.92460be1.js"><link rel="prefetch" href="/note/assets/js/38.8532070d.js"><link rel="prefetch" href="/note/assets/js/39.9cc3b3d9.js"><link rel="prefetch" href="/note/assets/js/4.2b7fc900.js"><link rel="prefetch" href="/note/assets/js/40.3ec1b99e.js"><link rel="prefetch" href="/note/assets/js/41.d22f0de1.js"><link rel="prefetch" href="/note/assets/js/42.4796d96b.js"><link rel="prefetch" href="/note/assets/js/43.4c97d146.js"><link rel="prefetch" href="/note/assets/js/44.6e02569c.js"><link rel="prefetch" href="/note/assets/js/5.bb5b8508.js"><link rel="prefetch" href="/note/assets/js/6.ec170bea.js"><link rel="prefetch" href="/note/assets/js/7.12a33526.js"><link rel="prefetch" href="/note/assets/js/8.70ad78c1.js"><link rel="prefetch" href="/note/assets/js/9.b2f872fe.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.725ed339.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">jiaHang的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/note/web/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/note/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/interview/" class="nav-link">
  面试问题
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/note/web/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/note/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/interview/" class="nav-link">
  面试问题
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/web/" aria-current="page" class="sidebar-link">前端</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>rollup</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/web/rollup/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/note/web/rollup/rollupUse.html" aria-current="page" class="active sidebar-link">rollup使用教程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_1-新建工程" class="sidebar-link">1.新建工程</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_2-安装rollup" class="sidebar-link">2.安装rollup</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_3-创建rollup-config-js" class="sidebar-link">3.创建rollup.config.js</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_4-编写要打包的文件" class="sidebar-link">4.编写要打包的文件</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_5-编写package-json中的打包命令" class="sidebar-link">5.编写package.json中的打包命令</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_6-执行npm-run-build-查看文件输出结果" class="sidebar-link">6.执行npm run build 查看文件输出结果</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_7-使用打包后的文件" class="sidebar-link">7.使用打包后的文件</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_1-input" class="sidebar-link">1.input</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_2-output" class="sidebar-link">2.output</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_3-plugins" class="sidebar-link">3.plugins</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_4-external" class="sidebar-link">4.external</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_5-global" class="sidebar-link">5.global</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_1-使用babel" class="sidebar-link">1.使用Babel</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_2-node模块的引用" class="sidebar-link">2.node模块的引用</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_3-使用typescript" class="sidebar-link">3.使用typescript</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_4-压缩代码" class="sidebar-link">4.压缩代码</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_5-编译css" class="sidebar-link">5.编译css</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_6-开启本地服务器" class="sidebar-link">6.开启本地服务器</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_7-开启热更新" class="sidebar-link">7.开启热更新</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_8-区分开发环境和生产环境" class="sidebar-link">8.区分开发环境和生产环境</a></li><li class="sidebar-sub-header"><a href="/note/web/rollup/rollupUse.html#_9-相关rollup插件地址" class="sidebar-link">9.相关rollup插件地址</a></li></ul></li><li><a href="/note/web/rollup/rollupTheory.html" class="sidebar-link">rollup打包原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>调试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>rollup（下一代ES模块捆绑器）是什么请查看<a href="%5Brollupjs.org/guide/en/%5D(http://rollupjs.org/guide/en/)">官网介绍</a></p></blockquote> <blockquote><p>注意不要看Rollup.js <a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer">中文网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，因为这是别人翻译的，不是实时更新的，我之前看这个老是安装出错</p></blockquote> <p><strong>之前在网络上查找过相关的rollup使用，有些文章很概念不易理解，没有具体步骤；有些文章步骤不够详细，没有来龙去脉。所以打算整理个文章给后来者减少弯路。我保证此文真的是手把手教学，很接地气，因为我是边建工程边使用边写文章，不是某个项目里的代码，所以代码清晰，没有冗余。</strong></p> <h1 id="为什么不用webpack"><a href="#为什么不用webpack" class="header-anchor">#</a> 为什么不用webpack</h1> <p>一说到打包工具大家都想到webpack，因为我们用到的vue，react脚手架都是基于webpack的，他有各种loader，帮助我们解决各种问题，这针对于开发项目是很有效的，但是他生成代码有很多不是我们所写的逻辑代码, 比如一些他自有的模块加载功能:</p> <p><img src="https://gitee.com/yutao618/images/raw/master/images/ThirdPartyImage16196034788090.png" alt=""></p> <p>如果你要开发js库，那webpack的繁琐和打包后的文件体积就不太适用了。有需求就有工具，所以rollup的产生就是针对开发js库的。</p> <p>rollup生成代码只是把我们的代码转码成目标js并无其他,同时如果需要,他可以同时帮我们生成支持umd/commonjs/es的js代码,vue/react/angular都在用他作为打包工具。查看他们的官网代码都可以看到rollup的影子。</p> <h1 id="快速入门"><a href="#快速入门" class="header-anchor">#</a> 快速入门</h1> <h2 id="_1-新建工程"><a href="#_1-新建工程" class="header-anchor">#</a> 1.新建工程</h2> <p>新建一个空文件夹，比如rollupDemo,执行项目初始化</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> init -y
</code></pre></div><h2 id="_2-安装rollup"><a href="#_2-安装rollup" class="header-anchor">#</a> 2.安装rollup</h2> <p>用vscode打开这个工程，执行命令安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> rollup --save-dev
</code></pre></div><p>执行后我们发现项目自动生产了一些文件，并看到package包里有了rollup。</p> <h3 id="添加gitignore，忽略不用上传的文件"><a href="#添加gitignore，忽略不用上传的文件" class="header-anchor">#</a> 添加gitignore，忽略不用上传的文件</h3> <div class="language- extra-class"><pre class="language-text"><code>.DS_Store
node_modules
/dist


# local env files
.env.local
.env.*.local

# Log files
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# Editor directories and files
.idea
.vscode
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

</code></pre></div><h2 id="_3-创建rollup-config-js"><a href="#_3-创建rollup-config-js" class="header-anchor">#</a> 3.创建rollup.config.js</h2> <blockquote><p>我们也可以不用配置文件直接用cli命令来打包，但是如果添加更多的选项，这种命令行的方式就显得麻烦。为此，我们可以创建配置文件来囊括所需的选项。配置文件由 JavaScript 写成，比 CLI 更加灵活。（cli命令打包请看官网介绍）</p></blockquote> <p>配置文件是一个ES6模块，它对外暴露一个对象，这个对象包含了一些Rollup需要的一些选项。通常，我们把这个配置文件叫做<code>rollup.config.js</code>，它通常位于项目的根目录,下面是一些配置选项</p> <div class="language- extra-class"><pre class="language-text"><code>// rollup.config.js
export default {
  // 核心选项
  input,     // 必须
  external,
  plugins,

  // 额外选项
  onwarn,

  // danger zone
  acorn,
  context,
  moduleContext,
  legacy

  output: {  // 必须 (如果要输出多个，可以是一个数组)
    // 核心选项
    file,    // 必须
    format,  // 必须
    name,
    globals,

    // 额外选项
    paths,
    banner,
    footer,
    intro,
    outro,
    sourcemap,
    sourcemapFile,
    interop,

    // 高危选项
    exports,
    amd,
    indent
    strict
  },
};
</code></pre></div><p>rollup.config.js当前配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span><span class="token string">'./src/main.js'</span><span class="token punctuation">,</span><span class="token comment">//入口文件</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span>
    file<span class="token operator">:</span><span class="token string">'./dist/bundle.js'</span><span class="token punctuation">,</span><span class="token comment">//打包后的存放文件</span>
    format<span class="token operator">:</span><span class="token string">'cjs'</span><span class="token punctuation">,</span><span class="token comment">//输出格式 amd es6 iife umd cjs</span>
    name<span class="token operator">:</span><span class="token string">'bundleName'</span><span class="token comment">//如果iife,umd需要指定一个全局变量</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-编写要打包的文件"><a href="#_4-编写要打包的文件" class="header-anchor">#</a> 4.编写要打包的文件</h2> <h3 id="_1-新建src文件夹，并新建main-js-应用程序入口"><a href="#_1-新建src文件夹，并新建main-js-应用程序入口" class="header-anchor">#</a> 1.新建src文件夹，并新建main.js(应用程序入口)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/myModole'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-新建modules文件夹（代表模块文件）"><a href="#_2-新建modules文件夹（代表模块文件）" class="header-anchor">#</a> 2.新建modules文件夹（代表模块文件）</h3> <blockquote><p>modules的作用的区分模块和主入口，modules中可根据你自己的js库设计文件目录结构。</p></blockquote> <p>modules/myModole 文件内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'jiaHang'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span>

</code></pre></div><h2 id="_5-编写package-json中的打包命令"><a href="#_5-编写package-json中的打包命令" class="header-anchor">#</a> 5.编写package.json中的打包命令</h2> <p>在package.json中加一条script语句</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollupDemo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup --config&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;rollup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.45.2&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_6-执行npm-run-build-查看文件输出结果"><a href="#_6-执行npm-run-build-查看文件输出结果" class="header-anchor">#</a> 6.执行npm run build 查看文件输出结果</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'jiaHang'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p>我们看到输出的结果十分的清晰，没有像webpack那样多余的代码，而且myMoudule中的有没有被打包过来，这就是rollup最大的亮点tree-shaking,这个我们稍后再说。</p></blockquote> <h2 id="_7-使用打包后的文件"><a href="#_7-使用打包后的文件" class="header-anchor">#</a> 7.使用打包后的文件</h2> <p>在src下面新建一个index.html,并引入打包之后的bundle.js就可以看到控制台中打印的log</p> <blockquote><p>打开这个网页后我们看到弹窗内容Hello from Rollup</p></blockquote> <h1 id="常用配置"><a href="#常用配置" class="header-anchor">#</a> 常用配置</h1> <h2 id="_1-input"><a href="#_1-input" class="header-anchor">#</a> 1.input</h2> <p>入口文件地址</p> <h2 id="_2-output"><a href="#_2-output" class="header-anchor">#</a> 2.output</h2> <div class="language- extra-class"><pre class="language-text"><code>output:{
    file:'bundle.js', // 输出文件
    format: 'cjs,  //  五种输出格式：amd /  es6 / iife / umd / cjs
    name:'A',  //当format为iife和umd时必须提供，将作为全局变量挂在window(浏览器环境)下：window.A=...
    sourcemap:true  //生成bundle.map.js文件，方便调试
}
</code></pre></div><h2 id="_3-plugins"><a href="#_3-plugins" class="header-anchor">#</a> 3.plugins</h2> <p>各种插件使用的配置</p> <h2 id="_4-external"><a href="#_4-external" class="header-anchor">#</a> 4.external</h2> <div class="language- extra-class"><pre class="language-text"><code>external:['lodash'] //告诉rollup不要将此lodash打包，而作为外部依赖
</code></pre></div><h2 id="_5-global"><a href="#_5-global" class="header-anchor">#</a> 5.global</h2> <div class="language- extra-class"><pre class="language-text"><code>global:{
    'jquery':'$' //告诉rollup 全局变量$即是jquery
}
</code></pre></div><h1 id="深入使用"><a href="#深入使用" class="header-anchor">#</a> 深入使用</h1> <h2 id="_1-使用babel"><a href="#_1-使用babel" class="header-anchor">#</a> 1.使用Babel</h2> <blockquote><p>为了正确解析我们的模块并使其与旧版浏览器兼容，我们应该包括babel来编译输出。许多开发人员在他们的项目中使用 Babel ，以便他们可以使用未被浏览器和 Node.js 支持的将来版本的 JavaScript 特性。</p></blockquote> <h3 id="_1-1-安装-rollup-plugin-babel"><a href="#_1-1-安装-rollup-plugin-babel" class="header-anchor">#</a> 1.1 安装 rollup-plugin-babel</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install rollup-plugin-babel --save-dev
</code></pre></div><h3 id="_1-2-配置rollup-config-js"><a href="#_1-2-配置rollup-config-js" class="header-anchor">#</a> 1.2 配置rollup.config.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'./src/main'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'./dist/bundle.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'bundleName'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-3-添加babel配置文件-babelrc"><a href="#_1-3-添加babel配置文件-babelrc" class="header-anchor">#</a> 1.3 添加Babel配置文件.babelrc</h3> <blockquote><p>在src文件夹下添加.babelrc</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 设置为false,否则babel会在rollup有机会执行其操作之前导致我们的模块转化为commonjs</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><p>这个设置有一些不寻常的地方。</p> <blockquote><p>首先，我们设置 &quot;modules&quot;: false ，否则 Babel 会在 Rollup 有机会做处理之前，将我们的模块转成 CommonJS ，导致 Rollup 的一些处理失败。</p></blockquote> <blockquote><p>第二，我们将 .babelrc 文件放在 src 中，而不是根目录下。 这允许我们对于不同的任务有不同的 .babelrc 配置，比如像测试，如果我们以后需要的话 - 通常为单独的任务单独配置会更好。</p></blockquote> <h3 id="_1-4-安装-babel-core-和-babel-preset-env"><a href="#_1-4-安装-babel-core-和-babel-preset-env" class="header-anchor">#</a> 1.4 安装@babel/core 和 @babel/preset-env</h3> <blockquote><p>@babel/core是babel的核心，我们看到babelrc配置了 preset env，所以要安装这两个插件</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>npm install @babel/core @babel/preset-env --save-dev
</code></pre></div><p><strong>最后运行npm run build,我们看到打包后出来的文件内容经过babel转换后有es6语法变成了es5语法</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'jiaHang'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2-node模块的引用"><a href="#_2-node模块的引用" class="header-anchor">#</a> 2.node模块的引用</h2> <blockquote><p>在某些时候，您的项目可能取决于从NPM安装到node_modules文件夹中的软件包。</p></blockquote> <p>与Webpack和Browserify等其他捆绑软件不同，Rollup不知道如何``开箱即用''如何处理这些依赖项-我们需要添加一些插件配置。</p> <blockquote><p>rollup.js编译源码中的模块引用默认只支持 ES6+的模块方式import/export。然而大量的npm模块是基于CommonJS模块方式，这就导致了大量 npm 模块不能直接编译使用。所以辅助rollup.js编译支持 npm模块和CommonJS模块方式的插件就应运而生。</p></blockquote> <ul><li>rollup-plugin-node-resolve 插件允许我们加载第三方模块</li> <li>@rollup/plugin-commons 插件将它们转换为ES6版本</li></ul> <h3 id="_2-1-安装-rollup-plugin-node-resolve和-rollup-plugin-commonjs"><a href="#_2-1-安装-rollup-plugin-node-resolve和-rollup-plugin-commonjs" class="header-anchor">#</a> 2.1 安装@rollup/plugin-node-resolve和@rollup/plugin-commonjs</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install @rollup/plugin-node-resolve @rollup/plugin-commonjs --save-dev
</code></pre></div><h3 id="_2-2-配置rollup-config-js"><a href="#_2-2-配置rollup-config-js" class="header-anchor">#</a> 2.2 配置rollup.config.js</h3> <h3 id="_2-3-使用一个第三方库lodash"><a href="#_2-3-使用一个第三方库lodash" class="header-anchor">#</a> 2.3 使用一个第三方库lodash</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install lodash --save-dev
</code></pre></div><blockquote><p>打开src/main.js使用lodash</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./modules/myModole'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>执行npm run build 后我们看打包后的文件多了很多内容，这些代码就是lodash的代码，被我们打包整合进来了。</p> <h3 id="_2-4-额外补充"><a href="#_2-4-额外补充" class="header-anchor">#</a> 2.4 额外补充</h3> <blockquote><p>如果你不想第三方库被打包进来，而可以在外面引入，配合使用的话，可以在rollup.config.js中配置external</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-typescript'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'./src/main'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'./dist/bundle.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'bundleName'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>执行npm run build 后发现打包出来的内容变少了</p></blockquote> <p>​</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">_interopDefaultLegacy</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> e <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> e <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token string">'default'</span> <span class="token keyword">in</span> e <span class="token operator">?</span> e <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'default'</span><span class="token operator">:</span> e <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> ___default <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_interopDefaultLegacy</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'jiaHang'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> ___default<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p>然后页面里使用也稍作修改，script引入lodash，使用iife打包出来的文件（因为我们这里使用页面引用的方式），查看页面可以正常输出。</p></blockquote> <h2 id="_3-使用typescript"><a href="#_3-使用typescript" class="header-anchor">#</a> 3.使用typescript</h2> <blockquote><p>我们在开发大型项目时，一般都会使用typescript来增强代码的可维护性。所以在rollup中使用typescript也是必不可少的。</p></blockquote> <h3 id="_3-1-安装-rollup-plugin-typescript"><a href="#_3-1-安装-rollup-plugin-typescript" class="header-anchor">#</a> 3.1 安装@rollup/plugin-typescript</h3> <blockquote><p>我之前使用的时候用的是rollup-plugin-typescript，今天写这篇文章时发现此插件不维护更新了，模块移植到了@rollup/plugin-typescript</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>npm install @rollup/plugin-typescript --save-dev
</code></pre></div><blockquote><p>安装后发现有报错,提示我们要安装tslib和typescript</p></blockquote> <h3 id="_3-2-安装tslib-和-typescript"><a href="#_3-2-安装tslib-和-typescript" class="header-anchor">#</a> 3.2 安装tslib 和 typescript</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install tslib typescript --save-dev
</code></pre></div><h3 id="_3-3-配置rollup-config-js"><a href="#_3-3-配置rollup-config-js" class="header-anchor">#</a> 3.3 配置rollup.config.js</h3> <blockquote><p>引入使用插件</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-typescript'</span>
<span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-commonjs'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'./src/main'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'./dist/bundle.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'bundleName'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-4-配置tsconfig-json"><a href="#_3-4-配置tsconfig-json" class="header-anchor">#</a> 3.4 配置tsconfig.json</h3> <blockquote><p>如果不配置直接运行npm run build 会有提示让我们新建tsconfig配置,简单配置下tsconfig</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;es6&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;node_modules&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;src/**/*&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_3-5-编写ts文件"><a href="#_3-5-编写ts文件" class="header-anchor">#</a> 3.5 编写ts文件</h3> <p>Greeter.ts</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">{</span>
  greeter<span class="token operator">:</span> string<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>greeter <span class="token operator">=</span> message
  <span class="token punctuation">}</span>

  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Greeter
</code></pre></div><p>main.js</p> <div class="language- extra-class"><pre class="language-text"><code>import { name } from './modules/myModole';
import Greeter from './modules/Greeter';
import _ from 'lodash';

const a = new Greeter('ss');
a.greet()
console.log('hello' + name);
const arr = _.concat([1, 2], 3, 4, [5]);
console.log(arr);

</code></pre></div><h2 id="_4-压缩代码"><a href="#_4-压缩代码" class="header-anchor">#</a> 4.压缩代码</h2> <blockquote><p>为了时代码体积更小，我们都会使用代码压缩插件</p></blockquote> <h3 id="_4-1-安装rollup-plugin-terser"><a href="#_4-1-安装rollup-plugin-terser" class="header-anchor">#</a> 4.1 安装rollup-plugin-terser</h3> <blockquote><p>terser是什么，它是适用于ES6 +的JavaScript解析器，mangler和压缩器工具包</p></blockquote> <blockquote><p>我们比较熟悉的是uglify，因为我们在webpack中使用过，rollup中也有rollup-plugin-uglify插件</p></blockquote> <p><img src="https://gitee.com/yutao618/images/raw/master/images/ThirdPartyImage161960347880930.png" alt=""></p> <blockquote><p>我们看到 注意：uglify-js只能翻译es5语法。如果要转译es6+语法，请改用terser</p></blockquote> <blockquote><p>所以我们使用rollup-plugin-terser</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>npm install rollup-plugin-terser --save-dev
</code></pre></div><h3 id="_4-2-配置rollup-config-js"><a href="#_4-2-配置rollup-config-js" class="header-anchor">#</a> 4.2 配置rollup.config.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-typescript'</span>
<span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-commonjs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'./src/main'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'./dist/bundle.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'bundleName'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-编译css"><a href="#_5-编译css" class="header-anchor">#</a> 5.编译css</h2> <blockquote><p>开发项目我们用webpack，开发js类库，rollup比webpack强。开发js类库一般是不写css，如果你要写大量的css，那可能你开发的是项目，优先选择webpack，webpack里也有开发library的配置。</p></blockquote> <blockquote><p>如果你的js类库里还是必不可少要写些css的话，rollup也是有插件编译css的</p></blockquote> <h3 id="_5-1-安装rollup-plugin-postcss"><a href="#_5-1-安装rollup-plugin-postcss" class="header-anchor">#</a> 5.1 安装rollup-plugin-postcss</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install rollup-plugin-postcss --save-dev
</code></pre></div><h3 id="_5-2-配置rollup-config-js"><a href="#_5-2-配置rollup-config-js" class="header-anchor">#</a> 5.2 配置rollup.config.js</h3> <blockquote><p>引入postcss插件并使用，先注释掉压缩插件，让我们能看看打包出来的css会是什么样的。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>
import babel from 'rollup-plugin-babel'
import resolve from '@rollup/plugin-node-resolve'
import commonjs from '@rollup/plugin-typescript'
import typescript from '@rollup/plugin-commonjs'
import { terser } from 'rollup-plugin-terser'
import postcss from 'rollup-plugin-postcss'

export default {
  input: './src/main',
  output: {
    file: './dist/bundle.js',
    format: 'cjs',
    name: 'bundleName'
  },
  plugins: [
    typescript(),
    resolve(),
    commonjs(),
    babel({
      exclude: 'node_modules/**'
    }),
    // terser(),
    postcss()
  ],
  external: ['lodash']
}

</code></pre></div><h3 id="_5-3-编写使用css"><a href="#_5-3-编写使用css" class="header-anchor">#</a> 5.3 编写使用css</h3> <blockquote><p>1.在src目录下写入style.css文件</p></blockquote> <p><img src="https://gitee.com/yutao618/images/raw/master/images/ThirdPartyImage161960347880934.png" alt=""></p> <blockquote><p>2.main.js中写入相关的css使用代码</p></blockquote> <p><img src="https://gitee.com/yutao618/images/raw/master/images/ThirdPartyImage161960347880935.png" alt=""></p> <blockquote><p>3.执行npm run build 查看打包后的文件内容。我们看到css通过这块代码动态引入了</p></blockquote> <p><img src="https://gitee.com/yutao618/images/raw/master/images/ThirdPartyImage161960347880936.png" alt=""></p> <blockquote><p>4.打开页面查看html代码</p></blockquote> <p><img src="https://gitee.com/yutao618/images/raw/master/images/ThirdPartyImage161960347880937.png" alt=""></p> <blockquote><p>使用less等预编译也是可以的，如有需要，向我提问我再更新。</p></blockquote> <h2 id="_6-开启本地服务器"><a href="#_6-开启本地服务器" class="header-anchor">#</a> 6.开启本地服务器</h2> <blockquote><p>在实际开发过程中，我们肯定要运行代码，查看页面，这时有个本地服务器就很重要，这样可以调试代码。</p></blockquote> <h3 id="_6-1-安装rollup-plugin-serve"><a href="#_6-1-安装rollup-plugin-serve" class="header-anchor">#</a> 6.1 安装rollup-plugin-serve</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install rollup-plugin-serve --save-dev
</code></pre></div><h3 id="_6-2-配置rollup-config-js"><a href="#_6-2-配置rollup-config-js" class="header-anchor">#</a> 6.2 配置rollup.config.js</h3> <p>记得配置sourcemap: true,这样调试代码方便。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-typescript'</span>
<span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-commonjs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span>
<span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">'rollup-plugin-postcss'</span>
<span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">'rollup-plugin-serve'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'./src/main'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'./dist/bundle.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'bundleName'</span><span class="token punctuation">,</span>
    sourcemap<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      contentBase<span class="token operator">:</span> <span class="token string">'dist'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_7-开启热更新"><a href="#_7-开启热更新" class="header-anchor">#</a> 7.开启热更新</h2> <blockquote><p>现在本地服务器有了，但是每次修改代码，还要重新启动才能生效，很不方便，所以需要热更新。</p></blockquote> <h3 id="_7-1-安装rollup-plugin-livereload"><a href="#_7-1-安装rollup-plugin-livereload" class="header-anchor">#</a> 7.1 安装rollup-plugin-livereload</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install rollup-plugin-livereload --save-dev
</code></pre></div><h3 id="_7-2-配置rollup-config-js"><a href="#_7-2-配置rollup-config-js" class="header-anchor">#</a> 7.2 配置rollup.config.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-typescript'</span>
<span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-commonjs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span>
<span class="token keyword">import</span> postcss <span class="token keyword">from</span> <span class="token string">'rollup-plugin-postcss'</span>
<span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">'rollup-plugin-serve'</span>
<span class="token keyword">import</span> livereload <span class="token keyword">from</span> <span class="token string">'rollup-plugin-livereload'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'./src/main'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'./dist/bundle.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'bundleName'</span><span class="token punctuation">,</span>
    sourcemap<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">livereload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      contentBase<span class="token operator">:</span> <span class="token string">'dist'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-3增加script语句"><a href="#_7-3增加script语句" class="header-anchor">#</a> 7.3增加script语句</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollupDemo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup --config&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup --config -w&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@babel/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.13.16&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@babel/preset-env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.13.15&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@rollup/plugin-commonjs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^18.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@rollup/plugin-node-resolve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^11.2.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@rollup/plugin-typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.2.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.21&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;postcss&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.2.13&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rollup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.45.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rollup-plugin-babel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.4.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rollup-plugin-livereload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rollup-plugin-postcss&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rollup-plugin-serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;rollup-plugin-terser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tslib&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.4&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_8-区分开发环境和生产环境"><a href="#_8-区分开发环境和生产环境" class="header-anchor">#</a> 8.区分开发环境和生产环境</h2> <blockquote><p>在开发环境我们需要sourcemap开启，配置热更新和本地服务，在生产环境我们需要sourcemap关闭，不需要热更新和本地服务，需要代码压缩等，所以需要区分。</p></blockquote> <p>将rollup.config.js拆分成两个rollup.config.dev.js和rollup.config.build.js,再结合我们项目实际情况来编写配置文件。</p> <h2 id="_9-相关rollup插件地址"><a href="#_9-相关rollup插件地址" class="header-anchor">#</a> 9.相关rollup插件地址</h2> <ul><li><a href="https://github.com/rollup/awesome" target="_blank" rel="noopener noreferrer">awesome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/rollup/plugins" target="_blank" rel="noopener noreferrer">https://github.com/rollup/plugins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h1 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h1> <p>rollup基本使用差不多都是这样了，有很多插件都能解决相关配置需求，具体可以参考下文档，接下来我们就需要深入的去理解rollup的打包机制是怎么样。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/web/rollup/" class="prev router-link-active">
        目录
      </a></span> <span class="next"><a href="/note/web/rollup/rollupTheory.html">
        rollup打包原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.02190172.js" defer></script><script src="/note/assets/js/2.2dccd611.js" defer></script><script src="/note/assets/js/35.c486c7ec.js" defer></script>
  </body>
</html>
