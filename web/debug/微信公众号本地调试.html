<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>charles  代理本地调试微信公众号 | jiaHang的博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="专注前端技术栈分享，做一个爱折腾的前端">
    <link rel="preload" href="/note/assets/css/0.styles.725ed339.css" as="style"><link rel="preload" href="/note/assets/js/app.02190172.js" as="script"><link rel="preload" href="/note/assets/js/2.2dccd611.js" as="script"><link rel="preload" href="/note/assets/js/15.6a480c60.js" as="script"><link rel="prefetch" href="/note/assets/js/10.a05513c9.js"><link rel="prefetch" href="/note/assets/js/11.7ceb6923.js"><link rel="prefetch" href="/note/assets/js/12.fb88bae4.js"><link rel="prefetch" href="/note/assets/js/13.4b17ba74.js"><link rel="prefetch" href="/note/assets/js/14.ce1cd100.js"><link rel="prefetch" href="/note/assets/js/16.6d6b8a6a.js"><link rel="prefetch" href="/note/assets/js/17.c36721ad.js"><link rel="prefetch" href="/note/assets/js/18.77bcea9f.js"><link rel="prefetch" href="/note/assets/js/19.f262839a.js"><link rel="prefetch" href="/note/assets/js/20.5b1b9830.js"><link rel="prefetch" href="/note/assets/js/21.76b74656.js"><link rel="prefetch" href="/note/assets/js/22.e663cec2.js"><link rel="prefetch" href="/note/assets/js/23.c1f1c7e7.js"><link rel="prefetch" href="/note/assets/js/24.5ddffc93.js"><link rel="prefetch" href="/note/assets/js/25.95b0061c.js"><link rel="prefetch" href="/note/assets/js/26.c4c127de.js"><link rel="prefetch" href="/note/assets/js/27.234a7f7e.js"><link rel="prefetch" href="/note/assets/js/28.3bb3b4b8.js"><link rel="prefetch" href="/note/assets/js/29.1339c108.js"><link rel="prefetch" href="/note/assets/js/3.6e8c2ef0.js"><link rel="prefetch" href="/note/assets/js/30.3235f9a2.js"><link rel="prefetch" href="/note/assets/js/31.2a4efe07.js"><link rel="prefetch" href="/note/assets/js/32.d3d3c893.js"><link rel="prefetch" href="/note/assets/js/33.eaca5eef.js"><link rel="prefetch" href="/note/assets/js/34.684f8bf3.js"><link rel="prefetch" href="/note/assets/js/35.c486c7ec.js"><link rel="prefetch" href="/note/assets/js/36.2f90f872.js"><link rel="prefetch" href="/note/assets/js/37.92460be1.js"><link rel="prefetch" href="/note/assets/js/38.8532070d.js"><link rel="prefetch" href="/note/assets/js/39.9cc3b3d9.js"><link rel="prefetch" href="/note/assets/js/4.2b7fc900.js"><link rel="prefetch" href="/note/assets/js/40.3ec1b99e.js"><link rel="prefetch" href="/note/assets/js/41.d22f0de1.js"><link rel="prefetch" href="/note/assets/js/42.4796d96b.js"><link rel="prefetch" href="/note/assets/js/43.4c97d146.js"><link rel="prefetch" href="/note/assets/js/44.6e02569c.js"><link rel="prefetch" href="/note/assets/js/5.bb5b8508.js"><link rel="prefetch" href="/note/assets/js/6.ec170bea.js"><link rel="prefetch" href="/note/assets/js/7.12a33526.js"><link rel="prefetch" href="/note/assets/js/8.70ad78c1.js"><link rel="prefetch" href="/note/assets/js/9.b2f872fe.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.725ed339.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">jiaHang的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/note/web/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/note/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/interview/" class="nav-link">
  面试问题
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/note/web/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/note/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/note/interview/" class="nav-link">
  面试问题
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/web/" aria-current="page" class="sidebar-link">前端</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>rollup</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>调试</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/web/debug/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/note/web/debug/微信公众号本地调试.html" class="active sidebar-link">charles代理本地调试微信公众号</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/web/debug/微信公众号本地调试.html#map-local-代理" class="sidebar-link">Map Local  代理</a></li><li class="sidebar-sub-header"><a href="/note/web/debug/微信公众号本地调试.html#map-remote-代理" class="sidebar-link">Map Remote 代理</a></li><li class="sidebar-sub-header"><a href="/note/web/debug/微信公众号本地调试.html#其他方式" class="sidebar-link">其他方式</a></li><li class="sidebar-sub-header"><a href="/note/web/debug/微信公众号本地调试.html#charles下载以及安装" class="sidebar-link">charles下载以及安装</a></li></ul></li><li><a href="/note/web/debug/微信公众号本地如何调试.html" class="sidebar-link">微信公众号本地如何调试</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="charles-代理本地调试微信公众号"><a href="#charles-代理本地调试微信公众号" class="header-anchor">#</a> charles  代理本地调试微信公众号</h1> <p>在微信内置浏览器中使用微信JS SDK，可以使用微信提供的功能，例如设置分享链接的标题和图片、调起微信支付、打开扫一扫等等。
根据官方文档，前端在使用微信的接口前要先进行配置，如下：</p> <div class="language- extra-class"><pre class="language-text"><code>wx.config({
    debug: true, // 调试模式
    appId: '', // 必填，公众号的唯一标识
    timestamp: , // 必填，生成签名的时间戳
    nonceStr: '', // 必填，生成签名的随机串
    signature: '',// 必填，签名
    jsApiList: [] // 必填，需要使用的JS接口列表
});
</code></pre></div><p>为什么要用到<code>charles</code>代理来本地调试？</p> <blockquote><p>配置信息得从后端获取，后端在计算<code>signature</code>时需要前端传入当前页面的URL。开发者要在公众平台设置JS SDK安全域名，在这个域名下才能使用微信JS SDK。也就是说调用JS SDK一共有2个条件：1. 在微信内置浏览器访问，或者在电脑端的微信开发者工具；2. 在指定域名下访问。</p></blockquote> <p>所以，只有在微信公众号中的添加的js安全域名，在可以使用使用授权，分享等JSDK。但是我们平常开发阶段，要么就是一个本地的静态 <code>Html</code> 文件，或者是使用的是一些框架通过<code>npm run dev</code>启动的一些服务，亦或者是通过其他例如<code>vscode</code>的<code>live serve</code> ,<code>http-serve</code>等工具启动的一些本地服务，这些文件路径或者本地服务ip不是公众号中配置的安全域名，在做安全校验的时候，是无法通过服务端的签名校验的，所以，必须通过代理的方式绕过安全校验，而<code>charles</code>针对这些情况都可以应对，以下几种方式都可以实现本地调试。</p> <h2 id="map-local-代理"><a href="#map-local-代理" class="header-anchor">#</a> Map Local  代理</h2> <p>是将某个网络请求重定向到本地的某个文件或者文件夹</p> <ol><li><strong>开启  <code>Windows Proxy</code> 选项</strong></li></ol> <p><img src="https://fastly.jsdelivr.net/gh/yutao721/blogImage@main/img/20230224140357.png" alt=""></p> <ol start="2"><li><p><strong>Tools &gt; Map Local &gt; 勾选 <code>Enable Map Local</code>选项</strong></p></li> <li><p><strong>填写代理信息</strong></p></li></ol> <p><img src="https://fastly.jsdelivr.net/gh/yutao721/blogImage@main/img/20230224140707.png" alt="2"></p> <p>如何填写这里的信息，用一个简单的例子来说明：假如某个页面线上的访问地址（添加了JS安全域名）是：<code>http://shop.zhuoyou.com/app_v1/lunch/index.html</code>,则配置信息如下：</p> <p><img src="https://fastly.jsdelivr.net/gh/yutao721/blogImage@main/img/20230224140720.png" alt="3"></p> <ul><li>Protocol：协议类型，https， http 或者为空，一般不填也可以。</li> <li>Host：域名（需要填写的是JS安全域名）</li> <li>Port：端口号</li> <li>Path： 路径，可以以<code>**/*</code>的形式填写</li> <li>Query：参数</li> <li>Local Path：本地所在的目录，文件夹或者文件都可以</li></ul> <ol start="4"><li><p><strong>微信开发中工具 设置代理</strong></p> <p>设置 &gt; 代理设置 &gt; 手动设置代理，填入本地 ip 或者 <code>127.0.0.1</code> 端口：8888</p> <p><code>charles</code> 默认端口是8888，如果做了修改，则保持一致即可。</p></li> <li><p><strong>访问页面</strong></p></li></ol> <p>在微信开发者工具输入地址，<code>http://shop.zhuoyou.com/app_v1/lunchApp/index.html</code> 就可以本地使用开发者工具调试公众号的开发了。</p> <p><img src="https://fastly.jsdelivr.net/gh/yutao721/blogImage@main/img/20230224140732.png" alt="4"></p> <p>也可以通过<code>charles</code>的面板工具可以看到，当访问url的时候，其实是访问的本地的文件。</p> <ol start="6"><li><strong>手机上访问</strong></li></ol> <p>在开发者工具中也只能模拟一些JSDK的一些方法，有时候需要真机上调试，就需要在手机上也设置代理</p> <ul><li>手机WIFI必须和电脑在同一个网络</li> <li>WIFI 设置代理，手动，填入电脑的ip地址：端口8888</li></ul> <p><img src="https://fastly.jsdelivr.net/gh/yutao721/blogImage@main/img/20230224140741.png" alt="5"></p> <p>然后，点击开发者工具上的预览，生成二维码，即可手机上访问。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>通过踩坑，通过链接地址的形式访问页面，有些时候很多jsApi会失败，最好已二维码的形式访问，或者链接地址收藏，通过收藏夹访问。</p></div> <h2 id="map-remote-代理"><a href="#map-remote-代理" class="header-anchor">#</a> Map Remote 代理</h2> <p>是将某个网络请求重定向到另一个网络请求。</p> <ol><li><p><strong>开启  <code>Windows Proxy</code> 选项</strong></p></li> <li><p><strong>Tools &gt; Map Remote&gt; 勾选 <code>Enable Map Remote</code>选项</strong></p></li> <li><p><strong>填写代理信息</strong></p></li></ol> <p>如何填写这里的信息，用一个简单的例子来说明：假如本地起的服务是：<code>localhost:3000</code></p> <p><img src="https://fastly.jsdelivr.net/gh/yutao721/blogImage@main/img/20230224140753.png" alt="6"></p> <ul><li>Map To：本地所起的服务，端口号也是本地服务对应的端口号</li> <li>Map From：线上地址，Protocol可以不填，只要域名命中就可以代理。根据线上实际情况配置即可</li></ul> <ol start="4"><li><strong>微信开发中工具 设置代理</strong></li></ol> <p>设置 &gt; 代理设置 &gt; 手动设置代理，填入本地 ip 或者 <code>127.0.0.1</code> 端口：8888</p> <p><code>charles</code> 默认端口是8888，如果做了修改，则保持一致即可。</p> <ol start="5"><li><strong>访问页面</strong></li></ol> <p>在微信开发者工具输入地址，<code>http://shop.zhuoyou.com/</code> 就代理到本地的<code>localhost:3000</code>的服务了,可以本地使用开发者工具调试公众号的开发了。</p> <p><img src="https://fastly.jsdelivr.net/gh/yutao721/blogImage@main/img/20230224140802.png" alt="7"></p> <p>查看<code>charles</code>工具可以看到代理已经成功。</p> <ol start="6"><li><strong>手机上访问</strong></li></ol> <p>在开发者工具中也只能模拟一些JSDK的一些方法，有时候需要真机上调试，就需要在手机上也设置代理</p> <ul><li>手机WIFI必须和电脑在同一个网络</li> <li>WIFI 设置代理，手动，填入电脑的ip地址：端口8888</li></ul> <h2 id="其他方式"><a href="#其他方式" class="header-anchor">#</a> 其他方式</h2> <p>也可以通过修改本地host文件的方式处理</p> <ol><li>修改host文件，将域名映射到127.0.0.1 IP地址</li></ol> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1 shop.zhuoyou.com
</code></pre></div><ol start="2"><li>开发者工具中 访问<code>htpp://shop.zhuoyou.com:3000</code>,如果本地服务的端口是80，则可以不填了。</li> <li>手机访问</li></ol> <p>通过上面2步，其实开发工具其实已经是可以正常访问了，不需要开发者工具设置任何代理，也不需要开启charles，但是如果手机上需要访问，则需要开启charles即可。</p> <h2 id="charles下载以及安装"><a href="#charles下载以及安装" class="header-anchor">#</a> charles下载以及安装</h2> <p><a href="https://pan.baidu.com/s/1C9Dr6Zy8WkpSeRBb9XdWrQ?pwd=4rmt" target="_blank" rel="noopener noreferrer">charles百度网盘下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li>解压charles.rar &gt; charles-proxy-4.1.4-win64.msi安装</li> <li>安装之后，再使用jar，去破解，更新lib下的jar就可以</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/web/debug/" class="prev router-link-active">
        目录
      </a></span> <span class="next"><a href="/note/web/debug/微信公众号本地如何调试.html">
        微信公众号本地如何调试
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.02190172.js" defer></script><script src="/note/assets/js/2.2dccd611.js" defer></script><script src="/note/assets/js/15.6a480c60.js" defer></script>
  </body>
</html>
